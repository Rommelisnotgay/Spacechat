{"version":3,"file":"index-25b167b2.js","sources":["../../src/App.vue","../../src/services/socket.ts","../../src/services/webrtc.ts","../../src/services/storage.ts","../../src/services/chat.ts","../../src/components/connection-card.vue","../../src/components/control-buttons.vue","../../src/components/chat-modal.vue","../../src/components/games/TicTacToe.vue","../../src/components/games/RockPaperScissors.vue","../../src/components/games/TriviaGame.vue","../../src/components/games/GameSelector.vue","../../src/components/games/GameSelector.vue","../../src/components/games-modal.vue","../../src/components/donation-modal.vue","../../src/components/ui/select.vue","../../src/components/starfield.vue","../../src/components/audio/AudioOutput.vue","../../src/views/HomeView.vue","../../src/router/index.ts","../../src/main.ts"],"sourcesContent":["<template>\n  <div class=\"app-container\">\n    <RouterView />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { RouterView } from 'vue-router'\n</script>\n\n<style>\n@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n\nbody {\n  font-family: 'Inter', sans-serif;\n  margin: 0;\n  padding: 0;\n  background-color: #3A2273; /* خلفية احتياطية */\n  min-height: 100vh;\n  color: white;\n  overflow-x: hidden;\n}\n\n.app-container {\n  background: linear-gradient(to bottom right, #4c1d95, #6d28d9, #7c3aed);\n  min-height: 100vh;\n  width: 100%;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n}\n\n/* Animations */\n.animate-pulse-slow {\n  animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n.animate-float {\n  animation: float 6s ease-in-out infinite;\n}\n\n@keyframes float {\n  0%, 100% { \n    transform: translateY(0); \n  }\n  50% { \n    transform: translateY(-10px); \n  }\n}\n\n/* Button styles */\nbutton {\n  transition: all 0.2s ease;\n}\n\nbutton:active {\n  transform: scale(0.95);\n}\n\n/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 6px;\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(76, 29, 149, 0.3);\n  border-radius: 10px;\n}\n\n::-webkit-scrollbar-thumb {\n  background: rgba(124, 58, 237, 0.6);\n  border-radius: 10px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: rgba(124, 58, 237, 0.8);\n}\n</style>\n","import { ref, onMounted, onUnmounted } from 'vue';\nimport { io, Socket } from 'socket.io-client';\n\n// Determine the API URL based on environment\nconst getApiUrl = () => {\n  // For production on Glitch, use relative URL which will use the same host\n  if (import.meta.env.PROD) {\n    return window.location.origin;\n  }\n  \n  // For development, use the configured API URL or default\n  return import.meta.env.VITE_API_URL || 'http://localhost:3000';\n};\n\n// Socket instance\nconst socket = ref<Socket | null>(null);\nconst userId = ref<string | null>(null);\nconst isConnected = ref(false);\n\n/**\n * Socket service for managing real-time connections\n */\nexport function useSocket() {\n  onMounted(() => {\n    if (!socket.value) {\n      initializeSocket();\n    }\n  });\n\n  onUnmounted(() => {\n    // Clean up socket connection when component is unmounted\n    // But don't disconnect completely - just remove listeners from this instance\n    if (socket.value) {\n      cleanupSocketListeners();\n    }\n  });\n\n  // Initialize the socket connection\n  function initializeSocket() {\n    const apiUrl = getApiUrl();\n    console.log(`Connecting to socket server at: ${apiUrl}`);\n    \n    // Connect to socket.io server\n    socket.value = io(apiUrl, {\n      autoConnect: true,\n      reconnection: true,\n      reconnectionAttempts: Infinity, // Try to reconnect forever\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000, // Max delay between reconnections\n      timeout: 20000, // Increased timeout\n      transports: ['websocket', 'polling'] // Prefer WebSocket but fallback to polling\n    });\n\n    setupSocketListeners();\n  }\n\n  // Set up all socket event listeners\n  function setupSocketListeners() {\n    if (!socket.value) return;\n\n    // Set up event listeners\n    socket.value.on('connect', () => {\n      console.log('Socket connected');\n      isConnected.value = true;\n      \n      // Get user ID from the server after connecting\n      socket.value?.emit('user:identify', {}, (id: string) => {\n        console.log('Identified with server, user ID:', id);\n        userId.value = id;\n      });\n      \n      // Request online count update\n      socket.value?.emit('get-online-count');\n    });\n\n    socket.value.on('disconnect', () => {\n      console.log('Socket disconnected');\n      isConnected.value = false;\n    });\n\n    socket.value.on('reconnect', (attemptNumber: number) => {\n      console.log(`Socket reconnected after ${attemptNumber} attempts`);\n      isConnected.value = true;\n      \n      // Re-identify with the server and refresh state\n      if (userId.value) {\n        socket.value?.emit('user:identify', { prevUserId: userId.value }, (id: string) => {\n          console.log('Re-identified with server after reconnection, user ID:', id);\n          userId.value = id;\n          \n          // Re-request online count\n          socket.value?.emit('get-online-count');\n        });\n      }\n    });\n\n    socket.value.on('reconnect_attempt', (attemptNumber: number) => {\n      console.log(`Socket reconnection attempt ${attemptNumber}`);\n    });\n\n    socket.value.on('reconnect_error', (error: Error) => {\n      console.error('Socket reconnection error:', error);\n    });\n\n    socket.value.on('reconnect_failed', () => {\n      console.error('Socket reconnection failed');\n      \n      // Try to initialize socket again after a delay\n      setTimeout(() => {\n        if (!isConnected.value) {\n          console.log('Attempting to reinitialize socket connection...');\n          cleanupSocketListeners();\n          initializeSocket();\n        }\n      }, 5000);\n    });\n\n    socket.value.on('error', (error: Error) => {\n      console.error('Socket error:', error);\n    });\n    \n    // Handle user ID from server\n    socket.value.on('user-id', (id: string) => {\n      console.log('Received user ID from server:', id);\n      userId.value = id;\n    });\n  }\n\n  // Clean up all socket listeners\n  function cleanupSocketListeners() {\n    if (!socket.value) return;\n    \n    socket.value.off('connect');\n    socket.value.off('disconnect');\n    socket.value.off('reconnect');\n    socket.value.off('reconnect_attempt');\n    socket.value.off('reconnect_error');\n    socket.value.off('reconnect_failed');\n    socket.value.off('error');\n    socket.value.off('user-id');\n  }\n\n  // Force reconnection\n  function reconnect() {\n    if (socket.value) {\n      console.log('Forcing socket reconnection...');\n      socket.value.disconnect();\n      socket.value.connect();\n    } else {\n      initializeSocket();\n    }\n  }\n\n  return { \n    socket, \n    isConnected, \n    userId,\n    reconnect \n  };\n}\n","import { ref, onUnmounted, shallowRef, watch, computed } from 'vue';\nimport { useSocket } from './socket';\nimport { Socket } from 'socket.io-client';\n\ninterface ConnectionPreferences {\n  vibe?: string;\n  language?: string;\n  preferSameLanguage?: boolean;\n}\n\n// Create a more complete configuration with TURN servers for better compatibility\nconst rtcConfiguration: RTCConfiguration = {\n  iceServers: [\n    // TURN servers first for better NAT traversal\n    {\n      urls: [\n        'turn:relay.metered.ca:443?transport=tcp',\n        'turn:relay.metered.ca:443',\n        'turn:relay.metered.ca:80'\n      ],\n      username: 'e7d68233d99b711f726f5f4d',\n      credential: 'tYJEzRe2K5L7A0kO'\n    },\n    {\n      urls: [\n        'turn:openrelay.metered.ca:443?transport=tcp',\n        'turn:openrelay.metered.ca:443', \n        'turn:openrelay.metered.ca:80'\n      ],\n      username: 'openrelayproject',\n      credential: 'openrelayproject'\n    },\n    {\n      urls: [\n        'turn:turn.anyfirewall.com:443?transport=tcp'\n      ],\n      username: 'webrtc',\n      credential: 'webrtc'\n    },\n    // STUN servers last\n    { urls: 'stun:stun.l.google.com:19302' },\n    { urls: 'stun:stun1.l.google.com:19302' }\n  ],\n  iceCandidatePoolSize: 10,\n  iceTransportPolicy: 'all',\n  bundlePolicy: 'max-bundle',\n  rtcpMuxPolicy: 'require'\n};\n\n// Singleton instances for WebRTC to ensure persistence across component lifecycles\nlet globalPeerConnection: RTCPeerConnection | null = null;\nlet globalLocalStream: MediaStream | null = null;\nlet globalRemoteStream: MediaStream | null = null;\nconst globalConnectionState = ref<string>('new');\nconst globalIsAudioMuted = ref<boolean>(false);\nconst globalPartnerId = ref<string | null>(null);\n\n// Add debug flag\nconst DEBUG = true;\n\n// Debugging info storage\nlet lastConnectionError: string = '';\nlet failureReason: string = '';\nlet peerConnectionStats: any = null;\n\n// Adding variables to control the connection\nlet isNegotiating = false; // Prevent offer/answer overlap\nlet isRestartingIce = false; // Control ICE restart\nlet connectionRetryCount = 0; // Number of connection retry attempts\nconst MAX_CONNECTION_RETRIES = 10; // Increased number of attempts\nlet pendingCandidates: RTCIceCandidate[] = []; // List of pending ICE candidates\n\n// Adding stability variables\nlet heartbeatInterval: number | null = null;\nlet trackCheckInterval: number | null = null;\nlet connectionMonitorInterval: number | null = null;\nconst HEARTBEAT_INTERVAL = 3000; // Reduced heartbeat interval\nconst TRACK_CHECK_INTERVAL = 3000; // 3 seconds\nconst CONNECTION_MONITOR_INTERVAL = 5000; // 5 seconds\nconst CONNECTION_STABILITY_THRESHOLD = 10000; // 10 seconds before considering the connection stable\n\n// Add constants for connection timeouts\nconst CONNECTION_TIMEOUT = 8000; // Reduced timeout to 8 seconds\nconst RECONNECT_DELAY = 500; // Reduced delay before reconnection\n\n// Get connection statistics\nasync function getConnectionStats(): Promise<any> {\n  if (!globalPeerConnection) {\n    return { error: 'No peer connection available' };\n  }\n  \n  try {\n    const stats: any = {};\n    const statsReport = await globalPeerConnection.getStats();\n    \n    statsReport.forEach((report: any) => {\n      if (report.type === 'transport') {\n        stats.transport = {\n          bytesReceived: report.bytesReceived,\n          bytesSent: report.bytesSent,\n          dtlsState: report.dtlsState,\n          selectedCandidatePairId: report.selectedCandidatePairId\n        };\n      } else if (report.type === 'candidate-pair' && report.selected) {\n        stats.selectedCandidatePair = {\n          localCandidateId: report.localCandidateId,\n          remoteCandidateId: report.remoteCandidateId,\n          state: report.state,\n          availableOutgoingBitrate: report.availableOutgoingBitrate\n        };\n      } else if (report.type === 'local-candidate' || report.type === 'remote-candidate') {\n        if (!stats.candidates) stats.candidates = [];\n        stats.candidates.push({\n          type: report.type,\n          id: report.id,\n          ip: report.ip,\n          port: report.port,\n          protocol: report.protocol,\n          candidateType: report.candidateType\n        });\n      } else if (report.type === 'media-source' || report.type === 'track' || report.type === 'media-playout') {\n        if (!stats.media) stats.media = [];\n        stats.media.push({\n          type: report.type,\n          id: report.id,\n          kind: report.kind,\n          audioLevel: report.audioLevel,\n          trackIdentifier: report.trackIdentifier\n        });\n      }\n    });\n    \n    return stats;\n  } catch (error) {\n    console.error('[WebRTC] Error getting stats:', error);\n    return { error: 'Failed to get stats: ' + error };\n  }\n}\n\n// Update connection statistics periodically\nfunction startStatsCollection() {\n  // Clear any existing timer\n  stopStatsCollection();\n  \n  // Start a new timer to collect stats every 5 seconds\n  const statsTimer = setInterval(async () => {\n    if (globalPeerConnection && \n        (globalConnectionState.value === 'connected' || \n         globalConnectionState.value === 'connecting')) {\n      peerConnectionStats = await getConnectionStats();\n      if (DEBUG) console.log('[WebRTC] Connection stats:', peerConnectionStats);\n    } else {\n      stopStatsCollection();\n    }\n  }, 5000);\n  \n  // Store the timer ID globally\n  (window as any).__webrtcStatsTimer = statsTimer;\n}\n\n// Stop stats collection\nfunction stopStatsCollection() {\n  const timer = (window as any).__webrtcStatsTimer;\n  if (timer) {\n    clearInterval(timer);\n    (window as any).__webrtcStatsTimer = null;\n  }\n}\n\n// Diagnose connection issues\nfunction diagnoseConnectionIssues(): string {\n  if (!globalPeerConnection) {\n    return 'No peer connection has been established.';\n  }\n  \n  // Check for specific issues\n  if (failureReason) {\n    return `Connection failed: ${failureReason}`;\n  }\n  \n  if (lastConnectionError) {\n    return `Last error: ${lastConnectionError}`;\n  }\n  \n  if (!globalLocalStream || globalLocalStream.getAudioTracks().length === 0) {\n    return 'No local audio tracks available. Microphone may not be accessible.';\n  }\n  \n  if (!globalRemoteStream || globalRemoteStream.getAudioTracks().length === 0) {\n    return 'No remote audio tracks received. Partner may not have microphone access.';\n  }\n  \n  const state = globalPeerConnection.connectionState || globalPeerConnection.iceConnectionState;\n  \n  switch (state) {\n    case 'new':\n      return 'Connection is being set up but has not started yet.';\n    case 'connecting':\n      return 'Connection is in progress. This may take time depending on network conditions.';\n    case 'connected':\n      if (peerConnectionStats?.selectedCandidatePair?.state !== 'succeeded') {\n        return 'Connected but ICE negotiation not complete. Audio may be delayed.';\n      }\n      return 'Connection appears to be working. If no audio, check browser audio settings.';\n    case 'disconnected':\n      return 'Connection temporarily disconnected. This may resolve itself.';\n    case 'failed':\n      return 'Connection failed. Likely causes: firewall, VPN, or network issues.';\n    case 'closed':\n      return 'Connection was closed.';\n    default:\n      return `Unknown connection state: ${state}`;\n  }\n}\n\n// متغير عام لتخزين إعدادات الاتصال الحالية\nlet currentRtcConfig: RTCConfiguration = {\n  iceTransportPolicy: 'all', \n  iceCandidatePoolSize: 10,\n  iceServers: [\n    // خوادم TURN مجانية - وضعها أولاً لإعطائها الأولوية\n    {\n      urls: [\n        'turn:openrelay.metered.ca:80',\n        'turn:openrelay.metered.ca:443',\n        'turn:openrelay.metered.ca:443?transport=tcp'\n      ],\n      username: 'openrelayproject',\n      credential: 'openrelayproject'\n    },\n    // خوادم TURN مجانية أخرى\n    {\n      urls: [\n        'turn:relay.metered.ca:80',\n        'turn:relay.metered.ca:443'\n      ],\n      username: 'e7d68233d99b711f726f5f4d',\n      credential: 'tYJEzRe2K5L7A0kO'\n    },\n    // خوادم TURN مجانية إضافية\n    {\n      urls: [\n        'turn:turn.anyfirewall.com:443?transport=tcp'\n      ],\n      username: 'webrtc',\n      credential: 'webrtc'\n    },\n    // خوادم STUN - بعد خوادم TURN\n    { \n      urls: [\n        'stun:stun.l.google.com:19302',\n        'stun:stun1.l.google.com:19302',\n        'stun:stun2.l.google.com:19302',\n        'stun:stun3.l.google.com:19302',\n        'stun:stun4.l.google.com:19302'\n      ]\n    }\n  ],\n  bundlePolicy: 'max-bundle',\n  rtcpMuxPolicy: 'require'\n};\n\n// إعدادات خوادم STUN فقط للاتصالات السريعة\nconst fastRtcConfiguration: RTCConfiguration = {\n  iceTransportPolicy: 'all',\n  iceCandidatePoolSize: 10,\n  iceServers: [\n    {\n      urls: [\n        'stun:stun.l.google.com:19302',\n        'stun:stun1.l.google.com:19302',\n        'stun:stun2.l.google.com:19302',\n        'stun:stun3.l.google.com:19302',\n        'stun:stun4.l.google.com:19302'\n      ]\n    }\n  ],\n  bundlePolicy: 'max-bundle',\n  rtcpMuxPolicy: 'require'\n};\n\n// إعدادات TURN فقط لحالات الشبكات المحمية - الآن مع خوادم TURN المجانية فقط\nconst turnOnlyRtcConfiguration: RTCConfiguration = {\n  iceTransportPolicy: 'relay', // إجبار استخدام خوادم TURN فقط\n  iceCandidatePoolSize: 10,\n  iceServers: [\n    // خوادم TURN مجانية\n    {\n      urls: [\n        'turn:openrelay.metered.ca:80',\n        'turn:openrelay.metered.ca:443',\n        'turn:openrelay.metered.ca:443?transport=tcp'\n      ],\n      username: 'openrelayproject',\n      credential: 'openrelayproject'\n    },\n    // خوادم TURN إضافية للتنوع\n    {\n      urls: [\n        'turn:relay.metered.ca:80',\n        'turn:relay.metered.ca:443'\n      ],\n      username: 'e7d68233d99b711f726f5f4d',\n      credential: 'tYJEzRe2K5L7A0kO'\n    },\n    // خوادم TURN إضافية مجانية\n    {\n      urls: [\n        'turn:turn.anyfirewall.com:443?transport=tcp'\n      ],\n      username: 'webrtc',\n      credential: 'webrtc'\n    },\n    // خوادم TURN إضافية\n    {\n      urls: [\n        'turn:openrelay.metered.ca:443?transport=tcp'\n      ],\n      username: 'openrelayproject',\n      credential: 'openrelayproject'\n    }\n  ],\n  bundlePolicy: 'max-bundle',\n  rtcpMuxPolicy: 'require'\n};\n\n// إعدادات خوادم STUN/TURN مختلطة\nconst standardRtcConfiguration: RTCConfiguration = {\n  iceTransportPolicy: 'all',\n  iceCandidatePoolSize: 10,\n  iceServers: [\n    // خوادم STUN مجانية من Google\n    { \n      urls: [\n        'stun:stun.l.google.com:19302',\n        'stun:stun1.l.google.com:19302',\n        'stun:stun2.l.google.com:19302'\n      ]\n    },\n    // خوادم TURN مجانية\n    {\n      urls: [\n        'turn:openrelay.metered.ca:80',\n        'turn:openrelay.metered.ca:443',\n        'turn:openrelay.metered.ca:443?transport=tcp'\n      ],\n      username: 'openrelayproject',\n      credential: 'openrelayproject'\n    }\n  ],\n  bundlePolicy: 'max-bundle',\n  rtcpMuxPolicy: 'require'\n};\n\n/**\n * WebRTC service for audio calls\n */\nexport function useWebRTC() {\n  const { socket, userId } = useSocket();\n  \n  // Use shallow refs to the global objects\n  const peerConnection = shallowRef<RTCPeerConnection | null>(globalPeerConnection);\n  const localStream = shallowRef<MediaStream | null>(globalLocalStream);\n  const remoteStream = shallowRef<MediaStream | null>(globalRemoteStream);\n  const connectionState = globalConnectionState;\n  const isAudioMuted = globalIsAudioMuted;\n  const partnerId = globalPartnerId;\n  \n  // Audio constraints\n  const audioConstraints = ref<MediaTrackConstraints>({\n    echoCancellation: true,\n    noiseSuppression: true\n  });\n  \n  /**\n   * Initialize local media stream (microphone)\n   */\n  const initializeLocalStream = async (): Promise<MediaStream> => {\n    try {\n      if (globalLocalStream) {\n        if (DEBUG) console.log('[WebRTC] Using existing local stream');\n        \n        // Check if audio tracks are still active\n        const audioTracks = globalLocalStream.getAudioTracks();\n        if (audioTracks.length === 0 || !audioTracks[0].enabled) {\n          if (DEBUG) console.log('[WebRTC] Existing stream has no active audio tracks, requesting new stream');\n          // If no active audio tracks, get a new stream\n          globalLocalStream.getTracks().forEach(track => track.stop());\n          globalLocalStream = null;\n        } else {\n          return globalLocalStream;\n        }\n      }\n      \n      if (DEBUG) console.log('[WebRTC] Requesting access to microphone with specific constraints');\n      \n      // Try with more specific audio constraints for better quality\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n          sampleRate: 48000,\n          channelCount: 2\n        },\n        video: false\n      });\n      \n      // Double check that we got audio tracks\n      if (stream.getAudioTracks().length === 0) {\n        console.error('[WebRTC] No audio tracks found in stream');\n        throw new Error('No audio tracks available');\n      }\n      \n      if (DEBUG) {\n        console.log('[WebRTC] Local stream acquired successfully');\n        console.log('[WebRTC] Audio tracks:', stream.getAudioTracks().length);\n        const tracks = stream.getAudioTracks();\n        tracks.forEach(track => {\n          console.log(`[WebRTC] Track: ${track.label}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n          console.log('[WebRTC] Track settings:', JSON.stringify(track.getSettings()));\n        });\n      }\n      \n      // Ensure all tracks are enabled\n      stream.getTracks().forEach(track => {\n        track.enabled = true;\n      });\n      \n      globalLocalStream = stream;\n      localStream.value = stream;\n      return stream;\n    } catch (error) {\n      console.error('[WebRTC] Error accessing microphone:', error);\n      \n      // Try with simpler constraints as fallback\n      try {\n        if (DEBUG) console.log('[WebRTC] Trying fallback with simpler constraints');\n        const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });\n        \n        if (stream.getAudioTracks().length === 0) {\n          throw new Error('No audio tracks available');\n        }\n        \n        globalLocalStream = stream;\n        localStream.value = stream;\n        return stream;\n      } catch (fallbackError) {\n        console.error('[WebRTC] Fallback also failed:', fallbackError);\n        throw new Error('Could not access microphone. Please check permissions.');\n      }\n    }\n  };\n  \n  /**\n   * إنشاء اتصال RTCPeerConnection جديد مع تحسينات الاستقرار\n   */\n  const createPeerConnection = (): RTCPeerConnection => {\n    if (globalPeerConnection && globalPeerConnection.connectionState !== 'closed' && \n        globalPeerConnection.connectionState !== 'failed' && \n        globalPeerConnection.connectionState !== 'disconnected') {\n      if (DEBUG) console.log('[WebRTC] Reusing existing peer connection');\n      return globalPeerConnection;\n    }\n    \n    // البدء مباشرة بخوادم TURN لتسريع الاتصال والتغلب على مشاكل NAT\n    if (DEBUG) console.log('[WebRTC] Creating new peer connection with TURN servers');\n    \n    // إغلاق أي اتصال موجود\n    if (globalPeerConnection) {\n      closeConnection();\n    }\n    \n    // إنشاء اتصال جديد مع إعطاء الأولوية لخوادم TURN\n    const pc = new RTCPeerConnection(rtcConfiguration);\n    \n    // Create a new stream for remote audio\n    if (!globalRemoteStream) {\n      globalRemoteStream = new MediaStream();\n      remoteStream.value = globalRemoteStream;\n    }\n    \n    // Set up connection timeout\n    setupConnectionTimeout(pc);\n    \n    // Handle incoming tracks\n    pc.ontrack = (event) => {\n      if (DEBUG) console.log('[WebRTC] Track received:', event.track.kind);\n      \n      // Add the track to the remote stream\n      if (event.track.kind === 'audio') {\n        if (DEBUG) console.log('[WebRTC] Adding remote audio track to stream');\n        if (!globalRemoteStream) {\n          globalRemoteStream = new MediaStream();\n        }\n        globalRemoteStream.addTrack(event.track);\n        remoteStream.value = globalRemoteStream;\n        \n        // تفعيل المسار الصوتي\n        event.track.enabled = true;\n      }\n    };\n      \n    // Handle connection state changes\n    pc.onconnectionstatechange = () => {\n      if (DEBUG) console.log('[WebRTC] Connection state changed:', pc.connectionState);\n      \n      // مهم: لا تقم بتغيير حالة الاتصال من \"متصل\" إلى \"جاري الاتصال\" إذا كان الصوت يعمل بالفعل\n      if (pc.connectionState === 'connecting' && globalConnectionState.value === 'connected') {\n        // تحقق من وجود مسارات صوتية تعمل\n        const hasWorkingAudioTracks = globalRemoteStream && \n                                    globalRemoteStream.getAudioTracks().length > 0 &&\n                                    globalRemoteStream.getAudioTracks().some(track => track.enabled);\n        \n        if (hasWorkingAudioTracks) {\n          if (DEBUG) console.log('[WebRTC] Ignoring state change to \"connecting\" because audio is working');\n          return; // لا تغير الحالة إذا كان الصوت يعمل\n        }\n      }\n      \n      // خاص بحالة matched: لا تغير إلى connecting بعد أن نكون matched\n      if (pc.connectionState === 'connecting' && globalConnectionState.value === 'matched') {\n        if (DEBUG) console.log('[WebRTC] Still in negotiation phase, keeping matched state');\n        return; // الإبقاء على حالة matched خلال مرحلة التفاوض\n      }\n      \n      // تحديث الحالة فقط إذا لم تكن تجاهلناها أعلاه\n      globalConnectionState.value = pc.connectionState || 'new';\n      connectionState.value = pc.connectionState || 'new';\n      \n      // Handle specific states\n      if (pc.connectionState === 'connected') {\n        if (DEBUG) console.log('[WebRTC] Connection established');\n        connectionRetryCount = 0; // Reset retry count on successful connection\n        startConnectionMonitoring(); // Start monitoring connection quality\n        \n        // تأكد من وجود المسارات الصوتية وتحسين وقت استجابة الاتصال\n        setTimeout(() => {\n          // فحص المسارات وإصلاحها إذا لزم الأمر\n          checkAndFixTracks();\n          \n          // التأكد من أن الصوت يعمل قبل تحديث الحالة\n          const audioIsWorking = globalRemoteStream && \n                               globalRemoteStream.getAudioTracks().length > 0 &&\n                               globalRemoteStream.getAudioTracks().some(track => track.readyState === 'live');\n          \n          if (DEBUG) console.log(`[WebRTC] Audio tracks working: ${audioIsWorking}`);\n          \n          // تحقق مرة أخرى بعد لحظة لضمان استقرار الاتصال\n          setTimeout(() => {\n            if (pc.connectionState === 'connected') {\n              checkAndFixTracks();\n              \n              // إذا كنا في حالة matched، حدث فوراً إلى حالة connected\n              if (globalConnectionState.value === 'matched') {\n                if (DEBUG) console.log('[WebRTC] Updating state from matched to connected');\n                globalConnectionState.value = 'connected';\n                connectionState.value = 'connected';\n              }\n            }\n          }, 1000);\n        }, 300);\n        \n        // Start the heartbeat to keep the connection alive\n        startConnectionHeartbeat();\n      } else if (pc.connectionState === 'failed') {\n        failureReason = 'Connection failed';\n        \n        // Try to recover automatically\n        if (connectionRetryCount < MAX_CONNECTION_RETRIES && !isRestartingIce) {\n          connectionRetryCount++;\n          console.log(`[WebRTC] Connection failed, attempting recovery (${connectionRetryCount}/${MAX_CONNECTION_RETRIES})`);\n          attemptConnectionRecovery();\n        } else {\n          console.error('[WebRTC] Connection failed and max retries reached');\n        }\n      } else if (pc.connectionState === 'disconnected') {\n        // عند فقدان الاتصال، لا تغير الحالة فورًا إذا كان الصوت لا يزال يعمل\n        const audioStillWorking = globalRemoteStream && \n                               globalRemoteStream.getAudioTracks().length > 0 &&\n                               globalRemoteStream.getAudioTracks().some(track => track.readyState === 'live');\n        \n        if (audioStillWorking) {\n          if (DEBUG) console.log('[WebRTC] Connection reported as disconnected but audio still works, not changing state');\n          \n          // محاولة استعادة الاتصال في الخلفية بدون تغيير الحالة المرئية\n          if (!isRestartingIce && connectionRetryCount < MAX_CONNECTION_RETRIES) {\n            connectionRetryCount++;\n            console.log(`[WebRTC] Silent connection recovery (${connectionRetryCount}/${MAX_CONNECTION_RETRIES})`);\n            \n            // تأخير قصير قبل محاولة الإصلاح\n            setTimeout(() => {\n              // لنفحص مرة أخرى إذا كان الاتصال لا يزال مقطوعًا\n              if (pc.connectionState === 'disconnected' || pc.connectionState === 'failed') {\n                if (DEBUG) console.log('[WebRTC] Attempting silent recovery');\n                attemptConnectionRecovery();\n              }\n            }, 1000);\n          }\n          \n          return; // لا تغير الحالة المرئية\n        }\n        \n        // When disconnected and audio not working, wait a moment before trying to recover\n        setTimeout(() => {\n          if (pc.connectionState === 'disconnected' && !isRestartingIce && connectionRetryCount < MAX_CONNECTION_RETRIES) {\n            connectionRetryCount++;\n            console.log(`[WebRTC] Connection disconnected, attempting recovery (${connectionRetryCount}/${MAX_CONNECTION_RETRIES})`);\n            attemptConnectionRecovery();\n          }\n        }, 1000); // تقليل وقت الانتظار\n      } else if (pc.connectionState === 'closed') {\n        stopConnectionHeartbeat();\n        stopConnectionMonitoring();\n      }\n    };\n    \n    // Handle ICE connection state changes\n    pc.oniceconnectionstatechange = () => {\n      if (DEBUG) console.log('[WebRTC] ICE connection state changed:', pc.iceConnectionState);\n      \n      // Handle specific ICE states\n      if (pc.iceConnectionState === 'failed') {\n        failureReason = 'ICE connection failed';\n        if (!isRestartingIce && connectionRetryCount < MAX_CONNECTION_RETRIES) {\n          connectionRetryCount++;\n          console.log(`[WebRTC] ICE connection failed, attempting restart (${connectionRetryCount}/${MAX_CONNECTION_RETRIES})`);\n          \n          // Restart ICE\n          isRestartingIce = true;\n          \n          // تجربة إعادة تشغيل ICE بعد فترة قصيرة\n          setTimeout(async () => {\n            if (pc.connectionState !== 'closed') {\n              try {\n                if (DEBUG) console.log('[WebRTC] Attempting ICE restart');\n                \n                const offer = await pc.createOffer({ iceRestart: true });\n                await pc.setLocalDescription(offer);\n                \n                if (socket.value && partnerId.value) {\n                  socket.value.emit('voice-offer', {\n                    offer: pc.localDescription,\n                    to: partnerId.value\n                  });\n                }\n                \n                // Reset the ICE restart flag after some time\n                setTimeout(() => {\n                  isRestartingIce = false;\n                }, 5000);\n              } catch (error) {\n                console.error('[WebRTC] ICE restart failed:', error);\n                isRestartingIce = false;\n              }\n            } else {\n              isRestartingIce = false;\n            }\n          }, 1000);\n        }\n      } else if (pc.iceConnectionState === 'connected') {\n        // عند الاتصال الناجح، نتحقق من وجود مسارات صوتية\n        checkAndFixTracks();\n      }\n    };\n    \n    // Handle ICE candidate generation\n    pc.onicecandidate = (event) => {\n      if (!event.candidate) {\n        if (DEBUG) console.log('[WebRTC] ICE gathering complete');\n        return;\n      }\n      \n      if (DEBUG) console.log('[WebRTC] ICE candidate generated:', event.candidate.candidate);\n      \n      // Send the ICE candidate to the remote peer if we have a socket and partner\n      if (socket.value && partnerId.value) {\n        if (DEBUG) console.log('[WebRTC] Sending ICE candidate to partner');\n        socket.value.emit('ice-candidate', {\n          candidate: event.candidate,\n          to: partnerId.value\n        });\n      }\n    };\n    \n    // Handle ICE gathering state changes\n    pc.onicegatheringstatechange = () => {\n      if (DEBUG) console.log('[WebRTC] ICE gathering state changed:', pc.iceGatheringState);\n    };\n    \n    // Handle signaling state changes\n    pc.onsignalingstatechange = () => {\n      if (DEBUG) console.log('[WebRTC] Signaling state changed:', pc.signalingState);\n      \n      // If signaling state is stable, reset negotiating flag\n      if (pc.signalingState === 'stable') {\n        isNegotiating = false;\n      }\n    };\n    \n    // Update global reference\n    globalPeerConnection = pc;\n    peerConnection.value = pc;\n    \n    return pc;\n  };\n  \n  /**\n   * Create an offer and send it to the target peer\n   */\n  const createOffer = async (targetPartnerId: string | null): Promise<any> => {\n    // Clear any existing connection timeout\n    if ((window as any).__webrtcConnectionTimeout) {\n      clearTimeout((window as any).__webrtcConnectionTimeout);\n    }\n    \n    if (!targetPartnerId) {\n      const errorMsg = 'Cannot create offer: No target partner ID provided';\n      console.error(`[WebRTC] ${errorMsg}`);\n      lastConnectionError = errorMsg;\n      return { error: errorMsg };\n    }\n    \n    if (!socket.value) {\n      const errorMsg = 'Cannot create offer: socket not available';\n      console.error(`[WebRTC] ${errorMsg}`);\n      lastConnectionError = errorMsg;\n      return { error: errorMsg };\n    }\n    \n    // Make sure we have access to the microphone before creating an offer\n    if (!globalLocalStream) {\n      try {\n        if (DEBUG) console.log('[WebRTC] Initializing local stream before creating offer');\n        await initializeLocalStream();\n      } catch (error) {\n        console.error('[WebRTC] Failed to initialize local stream:', error);\n        lastConnectionError = `Failed to access microphone: ${error}`;\n        return { error: `Failed to access microphone: ${error}` };\n      }\n    }\n    \n    if (DEBUG) console.log(`[WebRTC] Creating offer for partner: ${targetPartnerId}`);\n    \n    // تحقق من وجود تفاوض جارٍ\n    if (isNegotiating) {\n      console.warn('[WebRTC] Negotiation already in progress, deferring new offer');\n      \n      // إعادة المحاولة بعد تأخير قصير\n      return new Promise(resolve => {\n        setTimeout(async () => {\n          if (!isNegotiating) {\n            resolve(await createOffer(targetPartnerId));\n          } else {\n            resolve({ waiting: 'Negotiation in progress' });\n          }\n        }, 1000);\n      });\n    }\n    \n    // Mark that we are negotiating\n    isNegotiating = true;\n    globalPartnerId.value = targetPartnerId;\n    partnerId.value = targetPartnerId;\n    \n    try {\n      // Store the partner ID\n      if (DEBUG) console.log(`[WebRTC] Setting partner ID: ${targetPartnerId}`);\n      \n      // إعادة تكوين WebRTC للتأكد من أن الاتصال نظيف\n      const pc = createPeerConnection();\n      \n      // إضافة المسارات المحلية\n      if (globalLocalStream) {\n        if (DEBUG) {\n          console.log('[WebRTC] Adding local tracks to connection');\n          console.log(`[WebRTC] Local stream has ${globalLocalStream.getTracks().length} tracks`);\n        }\n        \n        // إعادة تعيين المرسلين إذا كانوا موجودين بالفعل\n        const localMediaStream: MediaStream = globalLocalStream;\n        if (pc.getSenders().length > 0) {\n          if (DEBUG) console.log('[WebRTC] Replacing existing senders');\n          let i = 0;\n          localMediaStream.getTracks().forEach((track: MediaStreamTrack) => {\n            if (pc.getSenders()[i]) {\n              pc.getSenders()[i].replaceTrack(track);\n              i++;\n            } else {\n              pc.addTrack(track, localMediaStream);\n            }\n          });\n        } else {\n          // إضافة المسارات عادية إذا لم تكن موجودة\n          localMediaStream.getTracks().forEach((track: MediaStreamTrack) => {\n            pc.addTrack(track, localMediaStream);\n          });\n        }\n      } else {\n        console.error('[WebRTC] No local stream to add tracks from');\n        // حاول الحصول على تدفق محلي مرة أخرى\n        await initializeLocalStream();\n        if (globalLocalStream) {\n          const localMediaStream: MediaStream = globalLocalStream;\n          localMediaStream.getTracks().forEach((track: MediaStreamTrack) => {\n            pc.addTrack(track, localMediaStream);\n          });\n        }\n      }\n      \n      // تحديث حالة الاتصال\n      globalConnectionState.value = 'connecting';\n      connectionState.value = 'connecting';\n      \n      // إنشاء عرض مع الخيارات المناسبة\n      if (DEBUG) console.log('[WebRTC] Creating offer');\n      const offer = await pc.createOffer({\n        offerToReceiveAudio: true,\n        offerToReceiveVideo: false,\n      });\n      \n      // تعيين الوصف المحلي\n      if (DEBUG) console.log('[WebRTC] Setting local description');\n      await pc.setLocalDescription(offer);\n      \n      // إنتظار اكتمال جمع مرشحات ICE\n      if (DEBUG) console.log('[WebRTC] Waiting for ICE gathering to complete');\n      await waitForIceGatheringComplete(pc);\n      \n      // إرسال العرض إلى الشريك\n      if (socket.value && targetPartnerId) {\n        if (DEBUG) console.log('[WebRTC] Sending offer to partner');\n        \n        // للتوافق مع الخادم الحالي\n        socket.value.emit('voice-offer', {\n          offer: pc.localDescription,\n          to: targetPartnerId\n        });\n        \n        // إضافة إرسال بالتنسيق الجديد\n        socket.value.emit('webrtc-signal', {\n          type: 'offer',\n          offer: pc.localDescription,\n          to: targetPartnerId\n        });\n      }\n      \n      // إعداد مؤقت للتحقق من نجاح الاتصال\n      setupConnectionTimeout(pc);\n      \n      // بدء مراقبة الاتصال\n      startConnectionMonitoring();\n      \n      if (DEBUG) console.log('[WebRTC] Offer creation complete');\n      return { success: true };\n    } catch (error) {\n      console.error('[WebRTC] Error creating offer:', error);\n      lastConnectionError = `Error creating offer: ${error}`;\n      isNegotiating = false;\n      return { error: `Failed to create offer: ${error}` };\n    } finally {\n      // Mark that we are done negotiating\n      setTimeout(() => {\n        isNegotiating = false;\n      }, 2000);\n    }\n  };\n  \n  // Helper function to wait for ICE gathering to complete\n  const waitForIceGatheringComplete = (pc: RTCPeerConnection): Promise<void> => {\n    if (pc.iceGatheringState === 'complete') {\n      if (DEBUG) console.log('[WebRTC] ICE gathering already complete');\n      return Promise.resolve();\n    }\n    \n    return new Promise<void>((resolve) => {\n      const checkState = () => {\n        if (pc.iceGatheringState === 'complete') {\n          pc.removeEventListener('icegatheringstatechange', checkState);\n          resolve();\n        }\n      };\n      \n      pc.addEventListener('icegatheringstatechange', checkState);\n      \n      // Set a timeout to resolve anyway after a reasonable time\n      setTimeout(() => {\n        pc.removeEventListener('icegatheringstatechange', checkState);\n        if (DEBUG) console.log('[WebRTC] ICE gathering timed out, but continuing anyway');\n        resolve();\n      }, 2000);\n    });\n  };\n  \n  /**\n   * Handle an incoming WebRTC offer\n   */\n  const handleOffer = async (offer: RTCSessionDescriptionInit, targetPartnerId: string): Promise<void> => {\n    if (!socket.value) {\n      console.error('[WebRTC] Cannot handle offer: socket not available');\n      return;\n    }\n    \n    if (DEBUG) {\n      console.log('[WebRTC] Received offer from:', targetPartnerId);\n      console.log('[WebRTC] Offer SDP:', offer.sdp);\n    }\n    \n    // Store the partner ID\n    globalPartnerId.value = targetPartnerId;\n    partnerId.value = targetPartnerId;\n    \n    try {\n      // Make sure we have access to the microphone\n      if (!globalLocalStream) {\n        if (DEBUG) console.log('[WebRTC] Initializing local stream before handling offer');\n        await initializeLocalStream();\n      }\n      \n      // إعادة تكوين أو إعادة استخدام اتصال WebRTC\n      const pc = createPeerConnection();\n      \n      // إضافة المسارات المحلية إذا لم تكن موجودة\n      if (globalLocalStream) {\n        const senders = pc.getSenders();\n        if (senders.length === 0) {\n          if (DEBUG) console.log('[WebRTC] Adding local tracks to connection');\n          globalLocalStream.getTracks().forEach(track => {\n            pc.addTrack(track, globalLocalStream!);\n          });\n        } else {\n          if (DEBUG) console.log('[WebRTC] Senders already exist, not adding tracks again');\n        }\n      }\n      \n      // تحديث حالة الاتصال\n      globalConnectionState.value = 'connecting';\n      connectionState.value = 'connecting';\n      \n      // تعيين الوصف البعيد (العرض الوارد)\n      if (DEBUG) console.log('[WebRTC] Setting remote description (offer)');\n      await pc.setRemoteDescription(new RTCSessionDescription(offer));\n      \n      // إضافة أي مرشحي ICE معلقين\n      if (pendingCandidates.length > 0) {\n        if (DEBUG) console.log(`[WebRTC] Adding ${pendingCandidates.length} pending ICE candidates`);\n        for (const candidate of pendingCandidates) {\n          try {\n            await pc.addIceCandidate(candidate);\n          } catch (error) {\n            console.error('[WebRTC] Error adding pending ICE candidate:', error);\n          }\n        }\n        pendingCandidates = [];\n      }\n      \n      // إنشاء إجابة\n      if (DEBUG) console.log('[WebRTC] Creating answer');\n      const answer = await pc.createAnswer({\n        offerToReceiveAudio: true\n      });\n      \n      if (DEBUG) console.log('[WebRTC] Answer SDP:', answer.sdp);\n      \n      // تعيين الوصف المحلي (الإجابة)\n      if (DEBUG) console.log('[WebRTC] Setting local description (answer)');\n      await pc.setLocalDescription(answer);\n      \n      // انتظار جمع مرشحي ICE\n      await waitForIceGatheringComplete(pc);\n      \n      // إرسال الإجابة إلى الشريك\n      if (DEBUG) console.log('[WebRTC] Sending answer to:', targetPartnerId);\n      socket.value.emit('voice-answer', {\n        answer: pc.localDescription,\n        to: targetPartnerId\n      });\n      \n      // إرسال بالتنسيق البديل أيضا\n      socket.value.emit('webrtc-signal', {\n        type: 'answer',\n        answer: pc.localDescription,\n        to: targetPartnerId\n      });\n      \n      // تعيين مؤقت للاتصال\n      setupConnectionTimeout(pc);\n      \n      // بدء مراقبة الاتصال\n      startConnectionMonitoring();\n      \n      if (DEBUG) console.log('[WebRTC] Offer handling and answer creation complete');\n    } catch (error) {\n      console.error('[WebRTC] Error handling offer:', error);\n      lastConnectionError = `Error handling offer: ${error}`;\n      \n      // إعادة المحاولة بعد فترة في حالة الفشل\n      setTimeout(() => {\n        if (socket.value && partnerId.value) {\n          console.log('[WebRTC] Re-negotiating after offer error');\n          createOffer(partnerId.value);\n        }\n      }, 2000);\n    }\n  };\n  \n  /**\n   * Handle an incoming answer\n   */\n  const handleAnswer = async (answer: RTCSessionDescriptionInit): Promise<void> => {\n    try {\n      if (!globalPeerConnection) {\n        if (DEBUG) console.log('[WebRTC] Cannot handle answer: no peer connection available');\n        return;\n      }\n\n      // توثيق حالة الإشارة الحالية\n      const currentState = globalPeerConnection.signalingState;\n      if (DEBUG) console.log(`[WebRTC] Current signaling state before handling answer: ${currentState}`);\n\n      // التحقق من حالة الإشارة قبل تعيين الوصف البعيد\n      if (currentState === 'have-local-offer') {\n        if (DEBUG) console.log('[WebRTC] Setting remote description from answer');\n        try {\n          await globalPeerConnection.setRemoteDescription(new RTCSessionDescription(answer));\n          if (DEBUG) console.log('[WebRTC] Remote description set successfully, signaling state now: ' + globalPeerConnection.signalingState);\n        } catch (error: any) {\n          console.error('[WebRTC] Error setting remote description:', error);\n          \n          // إذا كان الخطأ متعلقًا بحالة غير صالحة، محاولة إصلاح الحالة\n          if (error.toString().includes('InvalidStateError')) {\n            console.warn('[WebRTC] Invalid state error, attempting to recover');\n            \n            // انتظار لحظة قبل المحاولة مرة أخرى\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            \n            // التحقق من الحالة مرة أخرى\n            if (globalPeerConnection.signalingState === 'have-local-offer') {\n              try {\n                if (DEBUG) console.log('[WebRTC] Retrying set remote description after delay');\n                await globalPeerConnection.setRemoteDescription(new RTCSessionDescription(answer));\n                if (DEBUG) console.log('[WebRTC] Remote description set successfully on retry');\n              } catch (retryError) {\n                console.error('[WebRTC] Final error setting remote description:', retryError);\n                // لا نرمي الخطأ هنا لتجنب إنهاء العملية\n              }\n            } else {\n              console.warn(`[WebRTC] Cannot set remote answer, wrong state: ${globalPeerConnection.signalingState}`);\n            }\n          }\n        }\n      } else {\n        console.warn(`[WebRTC] Cannot set remote description: wrong signaling state: ${currentState}`);\n        \n        // إذا كنا في حالة مستقرة، قد نكون عالجنا هذه الإجابة بالفعل أو فاتنا العرض\n        if (currentState === 'stable') {\n          if (DEBUG) console.log('[WebRTC] Already in stable state, ignoring answer');\n        } else if (currentState === 'have-remote-offer') {\n          console.warn('[WebRTC] We have a remote offer but received an answer - signaling confusion');\n          // يمكن إعادة تعيين الاتصال لتصحيح تسلسل الإشارات\n          if (connectionRetryCount < MAX_CONNECTION_RETRIES) {\n            connectionRetryCount++;\n            if (DEBUG) console.log(`[WebRTC] Resetting connection due to signaling confusion (${connectionRetryCount}/${MAX_CONNECTION_RETRIES})`);\n            closeConnection();\n            \n            // إعادة إنشاء اتصال جديد بعد فترة قصيرة\n            setTimeout(() => {\n              if (partnerId.value) {\n                createOffer(partnerId.value);\n              }\n            }, 2000);\n          }\n        }\n      }\n    } catch (error) {\n      console.error('[WebRTC] Error handling answer:', error);\n      lastConnectionError = `Error handling answer: ${error}`;\n      \n      // محاولة إصلاح الاتصال بدلاً من إغلاقه\n      if (DEBUG) console.log('[WebRTC] Attempting to recover from answer error');\n      if (connectionRetryCount < MAX_CONNECTION_RETRIES) {\n        await attemptConnectionRecovery();\n      }\n    }\n  };\n  \n  /**\n   * Toggle microphone mute state\n   */\n  const toggleMicrophone = async (): Promise<boolean> => {\n    // عكس حالة كتم الصوت الحالية\n    const shouldMute = !globalIsAudioMuted.value;\n    \n    // حالة كتم الصوت\n    if (shouldMute) {\n      if (DEBUG) console.log('[WebRTC] Muting microphone - stopping all tracks');\n      \n      // إيقاف مسارات الصوت إذا كانت موجودة\n      if (globalLocalStream) {\n        globalLocalStream.getAudioTracks().forEach(track => {\n          track.stop();\n        });\n        \n        // تصفير المتغيرات العامة\n        globalLocalStream = null;\n        localStream.value = null;\n      }\n      \n      // تحديث حالة كتم الصوت\n      globalIsAudioMuted.value = true;\n      \n      return false; // الميكروفون الآن مكتوم\n    } \n    // حالة إلغاء كتم الصوت\n    else {\n      if (DEBUG) console.log('[WebRTC] Unmuting microphone - requesting new permission');\n      \n      try {\n        // إلغاء أي stream موجود\n        if (globalLocalStream) {\n          globalLocalStream.getTracks().forEach(track => track.stop());\n          globalLocalStream = null;\n          localStream.value = null;\n        }\n        \n        // إجبار المتصفح على طلب إذن جديد\n        const stream = await navigator.mediaDevices.getUserMedia({\n          audio: {\n            echoCancellation: true,\n            noiseSuppression: true,\n            autoGainControl: true\n          },\n          video: false\n        });\n        \n        // التأكد من وجود مسارات صوتية\n        if (stream.getAudioTracks().length === 0) {\n          throw new Error('No audio tracks available');\n        }\n        \n        // تخزين التدفق الجديد\n        globalLocalStream = stream;\n        localStream.value = stream;\n        \n        // إضافة المسار الجديد للاتصال إذا كان موجودًا\n        if (globalPeerConnection && stream) {\n          try {\n            const senders = globalPeerConnection.getSenders();\n            const audioSender = senders.find(sender => sender.track && sender.track.kind === 'audio');\n            \n            if (audioSender) {\n              const audioTrack = stream.getAudioTracks()[0];\n              if (audioTrack) {\n                audioSender.replaceTrack(audioTrack);\n              }\n            } else if (stream.getAudioTracks().length > 0) {\n              stream.getAudioTracks().forEach(track => {\n                if (globalPeerConnection) {\n                  globalPeerConnection.addTrack(track, stream);\n                }\n              });\n            }\n          } catch (trackError) {\n            console.error('[WebRTC] Error adding audio tracks:', trackError);\n            // الاستمرار حتى مع حدوث خطأ في إضافة المسارات\n          }\n        }\n        \n        // تحديث حالة كتم الصوت - مهم!\n        globalIsAudioMuted.value = false;\n        \n        return true; // الميكروفون الآن غير مكتوم\n      } catch (error) {\n        console.error('[WebRTC] Error unmuting microphone:', error);\n        \n        // في حالة فشل إلغاء كتم الصوت، حاول مرة أخرى بخيارات أبسط\n        try {\n          const fallbackStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n          globalLocalStream = fallbackStream;\n          localStream.value = fallbackStream;\n          globalIsAudioMuted.value = false;\n          return true;\n        } catch (fallbackError) {\n          console.error('[WebRTC] Fallback microphone access also failed:', fallbackError);\n          return false;\n        }\n      }\n    }\n  };\n  \n  /**\n   * Close and cleanup the peer connection\n   */\n  const closeConnection = (): void => {\n    if (DEBUG) console.log('[WebRTC] Closing connection');\n    \n    // Stop all activity\n    stopConnectionHeartbeat();\n    stopConnectionMonitoring();\n    \n    if (globalPeerConnection) {\n      try {\n        // Remove all event listeners\n        globalPeerConnection.ontrack = null;\n        globalPeerConnection.onicecandidate = null;\n        globalPeerConnection.oniceconnectionstatechange = null;\n        globalPeerConnection.onicegatheringstatechange = null;\n        globalPeerConnection.onsignalingstatechange = null;\n        globalPeerConnection.onconnectionstatechange = null;\n        \n        // Stop all transceivers if supported\n        try {\n          if (globalPeerConnection.getTransceivers) {\n            globalPeerConnection.getTransceivers().forEach(transceiver => {\n              if (transceiver.stop) {\n                transceiver.stop();\n              }\n            });\n          }\n        } catch (e) {\n          // Ignore errors\n        }\n        \n        // Close the connection\n        globalPeerConnection.close();\n        if (DEBUG) console.log('[WebRTC] Peer connection closed');\n      } catch (error) {\n        console.error('[WebRTC] Error closing peer connection:', error);\n      }\n      \n      // Reset the global reference\n      globalPeerConnection = null;\n    }\n    \n    // Clear any remote tracks\n    if (globalRemoteStream) {\n      globalRemoteStream.getTracks().forEach(track => {\n        track.stop();\n      });\n      globalRemoteStream = new MediaStream();\n      remoteStream.value = globalRemoteStream;\n    }\n    \n    // Reset state\n    globalConnectionState.value = 'closed';\n    connectionState.value = 'closed';\n  };\n  \n  /**\n   * Close and cleanup all media streams\n   */\n  const cleanup = (): void => {\n    if (DEBUG) console.log('[WebRTC] Full cleanup initiated');\n    closeConnection();\n    \n    if (globalLocalStream) {\n      if (DEBUG) console.log('[WebRTC] Stopping local stream tracks');\n      globalLocalStream.getTracks().forEach(track => {\n        track.stop();\n      });\n      globalLocalStream = null;\n      localStream.value = null;\n    }\n    \n    if (DEBUG) console.log('[WebRTC] Cleanup complete');\n  };\n  \n  /**\n   * إعداد معالجي أحداث الويب سوكت\n   */\n  function setupSocketListeners() {\n    if (!socket.value) {\n      if (DEBUG) console.log('[WebRTC] No socket available, cannot set up listeners');\n        return;\n      }\n      \n    if (DEBUG) console.log('[WebRTC] Setting up socket listeners');\n    \n    // إزالة المستمعين السابقين لمنع التكرار\n    socket.value.off('webrtc-signal');\n    socket.value.off('ice-candidate');\n    socket.value.off('partner-disconnected');\n    socket.value.off('webrtc-connection-failed');\n    socket.value.off('connection-timeout');\n\n    // معالجة أحداث voice-offer و voice-answer القديمة\n    socket.value.off('voice-offer');\n    socket.value.off('voice-answer');\n    \n    socket.value.on('voice-offer', async (data: any) => {\n      if (DEBUG) console.log('[WebRTC] Received legacy voice-offer:', data);\n      // تحويل إلى صيغة webrtc-signal الجديدة\n      await handleOffer(data.offer, data.from);\n    });\n    \n    socket.value.on('voice-answer', async (data: any) => {\n      if (DEBUG) console.log('[WebRTC] Received legacy voice-answer:', data);\n      // تحويل إلى صيغة الإجابة الجديدة\n      await handleAnswer(data.answer);\n    });\n    \n    // التعامل مع إشارة WebRTC (offer, answer)\n    socket.value.on('webrtc-signal', async (data: { type: string, offer?: RTCSessionDescriptionInit, answer?: RTCSessionDescriptionInit, from: string }) => {\n      if (DEBUG) console.log(`[WebRTC] Received ${data.type} signal from ${data.from}`);\n      \n      // حفظ معرف الشريك\n      globalPartnerId.value = data.from;\n      partnerId.value = data.from;\n      \n      // معالجة العرض\n      if (data.type === 'offer' && data.offer) {\n        try {\n          await handleOffer(data.offer, data.from);\n        } catch (error) {\n          console.error('[WebRTC] Error handling offer:', error);\n          lastConnectionError = `Error handling offer: ${error}`;\n          \n          // إعلام الخادم بفشل الاتصال\n          if (socket.value) {\n            socket.value.emit('webrtc-connection-failed', {\n              to: data.from,\n              reason: `Failed to handle offer: ${error}`\n            });\n          }\n        }\n      }\n      // معالجة الإجابة\n      else if (data.type === 'answer' && data.answer) {\n        try {\n          await handleAnswer(data.answer);\n        } catch (error) {\n          console.error('[WebRTC] Error handling answer:', error);\n          lastConnectionError = `Error handling answer: ${error}`;\n          \n          // إعلام الخادم بفشل الاتصال\n          if (socket.value) {\n            socket.value.emit('webrtc-connection-failed', {\n              to: data.from,\n              reason: `Failed to handle answer: ${error}`\n            });\n          }\n        }\n      }\n    });\n    \n    // استقبال إشارة مرشحات ICE\n    socket.value.on('ice-candidate', async (data: { candidate: RTCIceCandidate, from: string }) => {\n      if (DEBUG) console.log(`[WebRTC] Received ICE candidate from ${data.from}`);\n      \n      if (data.from !== partnerId.value) {\n        if (DEBUG) console.log('[WebRTC] Ignoring ICE candidate from different partner');\n          return;\n        }\n      \n      try {\n        await handleIceCandidate(data.candidate);\n      } catch (error) {\n        console.error('[WebRTC] Error handling ICE candidate:', error);\n        lastConnectionError = `Error handling ICE candidate: ${error}`;\n      }\n    });\n    \n    // استقبال إشعار بفشل اتصال WebRTC\n    socket.value.on('webrtc-connection-failed', (data: { from: string, reason: string }) => {\n      if (DEBUG) console.log(`[WebRTC] Connection failed notification from ${data.from}: ${data.reason}`);\n      \n      // تحديث حالة الاتصال ومحاولة إعادة الاتصال\n      if (connectionRetryCount < MAX_CONNECTION_RETRIES) {\n        connectionRetryCount++;\n        console.log(`[WebRTC] Partner reported connection failure. Retry ${connectionRetryCount}/${MAX_CONNECTION_RETRIES}`);\n        \n        // إعادة بناء الاتصال\n        if (data.from === partnerId.value) {\n          setTimeout(() => {\n            if (partnerId.value && socket.value) {\n              createOffer(data.from);\n            }\n          }, RECONNECT_DELAY);\n        }\n      } else {\n        globalConnectionState.value = 'failed';\n        stopConnectionHeartbeat();\n        lastConnectionError = `Partner reported failure: ${data.reason}`;\n      }\n    });\n    \n    // إضافة معالج انقطاع الاتصال\n    socket.value.on('partner-disconnected', () => {\n      if (DEBUG) console.log('[WebRTC] Partner disconnected');\n      \n      // إغلاق الاتصال\n      closeConnection();\n      \n      // إعادة ضبط المتغيرات\n      globalPartnerId.value = null;\n      partnerId.value = null;\n      globalConnectionState.value = 'closed';\n      isNegotiating = false;\n      isRestartingIce = false;\n      connectionRetryCount = 0;\n    });\n  }\n  \n  // Setup the socket listeners when this hook is used\n  setupSocketListeners();\n  \n  // Clean up resources when component is unmounted\n  onUnmounted(() => {\n    // We don't close connections here anymore to maintain call during component changes\n    // Instead, we just remove our local references\n    peerConnection.value = null;\n    localStream.value = null;\n    remoteStream.value = null;\n  });\n  \n  // دالة لإرسال نبضات اتصال للحفاظ على استقرار الاتصال\n  function startConnectionHeartbeat() {\n    if (heartbeatInterval) {\n      clearInterval(heartbeatInterval);\n    }\n    \n    // بدء إرسال نبضات للحفاظ على الاتصال نشطًا\n    heartbeatInterval = window.setInterval(() => {\n      if (globalPeerConnection && \n          (globalConnectionState.value === 'connected' || \n           globalConnectionState.value === 'connecting')) {\n        \n        // إنشاء قناة بيانات جديدة كنبضة لإبقاء الاتصال نشطًا\n        try {\n          const channel = globalPeerConnection.createDataChannel(`heartbeat_${Date.now()}`);\n          \n          // إغلاق القناة بعد فترة قصيرة\n          setTimeout(() => {\n            try {\n              channel.close();\n            } catch (e) {\n              // تجاهل أي خطأ عند الإغلاق\n            }\n          }, 1000);\n          \n          if (DEBUG) console.log('[WebRTC] Heartbeat sent to keep connection alive');\n          \n          // إذا كان الاتصال في حالة \"جاري الاتصال\" لفترة طويلة، إرسال إشعار تشخيصي\n          if (globalConnectionState.value === 'connecting' && connectionRetryCount > 3) {\n            console.log('[WebRTC] Connection stuck in connecting state. Diagnostic report:');\n            console.log(getConnectionDiagnosticReport());\n          }\n        } catch (e) {\n          // تجاهل أخطاء إنشاء قناة البيانات إذا كان الاتصال مغلقًا بالفعل\n        }\n        \n        // التحقق من حالة المسارات\n        checkAndFixTracks();\n      } else {\n        stopConnectionHeartbeat();\n      }\n    }, HEARTBEAT_INTERVAL) as unknown as number;\n  }\n\n  // إيقاف نبضات الاتصال\n  function stopConnectionHeartbeat() {\n    if (heartbeatInterval) {\n      clearInterval(heartbeatInterval);\n      heartbeatInterval = null;\n    }\n  }\n\n  /**\n   * التحقق من حالة المسارات وإصلاح المشاكل المحتملة\n   */\n  function checkAndFixTracks() {\n    if (!globalPeerConnection || !globalLocalStream) {\n      if (DEBUG) console.log('[WebRTC] No peer connection or local stream to check tracks');\n      return;\n    }\n    \n    if (DEBUG) console.log('[WebRTC] Checking audio tracks');\n    \n    // تحقق من حالة الاتصال\n    if (DEBUG) console.log(`[WebRTC] Connection state: ${globalPeerConnection.connectionState}, ICE state: ${globalPeerConnection.iceConnectionState}`);\n    \n    // التحقق من المسارات المحلية\n    const localAudioTracks = globalLocalStream.getAudioTracks();\n    if (localAudioTracks.length === 0) {\n      if (DEBUG) console.log('[WebRTC] No local audio tracks found, initializing new stream');\n      \n      // إذا لم تكن هناك مسارات صوتية محلية، نحاول الحصول على تدفق جديد\n      initializeLocalStream().then(stream => {\n        if (globalPeerConnection && globalPeerConnection.connectionState !== 'closed') {\n          // إضافة المسارات إلى الاتصال\n          stream.getAudioTracks().forEach(track => {\n            if (DEBUG) console.log('[WebRTC] Adding new local track to connection');\n            try {\n              globalPeerConnection!.addTrack(track, stream);\n            } catch (e) {\n              // قد يكون السبب أن المسار موجود بالفعل\n              console.warn('[WebRTC] Error adding track, might already exist:', e);\n            }\n          });\n          \n          // بدء تفاوض جديد لتفعيل المسارات\n          if (globalPeerConnection.connectionState === 'connected' && !isNegotiating) {\n            if (DEBUG) console.log('[WebRTC] Starting negotiation for new local tracks');\n            startNegotiation();\n          }\n        }\n      }).catch(error => {\n        console.error('[WebRTC] Failed to initialize new stream:', error);\n      });\n    } else {\n      // التأكد من أن المسارات المحلية مفعلة\n      let fixedTracks = false;\n      localAudioTracks.forEach(track => {\n        if (!track.enabled) {\n          if (DEBUG) console.log(`[WebRTC] Enabling local track: ${track.label}`);\n          track.enabled = true;\n          fixedTracks = true;\n        }\n        \n        if (track.readyState !== 'live') {\n          if (DEBUG) console.log(`[WebRTC] Local track ${track.label} not live, state: ${track.readyState}`);\n          fixedTracks = true;\n        }\n      });\n      \n      // تحديث الحالة\n      if (localAudioTracks.some(track => !track.enabled)) {\n        globalIsAudioMuted.value = true;\n      } else {\n        globalIsAudioMuted.value = false;\n      }\n      \n      // إذا تم إصلاح المسارات، نحاول بدء تفاوض جديد\n      if (fixedTracks && globalPeerConnection.connectionState === 'connected' && !isNegotiating) {\n        if (DEBUG) console.log('[WebRTC] Fixed local tracks, starting negotiation');\n        startNegotiation();\n      }\n    }\n    \n    // التحقق من المسارات البعيدة\n    if (globalRemoteStream) {\n      const remoteAudioTracks = globalRemoteStream.getAudioTracks();\n      \n      if (remoteAudioTracks.length === 0) {\n        if (DEBUG) console.log('[WebRTC] No remote audio tracks found, checking receivers');\n        \n        // التحقق من المستقبلات\n        const receivers = globalPeerConnection.getReceivers();\n        const audioReceivers = receivers.filter(receiver => \n          receiver.track && \n          receiver.track.kind === 'audio' && \n          receiver.track.readyState === 'live'\n        );\n        \n        if (audioReceivers.length > 0) {\n          if (DEBUG) console.log(`[WebRTC] Found ${audioReceivers.length} audio receivers not in stream, adding tracks`);\n          \n          // إضافة المسارات من المستقبلات إلى التدفق البعيد\n          audioReceivers.forEach(receiver => {\n            if (receiver.track && !globalRemoteStream!.getTracks().includes(receiver.track)) {\n              if (DEBUG) console.log(`[WebRTC] Adding track ${receiver.track.id} to remote stream`);\n              try {\n                globalRemoteStream!.addTrack(receiver.track);\n              } catch (e) {\n                console.warn('[WebRTC] Error adding remote track:', e);\n              }\n            }\n          });\n          \n          // تحديث المكونات بالتدفق الجديد\n          remoteStream.value = globalRemoteStream;\n          if (DEBUG) console.log('[WebRTC] Updated remote stream with receiver tracks');\n        } else if (globalConnectionState.value === 'connected' && !isNegotiating) {\n          // لا توجد مسارات في المستقبلات، نحتاج إلى إعادة التفاوض\n          if (DEBUG) console.log('[WebRTC] No audio receivers found but connected, trying to renegotiate');\n          startNegotiation();\n        }\n      } else {\n        // التأكد من أن المسارات البعيدة مفعلة\n        let fixedRemoteTracks = false;\n        remoteAudioTracks.forEach(track => {\n          if (!track.enabled) {\n            if (DEBUG) console.log(`[WebRTC] Enabling remote track: ${track.label}`);\n            track.enabled = true;\n            fixedRemoteTracks = true;\n          }\n          \n          if (track.readyState !== 'live') {\n            if (DEBUG) console.log(`[WebRTC] Remote track ${track.label} not live, state: ${track.readyState}`);\n            fixedRemoteTracks = true;\n          }\n        });\n        \n        // إذا تم إصلاح المسارات البعيدة، نحدث المكونات\n        if (fixedRemoteTracks) {\n          remoteStream.value = globalRemoteStream;\n          if (DEBUG) console.log('[WebRTC] Updated remote stream after fixing tracks');\n        }\n      }\n    } else if (globalPeerConnection.getReceivers().length > 0) {\n      // إذا كان هناك مستقبلات ولكن لا يوجد تدفق بعيد، إنشاء واحد جديد\n      if (DEBUG) console.log('[WebRTC] No remote stream but receivers exist, creating new stream');\n      \n      globalRemoteStream = new MediaStream();\n      remoteStream.value = globalRemoteStream;\n      \n      // إضافة المسارات من المستقبلات\n      let addedTracks = false;\n      globalPeerConnection.getReceivers().forEach(receiver => {\n        if (receiver.track && receiver.track.kind === 'audio') {\n          if (DEBUG) console.log(`[WebRTC] Adding track ${receiver.track.id} from receiver to new remote stream`);\n          try {\n            globalRemoteStream!.addTrack(receiver.track);\n            addedTracks = true;\n          } catch (e) {\n            console.warn('[WebRTC] Error adding track from receiver:', e);\n          }\n        }\n      });\n      \n      // تحديث المكونات بالتدفق الجديد إذا تم إضافة مسارات\n      if (addedTracks) {\n        remoteStream.value = globalRemoteStream;\n        if (DEBUG) console.log('[WebRTC] Updated components with new remote stream');\n      }\n    }\n    \n    // تحديث معلومات التشخيص\n    updateDebugInfo();\n  }\n  \n  // استعادة الاتصال بعد انقطاع\n  async function attemptConnectionRecovery() {\n    if (!globalPeerConnection || !partnerId.value) {\n        return;\n      }\n    \n    if (DEBUG) console.log('[WebRTC] Attempting connection recovery');\n    \n    try {\n      // إعادة تشغيل ICE\n      if (globalPeerConnection.restartIce) {\n        globalPeerConnection.restartIce();\n        \n        // إعادة تفاوض على الاتصال\n        const offer = await globalPeerConnection.createOffer({ iceRestart: true });\n        await globalPeerConnection.setLocalDescription(offer);\n        \n        if (socket.value) {\n          socket.value.emit('offer', {\n            offer: globalPeerConnection.localDescription,\n            to: partnerId.value\n          });\n        }\n      }\n    } catch (error) {\n      console.error('[WebRTC] Recovery attempt failed:', error);\n    }\n  }\n  \n  // إتاحة معلومات التشخيص للواجهة عبر كائن عام\n  function updateDebugInfo() {\n    if (typeof window !== 'undefined') {\n      (window as any).__webrtc_debug = {\n        connectionState: globalConnectionState.value,\n        connectionRetryCount,\n        lastConnectionError,\n        failureReason,\n        isNegotiating,\n        isRestartingIce,\n        pendingCandidates: pendingCandidates.length,\n        hasLocalTracks: globalLocalStream ? globalLocalStream.getAudioTracks().length > 0 : false,\n        hasRemoteTracks: globalRemoteStream ? globalRemoteStream.getAudioTracks().length > 0 : false\n      };\n    }\n  }\n\n  // تحديث معلومات التشخيص عند تغيير الحالة\n  watch(() => globalConnectionState.value, () => {\n    updateDebugInfo();\n  });\n  \n  // دالة لمراقبة جودة الاتصال\n  function startConnectionMonitoring() {\n    if (connectionMonitorInterval) {\n      clearInterval(connectionMonitorInterval);\n    }\n    \n    // تتبع مرشحات ICE المحلية والبعيدة للتشخيص\n    if (typeof window !== 'undefined') {\n      (window as any).__localIceCandidates = [];\n      (window as any).__remoteIceCandidates = [];\n      (window as any).__iceCandidatePairs = [];\n    }\n    \n    // إضافة مستمع لمرشحات ICE المحلية\n    if (globalPeerConnection) {\n      globalPeerConnection.onicecandidate = (event) => {\n        if (event.candidate) {\n          if (DEBUG) console.log('[WebRTC] ICE candidate generated:', event.candidate.candidate);\n          \n          // حفظ المرشح للتشخيص\n          if (typeof window !== 'undefined') {\n            (window as any).__localIceCandidates = (window as any).__localIceCandidates || [];\n            (window as any).__localIceCandidates.push({\n              candidate: event.candidate.candidate,\n              timestamp: Date.now()\n            });\n          }\n          \n          // إرسال المرشح للطرف الآخر\n          if (socket.value && partnerId.value) {\n            if (DEBUG) console.log('[WebRTC] Sending ICE candidate to partner');\n            socket.value.emit('ice-candidate', {\n              candidate: event.candidate,\n              to: partnerId.value\n            });\n          }\n        }\n      };\n    }\n    \n    connectionMonitorInterval = window.setInterval(async () => {\n      if (!globalPeerConnection || globalConnectionState.value !== 'connecting' && globalConnectionState.value !== 'connected') {\n        stopConnectionMonitoring();\n        return;\n      }\n      \n      try {\n        // جمع إحصائيات الاتصال\n        const stats = await getConnectionStats();\n        \n        // تتبع أزواج المرشحات ICE\n        if (stats && stats.iceCandidatePairs) {\n          if (typeof window !== 'undefined') {\n            (window as any).__iceCandidatePairs = stats.iceCandidatePairs;\n          }\n        }\n        \n        // تحقق من جودة الاتصال\n        checkConnectionHealth(stats);\n      } catch (error) {\n        console.error('[WebRTC] Error monitoring connection:', error);\n      }\n    }, CONNECTION_MONITOR_INTERVAL) as unknown as number;\n  }\n\n  // إيقاف مراقبة الاتصال\n  function stopConnectionMonitoring() {\n    if (connectionMonitorInterval) {\n      clearInterval(connectionMonitorInterval);\n      connectionMonitorInterval = null;\n    }\n  }\n\n  // التحقق من صحة الاتصال بناءً على الإحصائيات\n  function checkConnectionHealth(stats: any) {\n    if (!stats || stats.error) return;\n    \n    // فحص مسارات الصوت\n    const hasAudioIssues = !stats.media || stats.media.length === 0 || \n                           !stats.media.some((m: any) => m.kind === 'audio' && m.audioLevel > 0);\n    \n    // فحص أزواج المرشحين\n    const hasCandidatePairIssues = !stats.selectedCandidatePair || \n                                  stats.selectedCandidatePair.state !== 'succeeded';\n    \n    if (hasAudioIssues || hasCandidatePairIssues) {\n      if (DEBUG) console.log('[WebRTC] Connection health issues detected, trying to fix...');\n      \n      // إعادة التحقق من المسارات\n      checkAndFixTracks();\n      \n      // إذا استمرت المشاكل، محاولة إعادة الاتصال\n      if (globalConnectionState.value === 'connected' && connectionRetryCount < MAX_CONNECTION_RETRIES) {\n        connectionRetryCount++;\n        if (DEBUG) console.log(`[WebRTC] Attempting connection improvement (${connectionRetryCount}/${MAX_CONNECTION_RETRIES})`);\n        \n        // استخدام طريقة أكثر لطفًا لتحسين الاتصال\n        if (globalPeerConnection && globalPeerConnection.getTransceivers) {\n          globalPeerConnection.getTransceivers().forEach(transceiver => {\n            if (transceiver.sender && transceiver.sender.track && transceiver.sender.track.kind === 'audio') {\n              transceiver.sender.setParameters({\n                ...transceiver.sender.getParameters(),\n                degradationPreference: 'maintain-framerate'\n              });\n            }\n          });\n        }\n      }\n    }\n  }\n  \n  // Add a new function to explicitly handle connection timeout\n  function setupConnectionTimeout(pc: RTCPeerConnection): void {\n    if (!partnerId.value) return;\n    \n    // Clear any existing connection timeout\n    if ((window as any).__webrtcConnectionTimeout) {\n      clearTimeout((window as any).__webrtcConnectionTimeout);\n    }\n    \n    // Set a new timeout\n    (window as any).__webrtcConnectionTimeout = setTimeout(() => {\n      if (pc.connectionState === 'connecting' || pc.connectionState === 'new') {\n        if (DEBUG) console.log(`[WebRTC] Connection attempt timed out after ${CONNECTION_TIMEOUT/1000} seconds`);\n        \n        // جمع معلومات تشخيصية إضافية\n        const candidateInfo = {\n          localCandidates: (window as any).__localIceCandidates?.length || 0,\n          remoteCandidates: (window as any).__remoteIceCandidates?.length || 0,\n          iceCandidatePairsCount: (window as any).__iceCandidatePairs?.length || 0\n        };\n        \n        console.log('[WebRTC] Connection diagnostic info:', JSON.stringify(candidateInfo));\n        lastConnectionError = `Connection timed out. Local candidates: ${candidateInfo.localCandidates}, Remote: ${candidateInfo.remoteCandidates}`;\n        \n        // التحقق إذا تم توليد أي مرشحات ICE محلية\n        if (candidateInfo.localCandidates === 0) {\n          console.error('[WebRTC] No local ICE candidates generated, could be a network/firewall issue');\n          lastConnectionError += '. No local candidates - check firewall settings';\n        }\n        \n        // محاولة استخدام خوادم TURN إذا فشلت STUN أو العكس\n        if (partnerId.value) {\n          if (DEBUG) console.log('[WebRTC] Restarting connection with different servers');\n          \n          // إغلاق الاتصال الحالي\n          closeConnection();\n          \n          // إنشاء اتصال جديد باستخدام إعدادات مختلفة\n          setTimeout(() => {\n            if (partnerId.value) {\n              // تبديل بين إعدادات الاتصال المختلفة بناءً على المحاولة السابقة\n              if (currentRtcConfig === standardRtcConfiguration || currentRtcConfig === fastRtcConfiguration) {\n                if (DEBUG) console.log('[WebRTC] Switching to TURN-only configuration');\n                currentRtcConfig = turnOnlyRtcConfiguration;\n              } else {\n                if (DEBUG) console.log('[WebRTC] Switching to standard configuration');\n                currentRtcConfig = standardRtcConfiguration;\n              }\n              createOffer(partnerId.value);\n            }\n          }, RECONNECT_DELAY);\n        }\n      }\n    }, CONNECTION_TIMEOUT);\n  }\n  \n  // دالة للحصول على تقرير تشخيصي شامل\n  function getConnectionDiagnosticReport(): string {\n    const peerConn = globalPeerConnection;\n    const report = [];\n    \n    report.push(`Connection State: ${peerConn?.connectionState || 'none'}`);\n    report.push(`Signaling State: ${peerConn?.signalingState || 'none'}`);\n    report.push(`ICE Connection State: ${peerConn?.iceConnectionState || 'none'}`);\n    report.push(`ICE Gathering State: ${peerConn?.iceGatheringState || 'none'}`);\n    report.push(`Reconnection Attempts: ${connectionRetryCount}/${MAX_CONNECTION_RETRIES}`);\n    report.push(`Last Error: ${lastConnectionError || 'none'}`);\n    report.push(`Local Audio Tracks: ${globalLocalStream?.getAudioTracks().length || 0}`);\n    report.push(`Remote Audio Tracks: ${globalRemoteStream?.getAudioTracks().length || 0}`);\n    report.push(`Local Candidates: ${(window as any).__localIceCandidates?.length || 0}`);\n    report.push(`Remote Candidates: ${(window as any).__remoteIceCandidates?.length || 0}`);\n    report.push(`Is Negotiating: ${isNegotiating}`);\n    report.push(`Is Restarting ICE: ${isRestartingIce}`);\n    \n    return report.join('\\n');\n  }\n  \n  /**\n   * معالجة مرشح ICE من النظير البعيد\n   */\n  const handleIceCandidate = async (candidate: RTCIceCandidate): Promise<void> => {\n    if (!globalPeerConnection) {\n      if (DEBUG) console.log('[WebRTC] Received ICE candidate but no peer connection exists');\n        return;\n      }\n      \n      try {\n      if (DEBUG) console.log('[WebRTC] Adding received ICE candidate:', candidate.candidate);\n      \n      // التحقق من أن الوصف المحلي موجود قبل إضافة المرشحين\n      if (!globalPeerConnection.remoteDescription || !globalPeerConnection.localDescription) {\n        if (DEBUG) console.log('[WebRTC] Delaying ICE candidate addition until descriptions are set');\n        \n        // تخزين المرشح للإضافة لاحقًا بعد ضبط الوصف\n        setTimeout(async () => {\n          if (globalPeerConnection && globalPeerConnection.remoteDescription) {\n            if (DEBUG) console.log('[WebRTC] Adding delayed ICE candidate after timeout');\n            try {\n              await globalPeerConnection.addIceCandidate(candidate);\n      } catch (error) {\n              console.error('[WebRTC] Error adding delayed ICE candidate:', error);\n            }\n          }\n        }, 1000);\n        \n        return;\n      }\n      \n      // محاولة إضافة المرشح\n      await globalPeerConnection.addIceCandidate(candidate);\n      \n      if (DEBUG) console.log('[WebRTC] Successfully added ICE candidate');\n    } catch (error) {\n      console.error('[WebRTC] Error adding ICE candidate:', error);\n      lastConnectionError = `Error adding ICE candidate: ${error}`;\n      \n      // محاولة ثانية بعد تأخير\n      setTimeout(async () => {\n        if (globalPeerConnection && globalPeerConnection.remoteDescription) {\n          if (DEBUG) console.log('[WebRTC] Retrying to add ICE candidate after error');\n          try {\n            await globalPeerConnection.addIceCandidate(candidate);\n            if (DEBUG) console.log('[WebRTC] Successfully added ICE candidate on retry');\n          } catch (retryError) {\n            console.error('[WebRTC] Error adding ICE candidate on retry:', retryError);\n          }\n        }\n      }, 2000);\n    }\n  };\n  \n  // تم حذف التعريفات المكررة\n  \n  /**\n   * بدء تفاوض جديد على الاتصال WebRTC\n   */\n  function startNegotiation(): void {\n    if (!globalPeerConnection || !partnerId.value || isNegotiating) {\n      if (DEBUG) console.log('[WebRTC] Cannot start negotiation: missing connection, partner ID, or already negotiating');\n      return;\n    }\n    \n    if (DEBUG) console.log('[WebRTC] Starting new negotiation');\n    isNegotiating = true;\n    \n    try {\n      // بدء تفاوض جديد بإنشاء عرض\n      globalPeerConnection.createOffer({\n        offerToReceiveAudio: true,\n        offerToReceiveVideo: false,\n      })\n      .then(offer => {\n        if (!globalPeerConnection) return;\n        return globalPeerConnection.setLocalDescription(offer);\n      })\n      .then(() => {\n        if (!globalPeerConnection || !socket.value || !partnerId.value) return;\n        \n        // إرسال العرض الجديد\n        socket.value.emit('voice-offer', {\n          offer: globalPeerConnection.localDescription,\n          to: partnerId.value\n        });\n        \n        if (DEBUG) console.log('[WebRTC] Sent renegotiation offer');\n      })\n      .catch(error => {\n        console.error('[WebRTC] Error during negotiation:', error);\n      })\n      .finally(() => {\n        // إعادة تعيين العلم بعد فترة\n        setTimeout(() => {\n          isNegotiating = false;\n        }, 2000);\n      });\n    } catch (error) {\n      console.error('[WebRTC] Failed to start negotiation:', error);\n      isNegotiating = false;\n    }\n  }\n  \n  // إضافة وظيفة لمعلومات التشخيص\n  const diagnosticReport = {\n    connectionState: globalConnectionState.value,\n    iceCandidatesGenerated: pendingCandidates.length,\n    localStreamActive: !!globalLocalStream && globalLocalStream.active,\n    remoteStreamActive: !!globalRemoteStream && globalRemoteStream.active,\n    localTracks: globalLocalStream ? globalLocalStream.getAudioTracks().length : 0,\n    remoteTracks: globalRemoteStream ? globalRemoteStream.getAudioTracks().length : 0,\n    connectionRetries: connectionRetryCount,\n    lastError: lastConnectionError || failureReason || '',\n    isAudioMuted: globalIsAudioMuted.value,\n    forceReconnect: () => {\n      if (globalPeerConnection && globalConnectionState.value !== 'new') {\n        attemptConnectionRecovery();\n        return true;\n      }\n      return false;\n    }\n  };\n  \n  return {\n    socket,\n    peerConnection,\n    remoteStream,\n    localStream,\n    connectionState,\n    isAudioMuted,\n    partnerId,\n    createOffer,\n    handleOffer,\n    handleAnswer,\n    handleIceCandidate,\n    toggleMicrophone,\n    closeConnection,\n    initializeLocalStream,\n    cleanup,\n    diagnosticReport\n  };\n}\n\n// Fix for signaling state check\nfunction isSignalingStateStable(pc: RTCPeerConnection): boolean {\n  return pc.signalingState === 'stable';\n}\n\n// إضافة دالة للتحقق من إمكانية تعيين الوصف المحلي\nfunction canSetLocalDescription(pc: RTCPeerConnection): boolean {\n  return pc.signalingState === 'stable' || pc.signalingState === 'have-remote-offer';\n}\n","import { ref } from 'vue';\r\n\r\n// Check if localStorage is available\r\nfunction isLocalStorageAvailable(): boolean {\r\n  const test = 'test';\r\n  try {\r\n    localStorage.setItem(test, test);\r\n    localStorage.removeItem(test);\r\n    return true;\r\n  } catch (e) {\r\n    console.error('localStorage is not available:', e);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * A wrapper for localStorage with error handling\r\n */\r\nexport function useLocalStorage() {\r\n  const isAvailable = ref(isLocalStorageAvailable());\r\n  \r\n  /**\r\n   * Set an item in localStorage\r\n   */\r\n  function setItem(key: string, value: string): void {\r\n    if (!isAvailable.value) {\r\n      console.warn('localStorage is not available, cannot set item');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      localStorage.setItem(key, value);\r\n    } catch (error) {\r\n      console.error('Failed to set localStorage item:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Get an item from localStorage\r\n   */\r\n  function getItem(key: string): string | null {\r\n    if (!isAvailable.value) {\r\n      console.warn('localStorage is not available, cannot get item');\r\n      return null;\r\n    }\r\n    \r\n    try {\r\n      return localStorage.getItem(key);\r\n    } catch (error) {\r\n      console.error('Failed to get localStorage item:', error);\r\n      return null;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Remove an item from localStorage\r\n   */\r\n  function removeItem(key: string): void {\r\n    if (!isAvailable.value) {\r\n      console.warn('localStorage is not available, cannot remove item');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      localStorage.removeItem(key);\r\n    } catch (error) {\r\n      console.error('Failed to remove localStorage item:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Clear all items from localStorage\r\n   */\r\n  function clear(): void {\r\n    if (!isAvailable.value) {\r\n      console.warn('localStorage is not available, cannot clear storage');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      localStorage.clear();\r\n    } catch (error) {\r\n      console.error('Failed to clear localStorage:', error);\r\n    }\r\n  }\r\n  \r\n  return {\r\n    isAvailable,\r\n    setItem,\r\n    getItem,\r\n    removeItem,\r\n    clear\r\n  };\r\n}\r\n\r\n/**\r\n * Save a call record to history\r\n * @param partnerId The ID of the call partner\r\n * @param duration The call duration in seconds\r\n * @param gamesPlayed Array of games played during the call\r\n */\r\nexport function saveCallToHistory(partnerId: string, duration: number, gamesPlayed: string[] = []): void {\r\n  const { getItem, setItem } = useLocalStorage();\r\n  \r\n  try {\r\n    // Get existing history\r\n    const existingHistory = getItem('callHistory');\r\n    let history: any[] = [];\r\n    \r\n    if (existingHistory) {\r\n      history = JSON.parse(existingHistory);\r\n    }\r\n    \r\n    // Create new history entry\r\n    const newEntry = {\r\n      partnerId,\r\n      timestamp: new Date().toISOString(),\r\n      duration,\r\n      gamesPlayed\r\n    };\r\n    \r\n    // Add to history (at the beginning)\r\n    history.unshift(newEntry);\r\n    \r\n    // Limit history to last 20 entries\r\n    if (history.length > 20) {\r\n      history = history.slice(0, 20);\r\n    }\r\n    \r\n    // Save updated history\r\n    setItem('callHistory', JSON.stringify(history));\r\n  } catch (error) {\r\n    console.error('Error saving call to history:', error);\r\n  }\r\n}\r\n","import { ref, watch, shallowRef } from 'vue';\r\nimport { useSocket } from './socket';\r\nimport { useLocalStorage } from './storage';\r\n\r\n// Types\r\nexport interface ChatMessage {\r\n  sender: 'me' | 'partner';\r\n  text: string;\r\n  timestamp: number;\r\n}\r\n\r\n// Global state for chat\r\nconst allMessages = ref<Record<string, ChatMessage[]>>({});\r\nconst currentPartnerId = ref<string | null>(null);\r\nconst unreadMessages = ref<Record<string, boolean>>({});\r\nconst isListening = ref(false);\r\n\r\n// Debug flag\r\nconst DEBUG = true;\r\n\r\n// Create a singleton instance to ensure the service is only initialized once\r\nlet isInitialized = false;\r\n\r\n/**\r\n * Centralized chat service to handle messaging across components\r\n */\r\nexport function useChat() {\r\n  const { socket, userId } = useSocket();\r\n  const storage = useLocalStorage();\r\n\r\n  // Initialize the service if not already done\r\n  if (!isInitialized) {\r\n    if (DEBUG) console.log('[ChatService] Initializing chat service');\r\n    initializeChatService();\r\n    isInitialized = true;\r\n  } else {\r\n    if (DEBUG) console.log('[ChatService] Using existing chat service instance');\r\n  }\r\n\r\n  /**\r\n   * Initialize the chat service\r\n   */\r\n  function initializeChatService() {\r\n    // Set up global socket listeners\r\n    setupGlobalSocketListeners();\r\n\r\n    // Load all saved chats from localStorage\r\n    loadAllChats();\r\n\r\n    // Watch for changes to messages and save them\r\n    watch(allMessages, () => {\r\n      saveAllChats();\r\n    }, { deep: true });\r\n\r\n    // When socket changes (after reconnection), ensure we're still listening\r\n    watch(() => socket.value, (newSocket) => {\r\n      if (newSocket && !isListening.value) {\r\n        if (DEBUG) console.log('[ChatService] Socket reconnected, setting up listeners again');\r\n        setupGlobalSocketListeners();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set up global socket listeners for chat messages\r\n   */\r\n  function setupGlobalSocketListeners() {\r\n    if (!socket.value) {\r\n      if (DEBUG) console.log('[ChatService] No socket available, cannot set up listeners');\r\n      return;\r\n    }\r\n    \r\n    if (isListening.value) {\r\n      // Remove existing listeners to prevent duplicates\r\n      if (DEBUG) console.log('[ChatService] Removing existing chat-message listener');\r\n      socket.value.off('chat-message');\r\n      isListening.value = false;\r\n    }\r\n\r\n    if (DEBUG) console.log('[ChatService] Setting up chat-message listener');\r\n    \r\n    // Listen for incoming messages globally\r\n    socket.value.on('chat-message', (data: { text: string; from: string; timestamp: number }) => {\r\n      if (DEBUG) console.log('[ChatService] Received chat message:', data);\r\n      \r\n      // Create conversation key\r\n      const partnerId = data.from;\r\n      const conversationKey = getConversationKey(partnerId);\r\n\r\n      if (DEBUG) console.log(`[ChatService] Conversation key: ${conversationKey}, current partner: ${currentPartnerId.value}`);\r\n\r\n      // Initialize conversation if it doesn't exist\r\n      if (!allMessages.value[conversationKey]) {\r\n        allMessages.value[conversationKey] = [];\r\n      }\r\n\r\n      // Add message to conversation\r\n      allMessages.value[conversationKey].push({\r\n        sender: 'partner',\r\n        text: data.text,\r\n        timestamp: data.timestamp || Date.now()\r\n      });\r\n\r\n      // Mark as unread if it's not the current conversation\r\n      if (partnerId !== currentPartnerId.value) {\r\n        unreadMessages.value[partnerId] = true;\r\n        if (DEBUG) console.log(`[ChatService] Marked message from ${partnerId} as unread`);\r\n      }\r\n\r\n      // Save to localStorage\r\n      saveAllChats();\r\n      \r\n      if (DEBUG) console.log(`[ChatService] Updated messages:`, allMessages.value[conversationKey]);\r\n    });\r\n\r\n    isListening.value = true;\r\n    if (DEBUG) console.log('[ChatService] Chat message listener setup complete');\r\n  }\r\n\r\n  /**\r\n   * Set the current partner ID\r\n   */\r\n  function setCurrentPartner(partnerId: string | null) {\r\n    if (DEBUG) console.log(`[ChatService] Setting current partner: ${partnerId}`);\r\n    currentPartnerId.value = partnerId;\r\n\r\n    // Clear unread messages for this partner\r\n    if (partnerId) {\r\n      unreadMessages.value[partnerId] = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send a message to the current partner\r\n   */\r\n  function sendMessage(text: string, toPartnerId: string | null = null) {\r\n    // Use specified partner or current partner\r\n    const partnerId = toPartnerId || currentPartnerId.value;\r\n    \r\n    if (!partnerId || !text.trim() || !socket.value) {\r\n      if (DEBUG) console.log(`[ChatService] Cannot send message: partnerId=${partnerId}, text=${text.trim() ? 'present' : 'empty'}, socket=${socket.value ? 'present' : 'not present'}`);\r\n      return false;\r\n    }\r\n\r\n    if (DEBUG) console.log(`[ChatService] Sending message to ${partnerId}: ${text}`);\r\n\r\n    // Create conversation key\r\n    const conversationKey = getConversationKey(partnerId);\r\n\r\n    // Initialize conversation if it doesn't exist\r\n    if (!allMessages.value[conversationKey]) {\r\n      allMessages.value[conversationKey] = [];\r\n    }\r\n\r\n    // Add message to our local state\r\n    const timestamp = Date.now();\r\n    allMessages.value[conversationKey].push({\r\n      sender: 'me',\r\n      text: text.trim(),\r\n      timestamp\r\n    });\r\n\r\n    // Send message to partner\r\n    socket.value.emit('chat-message', {\r\n      text: text.trim(),\r\n      to: partnerId\r\n    });\r\n    \r\n    if (DEBUG) console.log(`[ChatService] Message sent, current messages:`, allMessages.value[conversationKey]);\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get messages for a specific partner\r\n   */\r\n  function getMessages(partnerId: string | null): ChatMessage[] {\r\n    if (!partnerId) return [];\r\n\r\n    const conversationKey = getConversationKey(partnerId);\r\n    const messages = allMessages.value[conversationKey] || [];\r\n    \r\n    if (DEBUG) console.log(`[ChatService] Getting messages for ${partnerId}, found ${messages.length} messages`);\r\n    return messages;\r\n  }\r\n\r\n  /**\r\n   * Check if there are unread messages from a partner\r\n   */\r\n  function hasUnreadMessages(partnerId: string | null): boolean {\r\n    if (!partnerId) return false;\r\n    const hasUnread = !!unreadMessages.value[partnerId];\r\n    if (DEBUG) console.log(`[ChatService] Checking unread for ${partnerId}: ${hasUnread}`);\r\n    return hasUnread;\r\n  }\r\n\r\n  /**\r\n   * Mark messages as read for a partner\r\n   */\r\n  function markAsRead(partnerId: string | null) {\r\n    if (!partnerId) return;\r\n    if (DEBUG) console.log(`[ChatService] Marking messages as read for ${partnerId}`);\r\n    unreadMessages.value[partnerId] = false;\r\n  }\r\n\r\n  /**\r\n   * Get a unique key for a conversation\r\n   */\r\n  function getConversationKey(partnerId: string): string {\r\n    if (!userId.value) return partnerId;\r\n    \r\n    // Create a consistent key regardless of who initiated the chat\r\n    const ids = [userId.value, partnerId].sort();\r\n    return `${ids[0]}_${ids[1]}`;\r\n  }\r\n\r\n  /**\r\n   * Save all chats to localStorage\r\n   */\r\n  function saveAllChats() {\r\n    if (!storage.isAvailable.value) {\r\n      if (DEBUG) console.log('[ChatService] localStorage not available, cannot save chats');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Save messages\r\n      storage.setItem('chat_messages', JSON.stringify(allMessages.value));\r\n      \r\n      // Save unread status\r\n      storage.setItem('chat_unread', JSON.stringify(unreadMessages.value));\r\n      \r\n      if (DEBUG) console.log('[ChatService] Saved chats to localStorage');\r\n    } catch (error) {\r\n      console.error('[ChatService] Failed to save chats:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load all saved chats from localStorage\r\n   */\r\n  function loadAllChats() {\r\n    if (!storage.isAvailable.value) {\r\n      if (DEBUG) console.log('[ChatService] localStorage not available, cannot load chats');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Load messages\r\n      const savedMessages = storage.getItem('chat_messages');\r\n      if (savedMessages) {\r\n        allMessages.value = JSON.parse(savedMessages);\r\n        if (DEBUG) console.log('[ChatService] Loaded messages from localStorage:', Object.keys(allMessages.value).length, 'conversations');\r\n      }\r\n\r\n      // Load unread status\r\n      const savedUnread = storage.getItem('chat_unread');\r\n      if (savedUnread) {\r\n        unreadMessages.value = JSON.parse(savedUnread);\r\n        if (DEBUG) console.log('[ChatService] Loaded unread status from localStorage');\r\n      }\r\n    } catch (error) {\r\n      console.error('[ChatService] Failed to load chats:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear chat history for a specific partner\r\n   */\r\n  function clearChat(partnerId: string) {\r\n    if (!partnerId) return;\r\n\r\n    const conversationKey = getConversationKey(partnerId);\r\n    if (allMessages.value[conversationKey]) {\r\n      allMessages.value[conversationKey] = [];\r\n      saveAllChats();\r\n      if (DEBUG) console.log(`[ChatService] Cleared chat for ${partnerId}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all chat history\r\n   */\r\n  function clearAllChats() {\r\n    allMessages.value = {};\r\n    unreadMessages.value = {};\r\n    saveAllChats();\r\n    if (DEBUG) console.log('[ChatService] Cleared all chats');\r\n  }\r\n\r\n  // Return the public API\r\n  return {\r\n    messages: allMessages,  // Removed shallowRef to ensure reactivity\r\n    unreadMessages: unreadMessages,  // Removed shallowRef\r\n    currentPartnerId,\r\n    setCurrentPartner,\r\n    sendMessage,\r\n    getMessages,\r\n    hasUnreadMessages,\r\n    markAsRead,\r\n    clearChat,\r\n    clearAllChats\r\n  };\r\n} ","<template>\n  <div class=\"bg-white/5 backdrop-blur-sm rounded-2xl p-6 text-center border border-white/10\">\n    <!-- Searching State -->\n    <div v-if=\"status === 'searching'\">\n      <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center animate-pulse\">\n        <div class=\"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n      </div>\n      <h2 class=\"text-lg font-semibold mb-2\">Searching...</h2>\n      <p class=\"text-sm text-gray-300\">Looking for someone to talk to</p>\n    </div>\n\n    <!-- Matched State - New state for quick transition -->\n    <div v-else-if=\"status === 'matched'\">\n      <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-yellow-500 to-green-500 rounded-full flex items-center justify-center animate-pulse\">\n        <span class=\"text-2xl\">🔄</span>\n      </div>\n      <h2 class=\"text-lg font-semibold mb-2 text-yellow-400\">Match Found!</h2>\n      <div v-if=\"partnerInfo\" class=\"flex items-center justify-center gap-2 text-gray-300\">\n        <span class=\"text-xl\">{{ partnerInfo.flag }}</span>\n        <span class=\"text-sm\">{{ partnerInfo.country }}</span>\n      </div>\n      <p class=\"text-sm text-yellow-400 mt-2\">Setting up voice connection...</p>\n      \n      <!-- Connection progress indicator -->\n      <div class=\"mt-3 relative h-1.5 w-3/4 mx-auto bg-gray-700 rounded-full overflow-hidden\">\n        <div class=\"absolute top-0 left-0 h-full bg-gradient-to-r from-yellow-500 to-green-500 rounded-full animate-progress\"></div>\n      </div>\n    </div>\n\n    <!-- Connected State -->\n    <div v-else-if=\"status === 'connected'\">\n      <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center\">\n        <span class=\"text-2xl\">👥</span>\n      </div>\n      <h2 class=\"text-lg font-semibold mb-2\">Connected!</h2>\n      <div v-if=\"partnerInfo\" class=\"flex items-center justify-center gap-2 text-gray-300\">\n        <span class=\"text-xl\">{{ partnerInfo.flag }}</span>\n        <span class=\"text-sm\">{{ partnerInfo.country }}</span>\n      </div>\n      <p class=\"text-sm text-green-400 mt-2\">You can talk now</p>\n    </div>\n\n    <!-- Disconnected/Ready State -->\n    <div v-else>\n      <div class=\"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-gray-600 to-gray-700 rounded-full flex items-center justify-center\">\n        <span class=\"text-2xl\">🌟</span>\n      </div>\n      <h2 class=\"text-lg font-semibold mb-2\">Ready to Connect</h2>\n      <p class=\"text-sm text-gray-300\">Press \"Next\" to find someone to talk with</p>\n    </div>\n    \n    <!-- Connection Status Indicator -->\n    <div v-if=\"showStatus && status !== 'disconnected'\" class=\"mt-4 text-xs\">\n      <div class=\"flex items-center justify-center gap-2\">\n        <span :class=\"{\n          'text-green-400': status === 'connected',\n          'text-yellow-400': status === 'matched',\n          'text-blue-400': status === 'searching'\n        }\">●</span>\n        <span>{{ connectionStatusText }}</span>\n      </div>\n      \n      <!-- Error message if exists -->\n      <p v-if=\"errorMessage\" class=\"text-red-400 mt-1 text-xs\">{{ errorMessage }}</p>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue';\n\ninterface PartnerInfo {\n  flag?: string;\n  country?: string;\n  id?: string;\n}\n\nconst props = defineProps({\n  status: {\n    type: String,\n    default: 'disconnected', // 'searching', 'matched', 'connected', 'disconnected'\n  },\n  partnerInfo: {\n    type: Object as () => PartnerInfo | null,\n    default: null\n  },\n  errorMessage: {\n    type: String,\n    default: ''\n  },\n  showStatus: {\n    type: Boolean,\n    default: true\n  }\n});\n\n// Computed text for connection status\nconst connectionStatusText = computed(() => {\n  switch (props.status) {\n    case 'searching': return 'Searching...';\n    case 'matched': return 'Partner found, connecting...';\n    case 'connected': return 'Connected';\n    default: return 'Disconnected';\n  }\n});\n</script>\n\n<style scoped>\n@keyframes progress {\n  0% { width: 0; }\n  100% { width: 100%; }\n}\n\n.animate-progress {\n  animation: progress 3s ease-in-out infinite;\n}\n</style> ","<template>\n  <div class=\"space-y-3 md:space-y-4 px-2\">\n    <!-- Main Control Buttons -->\n    <div class=\"flex justify-center items-center gap-3 md:gap-4\">\n      <!-- Mute Button -->\n      <button\n        @click=\"toggleMute\"\n        class=\"w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center transition-all shadow-xl transform hover:scale-110\"\n        :class=\"isMuted ? 'bg-gradient-to-r from-red-400 to-pink-400 shadow-red-400/70' : 'bg-gradient-to-r from-emerald-400 to-green-400 hover:from-green-400 hover:to-emerald-400 shadow-emerald-400/70'\"\n        :disabled=\"isProcessing\"\n      >\n        <div class=\"relative\">\n          <span v-if=\"!isMuted\" class=\"text-white text-lg md:text-xl\">🎤</span>\n          <span v-else class=\"text-white text-lg md:text-xl\">🔇</span>\n          <span v-if=\"isProcessing\" class=\"absolute -top-1 -right-1 w-3 h-3 bg-yellow-300 rounded-full animate-pulse\"></span>\n        </div>\n      </button>\n\n      <!-- Next/Find Partner Button -->\n      <button\n        @click=\"$emit('find-next')\"\n        class=\"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-r from-orange-400 to-yellow-400 hover:from-yellow-400 hover:to-orange-400 rounded-full flex items-center justify-center shadow-2xl shadow-orange-400/80 transition-all transform hover:scale-110\"\n      >\n        <span class=\"text-white text-2xl md:text-3xl\">📞</span>\n      </button>\n\n      <!-- Chat Button -->\n      <button\n        @click=\"$emit('toggle-chat')\"\n        :disabled=\"isDisabled\"\n        class=\"w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center shadow-xl transition-all transform hover:scale-110\"\n        :class=\"isDisabled ? 'bg-gray-600 cursor-not-allowed opacity-50' : 'bg-gradient-to-r from-blue-400 to-cyan-400 hover:from-cyan-400 hover:to-blue-400 shadow-blue-400/70'\"\n      >\n        <span class=\"text-white text-lg md:text-xl\">💬</span>\n      </button>\n    </div>\n\n    <!-- Secondary Controls -->\n    <div class=\"flex flex-wrap justify-center gap-2 md:gap-3\">\n      <button\n        @click=\"$emit('toggle-games')\"\n        class=\"bg-gradient-to-r from-purple-400 to-pink-400 hover:from-pink-400 hover:to-purple-400 rounded-full px-3 py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-purple-400/70 transition-all transform hover:scale-110\"\n      >\n        🎮 Games\n      </button>\n      <button\n        @click=\"$emit('toggle-history')\"\n        class=\"bg-gradient-to-r from-indigo-400 to-blue-400 hover:from-blue-400 hover:to-indigo-400 rounded-full px-3 py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-indigo-400/70 transition-all transform hover:scale-110\"\n      >\n        📞 History\n      </button>\n      <button\n        @click=\"$emit('toggle-donation')\"\n        class=\"bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-orange-400 hover:to-yellow-400 rounded-full px-3 py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-yellow-400/70 transition-all animate-pulse transform hover:scale-110\"\n      >\n        ❤️ Support\n      </button>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue';\n\nconst props = defineProps({\n  isMuted: {\n    type: Boolean,\n    default: false\n  },\n  isDisabled: {\n    type: Boolean,\n    default: true\n  }\n});\n\nconst emit = defineEmits([\n  'toggle-mute',\n  'find-next',\n  'toggle-chat',\n  'toggle-games',\n  'toggle-history',\n  'toggle-donation'\n]);\n\n// منع النقرات المتكررة\nconst isProcessing = ref(false);\n\n// Enhanced mute toggle function to ensure audio works properly\nfunction toggleMute() {\n  if (isProcessing.value) return; // منع النقرات المتكررة\n  \n  isProcessing.value = true;\n  emit('toggle-mute');\n  \n  // تقليل وقت القفل لزيادة الاستجابة\n  setTimeout(() => {\n    isProcessing.value = false;\n  }, 200); // تقليل الوقت من 500 إلى 200 مللي ثانية\n  \n  // محاولة تشغيل الصوت بعد تفاعل المستخدم\n  setTimeout(() => {\n    try {\n      const audioElement = document.querySelector('audio');\n      if (audioElement && audioElement.paused) {\n        audioElement.play().catch(err => {\n          console.warn('Could not auto-play audio after mute toggle:', err);\n        });\n      }\n    } catch (error) {\n      console.error('Error trying to auto-play:', error);\n    }\n  }, 300);\n}\n</script> ","<template>\r\n  <div v-if=\"isOpen\" class=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n    <div class=\"bg-gray-900 rounded-lg w-full max-w-md mx-auto h-[80vh] flex flex-col\">\r\n      <!-- Header -->\r\n      <div class=\"flex items-center justify-between p-4 border-b border-gray-700\">\r\n        <div class=\"flex items-center\">\r\n          <span class=\"text-white text-lg font-medium\">💬 Chat</span>\r\n        </div>\r\n        <button \r\n          @click=\"$emit('close')\" \r\n          class=\"text-gray-400 hover:text-white\"\r\n        >\r\n          ✕\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- Messages -->\r\n      <div class=\"flex-1 p-4 overflow-y-auto\" ref=\"messagesContainerRef\">\r\n        <div v-if=\"messages.length === 0\" class=\"h-full flex items-center justify-center text-gray-500\">\r\n          <div class=\"text-center\">\r\n            <p>No messages yet</p>\r\n            <p class=\"text-sm mt-1\">Send a message to start the conversation</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div v-else class=\"space-y-2\">\r\n          <div \r\n            v-for=\"message in messages\" \r\n            :key=\"message.id\"\r\n            class=\"rounded-lg p-3 max-w-[80%]\"\r\n            :class=\"message.isOwn \r\n              ? 'bg-blue-700 ml-auto' \r\n              : 'bg-gray-700 mr-auto'\"\r\n          >\r\n            <div class=\"flex justify-between gap-2\">\r\n              <span class=\"text-sm\" :class=\"message.isOwn ? 'text-blue-200' : 'text-gray-200'\">\r\n                {{ message.isOwn ? 'You' : 'Partner' }}\r\n              </span>\r\n              <span class=\"text-xs text-gray-400\">\r\n                {{ formatTime(message.timestamp) }}\r\n              </span>\r\n            </div>\r\n            <p class=\"mt-1 text-white break-words\">{{ message.message }}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Input -->\r\n      <div class=\"p-3 border-t border-gray-700\">\r\n        <form @submit.prevent=\"sendMessage\" class=\"flex gap-2\">\r\n          <input\r\n            v-model=\"currentMessage\"\r\n            type=\"text\"\r\n            placeholder=\"Type a message...\"\r\n            class=\"flex-1 bg-gray-800 border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n            :disabled=\"!isConnected\"\r\n          />\r\n          <button\r\n            type=\"submit\"\r\n            class=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            :disabled=\"!isConnected || !currentMessage.trim()\"\r\n          >\r\n            Send\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted, watch, nextTick } from 'vue';\r\n\r\ninterface Message {\r\n  id: string;\r\n  message: string;\r\n  isOwn: boolean;\r\n  timestamp: number;\r\n}\r\n\r\nconst props = defineProps({\r\n  isOpen: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  isConnected: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  messages: {\r\n    type: Array as () => Message[],\r\n    default: () => []\r\n  }\r\n});\r\n\r\nconst emit = defineEmits(['close', 'send-message']);\r\n\r\nconst currentMessage = ref('');\r\nconst messagesContainerRef = ref<HTMLElement | null>(null);\r\n\r\nconst sendMessage = () => {\r\n  if (currentMessage.value.trim() && props.isConnected) {\r\n    emit('send-message', currentMessage.value);\r\n    currentMessage.value = '';\r\n  }\r\n};\r\n\r\nconst scrollToBottom = async () => {\r\n  await nextTick();\r\n  if (messagesContainerRef.value) {\r\n    messagesContainerRef.value.scrollTop = messagesContainerRef.value.scrollHeight;\r\n  }\r\n};\r\n\r\nconst formatTime = (timestamp: number): string => {\r\n  return new Date(timestamp).toLocaleTimeString([], { \r\n    hour: '2-digit', \r\n    minute: '2-digit' \r\n  });\r\n};\r\n\r\nwatch(() => props.messages, () => {\r\n  scrollToBottom();\r\n}, { deep: true });\r\n\r\nwatch(() => props.isOpen, (newVal) => {\r\n  if (newVal) {\r\n    scrollToBottom();\r\n  }\r\n});\r\n\r\nonMounted(() => {\r\n  if (props.isOpen) {\r\n    scrollToBottom();\r\n  }\r\n});\r\n</script> ","<template>\n  <div class=\"w-full\">\n    <!-- Game Header -->\n    <div class=\"flex justify-between items-center mb-4\">\n      <h2 class=\"text-xl font-bold text-purple-400\">Tic Tac Toe</h2>\n      <div class=\"text-white text-sm\">\n        <span v-if=\"gameState === 'waiting'\" class=\"text-yellow-300 animate-pulse\">\n          Waiting for partner...\n        </span>\n        <span v-else-if=\"winner\">\n          {{ winner === playerSymbol ? 'You Won! 🎉' : winner === 'tie' ? \"It's a Tie! 🤝\" : 'You Lost! 😢' }}\n        </span>\n        <span v-else>\n          {{ isMyTurn ? 'Your Turn' : \"Partner's Turn\" }}\n        </span>\n      </div>\n    </div>\n    \n    <!-- Room Info & Invite - Hidden visually but kept for functionality -->\n    <div v-if=\"roomId\" class=\"hidden\">\n      <div class=\"text-sm text-gray-300\">Room: <span class=\"text-purple-400\">{{ roomId }}</span></div>\n      <button \n        @click=\"copyInviteLink\" \n        class=\"bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm transition-colors\"\n      >\n        {{ copied ? 'Copied!' : 'Invite' }}\n      </button>\n    </div>\n    \n    <!-- Game Board -->\n    <div class=\"bg-gray-800 rounded-lg p-4 mb-4\">\n      <div class=\"flex flex-col items-center\" :class=\"{'opacity-60': gameState === 'waiting'}\">\n        <!-- Player Info -->\n        <div class=\"mb-4 text-center\">\n          <p class=\"text-gray-300 text-sm mb-2\">You are: <span class=\"font-bold text-lg\">{{ playerSymbol }}</span></p>\n        </div>\n        \n        <!-- Board -->\n    <div class=\"grid grid-cols-3 gap-2 mb-4\">\n      <button \n        v-for=\"(cell, index) in board\" \n        :key=\"index\"\n        @click=\"makeMove(index)\"\n            :disabled=\"cell !== '' || !isMyTurn || winner !== null || gameState === 'waiting'\"\n            class=\"w-20 h-20 bg-gray-700 hover:bg-gray-600 rounded-lg flex items-center justify-center text-3xl font-bold transition-colors\"\n            :class=\"{\n              'cursor-not-allowed': cell !== '' || !isMyTurn || winner !== null,\n              'hover:bg-purple-700': isMyTurn && cell === '' && !winner && gameState === 'playing'\n            }\"\n      >\n            <span v-if=\"cell === 'X'\" class=\"text-blue-400\">X</span>\n            <span v-else-if=\"cell === 'O'\" class=\"text-green-400\">O</span>\n          </button>\n        </div>\n        \n        <!-- Game Result Actions -->\n        <div v-if=\"winner\" class=\"text-center mt-4\">\n          <button \n            @click=\"resetGame\" \n            class=\"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm transition-colors mb-2\"\n          >\n            Play Again\n      </button>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Game Controls -->\n    <div class=\"flex justify-between\">\n      <button \n        @click=\"$emit('back')\" \n        class=\"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors\"\n      >\n        Back to Games\n      </button>\n      \n      <button \n        v-if=\"gameState === 'waiting'\"\n        @click=\"sendInvite\" \n        class=\"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors\"\n      >\n        Invite Partner\n      </button>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue';\nimport { useSocket } from '@/services/socket';\n\nconst props = defineProps({\n  partnerId: {\n    type: String,\n    required: true\n  },\n  initialRoomId: {\n    type: String,\n    default: undefined\n  }\n});\n\nconst emit = defineEmits(['back', 'error']);\n\nconst { socket, userId } = useSocket();\n\n// Generate a unique room ID or use the initial one\nconst roomId = ref(props.initialRoomId && props.initialRoomId.startsWith('ttt-') \n  ? props.initialRoomId \n  : `ttt-${Math.random().toString(36).substring(2, 8)}`);\nconst copied = ref(false);\n\n// Game state\nconst gameState = ref<'waiting' | 'playing' | 'finished'>('waiting');\nconst board = ref<string[]>(['', '', '', '', '', '', '', '', '']);\nconst playerSymbol = ref('X');\nconst partnerSymbol = ref('O');\nconst currentTurn = ref('X');\nconst winner = ref<string | null>(null);\nconst partnerReady = ref(false);\nconst connectionLostTimeout = ref<number | null>(null);\nconst lastMoveTime = ref<number>(Date.now());\n\n// Constants\nconst CONNECTION_TIMEOUT = 30000; // 30 seconds without moves considered disconnection\n\n// Computed property to determine if it's the current player's turn\nconst isMyTurn = computed(() => {\n  return currentTurn.value === playerSymbol.value;\n});\n\n// Make a move\nconst makeMove = (index: number) => {\n  if (\n    gameState.value !== 'playing' || \n    board.value[index] !== '' || \n    !isMyTurn.value || \n    winner.value !== null\n  ) return;\n  \n  try {\n    // Update the board locally\n    board.value[index] = playerSymbol.value;\n    currentTurn.value = partnerSymbol.value;\n    lastMoveTime.value = Date.now();\n      \n    // Send the move to the partner\n    socket.value?.emit('game-move', {\n      gameType: 'tic-tac-toe',\n      move: index,\n      to: props.partnerId,\n      roomId: roomId.value\n    });\n    \n    // Check for a winner\n    checkWinner();\n    \n    // Reset connection timeout\n    startConnectionTimeout();\n  } catch (error) {\n    handleError(\"Failed to make a move. Please try again.\");\n  }\n};\n\n// Check for a winner\nconst checkWinner = () => {\n  const winPatterns = [\n    [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows\n    [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns\n    [0, 4, 8], [2, 4, 6]             // diagonals\n  ];\n  \n  // Check for winning combinations\n  for (const pattern of winPatterns) {\n    const [a, b, c] = pattern;\n    if (\n      board.value[a] && \n      board.value[a] === board.value[b] && \n      board.value[a] === board.value[c]\n    ) {\n      winner.value = board.value[a];\n      gameState.value = 'finished';\n      \n      // Clear connection timeout\n      if (connectionLostTimeout.value) {\n        clearTimeout(connectionLostTimeout.value);\n        connectionLostTimeout.value = null;\n      }\n      \n      return;\n    }\n  }\n  \n  // Check for a tie\n  if (!board.value.includes('')) {\n    winner.value = 'tie';\n    gameState.value = 'finished';\n    \n    // Clear connection timeout\n    if (connectionLostTimeout.value) {\n      clearTimeout(connectionLostTimeout.value);\n      connectionLostTimeout.value = null;\n    }\n  }\n};\n\n// Reset the game\nconst resetGame = () => {\n  try {\n    board.value = ['', '', '', '', '', '', '', '', ''];\n    currentTurn.value = Math.random() > 0.5 ? playerSymbol.value : partnerSymbol.value;\n    winner.value = null;\n    gameState.value = partnerReady.value ? 'playing' : 'waiting';\n    lastMoveTime.value = Date.now();\n    \n    // Send reset to the partner\n    socket.value?.emit('game-reset', {\n      gameType: 'tic-tac-toe',\n      to: props.partnerId,\n      roomId: roomId.value\n    });\n    \n    // Start connection timeout\n    startConnectionTimeout();\n  } catch (error) {\n    handleError(\"Failed to reset the game. Please try again.\");\n  }\n};\n\n// Copy invite link to clipboard\nconst copyInviteLink = () => {\n  const link = `${window.location.origin}/game/${roomId.value}`;\n  navigator.clipboard.writeText(link).then(() => {\n    copied.value = true;\n    setTimeout(() => {\n      copied.value = false;\n    }, 2000);\n  }).catch(() => {\n    handleError(\"Failed to copy invite link to clipboard.\");\n  });\n};\n\n// Send game invite\nconst sendInvite = () => {\n  try {\n    socket.value?.emit('game-invite', {\n      gameType: 'tic-tac-toe',\n      to: props.partnerId,\n      roomId: roomId.value\n    });\n  } catch (error) {\n    handleError(\"Failed to send game invite. Please try again.\");\n  }\n};\n\n// Handle errors\nconst handleError = (message: string) => {\n  console.error(`Tic-Tac-Toe Error: ${message}`);\n  emit('error', message);\n};\n\n// Start connection timeout\nconst startConnectionTimeout = () => {\n  // Clear any existing timeout\n  if (connectionLostTimeout.value) {\n    clearTimeout(connectionLostTimeout.value);\n  }\n  \n  // Only set timeout if the game is in progress and not finished\n  if (gameState.value === 'playing' && !winner.value) {\n    connectionLostTimeout.value = window.setTimeout(() => {\n      // Check if no moves for a while\n      if (Date.now() - lastMoveTime.value > CONNECTION_TIMEOUT) {\n        handleError(\"Connection with your partner appears to be lost. The game will be closed.\");\n        emit('back');\n      }\n    }, CONNECTION_TIMEOUT);\n  }\n};\n\n// Setup socket event handlers\nonMounted(() => {\n  try {\n    // Handle partner joining or being ready\n    socket.value?.on('game-invite-accept', (data: any) => {\n      if (data.from === props.partnerId) {\n        partnerReady.value = true;\n        gameState.value = 'playing';\n        lastMoveTime.value = Date.now();\n        \n        // Start connection timeout\n        startConnectionTimeout();\n      }\n    });\n    \n    // Handle partner moves\n    socket.value?.on('game-move', (data: any) => {\n      if (data.from === props.partnerId && data.gameType === 'tic-tac-toe') {\n        const moveIndex = data.move;\n        \n        if (\n          typeof moveIndex === 'number' && \n          moveIndex >= 0 && \n          moveIndex < 9 &&\n          board.value[moveIndex] === ''\n        ) {\n          board.value[moveIndex] = partnerSymbol.value;\n          currentTurn.value = playerSymbol.value;\n          lastMoveTime.value = Date.now();\n          \n          // Check for a winner\n          checkWinner();\n          \n          // Reset connection timeout\n          startConnectionTimeout();\n        } else {\n          handleError(\"Received invalid move from partner.\");\n        }\n      }\n    });\n    \n    // Handle game reset\n    socket.value?.on('game-reset', (data: any) => {\n      if (data.from === props.partnerId && data.gameType === 'tic-tac-toe') {\n        board.value = ['', '', '', '', '', '', '', '', ''];\n        currentTurn.value = data.firstTurn === playerSymbol.value ? playerSymbol.value : partnerSymbol.value;\n        winner.value = null;\n        gameState.value = 'playing';\n        lastMoveTime.value = Date.now();\n        \n        // Start connection timeout\n        startConnectionTimeout();\n      }\n    });\n  } catch (error) {\n    handleError(\"Failed to initialize game connection.\");\n  }\n});\n\n// Clean up event listeners and timeouts\nonUnmounted(() => {\n  socket.value?.off('game-invite-accept');\n  socket.value?.off('game-move');\n  socket.value?.off('game-reset');\n  \n  // Clear connection timeout\n  if (connectionLostTimeout.value) {\n    clearTimeout(connectionLostTimeout.value);\n    connectionLostTimeout.value = null;\n  }\n});\n\n// Start with waiting state\nif (!partnerReady.value) {\n  gameState.value = 'waiting';\n}\n</script>\n\n<style scoped>\n.animate-pulse {\n  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n</style> ","<template>\n  <div class=\"w-full\">\n    <!-- Game Header -->\n    <div class=\"flex justify-between items-center mb-4\">\n      <h2 class=\"text-xl font-bold text-purple-400\">Rock Paper Scissors</h2>\n      <div class=\"text-white text-sm\">\n        <span v-if=\"gameState === 'waiting'\" class=\"text-yellow-300 animate-pulse\">\n          Waiting for partner...\n        </span>\n        <span v-else-if=\"gameState === 'playing' && !playerChoice\">\n          Your Turn\n        </span>\n        <span v-else-if=\"gameState === 'playing' && playerChoice && !bothPlayersReady\">\n          Waiting for partner...\n        </span>\n      </div>\n    </div>\n    \n    <!-- Room Info & Invite - Hidden visually but kept for functionality -->\n    <div v-if=\"roomId\" class=\"hidden\">\n      <div class=\"text-sm text-gray-300\">Room: <span class=\"text-purple-400\">{{ roomId }}</span></div>\n      <button \n        @click=\"copyInviteLink\" \n        class=\"bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm transition-colors\"\n      >\n        {{ copied ? 'Copied!' : 'Invite' }}\n      </button>\n    </div>\n    \n    <!-- Game Board -->\n    <div class=\"bg-gray-800 rounded-lg p-4 mb-4\">\n      <div class=\"flex flex-col items-center\" :class=\"{'opacity-60': gameState !== 'playing'}\">\n        <!-- Your Choice -->\n        <div class=\"mb-6 text-center\">\n          <p class=\"text-gray-300 text-sm mb-1\">Your Choice</p>\n          <div class=\"text-5xl mb-4 h-16 flex items-center justify-center\">{{ playerChoice || '❓' }}</div>\n          \n          <div v-if=\"!playerChoice && gameState === 'playing'\" class=\"flex justify-center gap-4 mb-6\">\n            <button \n              @click=\"makeChoice('rock')\" \n              class=\"text-3xl bg-gray-700 hover:bg-purple-700 w-16 h-16 rounded-full flex items-center justify-center transition-all transform hover:scale-110 active:scale-95\"\n            >\n              👊\n            </button>\n            <button \n              @click=\"makeChoice('paper')\" \n              class=\"text-3xl bg-gray-700 hover:bg-purple-700 w-16 h-16 rounded-full flex items-center justify-center transition-all transform hover:scale-110 active:scale-95\"\n            >\n              ✋\n            </button>\n            <button \n              @click=\"makeChoice('scissors')\" \n              class=\"text-3xl bg-gray-700 hover:bg-purple-700 w-16 h-16 rounded-full flex items-center justify-center transition-all transform hover:scale-110 active:scale-95\"\n            >\n              ✌️\n            </button>\n          </div>\n          \n          <div class=\"w-full h-px bg-gray-700 my-4\"></div>\n          \n          <!-- Partner's Choice - Only show when game is complete -->\n          <p class=\"text-gray-300 text-sm mb-1\">Partner's Choice</p>\n          <div class=\"text-5xl mb-2 h-16 flex items-center justify-center\">\n            <span v-if=\"gameResult && partnerChoice\">{{ partnerChoice }}</span>\n            <span v-else-if=\"playerChoice\" class=\"animate-pulse\">⏳</span>\n            <span v-else>❓</span>\n          </div>\n        </div>\n        \n        <!-- Game Result -->\n        <div v-if=\"gameResult\" class=\"text-center mt-4\">\n          <div class=\"text-xl font-bold mb-4\" \n              :class=\"{\n                'text-green-400': gameResult === 'win',\n                'text-red-400': gameResult === 'lose',\n                'text-yellow-400': gameResult === 'tie'\n              }\">\n            {{ gameResult === 'win' ? 'You Win! 🎉' : gameResult === 'lose' ? 'You Lose! 😢' : 'It\\'s a Tie! 🤝' }}\n          </div>\n          <button \n            @click=\"resetGame\" \n            class=\"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm transition-colors mb-2\"\n          >\n            Play Again\n          </button>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Game Controls -->\n    <div class=\"flex justify-between\">\n      <button \n        @click=\"$emit('back')\" \n        class=\"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors\"\n      >\n        Back to Games\n      </button>\n      \n      <button \n        v-if=\"gameState === 'waiting'\"\n        @click=\"sendInvite\" \n        class=\"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors\"\n      >\n        Invite Partner\n      </button>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onUnmounted, watch, computed } from 'vue';\nimport { useSocket } from '@/services/socket';\n\nconst props = defineProps({\n  partnerId: {\n    type: String,\n    required: true\n  },\n  initialRoomId: {\n    type: String,\n    default: undefined\n  }\n});\n\nconst emit = defineEmits(['back', 'error']);\n\nconst { socket } = useSocket();\n\n// Game state\nconst gameState = ref<'waiting' | 'playing' | 'finished'>('waiting');\nconst playerChoice = ref('');\nconst partnerChoice = ref('');\nconst gameResult = ref<'win' | 'lose' | 'tie' | ''>('');\nconst partnerReady = ref(false);\nconst bothPlayersReady = ref(false);\nconst connectionLostTimeout = ref<number | null>(null);\nconst lastActivityTime = ref<number>(Date.now());\n\n// Constants\nconst CONNECTION_TIMEOUT = 30000; // 30 seconds without activity considered disconnection\n\n// Computed for both players ready\nconst bothReady = computed(() => {\n  return playerChoice.value !== '' && partnerChoice.value !== '';\n});\n\n// Choices mapping\nconst choices = {\n  rock: '👊',\n  paper: '✋',\n  scissors: '✌️'\n};\n\n// Generate a unique room ID or use the initial one\nconst roomId = ref(props.initialRoomId && props.initialRoomId.startsWith('rps-') \n  ? props.initialRoomId \n  : `rps-${Math.random().toString(36).substring(2, 8)}`);\n\n// Copy invite link\nconst copied = ref(false);\nconst copyInviteLink = () => {\n  const link = `${window.location.origin}/game/${roomId.value}`;\n  navigator.clipboard.writeText(link).then(() => {\n    copied.value = true;\n    setTimeout(() => {\n      copied.value = false;\n    }, 2000);\n  }).catch(() => {\n    handleError(\"Failed to copy invite link to clipboard.\");\n  });\n};\n\n// Make a choice\nconst makeChoice = (choice: 'rock' | 'paper' | 'scissors') => {\n  if (gameState.value !== 'playing' || playerChoice.value) return;\n  \n  try {\n    playerChoice.value = choices[choice];\n    lastActivityTime.value = Date.now();\n    \n    // Send the choice to the partner\n    socket.value?.emit('game-move', {\n      gameType: 'rock-paper-scissors',\n      move: choice,\n      to: props.partnerId,\n      roomId: roomId.value\n    });\n    \n    // Check if we can determine a result\n    checkGameResult();\n    \n    // Reset connection timeout\n    startConnectionTimeout();\n  } catch (error) {\n    handleError(\"Failed to make a choice. Please try again.\");\n  }\n};\n\n// Check the game result\nconst checkGameResult = () => {\n  if (!playerChoice.value || !partnerChoice.value) return;\n  \n  try {\n    const playerChoiceText = Object.entries(choices)\n      .find(([_, emoji]) => emoji === playerChoice.value)?.[0];\n    \n    const partnerChoiceText = Object.entries(choices)\n      .find(([_, emoji]) => emoji === partnerChoice.value)?.[0];\n    \n    if (!playerChoiceText || !partnerChoiceText) return;\n    \n    if (playerChoiceText === partnerChoiceText) {\n      gameResult.value = 'tie';\n    } else if (\n      (playerChoiceText === 'rock' && partnerChoiceText === 'scissors') ||\n      (playerChoiceText === 'paper' && partnerChoiceText === 'rock') ||\n      (playerChoiceText === 'scissors' && partnerChoiceText === 'paper')\n    ) {\n      gameResult.value = 'win';\n    } else {\n      gameResult.value = 'lose';\n    }\n    \n    // Game is finished, clear timeout\n    if (gameResult.value) {\n      gameState.value = 'finished';\n      if (connectionLostTimeout.value) {\n        clearTimeout(connectionLostTimeout.value);\n        connectionLostTimeout.value = null;\n      }\n    }\n  } catch (error) {\n    handleError(\"Failed to determine game result.\");\n  }\n};\n\n// Reset the game\nconst resetGame = () => {\n  try {\n    playerChoice.value = '';\n    partnerChoice.value = '';\n    gameResult.value = '';\n    lastActivityTime.value = Date.now();\n    \n    // Send reset to partner\n    socket.value?.emit('game-reset', {\n      gameType: 'rock-paper-scissors',\n      to: props.partnerId,\n      roomId: roomId.value\n    });\n    \n    // Keep state as playing if partner is ready\n    gameState.value = partnerReady.value ? 'playing' : 'waiting';\n    \n    // Start connection timeout\n    startConnectionTimeout();\n  } catch (error) {\n    handleError(\"Failed to reset the game. Please try again.\");\n  }\n};\n\n// Send game invite\nconst sendInvite = () => {\n  try {\n    socket.value?.emit('game-invite', {\n      gameType: 'rock-paper-scissors',\n      to: props.partnerId,\n      roomId: roomId.value\n    });\n  } catch (error) {\n    handleError(\"Failed to send game invite. Please try again.\");\n  }\n};\n\n// Handle errors\nconst handleError = (message: string) => {\n  console.error(`Rock-Paper-Scissors Error: ${message}`);\n  emit('error', message);\n};\n\n// Start connection timeout\nconst startConnectionTimeout = () => {\n  // Clear any existing timeout\n  if (connectionLostTimeout.value) {\n    clearTimeout(connectionLostTimeout.value);\n  }\n  \n  // Only set timeout if the game is in progress and not finished\n  if (gameState.value === 'playing' && !gameResult.value) {\n    connectionLostTimeout.value = window.setTimeout(() => {\n      // Check if no activity for a while\n      if (Date.now() - lastActivityTime.value > CONNECTION_TIMEOUT) {\n        handleError(\"Connection with your partner appears to be lost. The game will be closed.\");\n        emit('back');\n      }\n    }, CONNECTION_TIMEOUT);\n  }\n};\n\n// Socket event handlers\nonMounted(() => {\n  try {\n    // Handle partner joining or being ready\n    socket.value?.on('game-invite-accept', (data: any) => {\n      if (data.from === props.partnerId && data.gameType === 'rock-paper-scissors') {\n        partnerReady.value = true;\n        gameState.value = 'playing';\n        lastActivityTime.value = Date.now();\n        \n        // Start connection timeout\n        startConnectionTimeout();\n      }\n    });\n    \n    // Handle partner moves\n    socket.value?.on('game-move', (data: any) => {\n      if (data.from === props.partnerId && data.gameType === 'rock-paper-scissors') {\n        const move = data.move as keyof typeof choices;\n        \n        if (move && choices[move]) {\n          partnerChoice.value = choices[move];\n          lastActivityTime.value = Date.now();\n          \n          // Check if we can determine a result\n          checkGameResult();\n          \n          // Reset connection timeout\n          startConnectionTimeout();\n        } else {\n          handleError(\"Received invalid move from partner.\");\n        }\n      }\n    });\n    \n    // Handle game reset\n    socket.value?.on('game-reset', (data: any) => {\n      if (data.from === props.partnerId && data.gameType === 'rock-paper-scissors') {\n        playerChoice.value = '';\n        partnerChoice.value = '';\n        gameResult.value = '';\n        gameState.value = 'playing';\n        lastActivityTime.value = Date.now();\n        \n        // Start connection timeout\n        startConnectionTimeout();\n      }\n    });\n    \n    // If we have an initial room ID, start with waiting state\n    if (props.initialRoomId) {\n      gameState.value = 'waiting';\n      sendInvite();\n    }\n  } catch (error) {\n    handleError(\"Failed to initialize game connection.\");\n  }\n});\n\n// Clean up event listeners\nonUnmounted(() => {\n  socket.value?.off('game-invite-accept');\n  socket.value?.off('game-move');\n  socket.value?.off('game-reset');\n  \n  // Clear connection timeout\n  if (connectionLostTimeout.value) {\n    clearTimeout(connectionLostTimeout.value);\n    connectionLostTimeout.value = null;\n  }\n});\n\n// Watch for changes in partner's choice\nwatch([playerChoice, partnerChoice], () => {\n  if (playerChoice.value && partnerChoice.value) {\n    bothPlayersReady.value = true;\n    checkGameResult();\n  } else {\n    bothPlayersReady.value = false;\n  }\n});\n</script>\n\n<style scoped>\n.animate-pulse {\n  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n</style> ","<template>\r\n  <div class=\"w-full max-w-md mx-auto bg-purple-900 bg-opacity-80 rounded-xl p-4 shadow-lg\">\r\n    <div class=\"flex justify-between items-center mb-4\">\r\n      <h2 class=\"text-xl font-bold text-white\">Trivia Challenge</h2>\r\n      <div class=\"text-white\">\r\n        Score: {{ score }}\r\n      </div>\r\n    </div>\r\n    \r\n    <div v-if=\"loading\" class=\"flex flex-col items-center justify-center py-8\">\r\n      <div class=\"animate-spin h-10 w-10 border-4 border-blue-500 rounded-full border-t-transparent mb-4\"></div>\r\n      <p class=\"text-white\">Loading question...</p>\r\n    </div>\r\n    \r\n    <div v-else-if=\"currentQuestion\" class=\"space-y-4\">\r\n      <div class=\"bg-purple-800 bg-opacity-70 p-4 rounded-lg\">\r\n        <p class=\"text-white text-lg mb-2\">{{ currentQuestion.question }}</p>\r\n        <p class=\"text-gray-300 text-sm\">Category: {{ currentQuestion.category }}</p>\r\n      </div>\r\n      \r\n      <div class=\"space-y-2\">\r\n        <button \r\n          v-for=\"(answer, index) in shuffledAnswers\" \r\n          :key=\"index\"\r\n          @click=\"selectAnswer(answer)\"\r\n          :disabled=\"selectedAnswer !== null\"\r\n          :class=\"[\r\n            'w-full text-left p-3 rounded-lg transition-colors text-white',\r\n            selectedAnswer === null ? 'bg-purple-800 hover:bg-purple-700' : \r\n              answer === currentQuestion.correct_answer ? 'bg-green-600' :\r\n              selectedAnswer === answer ? 'bg-red-600' : 'bg-purple-800 opacity-75'\r\n          ]\"\r\n        >\r\n          {{ answer }}\r\n        </button>\r\n      </div>\r\n      \r\n      <div v-if=\"selectedAnswer\" class=\"mt-4 text-center\">\r\n        <p class=\"text-lg mb-4\" :class=\"isCorrect ? 'text-green-400' : 'text-red-400'\">\r\n          {{ isCorrect ? 'Correct! +1 point' : 'Wrong answer!' }}\r\n        </p>\r\n        <button \r\n          @click=\"nextQuestion\"\r\n          class=\"bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg transition-colors\"\r\n        >\r\n          Next Question\r\n        </button>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"mt-6 flex justify-end\">\r\n      <button \r\n        @click=\"$emit('close')\"\r\n        class=\"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors\"\r\n      >\r\n        Exit Game\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, onUnmounted } from 'vue';\r\nimport { useSocket } from '@/services/socket';\r\n\r\n// Define emits\r\nconst emit = defineEmits(['close']);\r\n\r\n// Game state\r\ninterface TriviaQuestion {\r\n  category: string;\r\n  question: string;\r\n  correct_answer: string;\r\n  incorrect_answers: string[];\r\n}\r\n\r\nconst loading = ref(true);\r\nconst currentQuestion = ref<TriviaQuestion | null>(null);\r\nconst shuffledAnswers = ref<string[]>([]);\r\nconst selectedAnswer = ref<string | null>(null);\r\nconst score = ref(0);\r\nconst isCorrect = computed(() => \r\n  selectedAnswer.value === currentQuestion.value?.correct_answer\r\n);\r\n\r\n// Get socket connection\r\nconst { socket, userId } = useSocket();\r\n\r\n// Initialize game\r\nfunction initGame() {\r\n  // Set up event listeners\r\n  socket.value?.on('trivia:question', (question: TriviaQuestion) => {\r\n    currentQuestion.value = question;\r\n    shuffleAnswers();\r\n    selectedAnswer.value = null;\r\n    loading.value = false;\r\n  });\r\n  \r\n  socket.value?.on('trivia:score', (data: { userId: string, score: number }) => {\r\n    if (data.userId === userId.value) {\r\n      score.value = data.score;\r\n    }\r\n  });\r\n  \r\n  // Request first question\r\n  requestQuestion();\r\n}\r\n\r\n// Shuffle answers for the current question\r\nfunction shuffleAnswers() {\r\n  if (!currentQuestion.value) return;\r\n  \r\n  const answers = [\r\n    currentQuestion.value.correct_answer,\r\n    ...currentQuestion.value.incorrect_answers\r\n  ];\r\n  \r\n  // Fisher-Yates shuffle\r\n  for (let i = answers.length - 1; i > 0; i--) {\r\n    const j = Math.floor(Math.random() * (i + 1));\r\n    [answers[i], answers[j]] = [answers[j], answers[i]];\r\n  }\r\n  \r\n  shuffledAnswers.value = answers;\r\n}\r\n\r\n// Select an answer\r\nfunction selectAnswer(answer: string) {\r\n  if (selectedAnswer.value !== null) return;\r\n  \r\n  selectedAnswer.value = answer;\r\n  \r\n  // Send answer to server\r\n  socket.value?.emit('trivia:answer', {\r\n    userId: userId.value,\r\n    answer\r\n  });\r\n  \r\n  // Update score locally\r\n  if (isCorrect.value) {\r\n    score.value++;\r\n  }\r\n}\r\n\r\n// Request new question\r\nfunction requestQuestion() {\r\n  loading.value = true;\r\n  socket.value?.emit('trivia:request', {\r\n    userId: userId.value\r\n  });\r\n}\r\n\r\n// Get next question\r\nfunction nextQuestion() {\r\n  requestQuestion();\r\n}\r\n\r\n// Setup and teardown\r\nonMounted(() => {\r\n  initGame();\r\n});\r\n\r\nonUnmounted(() => {\r\n  // Clean up listeners\r\n  socket.value?.off('trivia:question');\r\n  socket.value?.off('trivia:score');\r\n});\r\n</script>\r\n\r\n<style scoped>\r\nbutton:disabled {\r\n  cursor: not-allowed;\r\n}\r\n\r\n.animate-spin {\r\n  animation: spin 1s linear infinite;\r\n}\r\n\r\n@keyframes spin {\r\n  from {\r\n    transform: rotate(0deg);\r\n  }\r\n  to {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n</style> ","<template>\n  <div class=\"game-selector\">\n    <div v-if=\"!selectedGame\" class=\"game-list\">\n      <h3 class=\"text-xl font-bold mb-4 text-center text-purple-400\">Choose a Game</h3>\n      \n      <div class=\"grid grid-cols-1 gap-4 mb-4\">\n        <button \n          @click=\"selectGame('rock-paper-scissors')\" \n          class=\"p-4 bg-gray-800 rounded-lg flex items-center transition-all hover:bg-gray-700\"\n        >\n          <div class=\"w-12 h-12 bg-orange-600/30 rounded-full flex items-center justify-center mr-4\">\n            <span class=\"text-2xl\">👊</span>\n          </div>\n          <div class=\"flex-1\">\n            <h4 class=\"font-bold\">Rock Paper Scissors</h4>\n            <p class=\"text-sm text-gray-300\">Classic hand game</p>\n          </div>\n        </button>\n        \n        <button \n          @click=\"selectGame('tic-tac-toe')\" \n          class=\"p-4 bg-gray-800 rounded-lg flex items-center transition-all hover:bg-gray-700\"\n        >\n          <div class=\"w-12 h-12 bg-blue-600/30 rounded-full flex items-center justify-center mr-4\">\n            <span class=\"text-2xl\">⭕</span>\n          </div>\n          <div class=\"flex-1\">\n            <h4 class=\"font-bold\">Tic-Tac-Toe</h4>\n            <p class=\"text-sm text-gray-300\">Classic game of X's and O's</p>\n          </div>\n        </button>\n        \n        <button \n          @click=\"selectGame('trivia')\" \n          class=\"p-4 bg-gray-800 rounded-lg flex items-center transition-all hover:bg-gray-700\"\n        >\n          <div class=\"w-12 h-12 bg-green-600/30 rounded-full flex items-center justify-center mr-4\">\n            <span class=\"text-2xl\">❓</span>\n          </div>\n          <div class=\"flex-1\">\n            <h4 class=\"font-bold\">Trivia Challenge</h4>\n            <p class=\"text-sm text-gray-300\">Test your knowledge against your partner</p>\n          </div>\n        </button>\n      </div>\n      \n      <div class=\"text-center\">\n        <button \n          @click=\"$emit('close')\" \n          class=\"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors\"\n        >\n          Cancel\n        </button>\n      </div>\n    </div>\n    \n    <div v-else-if=\"error\" class=\"error-screen text-center p-4\">\n      <div class=\"mb-4\">\n        <div class=\"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-2\">\n          <span class=\"text-2xl\">⚠️</span>\n        </div>\n        <h3 class=\"text-xl font-bold mb-2 text-red-400\">Game Error</h3>\n        <p class=\"text-gray-300 mb-4\">{{ error }}</p>\n      </div>\n      \n      <button \n        @click=\"closeGame\" \n        class=\"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors\"\n      >\n        Back to Games\n      </button>\n    </div>\n    \n    <div v-else-if=\"waitingForAccept\" class=\"waiting-screen text-center p-4\">\n      <div class=\"animate-pulse mb-4\">\n        <div class=\"w-16 h-16 bg-purple-600/30 rounded-full flex items-center justify-center mx-auto mb-2\">\n          <span class=\"text-2xl\">⏳</span>\n        </div>\n        <h3 class=\"text-xl font-bold text-purple-400\">Waiting for partner to accept...</h3>\n      </div>\n      \n      <button \n        @click=\"cancelGame\" \n        class=\"px-4 py-2 bg-red-600 rounded-full hover:bg-red-700 transition-colors\"\n      >\n        Cancel\n      </button>\n    </div>\n    \n    <div v-else-if=\"showGameInvite\" class=\"game-invite text-center p-4\">\n      <div class=\"mb-4\">\n        <div class=\"w-16 h-16 bg-green-600/30 rounded-full flex items-center justify-center mx-auto mb-2\">\n          <span class=\"text-2xl\">🎮</span>\n        </div>\n        <h3 class=\"text-xl font-bold mb-2 text-purple-400\">Game Invitation</h3>\n        <p>Your partner wants to play {{ inviteGameName }}</p>\n      </div>\n      \n      <div class=\"flex justify-center gap-4\">\n        <button \n          @click=\"acceptInvite\" \n          class=\"px-4 py-2 bg-green-600 rounded-full hover:bg-green-700 transition-colors\"\n        >\n          Accept\n        </button>\n        <button \n          @click=\"declineInvite\" \n          class=\"px-4 py-2 bg-red-600 rounded-full hover:bg-red-700 transition-colors\"\n        >\n          Decline\n        </button>\n      </div>\n    </div>\n    \n    <TicTacToe \n      v-else-if=\"selectedGame === 'tic-tac-toe'\" \n      :partnerId=\"partnerId\"\n      :initialRoomId=\"roomId ? roomId : undefined\"\n      @back=\"closeGame\"\n      @error=\"handleGameError\"\n    />\n    \n    <RockPaperScissors \n      v-else-if=\"selectedGame === 'rock-paper-scissors'\" \n      :partnerId=\"partnerId\"\n      :initialRoomId=\"roomId ? roomId : undefined\"\n      @back=\"closeGame\"\n      @error=\"handleGameError\"\n    />\n    \n    <TriviaGame \n      v-else-if=\"selectedGame === 'trivia'\" \n      :partnerId=\"partnerId\"\n      :initiator=\"isInitiator\"\n      @close=\"closeGame\"\n      @game-end=\"handleGameEnd\"\n      @error=\"handleGameError\"\n    />\n\n    <div v-else class=\"game-not-found text-center p-4\">\n      <div class=\"mb-4\">\n        <div class=\"w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-2\">\n          <span class=\"text-2xl\">🔍</span>\n        </div>\n        <h3 class=\"text-xl font-bold mb-2 text-yellow-400\">Game Not Found</h3>\n        <p class=\"text-gray-300\">The selected game is not available.</p>\n      </div>\n      \n      <button \n        @click=\"closeGame\" \n        class=\"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors\"\n      >\n        Back to Games\n      </button>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, computed, onMounted, onUnmounted, watch } from 'vue';\nimport { useSocket } from '@/services/socket';\nimport TicTacToe from './TicTacToe.vue';\nimport RockPaperScissors from './RockPaperScissors.vue';\nimport TriviaGame from './TriviaGame.vue';\n\nexport default defineComponent({\n  name: 'GameSelector',\n  components: {\n    TicTacToe,\n    RockPaperScissors,\n    TriviaGame\n  },\n  props: {\n    partnerId: {\n      type: String,\n      required: true\n    }\n  },\n  emits: ['close', 'error'],\n  setup(props, { emit }) {\n    const { socket } = useSocket();\n    \n    const selectedGame = ref<string | null>(null);\n    const waitingForAccept = ref(false);\n    const showGameInvite = ref(false);\n    const inviteGameType = ref<string | null>(null);\n    const isInitiator = ref(false);\n    const roomId = ref<string | null>(null);\n    const error = ref<string | null>(null);\n    \n    // Constants\n    const INVITE_TIMEOUT = 30000; // 30 seconds\n    const IMPLEMENTED_GAMES = ['tic-tac-toe', 'rock-paper-scissors', 'trivia'];\n    \n    // Game name mapping\n    const gameNames: Record<string, string> = {\n      'tic-tac-toe': 'Tic-Tac-Toe',\n      'rock-paper-scissors': 'Rock Paper Scissors',\n      'trivia': 'Trivia Challenge',\n      'sound-game': 'Sound Game',\n      'word-galaxy': 'Word Galaxy'\n    };\n    \n    // Computed for game name\n    const inviteGameName = computed(() => {\n      return inviteGameType.value ? gameNames[inviteGameType.value] || inviteGameType.value : '';\n    });\n    \n    // Check if game is implemented\n    const isGameImplemented = (gameType: string): boolean => {\n      return IMPLEMENTED_GAMES.includes(gameType);\n    };\n    \n    // Select a game to play\n    const selectGame = (gameType: string) => {\n      // Check if game is implemented\n      if (!isGameImplemented(gameType)) {\n        error.value = `${gameNames[gameType] || gameType} is not yet implemented. Please try another game.`;\n        emit('error', error.value);\n        return;\n      }\n      \n      error.value = null;\n      waitingForAccept.value = true;\n      isInitiator.value = true;\n      \n      // Set selected game type immediately so we can show correct game UI \n      // but keep waiting overlay until partner accepts\n      selectedGame.value = gameType;\n      \n      // Send game invite to partner\n      socket.value?.emit('game-invite', {\n        gameType,\n        to: props.partnerId\n      });\n      \n      // Set a timeout in case partner doesn't respond\n      const timeoutId = setTimeout(() => {\n        if (waitingForAccept.value) {\n          waitingForAccept.value = false;\n          selectedGame.value = null;\n          error.value = \"Your partner didn't respond to the game invitation. Please try again.\";\n          emit('error', error.value);\n        }\n      }, INVITE_TIMEOUT);\n      \n      // Clear timeout if component is unmounted\n      onUnmounted(() => {\n        clearTimeout(timeoutId);\n      });\n    };\n    \n    // Cancel game selection\n    const cancelGame = () => {\n      // Notify partner\n      if (waitingForAccept.value) {\n        socket.value?.emit('game-invite-cancel', {\n          to: props.partnerId\n        });\n      }\n      \n      resetGameState();\n    };\n    \n    // Accept game invite\n    const acceptInvite = () => {\n      if (!inviteGameType.value) return;\n      \n      // Check if game is implemented\n      if (!isGameImplemented(inviteGameType.value)) {\n        error.value = `${gameNames[inviteGameType.value] || inviteGameType.value} is not yet implemented. Please ask your partner to choose another game.`;\n        emit('error', error.value);\n        \n        // Notify partner about the error\n        socket.value?.emit('game-invite-decline', {\n          to: props.partnerId\n        });\n        \n        showGameInvite.value = false;\n        inviteGameType.value = null;\n        return;\n      }\n      \n      error.value = null;\n      selectedGame.value = inviteGameType.value;\n      showGameInvite.value = false;\n      isInitiator.value = false;\n      \n      // Notify partner\n      socket.value?.emit('game-invite-accept', {\n        gameType: inviteGameType.value,\n        to: props.partnerId\n      });\n      \n      // Important: Clear waiting state when accepting an invite\n      waitingForAccept.value = false;\n    };\n    \n    // Decline game invite\n    const declineInvite = () => {\n      // Notify partner\n      socket.value?.emit('game-invite-decline', {\n        to: props.partnerId\n      });\n      \n      showGameInvite.value = false;\n      inviteGameType.value = null;\n    };\n    \n    // Close game\n    const closeGame = () => {\n      resetGameState();\n      \n      // Notify partner\n      socket.value?.emit('game-close', {\n        to: props.partnerId\n      });\n      \n      emit('close');\n    };\n    \n    // Reset game state\n    const resetGameState = () => {\n      selectedGame.value = null;\n      waitingForAccept.value = false;\n      showGameInvite.value = false;\n      inviteGameType.value = null;\n      roomId.value = null;\n      error.value = null;\n    };\n    \n    // Handle game error\n    const handleGameError = (errorMessage: string) => {\n      error.value = errorMessage;\n      emit('error', errorMessage);\n    };\n    \n    // Handle game end\n    const handleGameEnd = (result: any) => {\n      console.log('Game ended with result:', result);\n      // You can add any additional logic here for handling game results\n    };\n    \n    // Setup socket event handlers\n    onMounted(() => {\n      // Handle game invites from partner\n      socket.value?.on('game-invite', (data: any) => {\n        if (data.from === props.partnerId) {\n          inviteGameType.value = data.gameType;\n          roomId.value = data.roomId || null;\n          showGameInvite.value = true;\n        }\n      });\n      \n      // Handle invite acceptance\n      socket.value?.on('game-invite-accept', (data: any) => {\n        if (data.from === props.partnerId) {\n          if (waitingForAccept.value) {\n            waitingForAccept.value = false;\n            selectedGame.value = data.gameType;\n          } else if (showGameInvite.value) {\n            // If we're showing an invite and partner accepts, we should proceed with the game\n            showGameInvite.value = false;\n            selectedGame.value = inviteGameType.value;\n          }\n        }\n      });\n      \n      // Handle invite declination\n      socket.value?.on('game-invite-decline', (data: any) => {\n        if (data.from === props.partnerId) {\n          waitingForAccept.value = false;\n          selectedGame.value = null;\n          error.value = \"Your partner declined the game invitation.\";\n          emit('error', error.value);\n        }\n      });\n      \n      // Handle invite cancellation\n      socket.value?.on('game-invite-cancel', (data: any) => {\n        if (data.from === props.partnerId) {\n          showGameInvite.value = false;\n          inviteGameType.value = null;\n        }\n      });\n      \n      // Handle game close\n      socket.value?.on('game-close', (data: any) => {\n        if (data.from === props.partnerId) {\n          resetGameState();\n          error.value = \"Your partner ended the game session.\";\n          emit('error', error.value);\n          emit('close');\n        }\n      });\n      \n      // Handle game errors\n      socket.value?.on('game-error', (data: any) => {\n        if (data.from === props.partnerId) {\n          error.value = data.message || \"An error occurred in the game.\";\n          emit('error', error.value);\n        }\n      });\n    });\n    \n    // Clean up event listeners\n    onUnmounted(() => {\n      socket.value?.off('game-invite');\n      socket.value?.off('game-invite-accept');\n      socket.value?.off('game-invite-decline');\n      socket.value?.off('game-invite-cancel');\n      socket.value?.off('game-close');\n      socket.value?.off('game-error');\n    });\n    \n    return {\n      selectedGame,\n      waitingForAccept,\n      showGameInvite,\n      inviteGameType,\n      isInitiator,\n      roomId,\n      inviteGameName,\n      error,\n      selectGame,\n      cancelGame,\n      acceptInvite,\n      declineInvite,\n      closeGame,\n      handleGameEnd,\n      handleGameError\n    };\n  }\n});\n</script> ","<template>\n  <div class=\"game-selector\">\n    <div v-if=\"!selectedGame\" class=\"game-list\">\n      <h3 class=\"text-xl font-bold mb-4 text-center text-purple-400\">Choose a Game</h3>\n      \n      <div class=\"grid grid-cols-1 gap-4 mb-4\">\n        <button \n          @click=\"selectGame('rock-paper-scissors')\" \n          class=\"p-4 bg-gray-800 rounded-lg flex items-center transition-all hover:bg-gray-700\"\n        >\n          <div class=\"w-12 h-12 bg-orange-600/30 rounded-full flex items-center justify-center mr-4\">\n            <span class=\"text-2xl\">👊</span>\n          </div>\n          <div class=\"flex-1\">\n            <h4 class=\"font-bold\">Rock Paper Scissors</h4>\n            <p class=\"text-sm text-gray-300\">Classic hand game</p>\n          </div>\n        </button>\n        \n        <button \n          @click=\"selectGame('tic-tac-toe')\" \n          class=\"p-4 bg-gray-800 rounded-lg flex items-center transition-all hover:bg-gray-700\"\n        >\n          <div class=\"w-12 h-12 bg-blue-600/30 rounded-full flex items-center justify-center mr-4\">\n            <span class=\"text-2xl\">⭕</span>\n          </div>\n          <div class=\"flex-1\">\n            <h4 class=\"font-bold\">Tic-Tac-Toe</h4>\n            <p class=\"text-sm text-gray-300\">Classic game of X's and O's</p>\n          </div>\n        </button>\n        \n        <button \n          @click=\"selectGame('trivia')\" \n          class=\"p-4 bg-gray-800 rounded-lg flex items-center transition-all hover:bg-gray-700\"\n        >\n          <div class=\"w-12 h-12 bg-green-600/30 rounded-full flex items-center justify-center mr-4\">\n            <span class=\"text-2xl\">❓</span>\n          </div>\n          <div class=\"flex-1\">\n            <h4 class=\"font-bold\">Trivia Challenge</h4>\n            <p class=\"text-sm text-gray-300\">Test your knowledge against your partner</p>\n          </div>\n        </button>\n      </div>\n      \n      <div class=\"text-center\">\n        <button \n          @click=\"$emit('close')\" \n          class=\"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors\"\n        >\n          Cancel\n        </button>\n      </div>\n    </div>\n    \n    <div v-else-if=\"error\" class=\"error-screen text-center p-4\">\n      <div class=\"mb-4\">\n        <div class=\"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-2\">\n          <span class=\"text-2xl\">⚠️</span>\n        </div>\n        <h3 class=\"text-xl font-bold mb-2 text-red-400\">Game Error</h3>\n        <p class=\"text-gray-300 mb-4\">{{ error }}</p>\n      </div>\n      \n      <button \n        @click=\"closeGame\" \n        class=\"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors\"\n      >\n        Back to Games\n      </button>\n    </div>\n    \n    <div v-else-if=\"waitingForAccept\" class=\"waiting-screen text-center p-4\">\n      <div class=\"animate-pulse mb-4\">\n        <div class=\"w-16 h-16 bg-purple-600/30 rounded-full flex items-center justify-center mx-auto mb-2\">\n          <span class=\"text-2xl\">⏳</span>\n        </div>\n        <h3 class=\"text-xl font-bold text-purple-400\">Waiting for partner to accept...</h3>\n      </div>\n      \n      <button \n        @click=\"cancelGame\" \n        class=\"px-4 py-2 bg-red-600 rounded-full hover:bg-red-700 transition-colors\"\n      >\n        Cancel\n      </button>\n    </div>\n    \n    <div v-else-if=\"showGameInvite\" class=\"game-invite text-center p-4\">\n      <div class=\"mb-4\">\n        <div class=\"w-16 h-16 bg-green-600/30 rounded-full flex items-center justify-center mx-auto mb-2\">\n          <span class=\"text-2xl\">🎮</span>\n        </div>\n        <h3 class=\"text-xl font-bold mb-2 text-purple-400\">Game Invitation</h3>\n        <p>Your partner wants to play {{ inviteGameName }}</p>\n      </div>\n      \n      <div class=\"flex justify-center gap-4\">\n        <button \n          @click=\"acceptInvite\" \n          class=\"px-4 py-2 bg-green-600 rounded-full hover:bg-green-700 transition-colors\"\n        >\n          Accept\n        </button>\n        <button \n          @click=\"declineInvite\" \n          class=\"px-4 py-2 bg-red-600 rounded-full hover:bg-red-700 transition-colors\"\n        >\n          Decline\n        </button>\n      </div>\n    </div>\n    \n    <TicTacToe \n      v-else-if=\"selectedGame === 'tic-tac-toe'\" \n      :partnerId=\"partnerId\"\n      :initialRoomId=\"roomId ? roomId : undefined\"\n      @back=\"closeGame\"\n      @error=\"handleGameError\"\n    />\n    \n    <RockPaperScissors \n      v-else-if=\"selectedGame === 'rock-paper-scissors'\" \n      :partnerId=\"partnerId\"\n      :initialRoomId=\"roomId ? roomId : undefined\"\n      @back=\"closeGame\"\n      @error=\"handleGameError\"\n    />\n    \n    <TriviaGame \n      v-else-if=\"selectedGame === 'trivia'\" \n      :partnerId=\"partnerId\"\n      :initiator=\"isInitiator\"\n      @close=\"closeGame\"\n      @game-end=\"handleGameEnd\"\n      @error=\"handleGameError\"\n    />\n\n    <div v-else class=\"game-not-found text-center p-4\">\n      <div class=\"mb-4\">\n        <div class=\"w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-2\">\n          <span class=\"text-2xl\">🔍</span>\n        </div>\n        <h3 class=\"text-xl font-bold mb-2 text-yellow-400\">Game Not Found</h3>\n        <p class=\"text-gray-300\">The selected game is not available.</p>\n      </div>\n      \n      <button \n        @click=\"closeGame\" \n        class=\"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors\"\n      >\n        Back to Games\n      </button>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, computed, onMounted, onUnmounted, watch } from 'vue';\nimport { useSocket } from '@/services/socket';\nimport TicTacToe from './TicTacToe.vue';\nimport RockPaperScissors from './RockPaperScissors.vue';\nimport TriviaGame from './TriviaGame.vue';\n\nexport default defineComponent({\n  name: 'GameSelector',\n  components: {\n    TicTacToe,\n    RockPaperScissors,\n    TriviaGame\n  },\n  props: {\n    partnerId: {\n      type: String,\n      required: true\n    }\n  },\n  emits: ['close', 'error'],\n  setup(props, { emit }) {\n    const { socket } = useSocket();\n    \n    const selectedGame = ref<string | null>(null);\n    const waitingForAccept = ref(false);\n    const showGameInvite = ref(false);\n    const inviteGameType = ref<string | null>(null);\n    const isInitiator = ref(false);\n    const roomId = ref<string | null>(null);\n    const error = ref<string | null>(null);\n    \n    // Constants\n    const INVITE_TIMEOUT = 30000; // 30 seconds\n    const IMPLEMENTED_GAMES = ['tic-tac-toe', 'rock-paper-scissors', 'trivia'];\n    \n    // Game name mapping\n    const gameNames: Record<string, string> = {\n      'tic-tac-toe': 'Tic-Tac-Toe',\n      'rock-paper-scissors': 'Rock Paper Scissors',\n      'trivia': 'Trivia Challenge',\n      'sound-game': 'Sound Game',\n      'word-galaxy': 'Word Galaxy'\n    };\n    \n    // Computed for game name\n    const inviteGameName = computed(() => {\n      return inviteGameType.value ? gameNames[inviteGameType.value] || inviteGameType.value : '';\n    });\n    \n    // Check if game is implemented\n    const isGameImplemented = (gameType: string): boolean => {\n      return IMPLEMENTED_GAMES.includes(gameType);\n    };\n    \n    // Select a game to play\n    const selectGame = (gameType: string) => {\n      // Check if game is implemented\n      if (!isGameImplemented(gameType)) {\n        error.value = `${gameNames[gameType] || gameType} is not yet implemented. Please try another game.`;\n        emit('error', error.value);\n        return;\n      }\n      \n      error.value = null;\n      waitingForAccept.value = true;\n      isInitiator.value = true;\n      \n      // Set selected game type immediately so we can show correct game UI \n      // but keep waiting overlay until partner accepts\n      selectedGame.value = gameType;\n      \n      // Send game invite to partner\n      socket.value?.emit('game-invite', {\n        gameType,\n        to: props.partnerId\n      });\n      \n      // Set a timeout in case partner doesn't respond\n      const timeoutId = setTimeout(() => {\n        if (waitingForAccept.value) {\n          waitingForAccept.value = false;\n          selectedGame.value = null;\n          error.value = \"Your partner didn't respond to the game invitation. Please try again.\";\n          emit('error', error.value);\n        }\n      }, INVITE_TIMEOUT);\n      \n      // Clear timeout if component is unmounted\n      onUnmounted(() => {\n        clearTimeout(timeoutId);\n      });\n    };\n    \n    // Cancel game selection\n    const cancelGame = () => {\n      // Notify partner\n      if (waitingForAccept.value) {\n        socket.value?.emit('game-invite-cancel', {\n          to: props.partnerId\n        });\n      }\n      \n      resetGameState();\n    };\n    \n    // Accept game invite\n    const acceptInvite = () => {\n      if (!inviteGameType.value) return;\n      \n      // Check if game is implemented\n      if (!isGameImplemented(inviteGameType.value)) {\n        error.value = `${gameNames[inviteGameType.value] || inviteGameType.value} is not yet implemented. Please ask your partner to choose another game.`;\n        emit('error', error.value);\n        \n        // Notify partner about the error\n        socket.value?.emit('game-invite-decline', {\n          to: props.partnerId\n        });\n        \n        showGameInvite.value = false;\n        inviteGameType.value = null;\n        return;\n      }\n      \n      error.value = null;\n      selectedGame.value = inviteGameType.value;\n      showGameInvite.value = false;\n      isInitiator.value = false;\n      \n      // Notify partner\n      socket.value?.emit('game-invite-accept', {\n        gameType: inviteGameType.value,\n        to: props.partnerId\n      });\n      \n      // Important: Clear waiting state when accepting an invite\n      waitingForAccept.value = false;\n    };\n    \n    // Decline game invite\n    const declineInvite = () => {\n      // Notify partner\n      socket.value?.emit('game-invite-decline', {\n        to: props.partnerId\n      });\n      \n      showGameInvite.value = false;\n      inviteGameType.value = null;\n    };\n    \n    // Close game\n    const closeGame = () => {\n      resetGameState();\n      \n      // Notify partner\n      socket.value?.emit('game-close', {\n        to: props.partnerId\n      });\n      \n      emit('close');\n    };\n    \n    // Reset game state\n    const resetGameState = () => {\n      selectedGame.value = null;\n      waitingForAccept.value = false;\n      showGameInvite.value = false;\n      inviteGameType.value = null;\n      roomId.value = null;\n      error.value = null;\n    };\n    \n    // Handle game error\n    const handleGameError = (errorMessage: string) => {\n      error.value = errorMessage;\n      emit('error', errorMessage);\n    };\n    \n    // Handle game end\n    const handleGameEnd = (result: any) => {\n      console.log('Game ended with result:', result);\n      // You can add any additional logic here for handling game results\n    };\n    \n    // Setup socket event handlers\n    onMounted(() => {\n      // Handle game invites from partner\n      socket.value?.on('game-invite', (data: any) => {\n        if (data.from === props.partnerId) {\n          inviteGameType.value = data.gameType;\n          roomId.value = data.roomId || null;\n          showGameInvite.value = true;\n        }\n      });\n      \n      // Handle invite acceptance\n      socket.value?.on('game-invite-accept', (data: any) => {\n        if (data.from === props.partnerId) {\n          if (waitingForAccept.value) {\n            waitingForAccept.value = false;\n            selectedGame.value = data.gameType;\n          } else if (showGameInvite.value) {\n            // If we're showing an invite and partner accepts, we should proceed with the game\n            showGameInvite.value = false;\n            selectedGame.value = inviteGameType.value;\n          }\n        }\n      });\n      \n      // Handle invite declination\n      socket.value?.on('game-invite-decline', (data: any) => {\n        if (data.from === props.partnerId) {\n          waitingForAccept.value = false;\n          selectedGame.value = null;\n          error.value = \"Your partner declined the game invitation.\";\n          emit('error', error.value);\n        }\n      });\n      \n      // Handle invite cancellation\n      socket.value?.on('game-invite-cancel', (data: any) => {\n        if (data.from === props.partnerId) {\n          showGameInvite.value = false;\n          inviteGameType.value = null;\n        }\n      });\n      \n      // Handle game close\n      socket.value?.on('game-close', (data: any) => {\n        if (data.from === props.partnerId) {\n          resetGameState();\n          error.value = \"Your partner ended the game session.\";\n          emit('error', error.value);\n          emit('close');\n        }\n      });\n      \n      // Handle game errors\n      socket.value?.on('game-error', (data: any) => {\n        if (data.from === props.partnerId) {\n          error.value = data.message || \"An error occurred in the game.\";\n          emit('error', error.value);\n        }\n      });\n    });\n    \n    // Clean up event listeners\n    onUnmounted(() => {\n      socket.value?.off('game-invite');\n      socket.value?.off('game-invite-accept');\n      socket.value?.off('game-invite-decline');\n      socket.value?.off('game-invite-cancel');\n      socket.value?.off('game-close');\n      socket.value?.off('game-error');\n    });\n    \n    return {\n      selectedGame,\n      waitingForAccept,\n      showGameInvite,\n      inviteGameType,\n      isInitiator,\n      roomId,\n      inviteGameName,\n      error,\n      selectGame,\n      cancelGame,\n      acceptInvite,\n      declineInvite,\n      closeGame,\n      handleGameEnd,\n      handleGameError\n    };\n  }\n});\n</script> ","<template>\n  <div v-if=\"isOpen\" class=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\">\n    <div class=\"bg-[#1e1e2e] rounded-lg w-full max-w-md mx-auto shadow-2xl relative overflow-hidden\">\n      <!-- Header -->\n      <div class=\"flex items-center justify-between p-3 border-b border-gray-800\">\n        <div class=\"flex items-center gap-2\">\n          <span class=\"text-purple-400 text-xl\">🎮</span>\n          <h2 class=\"text-xl font-semibold text-[#a881fc]\">Space Games</h2>\n        </div>\n        <button \n          @click=\"$emit('close')\" \n          class=\"text-gray-400 hover:text-white text-lg\"\n        >\n          ✕\n        </button>\n      </div>\n      \n      <!-- Game Select View -->\n      <div v-if=\"!selectedGame\" class=\"p-4\">\n        <!-- Games Grid -->\n        <div class=\"grid grid-cols-2 gap-4 mb-4\">\n          <!-- Rock Paper Scissors -->\n          <button \n            class=\"bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors\"\n            @click=\"selectGame('rock-paper-scissors')\"\n            :disabled=\"!isConnected\"\n            :class=\"{'opacity-50 cursor-not-allowed': !isConnected}\"\n          >\n            <div class=\"bg-yellow-500 text-white w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl\">👊</div>\n            <div class=\"text-white font-medium\">Rock Paper Scissors</div>\n            <div class=\"text-xs text-gray-400\">vs Partner</div>\n          </button>\n          \n          <!-- Sound Game -->\n          <button \n            class=\"bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center relative\"\n            :class=\"{'opacity-50 cursor-not-allowed': true}\"\n            disabled\n          >\n            <div class=\"absolute inset-0 flex items-center justify-center bg-[#2e2e42]/80 rounded-lg\">\n              <span class=\"bg-purple-500 text-white text-xs px-2 py-1 rounded-md font-medium\">Coming Soon</span>\n            </div>\n            <div class=\"bg-indigo-600 text-white w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl\">🎵</div>\n            <div class=\"text-white font-medium\">Sound Game</div>\n            <div class=\"text-xs text-gray-400\">Voice Challenge</div>\n          </button>\n          \n          <!-- Tic Tac Toe -->\n          <button \n            class=\"bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors\"\n            @click=\"selectGame('tic-tac-toe')\"\n            :disabled=\"!isConnected\"\n            :class=\"{'opacity-50 cursor-not-allowed': !isConnected}\"\n          >\n            <div class=\"bg-red-600 text-white w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl\">⭕</div>\n            <div class=\"text-white font-medium\">Tic-Tac-Toe</div>\n            <div class=\"text-xs text-gray-400\">vs Partner</div>\n          </button>\n          \n          <!-- Word Galaxy -->\n          <button \n            class=\"bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center relative\"\n            :class=\"{'opacity-50 cursor-not-allowed': true}\"\n            disabled\n          >\n            <div class=\"absolute inset-0 flex items-center justify-center bg-[#2e2e42]/80 rounded-lg\">\n              <span class=\"bg-purple-500 text-white text-xs px-2 py-1 rounded-md font-medium\">Coming Soon</span>\n            </div>\n            <div class=\"bg-white text-gray-800 w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl\">💬</div>\n            <div class=\"text-white font-medium\">Word Galaxy</div>\n            <div class=\"text-xs text-gray-400\">Brain Game</div>\n          </button>\n        </div>\n        \n        <!-- Connection Notice -->\n        <p v-if=\"!isConnected\" class=\"text-center text-sm text-gray-400 mt-2\">\n          Connect to play with others\n        </p>\n      </div>\n      \n      <!-- Error Message -->\n      <div v-else-if=\"errorMessage\" class=\"text-center p-6\">\n        <div class=\"mb-4\">\n          <div class=\"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-2\">\n            <span class=\"text-2xl\">⚠️</span>\n          </div>\n          <h3 class=\"text-xl font-bold mb-2 text-red-400\">Game Error</h3>\n          <p class=\"text-gray-300\">{{ errorMessage }}</p>\n        </div>\n        \n        <button \n          @click=\"closeGame\" \n          class=\"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors mt-2\"\n        >\n          Back to Games\n        </button>\n      </div>\n      \n      <!-- Game Waiting Screen -->\n      <div v-else-if=\"waitingForAccept\" class=\"text-center p-6\">\n        <div class=\"animate-pulse mb-4\">\n          <div class=\"w-16 h-16 bg-purple-600/30 rounded-full flex items-center justify-center mx-auto mb-2\">\n            <span class=\"text-2xl\">⏳</span>\n          </div>\n          <h3 class=\"text-xl font-bold text-purple-400\">Waiting for partner to accept...</h3>\n        </div>\n        \n        <button \n          @click=\"cancelGame\" \n          class=\"px-4 py-2 bg-red-600 rounded-full hover:bg-red-700 transition-colors\"\n        >\n          Cancel\n        </button>\n      </div>\n      \n      <!-- Game Invite Screen -->\n      <div v-else-if=\"showGameInvite\" class=\"text-center p-6\">\n        <div class=\"mb-4\">\n          <div class=\"w-16 h-16 bg-green-600/30 rounded-full flex items-center justify-center mx-auto mb-2\">\n            <span class=\"text-2xl\">🎮</span>\n          </div>\n          <h3 class=\"text-xl font-bold mb-2 text-purple-400\">Game Invitation</h3>\n          <p>Your partner wants to play {{ getGameName(inviteGameType) }}</p>\n        </div>\n        \n        <div class=\"flex justify-center gap-4\">\n          <button \n            @click=\"acceptInvite\" \n            class=\"px-4 py-2 bg-green-600 rounded-full hover:bg-green-700 transition-colors\"\n          >\n            Accept\n          </button>\n          <button \n            @click=\"declineInvite\" \n            class=\"px-4 py-2 bg-red-600 rounded-full hover:bg-red-700 transition-colors\"\n          >\n            Decline\n          </button>\n        </div>\n      </div>\n      \n      <!-- Game View -->\n      <div v-else class=\"mt-2\">\n        <GameSelector \n          :partnerId=\"partnerId\" \n          @close=\"closeGame\"\n          @error=\"handleGameError\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onUnmounted, watch } from 'vue';\nimport { useSocket } from '@/services/socket';\nimport GameSelector from './games/GameSelector.vue';\n\nconst { socket } = useSocket();\n\nconst props = defineProps({\n  isOpen: {\n    type: Boolean,\n    default: false\n  },\n  partnerId: {\n    type: String,\n    required: true\n  },\n  isConnected: {\n    type: Boolean,\n    default: false\n  }\n});\n\nconst emit = defineEmits(['close']);\n\n// Game state\nconst selectedGame = ref<string | null>(null);\nconst waitingForAccept = ref(false);\nconst showGameInvite = ref(false);\nconst inviteGameType = ref<string | null>(null);\nconst errorMessage = ref<string | null>(null);\n\n// Constants\nconst INVITE_TIMEOUT = 30000; // 30 seconds\nconst IMPLEMENTED_GAMES = ['rock-paper-scissors', 'tic-tac-toe', 'trivia'];\n\n// Game name mapping\nconst gameNames: Record<string, string> = {\n  'tic-tac-toe': 'Tic-Tac-Toe',\n  'rock-paper-scissors': 'Rock Paper Scissors',\n  'trivia': 'Trivia Challenge',\n  'sound-game': 'Sound Game',\n  'word-galaxy': 'Word Galaxy'\n};\n\n// Get game name\nconst getGameName = (type: string | null): string => {\n  return type ? (gameNames[type] || type) : '';\n};\n\n// Check if game is implemented\nconst isGameImplemented = (gameType: string): boolean => {\n  return IMPLEMENTED_GAMES.includes(gameType);\n};\n\n// Select a game\nconst selectGame = (gameType: string) => {\n  if (!props.isConnected) return;\n  \n  // Check if game is implemented\n  if (!isGameImplemented(gameType)) {\n    errorMessage.value = `${getGameName(gameType)} is not yet implemented. Please try another game.`;\n    return;\n  }\n  \n  errorMessage.value = null;\n  selectedGame.value = gameType;\n  waitingForAccept.value = true;\n  \n  // Send game invite to partner\n  socket.value?.emit('game-invite', {\n    gameType,\n    to: props.partnerId\n  });\n  \n  // Set a timeout in case partner doesn't respond\n  const timeoutId = setTimeout(() => {\n    if (waitingForAccept.value) {\n      waitingForAccept.value = false;\n      errorMessage.value = \"Your partner didn't respond to the game invitation. Please try again.\";\n      selectedGame.value = null;\n    }\n  }, INVITE_TIMEOUT);\n  \n  // Clear timeout if component is unmounted\n  onUnmounted(() => {\n    clearTimeout(timeoutId);\n  });\n};\n\n// Cancel game\nconst cancelGame = () => {\n  // Notify partner\n  socket.value?.emit('game-invite-cancel', {\n    to: props.partnerId\n  });\n  \n  resetGameState();\n};\n\n// Accept game invite\nconst acceptInvite = () => {\n  if (!inviteGameType.value) return;\n  \n  // Check if game is implemented\n  if (!isGameImplemented(inviteGameType.value)) {\n    errorMessage.value = `${getGameName(inviteGameType.value)} is not yet implemented. Please ask your partner to choose another game.`;\n    \n    // Notify partner about the error\n    socket.value?.emit('game-invite-decline', {\n      to: props.partnerId\n    });\n    \n    showGameInvite.value = false;\n    inviteGameType.value = null;\n    return;\n  }\n  \n  errorMessage.value = null;\n  selectedGame.value = inviteGameType.value;\n  showGameInvite.value = false;\n  \n  // Notify partner\n  socket.value?.emit('game-invite-accept', {\n    gameType: inviteGameType.value,\n    to: props.partnerId\n  });\n  \n  // Important: Clear waiting state when accepting an invite\n  waitingForAccept.value = false;\n};\n\n// Decline game invite\nconst declineInvite = () => {\n  // Notify partner\n  socket.value?.emit('game-invite-decline', {\n    to: props.partnerId\n  });\n  \n  showGameInvite.value = false;\n  inviteGameType.value = null;\n};\n\n// Close game\nconst closeGame = () => {\n  resetGameState();\n  \n  // Notify partner that you've closed the game\n  socket.value?.emit('game-close', {\n    to: props.partnerId\n  });\n};\n\n// Reset game state\nconst resetGameState = () => {\n  selectedGame.value = null;\n  waitingForAccept.value = false;\n  showGameInvite.value = false;\n  inviteGameType.value = null;\n  errorMessage.value = null;\n};\n\n// Handle game error\nconst handleGameError = (error: string) => {\n  errorMessage.value = error;\n  selectedGame.value = null;\n};\n\n// Set up socket event listeners\nonMounted(() => {\n  // Handle game invites from partner\n  socket.value?.on('game-invite', (data: any) => {\n    if (data.from === props.partnerId) {\n      inviteGameType.value = data.gameType;\n      showGameInvite.value = true;\n    }\n  });\n  \n  // Handle invite acceptance\n  socket.value?.on('game-invite-accept', (data: any) => {\n    if (data.from === props.partnerId) {\n      if (waitingForAccept.value) {\n        waitingForAccept.value = false;\n      } else if (showGameInvite.value) {\n        // If we're showing an invite and partner accepts, we should proceed with the game too\n        showGameInvite.value = false;\n        selectedGame.value = inviteGameType.value;\n      }\n    }\n  });\n  \n  // Handle invite declination\n  socket.value?.on('game-invite-decline', (data: any) => {\n    if (data.from === props.partnerId) {\n      waitingForAccept.value = false;\n      selectedGame.value = null;\n      errorMessage.value = \"Your partner declined the game invitation.\";\n    }\n  });\n  \n  // Handle invite cancellation\n  socket.value?.on('game-invite-cancel', (data: any) => {\n    if (data.from === props.partnerId) {\n      showGameInvite.value = false;\n      inviteGameType.value = null;\n    }\n  });\n  \n  // Handle game close\n  socket.value?.on('game-close', (data: any) => {\n    if (data.from === props.partnerId) {\n      resetGameState();\n      errorMessage.value = \"Your partner ended the game session.\";\n    }\n  });\n  \n  // Handle errors from games\n  socket.value?.on('game-error', (data: any) => {\n    if (data.from === props.partnerId) {\n      errorMessage.value = data.message || \"An error occurred in the game.\";\n      selectedGame.value = null;\n    }\n  });\n});\n\n// Clean up event listeners\nonUnmounted(() => {\n  socket.value?.off('game-invite');\n  socket.value?.off('game-invite-accept');\n  socket.value?.off('game-invite-decline');\n  socket.value?.off('game-invite-cancel');\n  socket.value?.off('game-close');\n  socket.value?.off('game-error');\n});\n\n// Watch for dialog close to reset game state\nwatch(() => props.isOpen, (isOpen) => {\n  if (!isOpen) {\n    resetGameState();\n  }\n});\n</script>\n\n<style scoped>\n.game-card {\n  @apply bg-gradient-to-br from-purple-800/80 to-indigo-900/80 rounded-lg p-4 flex flex-col items-center text-center transition-all hover:from-purple-700/80 hover:to-indigo-800/80 border border-purple-500/20;\n}\n\n.game-icon {\n  @apply text-3xl mb-2;\n}\n\n.game-title {\n  @apply text-sm font-medium text-white;\n}\n\n.game-subtitle {\n  @apply text-xs text-purple-300;\n}\n\n.game-choice-btn {\n  @apply text-3xl bg-gray-700 hover:bg-gray-600 w-14 h-14 rounded-full flex items-center justify-center transition-all transform hover:scale-110;\n}\n</style>","<template>\r\n  <div v-if=\"isOpen\" class=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n    <div class=\"bg-gray-900 rounded-lg w-full max-w-md mx-auto p-6\">\r\n      <!-- Header -->\r\n      <div class=\"flex items-center justify-between mb-6\">\r\n        <div class=\"flex items-center gap-2\">\r\n          <span class=\"text-red-400 text-xl\">❤️</span>\r\n          <h2 class=\"text-lg font-semibold text-violet-400\">Support SpaceTalk</h2>\r\n        </div>\r\n        <button \r\n          @click=\"$emit('close')\" \r\n          class=\"text-gray-400 hover:text-white text-lg\"\r\n        >\r\n          ✕\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- Content -->\r\n      <div class=\"mb-6 text-center\">\r\n        <p class=\"text-gray-300\">Keep SpaceTalk free for everyone</p>\r\n      </div>\r\n      \r\n      <!-- Donation Options -->\r\n      <div class=\"grid grid-cols-3 gap-4 mb-6\">\r\n        <button \r\n          :class=\"[\r\n            'bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform',\r\n            selectedAmount === 5 ? 'ring-2 ring-emerald-500 scale-105' : ''\r\n          ]\"\r\n          @click=\"selectAmount(5)\"\r\n        >\r\n          <div class=\"text-lg font-bold text-white\">$5</div>\r\n          <div class=\"text-sm text-gray-400\">Coffee</div>\r\n        </button>\r\n        \r\n        <button \r\n          :class=\"[\r\n            'bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform',\r\n            selectedAmount === 15 ? 'ring-2 ring-emerald-500 scale-105' : ''\r\n          ]\"\r\n          @click=\"selectAmount(15)\"\r\n        >\r\n          <div class=\"text-lg font-bold text-white\">$15</div>\r\n          <div class=\"text-sm text-gray-400\">Fuel</div>\r\n        </button>\r\n        \r\n        <button \r\n          :class=\"[\r\n            'bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform',\r\n            selectedAmount === 50 ? 'ring-2 ring-emerald-500 scale-105' : ''\r\n          ]\"\r\n          @click=\"selectAmount(50)\"\r\n        >\r\n          <div class=\"text-lg font-bold text-white\">$50</div>\r\n          <div class=\"text-sm text-gray-400\">Rocket</div>\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- Development Info -->\r\n      <div class=\"flex justify-center items-center gap-1 mb-6\">\r\n        <span class=\"text-yellow-400\">⭐</span>\r\n        <span class=\"text-sm text-gray-300\">Boost development</span>\r\n      </div>\r\n      \r\n      <!-- Donate Button -->\r\n      <button \r\n        class=\"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-3 rounded-lg transition-colors mb-2 active:scale-95 transform duration-150\"\r\n        @click=\"openPayPal\"\r\n      >\r\n        Donate via PayPal\r\n      </button>\r\n      \r\n      <!-- Secure Payment Notice -->\r\n      <div class=\"text-xs text-gray-500 text-center\">\r\n        Secure payments via PayPal\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref } from 'vue';\r\n\r\ndefineProps({\r\n  isOpen: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n});\r\n\r\nconst emit = defineEmits(['close']);\r\n\r\nconst selectedAmount = ref(15);\r\n\r\nconst selectAmount = (amount: number) => {\r\n  selectedAmount.value = amount;\r\n};\r\n\r\nconst openPayPal = () => {\r\n  // Redirect to the specified PayPal link with the selected amount\r\n  window.open(`https://www.paypal.com/paypalme/spacetalk/${selectedAmount.value}`, '_blank');\r\n  emit('close');\r\n};\r\n</script> ","<template>\r\n  <div class=\"relative w-full\">\r\n    <button \r\n      type=\"button\" \r\n      ref=\"triggerRef\" \r\n      @click=\"toggleOpen\"\r\n      class=\"w-full flex items-center justify-between bg-purple-500/20 border-purple-500/30 rounded-full h-8 px-3 text-xs shadow-lg shadow-purple-500/20 text-white\"\r\n    >\r\n      <span>{{ displayValue || placeholder }}</span>\r\n      <span class=\"ml-1\">▼</span>\r\n    </button>\r\n    \r\n    <transition\r\n      enter-active-class=\"transition duration-200 ease-out\"\r\n      enter-from-class=\"opacity-0 translate-y-1\"\r\n      enter-to-class=\"opacity-100 translate-y-0\"\r\n      leave-active-class=\"transition duration-150 ease-in\"\r\n      leave-from-class=\"opacity-100 translate-y-0\"\r\n      leave-to-class=\"opacity-0 translate-y-1\"\r\n    >\r\n      <div \r\n        v-if=\"isOpen\"\r\n        ref=\"contentRef\"\r\n        class=\"absolute z-50 w-full mt-1 bg-gray-800 border border-gray-600 rounded-md shadow-lg max-h-48 overflow-y-auto\"\r\n      >\r\n        <div class=\"py-1\">\r\n          <slot>\r\n            <slot name=\"placeholder\">\r\n              <div class=\"px-3 py-2 text-xs text-gray-400\">No items</div>\r\n            </slot>\r\n          </slot>\r\n        </div>\r\n      </div>\r\n    </transition>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, onBeforeUnmount, watch } from 'vue';\r\n\r\nconst props = defineProps({\r\n  modelValue: {\r\n    type: [String, Number],\r\n    default: ''\r\n  },\r\n  placeholder: {\r\n    type: String,\r\n    default: 'Select an option'\r\n  },\r\n  options: {\r\n    type: Array as () => Array<{value: string | number, label: string}>,\r\n    default: () => []\r\n  }\r\n});\r\n\r\nconst emit = defineEmits(['update:modelValue', 'change']);\r\n\r\nconst isOpen = ref(false);\r\nconst triggerRef = ref<HTMLElement | null>(null);\r\nconst contentRef = ref<HTMLElement | null>(null);\r\n\r\nconst displayValue = computed(() => {\r\n  if (props.options && props.options.length) {\r\n    const option = props.options.find(opt => opt.value === props.modelValue);\r\n    return option ? option.label : '';\r\n  }\r\n  return props.modelValue;\r\n});\r\n\r\nconst toggleOpen = () => {\r\n  isOpen.value = !isOpen.value;\r\n};\r\n\r\nconst handleClickOutside = (event: MouseEvent) => {\r\n  if (\r\n    isOpen.value &&\r\n    triggerRef.value &&\r\n    contentRef.value &&\r\n    !triggerRef.value.contains(event.target as Node) && \r\n    !contentRef.value.contains(event.target as Node)\r\n  ) {\r\n    isOpen.value = false;\r\n  }\r\n};\r\n\r\nconst selectOption = (value: string | number) => {\r\n  emit('update:modelValue', value);\r\n  emit('change', value);\r\n  isOpen.value = false;\r\n};\r\n\r\nonMounted(() => {\r\n  document.addEventListener('click', handleClickOutside);\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n  document.removeEventListener('click', handleClickOutside);\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.select-enter-active,\r\n.select-leave-active {\r\n  transition: all 0.3s ease;\r\n}\r\n.select-enter-from,\r\n.select-leave-to {\r\n  opacity: 0;\r\n  transform: translateY(10px);\r\n}\r\n</style> ","<template>\n  <div class=\"fixed inset-0 overflow-hidden pointer-events-none\">\n    <div v-for=\"star in stars\" :key=\"star.id\" \n         class=\"absolute rounded-full bg-white\" \n         :style=\"{\n           width: `${star.size}px`,\n           height: `${star.size}px`,\n           top: `${star.y}%`,\n           left: `${star.x}%`,\n           opacity: star.opacity,\n           boxShadow: `0 0 ${star.size * 2}px rgba(255, 255, 255, ${star.opacity})`,\n           animation: `twinkle ${star.duration}s infinite ease-in-out`\n         }\">\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue';\n\ninterface Star {\n  id: number;\n  x: number;\n  y: number;\n  size: number;\n  opacity: number;\n  duration: number;\n}\n\nconst stars = ref<Star[]>([]);\n\nonMounted(() => {\n  generateStars();\n});\n\nconst generateStars = () => {\n  const numStars = 50;\n  const newStars: Star[] = [];\n  \n  for (let i = 0; i < numStars; i++) {\n    newStars.push({\n      id: i,\n      x: Math.random() * 100,\n      y: Math.random() * 100,\n      size: Math.random() * 2 + 1,\n      opacity: Math.random() * 0.7 + 0.3,\n      duration: Math.random() * 8 + 2\n    });\n  }\n  \n  stars.value = newStars;\n};\n</script>\n\n<style scoped>\n@keyframes twinkle {\n  0%, 100% {\n    opacity: 0.3;\n    transform: scale(0.8);\n  }\n  50% {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n</style>\n ","<template>\n  <div>\n    <!-- Hidden audio element that does all the heavy lifting - this is the most important part -->\n    <audio ref=\"audioElement\" autoplay playsinline class=\"hidden\"></audio>\n    \n    <!-- Only show debug panel during development -->\n    <div v-if=\"DEBUG\" class=\"fixed bottom-4 right-4 z-50 text-xs bg-gray-800/70 p-3 rounded-lg text-white\">\n      <div class=\"flex items-center gap-2 mb-1\">\n        <span v-if=\"isPlaying\" class=\"text-green-300 animate-pulse\">●</span>\n        <span v-else class=\"text-red-300\">●</span>\n        <span>{{ isPlaying ? 'Audio Active' : 'Audio Inactive' }}</span>\n      </div>\n      <div class=\"grid grid-cols-2 gap-x-3 gap-y-1\">\n        <span>Connection:</span>\n        <span :class=\"{\n          'text-green-400': correctedConnectionState === 'connected', \n          'text-yellow-400': correctedConnectionState === 'connecting', \n          'text-red-400': correctedConnectionState === 'failed' || correctedConnectionState === 'disconnected'\n        }\">{{ correctedConnectionState }}</span>\n        \n        <span>Stream:</span>\n        <span :class=\"{'text-green-400': hasRemoteStream, 'text-red-400': !hasRemoteStream}\">\n          {{ hasRemoteStream ? 'Available' : 'Not Available' }}\n        </span>\n        \n        <span>Tracks:</span>\n        <span>{{ tracksCount }}</span>\n      </div>\n      <div class=\"mt-2 flex justify-between\">\n        <button @click=\"checkAudioTracks\" class=\"text-xs bg-purple-700 hover:bg-purple-600 text-white px-2 py-1 rounded-full\">\n          Debug\n        </button>\n        <button @click=\"forceTryPlayAudio\" class=\"text-xs bg-blue-600 hover:bg-blue-500 text-white px-2 py-1 rounded-full\">\n          Play Audio\n        </button>\n        <button @click=\"forceReconnectStream\" class=\"text-xs bg-green-600 hover:bg-green-500 text-white px-2 py-1 rounded-full\">\n          Reconnect\n      </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onBeforeUnmount, watch, computed } from 'vue';\nimport { useWebRTC } from '@/services/webrtc';\n\n// Debug flag\nconst DEBUG = false; // Change to false for production\n\nconst props = defineProps({\n  showControls: {\n    type: Boolean,\n    default: true\n  }\n});\n\nconst { remoteStream, connectionState, partnerId, isAudioMuted } = useWebRTC();\nconst audioElement = ref<HTMLAudioElement | null>(null);\nconst volume = ref(0.8); // Default volume\nconst isPlaying = ref(false);\nconst reconnectAttempts = ref(0);\nconst maxReconnectAttempts = 10; // Increased number of attempts\n\n// Check if we have a remote stream\nconst hasRemoteStream = computed(() => {\n  const streamExists = remoteStream.value !== null;\n  // Use a safe method to check for tracks\n  const hasTracks = streamExists && remoteStream.value ? remoteStream.value.getAudioTracks().length > 0 : false;\n  const hasEnabledTracks = hasTracks && remoteStream.value ? remoteStream.value.getAudioTracks().some(track => track.enabled) : false;\n  \n  // Diagnostic log\n  if (DEBUG && streamExists && remoteStream.value) {\n    console.log(`[AudioOutput] Stream status: tracks=${remoteStream.value.getAudioTracks().length}, enabled=${hasEnabledTracks}`);\n  }\n  \n  return hasEnabledTracks;\n});\n\n// Get track count for display - shows only active tracks\nconst tracksCount = computed(() => {\n  if (!remoteStream.value) return 0;\n  \n  // Count only active tracks\n  return remoteStream.value.getAudioTracks().filter(track => \n    track.enabled && track.readyState === 'live'\n  ).length;\n});\n\n// Corrected connection state based on actual audio status\nconst correctedConnectionState = computed(() => {\n  // If audio is playing, the connection must be \"connected\" regardless of the official state\n  if (isPlaying.value && hasRemoteStream.value) {\n    return 'connected';\n  }\n  \n  // If the official connection state is \"connected\" but no audio, there's a problem\n  if (connectionState.value === 'connected' && !hasRemoteStream.value && !isPlaying.value) {\n    // Try reconnecting audio after a short delay\n    setTimeout(connectAudioStream, 500);\n  }\n  \n  return connectionState.value;\n});\n\n// Watch for changes to the remote stream\nwatch(() => remoteStream.value, (newStream) => {\n  if (DEBUG) {\n    console.log('[AudioOutput] Remote stream changed:', newStream ? 'Stream available' : 'No stream');\n    if (newStream) {\n      const tracks = newStream.getTracks();\n      console.log(`[AudioOutput] Remote stream has ${tracks.length} tracks`);\n      tracks.forEach(track => {\n        console.log(`[AudioOutput] Track: ${track.kind}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n      });\n    }\n  }\n  \n  // When we get a new stream, connect it immediately\n  connectAudioStream();\n  \n  // Reset reconnect attempts when stream changes\n  reconnectAttempts.value = 0;\n  \n  // Try to play immediately\n  setTimeout(tryPlayAudio, 500);\n});\n\n// Watch mute state to ensure it's respected\nwatch(() => isAudioMuted.value, (muted) => {\n  if (DEBUG) console.log(`[AudioOutput] Audio mute state changed to: ${muted}`);\n  \n  // Ensure audio plays when unmuting if we have a stream\n  if (!muted && remoteStream.value && audioElement.value) {\n    setTimeout(() => {\n      if (audioElement.value && audioElement.value.paused) {\n        audioElement.value.play().catch(err => {\n          if (DEBUG) console.warn('[AudioOutput] Could not auto-play after unmute:', err);\n        });\n      }\n    }, 300);\n  }\n});\n\n// Watch connection state\nwatch(() => connectionState.value, (newState) => {\n  if (DEBUG) console.log(`[AudioOutput] WebRTC connection state changed to: ${newState}`);\n  \n  if (newState === 'connected') {\n    // Try to play the audio when connection is established\n    setTimeout(() => {\n      connectAudioStream();\n      tryPlayAudio();\n    }, 1000);\n  } else if (newState === 'new' || newState === 'connecting') {\n    // Connection is being established\n    reconnectAttempts.value = 0;\n  } else if (newState === 'disconnected' || newState === 'failed') {\n    // Connection was lost - try reconnecting\n    reconnectStream();\n  }\n});\n\n// Watch for partner ID changes to reset state\nwatch(() => partnerId.value, (newPartnerId) => {\n  if (DEBUG) console.log(`[AudioOutput] Partner ID changed: ${newPartnerId}`);\n  \n  // Reset status when partner changes\n  isPlaying.value = false;\n  reconnectAttempts.value = 0;\n  \n  if (!newPartnerId) {\n    // No partner, stop audio\n    if (audioElement.value) {\n      audioElement.value.srcObject = null;\n    }\n  }\n});\n\nonMounted(() => {\n  if (DEBUG) console.log('[AudioOutput] Component mounted');\n  connectAudioStream();\n  \n  // Set up audio play monitoring\n  if (audioElement.value) {\n    audioElement.value.onplaying = () => {\n      if (DEBUG) console.log('[AudioOutput] Audio started playing');\n      isPlaying.value = true;\n    };\n    \n    audioElement.value.onpause = () => {\n      if (DEBUG) console.log('[AudioOutput] Audio paused');\n      isPlaying.value = false;\n    };\n    \n    audioElement.value.onended = () => {\n      if (DEBUG) console.log('[AudioOutput] Audio ended');\n      isPlaying.value = false;\n    };\n    \n    audioElement.value.onerror = (e) => {\n      console.error('[AudioOutput] Audio error:', e);\n      isPlaying.value = false;\n    };\n    \n    // Set initial volume\n    audioElement.value.volume = volume.value;\n  }\n  \n  // Add visibility change listener to handle page visibility changes\n  document.addEventListener('visibilitychange', handleVisibilityChange);\n  \n  // Start checking for audio every 5 seconds\n  startAudioCheck();\n});\n\nonBeforeUnmount(() => {\n  if (DEBUG) console.log('[AudioOutput] Component unmounting, cleaning up');\n  \n  // Clean up resources\n  if (audioElement.value) {\n    audioElement.value.srcObject = null;\n  }\n  \n  // Remove event listeners\n  document.removeEventListener('visibilitychange', handleVisibilityChange);\n  \n  // Clear any intervals\n  stopAudioCheck();\n});\n\n// Start periodic checks for audio\nlet audioCheckInterval: number | null = null;\nfunction startAudioCheck() {\n  stopAudioCheck(); // Clear any existing interval\n  \n  audioCheckInterval = window.setInterval(() => {\n    if (!isPlaying.value && hasRemoteStream.value && connectionState.value === 'connected') {\n      if (DEBUG) console.log('[AudioOutput] Periodic check: Audio not playing, trying to reconnect');\n      connectAudioStream();\n      tryPlayAudio();\n    }\n  }, 5000) as unknown as number;\n}\n\nfunction stopAudioCheck() {\n  if (audioCheckInterval) {\n    clearInterval(audioCheckInterval);\n    audioCheckInterval = null;\n  }\n}\n\n// Handle visibility change (when user switches tabs)\nfunction handleVisibilityChange() {\n  if (document.visibilityState === 'visible') {\n    if (DEBUG) console.log('[AudioOutput] Page became visible, trying to reconnect audio');\n    // Try to reconnect audio when page becomes visible again\n    connectAudioStream();\n    setTimeout(() => {\n      if (!isPlaying.value && hasRemoteStream.value) {\n        tryPlayAudio();\n      }\n    }, 500);\n  }\n}\n\n// Connect the audio stream to the audio element\nfunction connectAudioStream() {\n  if (!audioElement.value) {\n    if (DEBUG) console.log('[AudioOutput] No audio element ref available');\n    return;\n  }\n  \n  if (remoteStream.value) {\n    if (DEBUG) {\n      const audioTracks = remoteStream.value.getAudioTracks();\n      console.log(`[AudioOutput] Connecting remote stream with ${audioTracks.length} audio tracks`);\n      \n      audioTracks.forEach(track => {\n        console.log(`[AudioOutput] Audio track: ${track.label}, enabled: ${track.enabled}, readyState: ${track.readyState}`);\n      });\n    }\n    \n    // Always set the stream to ensure it's connected properly\n    audioElement.value.srcObject = remoteStream.value;\n    \n    // Make sure tracks are enabled\n    remoteStream.value.getAudioTracks().forEach(track => {\n      track.enabled = true;\n    });\n    \n    // Try to play the audio\n    tryPlayAudio();\n  } else {\n    if (DEBUG) console.log('[AudioOutput] No remote stream to connect');\n    audioElement.value.srcObject = null;\n    isPlaying.value = false;\n  }\n}\n\n// Try to play audio with retry logic\nasync function tryPlayAudio() {\n  if (!audioElement.value || !audioElement.value.srcObject) {\n    if (DEBUG) console.log('[AudioOutput] Cannot play: no audio element or srcObject');\n    return;\n  }\n  \n  try {\n    if (DEBUG) console.log(`[AudioOutput] Attempting to play audio (attempt ${reconnectAttempts.value + 1})`);\n    \n    // Check if we have audio tracks and they're enabled\n    const hasTracks = remoteStream.value && remoteStream.value.getAudioTracks().length > 0;\n    if (!hasTracks) {\n      if (DEBUG) console.log('[AudioOutput] No audio tracks available in remote stream');\n    }\n    \n    // Try to play\n    await audioElement.value.play();\n    \n    isPlaying.value = true;\n    reconnectAttempts.value = 0;\n    if (DEBUG) console.log('[AudioOutput] Audio playing successfully');\n  } catch (error) {\n    console.error('[AudioOutput] Error playing audio:', error);\n    isPlaying.value = false;\n    \n    // Check if this is a user interaction error\n    if (error instanceof DOMException && error.name === 'NotAllowedError') {\n      console.warn('[AudioOutput] Audio play was blocked by browser policy, user interaction needed');\n    }\n    \n    // Retry automatically with increasing delay if not manually triggered\n    if (reconnectAttempts.value < maxReconnectAttempts) {\n      reconnectAttempts.value++;\n      const delay = reconnectAttempts.value * 1000; // Increasing delay\n      \n      if (DEBUG) console.log(`[AudioOutput] Will retry playing in ${delay}ms`);\n      setTimeout(tryPlayAudio, delay);\n    } else {\n      console.warn('[AudioOutput] Max retry attempts reached, manual play required');\n    }\n  }\n}\n\n// Function to explicitly reconnect stream\nfunction reconnectStream() {\n  reconnectAttempts.value = 0;\n  if (DEBUG) console.log('[AudioOutput] Manual reconnect requested');\n  \n  if (audioElement.value) {\n    audioElement.value.srcObject = null;\n  }\n  \n  setTimeout(() => {\n    connectAudioStream();\n    tryPlayAudio();\n  }, 500);\n}\n\n// Update audio volume\nfunction updateVolume() {\n  if (audioElement.value) {\n    audioElement.value.volume = volume.value;\n    if (DEBUG) console.log(`[AudioOutput] Volume set to ${volume.value}`);\n  }\n}\n\n// New function to check audio tracks\nfunction checkAudioTracks() {\n  if (remoteStream.value) {\n    const tracks = remoteStream.value.getAudioTracks();\n    console.log(`[AudioOutput] Remote stream has ${tracks.length} audio tracks`);\n    tracks.forEach(track => {\n      console.log(`[AudioOutput] Track: ${track.kind}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n    });\n  }\n}\n\n// Force reconnect with reset state\nfunction forceReconnectStream() {\n  reconnectAttempts.value = 0;\n  if (DEBUG) console.log('[AudioOutput] Manual reconnect requested');\n  \n  if (audioElement.value) {\n    audioElement.value.srcObject = null;\n  }\n  \n  setTimeout(() => {\n    connectAudioStream();\n    tryPlayAudio();\n  }, 500);\n}\n\n// Force try play audio\nfunction forceTryPlayAudio() {\n  if (DEBUG) console.log('[AudioOutput] Manual play requested');\n  // Reset playing state\n  isPlaying.value = false;\n  \n  // Try to play with user interaction\n  setTimeout(() => {\n    tryPlayAudio();\n  }, 100);\n}\n</script>\n\n<style scoped>\n.audio-controls {\n  transition: all 0.3s ease;\n}\n\n.animate-pulse {\n  animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n/* Style the range input (volume slider) */\ninput[type=\"range\"]::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  appearance: none;\n  width: 12px;\n  height: 12px;\n  background: #fff;\n  border-radius: 50%;\n  cursor: pointer;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n  width: 12px;\n  height: 12px;\n  background: #fff;\n  border-radius: 50%;\n  cursor: pointer;\n}\n\n.hidden {\n  display: none;\n}\n</style> ","<template>\n  <div class=\"min-h-screen font-sans\">\n    <!-- Purple glow effects -->\n    <div class=\"fixed inset-0 pointer-events-none\">\n      <div class=\"absolute top-1/4 left-1/4 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl animate-pulse\"></div>\n      <div class=\"absolute top-1/3 right-1/3 w-24 h-24 bg-violet-500/20 rounded-full blur-2xl animate-pulse delay-1000\"></div>\n      <div class=\"absolute bottom-1/4 left-1/3 w-28 h-28 bg-indigo-500/20 rounded-full blur-3xl animate-pulse delay-2000\"></div>\n      <div class=\"absolute top-1/2 right-1/4 w-20 h-20 bg-fuchsia-500/20 rounded-full blur-2xl animate-pulse delay-500\"></div>\n    </div>\n    \n    <Starfield />\n    \n    <div class=\"relative min-h-screen z-10 text-white\">\n      <!-- Header -->\n      <header class=\"p-4 border-b border-white/10\">\n        <div class=\"max-w-4xl mx-auto\">\n          <!-- Logo -->\n          <div class=\"text-center mb-4\">\n            <div class=\"inline-flex items-center gap-2\">\n              <div class=\"w-6 h-6 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center shadow-lg shadow-cyan-500/50\">\n                <span class=\"text-white text-xs\">✨</span>\n              </div>\n              <h1 class=\"text-lg font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent drop-shadow-lg\">\n                SpaceTalk.live\n              </h1>\n            </div>\n          </div>\n\n          <!-- Statistics -->\n          <div class=\"flex justify-center gap-2 mb-3\">\n            <div class=\"bg-green-500/20 rounded-full px-2 py-1 text-xs flex items-center gap-1\">\n              <div class=\"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse\"></div>\n              <span>{{ onlineCount }} online</span>\n            </div>\n            <div v-if=\"dailyConnections > 0\" class=\"bg-purple-500/20 rounded-full px-2 py-1 text-xs\">\n              Today: {{ dailyConnections }} voices\n            </div>\n          </div>\n\n          <!-- Vibe Selector -->\n          <div class=\"grid grid-cols-2 gap-2 text-xs relative\">\n            <div class=\"relative\" ref=\"vibeDropdownRef\">\n              <div @click=\"toggleVibeDropdown\" class=\"cursor-pointer bg-purple-500/20 border border-purple-500/30 rounded-full h-8 flex items-center justify-between px-3 text-xs shadow-lg shadow-purple-500/20 text-white hover:bg-purple-500/30 active:scale-95 transition-all duration-150\">\n                <span class=\"flex items-center\">\n                  {{ getVibeEmoji(selectedVibe) }} {{ getVibeText(selectedVibe) }}\n                </span>\n                <span class=\"ml-2 text-xs transition-transform duration-300\" :class=\"{ 'rotate-180': showVibeDropdown }\">▼</span>\n              </div>\n              \n              <!-- Dropdown -->\n              <div v-if=\"showVibeDropdown\" class=\"absolute top-full left-0 mt-1 w-full bg-gray-800/95 backdrop-blur-md border border-gray-700 rounded-xl shadow-xl z-20 overflow-hidden transition-all duration-200 animate-dropdown\">\n                <div class=\"py-1\">\n                  <div\n                    v-for=\"vibe in vibes\" \n                    :key=\"vibe.value\"\n                    @click=\"selectVibe(vibe.value)\"\n                    class=\"px-3 py-2 hover:bg-gray-700/80 cursor-pointer transition-colors flex items-center gap-2\"\n                    :class=\"{'bg-gray-700/70': selectedVibe === vibe.value}\"\n                  >\n                    <span class=\"text-sm\">{{ vibe.emoji }}</span>\n                    <span>{{ vibe.text }}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            <button\n              @click=\"isFiltersOpen = true\"\n              class=\"bg-violet-500/20 border border-violet-500/30 rounded-full h-8 px-3 text-xs hover:bg-violet-500/30 active:scale-95 transition-all duration-150 shadow-lg shadow-violet-500/20\"\n            >\n              🔍 Filters\n            </button>\n          </div>\n        </div>\n      </header>\n\n      <!-- Main Content Area -->\n      <main class=\"flex-1 p-4\">\n        <div class=\"max-w-md mx-auto space-y-6\">\n          <!-- Connection Status Card -->\n          <connection-card \n            :status=\"connectionStatus\" \n            :partner-info=\"partnerInfo\" \n            :error-message=\"connectionError\"\n            :show-status=\"true\"\n          />\n\n          <!-- Auto-reconnect option -->\n          <div class=\"flex items-center justify-center gap-2 mb-4\">\n            <input\n              type=\"checkbox\"\n              id=\"auto-reconnect\"\n              v-model=\"autoReconnect\"\n              class=\"w-3 h-3 rounded border-gray-600 bg-gray-700 text-emerald-500 focus:ring-emerald-500 focus:ring-1\"\n            />\n            <label for=\"auto-reconnect\" class=\"text-xs text-gray-400 cursor-pointer\">\n              Auto-reconnect to others\n            </label>\n          </div>\n\n          <!-- Control Buttons -->\n          <control-buttons\n            :is-muted=\"isMuted\"\n            :is-disabled=\"connectionStatus !== 'connected'\"\n            @toggle-mute=\"toggleMute\"\n            @find-next=\"findNext\"\n            @toggle-chat=\"toggleChat\"\n            @toggle-games=\"isGamesOpen = true\"\n            @toggle-history=\"isHistoryOpen = true\"\n            @toggle-donation=\"isDonationOpen = true\"\n          />\n\n          <!-- Quote -->\n          <div class=\"text-center\">\n            <p class=\"text-xs text-gray-400 italic\">\"{{ currentQuote }}\"</p>\n          </div>\n        </div>\n      </main>\n\n      <!-- Guidelines Section -->\n      <footer class=\"p-4 border-t border-white/10\">\n        <div class=\"max-w-md mx-auto text-center space-y-2\">\n          <h3 class=\"text-sm font-semibold text-emerald-400\">Community Guidelines</h3>\n          <div class=\"text-xs text-gray-300 space-y-1\">\n            <p>• Must be 18+ years old to use this service</p>\n            <p>• Be respectful and kind to other users</p>\n            <p>• No harassment, hate speech, or inappropriate content</p>\n            <p>• Report any misconduct using the report feature</p>\n            <p>• Your privacy and safety are our priority</p>\n          </div>\n          <p class=\"text-xs text-gray-400 mt-3\">\n            By using SpaceTalk.live, you agree to follow these guidelines\n          </p>\n          \n          <!-- Links Section -->\n          <div class=\"flex justify-center gap-3 mt-4 text-xs\">\n            <a href=\"#\" class=\"bg-cyan-500/20 border border-cyan-500/30 rounded-full px-3 py-1.5 text-cyan-300 hover:text-cyan-200 hover:bg-cyan-500/30 transition-all shadow-lg shadow-cyan-500/20\">\n              ℹ️ About\n            </a>\n            <a href=\"https://instagram.com\" target=\"_blank\" class=\"bg-pink-500/20 border border-pink-500/30 rounded-full px-3 py-1.5 text-pink-300 hover:text-pink-200 hover:bg-pink-500/30 transition-all shadow-lg shadow-pink-500/20\">\n              📷 Instagram\n            </a>\n            <a href=\"https://facebook.com\" target=\"_blank\" class=\"bg-blue-500/20 border border-blue-500/30 rounded-full px-3 py-1.5 text-blue-300 hover:text-blue-200 hover:bg-blue-500/30 transition-all shadow-lg shadow-blue-500/20\">\n              📘 Facebook\n            </a>\n            <a href=\"mailto:contact@spacetalk.live\" class=\"bg-emerald-500/20 border border-emerald-500/30 rounded-full px-3 py-1.5 text-emerald-300 hover:text-emerald-200 hover:bg-emerald-500/30 transition-all shadow-lg shadow-emerald-500/20\">\n              📧 Contact\n            </a>\n          </div>\n        </div>\n      </footer>\n    </div>\n\n    <!-- Call History Modal -->\n    <div v-if=\"isHistoryOpen\" class=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div class=\"bg-gray-800 rounded-2xl p-6 w-full max-w-sm\">\n        <div class=\"flex justify-between items-center mb-4\">\n          <h2 class=\"text-lg font-semibold text-indigo-400\">📞 Call History</h2>\n          <button\n            @click=\"isHistoryOpen = false\"\n            class=\"text-gray-400 hover:text-white text-xl\"\n          >\n            ✕\n          </button>\n        </div>\n\n        <div class=\"space-y-3\">\n          <div v-if=\"callHistory.length === 0\" class=\"text-center py-8\">\n            <p class=\"text-gray-400 text-sm\">No recent calls</p>\n            <p class=\"text-xs text-gray-500 mt-1\">Your last 3 conversations will appear here</p>\n          </div>\n          \n          <div\n            v-else\n            v-for=\"(call, index) in callHistory\"\n            :key=\"call.id\"\n            class=\"bg-gray-700 rounded-lg p-3 flex items-center justify-between hover:bg-gray-600 transition-colors\"\n          >\n            <div class=\"flex items-center gap-3\">\n              <span class=\"text-2xl\">{{ call.flag }}</span>\n              <div>\n                <p class=\"text-white text-sm font-medium\">{{ call.country }}</p>\n                <p class=\"text-gray-400 text-xs\">\n                  {{ formatTime(call.timestamp) }}\n                </p>\n              </div>\n            </div>\n            <div class=\"text-xs text-gray-500\">\n              #{{ index + 1 }}\n            </div>\n          </div>\n        </div>\n\n        <p v-if=\"callHistory.length > 0\" class=\"text-xs text-gray-500 text-center mt-4\">\n          History clears when you leave the page\n        </p>\n      </div>\n    </div>\n\n    <!-- Filters Modal -->\n    <div v-if=\"isFiltersOpen\" class=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div class=\"bg-gray-800 rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto\">\n        <div class=\"flex justify-between items-center mb-4\">\n          <h2 class=\"text-lg font-semibold text-emerald-400\">Filters & Preferences</h2>\n          <button\n            @click=\"isFiltersOpen = false\"\n            class=\"text-gray-400 hover:text-white text-xl\"\n          >\n            ✕\n          </button>\n        </div>\n\n        <div class=\"space-y-4\">\n          <!-- Interest Keywords -->\n          <div>\n            <label class=\"block text-sm font-medium mb-2 text-teal-400\">Interest Keywords</label>\n            <input\n              v-model=\"interests\"\n              type=\"text\"\n              placeholder=\"e.g., music, travel, technology...\"\n              class=\"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm text-white placeholder-gray-400 focus:border-emerald-500 focus:outline-none\"\n            />\n            <p class=\"text-xs text-gray-400 mt-1\">Separate with commas</p>\n          </div>\n\n          <!-- Preferred Countries -->\n          <div>\n            <label class=\"block text-sm font-medium mb-2 text-emerald-400\">Preferred Countries</label>\n            <div class=\"bg-gray-700 border border-gray-600 rounded-lg p-2 min-h-[60px] max-h-32 overflow-y-auto\">\n              <p v-if=\"preferredCountries.length === 0\" class=\"text-xs text-gray-400 p-2\">No countries selected</p>\n              <div v-else class=\"flex flex-wrap gap-1\">\n                <span \n                  v-for=\"countryCode in preferredCountries\" \n                  :key=\"countryCode\"\n                  class=\"bg-emerald-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1\"\n                >\n                  {{ getCountryFlag(countryCode) }} {{ getCountryName(countryCode) }}\n                  <button\n                    @click=\"removePreferredCountry(countryCode)\"\n                    class=\"text-emerald-200 hover:text-white ml-1\"\n                  >\n                    ✕\n                  </button>\n                </span>\n              </div>\n            </div>\n            \n            <select-vue\n              v-model=\"tempCountrySelect\"\n              :options=\"availableCountriesForPreferred\"\n              placeholder=\"Add preferred country...\"\n              class=\"mt-2\"\n              @change=\"addPreferredCountry\"\n            />\n          </div>\n\n          <!-- Blocked Countries -->\n          <div>\n            <label class=\"block text-sm font-medium mb-2 text-red-400\">Blocked Countries</label>\n            <div class=\"bg-gray-700 border border-gray-600 rounded-lg p-2 min-h-[60px] max-h-32 overflow-y-auto\">\n              <p v-if=\"blockedCountries.length === 0\" class=\"text-xs text-gray-400 p-2\">No countries blocked</p>\n              <div v-else class=\"flex flex-wrap gap-1\">\n                <span \n                  v-for=\"countryCode in blockedCountries\" \n                  :key=\"countryCode\"\n                  class=\"bg-red-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1\"\n                >\n                  {{ getCountryFlag(countryCode) }} {{ getCountryName(countryCode) }}\n                  <button\n                    @click=\"removeBlockedCountry(countryCode)\"\n                    class=\"text-red-200 hover:text-white ml-1\"\n                  >\n                    ✕\n                  </button>\n                </span>\n              </div>\n            </div>\n            \n            <select-vue\n              v-model=\"tempBlockedSelect\"\n              :options=\"availableCountriesForBlocked\"\n              placeholder=\"Add blocked country...\"\n              class=\"mt-2\"\n              @change=\"addBlockedCountry\"\n            />\n          </div>\n\n          <!-- Auto-Next Timer -->\n          <div>\n            <label class=\"block text-sm font-medium mb-2 text-orange-400\">Auto-Next Timer</label>\n            <select-vue\n              v-model=\"autoNextTimer\"\n              :options=\"timerOptions\"\n              placeholder=\"Select timer\"\n            />\n          </div>\n        </div>\n        \n        <div class=\"flex gap-2 mt-6\">\n          <button\n            @click=\"clearFilters\"\n            class=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg text-sm transition-colors\"\n          >\n            Clear All\n          </button>\n          <button\n            @click=\"applyFilters\"\n            class=\"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-2 px-4 rounded-lg text-sm transition-colors\"\n          >\n            Apply Filters\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Modals -->\n    <chat-modal\n      :is-open=\"isChatOpen\"\n      @close=\"isChatOpen = false\"\n      :messages=\"chatMessages\"\n      @send-message=\"sendChatMessage\"\n      :is-connected=\"connectionStatus === 'connected'\"\n    />\n    \n    <games-modal\n      :is-open=\"isGamesOpen\"\n      @close=\"isGamesOpen = false\"\n      :is-connected=\"connectionStatus === 'connected'\"\n      @select-game=\"selectGame\"\n      :partner-id=\"partnerId || ''\"\n      :initial-game-room-id=\"gameRoomId\"\n    />\n    \n    <donation-modal\n      :is-open=\"isDonationOpen\"\n      @close=\"isDonationOpen = false\"\n    />\n    \n    <!-- Audio component integrated with controls but not directly visible -->\n    <div class=\"hidden\" v-if=\"connectionStatus === 'connected'\">\n      <AudioOutput :showControls=\"false\" />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onBeforeUnmount, computed, watch } from 'vue';\nimport { useSocket } from '@/services/socket';\nimport { useWebRTC } from '@/services/webrtc';\nimport { useChat } from '@/services/chat';\nimport { useRoute } from 'vue-router';\n\n// Components\nimport ConnectionCard from '@/components/connection-card.vue';\nimport ControlButtons from '@/components/control-buttons.vue';\nimport ChatModal from '@/components/chat-modal.vue';\nimport GamesModal from '@/components/games-modal.vue';\nimport DonationModal from '@/components/donation-modal.vue';\nimport SelectVue from '@/components/ui/select.vue';\nimport Starfield from '@/components/starfield.vue';\nimport AudioOutput from '@/components/audio/AudioOutput.vue';\n\n// State management\nconst connectionStatus = ref<string>('disconnected'); // disconnected, searching, matched, connected\nconst partnerId = ref<string | null>(null);\nconst partnerInfo = ref<any>(null);\nconst connectionError = ref<string>(''); // Add variable for error messages\nconst isMuted = ref(false);\n\n// UI state\nconst isChatOpen = ref(false);\nconst isGamesOpen = ref(false);\nconst isDonationOpen = ref(false);\nconst isHistoryOpen = ref(false);\nconst isFiltersOpen = ref(false);\nconst onlineCount = ref(0);\nconst dailyConnections = ref(0);\nconst autoReconnect = ref(false);\nconst chatMessages = ref<Array<{id: string; message: string; isOwn: boolean; timestamp: number}>>([]);\nconst callHistory = ref<Array<{id: string; country: string; flag: string; timestamp: number}>>([]);\n\n// Filter options\nconst selectedVibe = ref('any');\nconst showVibeDropdown = ref(false);\nconst interests = ref('');\nconst preferredCountries = ref<string[]>([]);\nconst blockedCountries = ref<string[]>([]);\nconst autoNextTimer = ref<string | number | undefined>('off');\nconst tempCountrySelect = ref('');\nconst tempBlockedSelect = ref('');\n\n// Vibes options\nconst vibes = [\n  { value: 'any', text: 'Any Vibe', emoji: '🌟' },\n  { value: 'chill', text: 'Chill', emoji: '😌' },\n  { value: 'fun', text: 'Fun', emoji: '🎉' },\n  { value: 'curious', text: 'Curious', emoji: '🤔' },\n  { value: 'creative', text: 'Creative', emoji: '🎨' }\n];\n\n// Options data\nconst timerOptions = [\n  { value: 'off', label: '⏰ Disabled' },\n  { value: '30', label: '30 seconds' },\n  { value: '60', label: '60 seconds' },\n  { value: '90', label: '90 seconds' }\n];\n\nconst countries: any[] = [\n  { value: 'any', label: '🌍 Any Country' },\n  { value: 'us', label: '🇺🇸 United States' },\n  { value: 'gb', label: '🇬🇧 United Kingdom' },\n  { value: 'ca', label: '🇨🇦 Canada' },\n  { value: 'au', label: '🇦🇺 Australia' },\n  { value: 'de', label: '🇩🇪 Germany' },\n  { value: 'fr', label: '🇫🇷 France' },\n  { value: 'it', label: '🇮🇹 Italy' },\n  { value: 'es', label: '🇪🇸 Spain' },\n  { value: 'jp', label: '🇯🇵 Japan' }\n];\n\n// Cosmic quotes\nconst cosmicQuotes = [\n  \"You're not alone in the universe.\",\n  \"Every voice carries a story from across the stars.\",\n  \"Connection transcends distance in the cosmic web.\",\n  \"Discover new worlds through conversation.\",\n  \"In space, every voice matters.\"\n];\nconst currentQuote = ref(cosmicQuotes[Math.floor(Math.random() * cosmicQuotes.length)]);\n\n// Initialize services\nconst socketService = useSocket();\nconst socket = socketService.socket;\nconst { \n  remoteStream,\n  localStream,\n  connectionState: webRTCConnectionState,\n  createOffer, \n  handleOffer, \n  handleAnswer, \n  handleIceCandidate,\n  closeConnection,\n  toggleMicrophone,\n  initializeLocalStream\n} = useWebRTC();\nconst chat = useChat();\n\n// Extract route params\nconst route = useRoute();\nconst gameRoomId = ref(route.params.roomId as string || null);\n\n// If we came from a game link, automatically open the games modal\nwatch(() => gameRoomId.value, (newRoomId) => {\n  if (newRoomId) {\n    isGamesOpen.value = true;\n  }\n}, { immediate: true });\n\n// Computed properties for country selectors\nconst availableCountriesForPreferred = computed(() => {\n  return countries.filter(c => \n    c.value !== 'any' && \n    !preferredCountries.value.includes(c.value) && \n    !blockedCountries.value.includes(c.value)\n  );\n});\n\nconst availableCountriesForBlocked = computed(() => {\n  return countries.filter(c => \n    c.value !== 'any' && \n    !blockedCountries.value.includes(c.value) && \n    !preferredCountries.value.includes(c.value)\n  );\n});\n\n// Methods\nconst toggleMute = async () => {\n  const newValue = await toggleMicrophone();\n  if (isMuted.value !== !newValue) {\n    isMuted.value = !newValue;\n  }\n  \n  if (connectionStatus.value === 'connected') {\n    setTimeout(() => {\n      const audioElement = document.querySelector('audio');\n      if (audioElement && audioElement.paused) {\n        audioElement.play().catch(() => {});\n      }\n    }, 300);\n  }\n};\n\nconst findNext = async () => {\n  // If we don't have microphone access yet, request it\n  if (!localStream.value) {\n    try {\n      await initializeLocalStream();\n      console.log('Microphone initialized');\n    } catch (error) {\n      console.error('Failed to access microphone', error);\n      alert('Please allow microphone access to use voice chat');\n      return;\n    }\n  }\n  \n  // Handle next partner request\n  if (socket.value) {\n    // Show status of searching for a new partner\n    connectionStatus.value = 'searching';\n    \n    // If there's a current partner, disconnect from them first\n    if (partnerId.value) {\n      console.log('Disconnecting from current partner');\n      socket.value.emit('disconnect-partner');\n      partnerId.value = null;\n      partnerInfo.value = null;\n      chatMessages.value = [];\n      // Close current WebRTC connection\n      closeConnection();\n    }\n    \n    console.log('Finding new partner with preferences');\n    // Send request to join the waiting queue with user preferences\n    socket.value.emit('join-queue', {\n      vibe: selectedVibe.value,\n      preferences: {\n        preferredCountries: preferredCountries.value.length ? preferredCountries.value : undefined,\n        blockedCountries: blockedCountries.value.length ? blockedCountries.value : undefined,\n        interests: interests.value ? interests.value.split(',').map(i => i.trim()) : undefined\n      }\n    });\n    \n    dailyConnections.value++;\n  }\n};\n\nconst toggleChat = () => {\n  isChatOpen.value = !isChatOpen.value;\n  \n  // Mark messages as read when opening chat\n  if (isChatOpen.value && partnerId.value) {\n    chat.markAsRead(partnerId.value);\n  }\n};\n\nconst toggleGamesOpen = () => {\n  isGamesOpen.value = !isGamesOpen.value;\n};\n\nconst toggleDonationOpen = () => {\n  isDonationOpen.value = !isDonationOpen.value;\n};\n\nconst toggleHistoryOpen = () => {\n  isHistoryOpen.value = !isHistoryOpen.value;\n};\n\nconst toggleFiltersOpen = () => {\n  isFiltersOpen.value = !isFiltersOpen.value;\n};\n\nconst sendChatMessage = (message: string) => {\n  if (socket.value && partnerId.value) {\n    socket.value.emit('chat-message', { message, to: partnerId.value });\n    \n    chatMessages.value.push({\n      id: Date.now().toString(),\n      message,\n      isOwn: true,\n      timestamp: Date.now()\n    });\n  }\n};\n\nconst selectGame = (game: string) => {\n  console.log(`Selected game: ${game}`);\n  if (socket.value && partnerId.value) {\n    socket.value.emit('game-invite', { game, to: partnerId.value });\n  }\n};\n\n// Filter methods\nconst addPreferredCountry = () => {\n  if (tempCountrySelect.value && !preferredCountries.value.includes(tempCountrySelect.value)) {\n    preferredCountries.value.push(tempCountrySelect.value);\n    tempCountrySelect.value = '';\n  }\n};\n\nconst removePreferredCountry = (countryCode: string) => {\n  preferredCountries.value = preferredCountries.value.filter(c => c !== countryCode);\n};\n\nconst addBlockedCountry = () => {\n  if (tempBlockedSelect.value && !blockedCountries.value.includes(tempBlockedSelect.value)) {\n    blockedCountries.value.push(tempBlockedSelect.value);\n    tempBlockedSelect.value = '';\n  }\n};\n\nconst removeBlockedCountry = (countryCode: string) => {\n  blockedCountries.value = blockedCountries.value.filter(c => c !== countryCode);\n};\n\nconst clearFilters = () => {\n  interests.value = '';\n  preferredCountries.value = [];\n  blockedCountries.value = [];\n  autoNextTimer.value = 'off';\n};\n\nconst applyFilters = () => {\n  isFiltersOpen.value = false;\n};\n\n// Utility methods\nconst getCountryFlag = (countryCode: string): string => {\n  const country = countries.find(c => c.value === countryCode);\n  return country ? country.label.split(' ')[0] : '🏳️';\n};\n\nconst getCountryName = (countryCode: string): string => {\n  const country = countries.find(c => c.value === countryCode);\n  return country ? country.label.split(' ').slice(1).join(' ') : 'Unknown';\n};\n\nconst formatTime = (timestamp: number): string => {\n  return new Date(timestamp).toLocaleTimeString([], { \n    hour: '2-digit', \n    minute: '2-digit' \n  });\n};\n\n// Vibe selector functions\nconst toggleVibeDropdown = () => {\n  showVibeDropdown.value = !showVibeDropdown.value;\n};\n\nconst selectVibe = (value: string) => {\n  selectedVibe.value = value;\n  showVibeDropdown.value = false;\n};\n\nconst getVibeEmoji = (value: string) => {\n  const vibe = vibes.find(v => v.value === value);\n  return vibe ? vibe.emoji : '🌟';\n};\n\nconst getVibeText = (value: string) => {\n  const vibe = vibes.find(v => v.value === value);\n  return vibe ? vibe.text : 'Any Vibe';\n};\n\n// Socket event setup\nonMounted(async () => {\n  console.log('Home view mounted');\n  \n  // Set up socket.io event listeners\n  if (socket.value) {\n    socket.value.on('online-count', (count: number) => {\n      onlineCount.value = count;\n    });\n    \n    socket.value.on('matched', (data: any) => {\n      console.log('Partner matched with event:', data);\n      \n      // Set the state to \"matched\" explicitly\n      connectionStatus.value = 'matched';\n      connectionError.value = ''; // Clear any previous error messages\n      \n      partnerId.value = data.partnerId;\n      partnerInfo.value = {\n        id: data.partnerId,\n        country: data.country || 'Unknown',\n        flag: data.flag || '🌍',\n        vibe: data.vibe || 'any'\n      };\n      \n      // Add to call history\n      callHistory.value.unshift({\n        id: Date.now().toString(),\n        country: partnerInfo.value.country,\n        flag: partnerInfo.value.flag,\n        timestamp: Date.now()\n      });\n      \n      // Keep only last 3 entries\n      if (callHistory.value.length > 3) {\n        callHistory.value = callHistory.value.slice(0, 3);\n      }\n      \n      console.log('Partner matched:', data);\n      \n      // Start WebRTC connection immediately without delay\n      if (data.partnerId) {\n        console.log('Initiating WebRTC connection with partner immediately');\n        const { createOffer } = useWebRTC();\n        createOffer(data.partnerId);\n        \n        // Make sure the state doesn't change to \"connected\" until audio is confirmed working\n        setTimeout(() => {\n          if (connectionStatus.value === 'matched' && webRTCConnectionState.value === 'connected') {\n            console.log('WebRTC connection established, updating UI state');\n            connectionStatus.value = 'connected';\n          }\n        }, 2000);\n      }\n    });\n\n    socket.value.on('direct-connection-established', (data: any) => {\n      console.log('Direct connection established:', data);\n      connectionStatus.value = 'connected';\n      partnerId.value = data.partnerId;\n      partnerInfo.value = {\n        id: data.partnerId,\n        country: data.country || 'Unknown',\n        flag: data.flag || '🌍'\n      };\n    });\n    \n    socket.value.on('partner-disconnected', () => {\n      connectionStatus.value = 'disconnected';\n      partnerId.value = null;\n      partnerInfo.value = null;\n      chatMessages.value = [];\n      \n      // If auto-reconnect is enabled, find a new partner\n      if (autoReconnect.value) {\n        setTimeout(() => {\n          if (connectionStatus.value === 'disconnected' && autoReconnect.value) {\n            findNext();\n          }\n        }, 2000);\n      }\n    });\n    \n    socket.value.on('chat-message', (data: any) => {\n      chatMessages.value.push({\n        id: Date.now().toString(),\n        message: data.message,\n        isOwn: false,\n        timestamp: Date.now()\n      });\n    });\n    \n    socket.value.on('error', (data: any) => {\n      console.error('Socket error:', data.message);\n      if (data.type === 'matching') {\n        connectionStatus.value = 'disconnected';\n      }\n    });\n\n    socket.value.on('voice-offer', handleVoiceOffer);\n    socket.value.on('voice-answer', handleVoiceAnswer);\n    socket.value.on('ice-candidate', processIceCandidateMessage);\n    \n    // Request online count when component mounts\n    socket.value.emit('get-online-count');\n  }\n\n  document.addEventListener('click', handleOutsideClick);\n});\n\nonBeforeUnmount(() => {\n  console.log('Home view unmounting, cleaning up connection');\n  closeConnection();\n  \n  // Remove event listeners\n  if (socket.value) {\n    socket.value.off('online-count');\n    socket.value.off('matched');\n    socket.value.off('direct-connection-established');\n    socket.value.off('partner-disconnected');\n    socket.value.off('chat-message');\n    socket.value.off('error');\n    socket.value.off('voice-offer');\n    socket.value.off('voice-answer');\n    socket.value.off('ice-candidate');\n  }\n\n  document.removeEventListener('click', handleOutsideClick);\n});\n\n// WebRTC handling methods\nconst handleVoiceOffer = async (data: any) => {\n  console.log('Received voice offer - forwarding to WebRTC service');\n  // All operations are forwarded to the WebRTC service\n  handleOffer(data.offer, data.from);\n};\n\nconst handleVoiceAnswer = async (data: any) => {\n  console.log('Received voice answer - forwarding to WebRTC service');\n  // All operations are forwarded to the WebRTC service\n  handleAnswer(data.answer);\n};\n\nconst processIceCandidateMessage = async (data: any) => {\n  console.log('Received ICE candidate - forwarding to WebRTC service');\n  // All operations are forwarded to the WebRTC service\n  handleIceCandidate(data.candidate);\n};\n\n// WebRTC connection state monitor\nwatch(webRTCConnectionState, (newState, oldState) => {\n  console.log(`[HomeView] WebRTC connection state changed: ${oldState} -> ${newState}`);\n  \n  // Show connection status to the user\n  if (newState === 'connected' && connectionStatus.value === 'matched') {\n    // Don't change the status immediately, first make sure audio is working\n    setTimeout(() => {\n      // Check again that the connection is still connected\n      if (webRTCConnectionState.value === 'connected' && connectionStatus.value === 'matched') {\n        connectionStatus.value = 'connected';\n        connectionError.value = ''; // Clear any previous error messages\n        console.log('[HomeView] Successfully transitioned from matched to connected');\n      }\n    }, 1000); // Short delay to ensure connection stability\n  } else if (newState === 'failed') {\n    // Hide error message initially, show after 1 minute if still not connected\n    connectionError.value = '';\n    setTimeout(() => {\n      if (webRTCConnectionState.value === 'failed' && \n          (connectionStatus.value === 'matched' || connectionStatus.value === 'connected')) {\n        connectionError.value = 'Connection failed. Press \"Next\" to find a new partner.';\n      }\n    }, 60000); // 1 minute delay\n  } else if (newState === 'disconnected') {\n    // Only set error if we were in connected or matched state, but delay showing it\n    if (connectionStatus.value === 'connected' || connectionStatus.value === 'matched') {\n      connectionError.value = '';\n      setTimeout(() => {\n        // Only show error if we're still disconnected after 1 minute\n        if (webRTCConnectionState.value === 'disconnected' && \n            (connectionStatus.value === 'connected' || connectionStatus.value === 'matched')) {\n          connectionError.value = 'Connection lost. Trying to reconnect...';\n        }\n      }, 60000); // 1 minute delay\n    }\n  }\n});\n\n// Close dropdown when clicking outside\nconst vibeDropdownRef = ref<HTMLElement | null>(null);\n\nconst handleOutsideClick = (event: MouseEvent) => {\n  const target = event.target as HTMLElement;\n  if (vibeDropdownRef.value && !vibeDropdownRef.value.contains(target)) {\n    showVibeDropdown.value = false;\n  }\n};\n</script>\n\n<style scoped>\n/* Animation for the pulse effect */\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n.delay-500 {\n  animation-delay: 0.5s;\n}\n\n.delay-1000 {\n  animation-delay: 1s;\n}\n\n.delay-2000 {\n  animation-delay: 2s;\n}\n</style> ","import { createRouter, createWebHistory } from 'vue-router';\nimport HomeView from '../views/HomeView.vue';\n\nconst router = createRouter({\n  history: createWebHistory(import.meta.env.BASE_URL),\n  routes: [\n    {\n      path: '/',\n      name: 'home',\n      component: HomeView\n    },\n    {\n      path: '/game/:roomId',\n      name: 'game',\n      component: HomeView,\n      props: true\n    }\n  ]\n});\n\nexport default router; ","import './assets/main.css'\r\nimport './index.css'\r\n\r\nimport { createApp } from 'vue'\r\nimport App from './App.vue'\r\nimport router from './router'\r\n\r\nconst app = createApp(App)\r\n\r\napp.use(router)\r\n\r\napp.mount('#app')\r\n"],"names":["_openBlock","_createElementBlock","_hoisted_1","_createVNode","_unref","RouterView","getApiUrl","socket","ref","userId","isConnected","useSocket","onMounted","initializeSocket","onUnmounted","cleanupSocketListeners","apiUrl","io","setupSocketListeners","_a","id","_b","attemptNumber","error","reconnect","rtcConfiguration","globalPeerConnection","globalLocalStream","globalRemoteStream","globalConnectionState","globalIsAudioMuted","globalPartnerId","DEBUG","lastConnectionError","failureReason","isNegotiating","isRestartingIce","connectionRetryCount","MAX_CONNECTION_RETRIES","pendingCandidates","heartbeatInterval","connectionMonitorInterval","HEARTBEAT_INTERVAL","CONNECTION_MONITOR_INTERVAL","CONNECTION_TIMEOUT","RECONNECT_DELAY","getConnectionStats","stats","report","currentRtcConfig","fastRtcConfiguration","turnOnlyRtcConfiguration","standardRtcConfiguration","useWebRTC","peerConnection","shallowRef","localStream","remoteStream","connectionState","isAudioMuted","partnerId","initializeLocalStream","audioTracks","track","stream","fallbackError","createPeerConnection","closeConnection","pc","setupConnectionTimeout","event","startConnectionMonitoring","checkAndFixTracks","audioIsWorking","startConnectionHeartbeat","attemptConnectionRecovery","stopConnectionHeartbeat","stopConnectionMonitoring","offer","createOffer","targetPartnerId","errorMsg","resolve","localMediaStream","i","waitForIceGatheringComplete","checkState","handleOffer","candidate","answer","handleAnswer","currentState","retryError","toggleMicrophone","audioSender","sender","audioTrack","trackError","fallbackStream","transceiver","cleanup","data","handleIceCandidate","channel","getConnectionDiagnosticReport","localAudioTracks","e","startNegotiation","fixedTracks","remoteAudioTracks","audioReceivers","receiver","fixedRemoteTracks","addedTracks","updateDebugInfo","watch","checkConnectionHealth","hasAudioIssues","m","hasCandidatePairIssues","candidateInfo","_c","peerConn","diagnosticReport","isLocalStorageAvailable","test","useLocalStorage","isAvailable","setItem","key","value","getItem","removeItem","clear","allMessages","currentPartnerId","unreadMessages","isListening","isInitialized","useChat","storage","initializeChatService","setupGlobalSocketListeners","loadAllChats","saveAllChats","newSocket","conversationKey","getConversationKey","setCurrentPartner","sendMessage","text","toPartnerId","timestamp","getMessages","messages","hasUnreadMessages","hasUnread","markAsRead","ids","savedMessages","savedUnread","clearChat","clearAllChats","props","__props","connectionStatusText","computed","_hoisted_2","_cache","_createElementVNode","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_normalizeClass","_hoisted_14","emit","__emit","isProcessing","toggleMute","audioElement","err","$emit","currentMessage","messagesContainerRef","scrollToBottom","nextTick","formatTime","newVal","_Fragment","_renderList","message","$event","roomId","copied","gameState","board","playerSymbol","partnerSymbol","currentTurn","winner","partnerReady","connectionLostTimeout","lastMoveTime","isMyTurn","makeMove","index","checkWinner","startConnectionTimeout","handleError","winPatterns","pattern","a","b","c","resetGame","copyInviteLink","link","sendInvite","moveIndex","cell","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","playerChoice","partnerChoice","gameResult","bothPlayersReady","lastActivityTime","choices","makeChoice","choice","checkGameResult","playerChoiceText","_","emoji","partnerChoiceText","move","loading","currentQuestion","shuffledAnswers","selectedAnswer","score","isCorrect","initGame","question","shuffleAnswers","requestQuestion","answers","j","selectAnswer","nextQuestion","_sfc_main$6","defineComponent","TicTacToe","RockPaperScissors","TriviaGame","selectedGame","waitingForAccept","showGameInvite","inviteGameType","isInitiator","INVITE_TIMEOUT","IMPLEMENTED_GAMES","gameNames","inviteGameName","isGameImplemented","gameType","selectGame","timeoutId","cancelGame","resetGameState","acceptInvite","declineInvite","closeGame","handleGameError","errorMessage","handleGameEnd","result","_d","_e","_f","_resolveComponent","_ctx","args","_component_TicTacToe","_component_RockPaperScissors","_component_TriviaGame","_createStaticVNode","getGameName","type","isOpen","_hoisted_15","GameSelector","selectedAmount","selectAmount","amount","openPayPal","triggerRef","contentRef","displayValue","option","opt","toggleOpen","handleClickOutside","onBeforeUnmount","_Transition","_renderSlot","stars","generateStars","newStars","star","_normalizeStyle","maxReconnectAttempts","volume","isPlaying","reconnectAttempts","hasRemoteStream","connectAudioStream","newStream","tryPlayAudio","muted","newState","reconnectStream","newPartnerId","handleVisibilityChange","startAudioCheck","stopAudioCheck","audioCheckInterval","hasTracks","delay","connectionStatus","partnerInfo","connectionError","isMuted","isChatOpen","isGamesOpen","isDonationOpen","isHistoryOpen","isFiltersOpen","onlineCount","dailyConnections","autoReconnect","chatMessages","callHistory","selectedVibe","showVibeDropdown","interests","preferredCountries","blockedCountries","autoNextTimer","tempCountrySelect","tempBlockedSelect","vibes","timerOptions","countries","cosmicQuotes","currentQuote","webRTCConnectionState","chat","route","useRoute","gameRoomId","newRoomId","availableCountriesForPreferred","availableCountriesForBlocked","newValue","findNext","toggleChat","sendChatMessage","game","addPreferredCountry","removePreferredCountry","countryCode","addBlockedCountry","removeBlockedCountry","clearFilters","applyFilters","getCountryFlag","country","getCountryName","toggleVibeDropdown","selectVibe","getVibeEmoji","vibe","v","getVibeText","count","handleVoiceOffer","handleVoiceAnswer","processIceCandidateMessage","handleOutsideClick","oldState","vibeDropdownRef","target","Starfield","ConnectionCard","ControlButtons","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","call","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","SelectVue","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","ChatModal","GamesModal","DonationModal","_hoisted_42","AudioOutput","router","createRouter","createWebHistory","HomeView","app","createApp","App"],"mappings":"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"}