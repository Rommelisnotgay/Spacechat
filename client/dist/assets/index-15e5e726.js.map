{"version":3,"file":"index-15e5e726.js","sources":["../../src/App.vue","../../src/services/socket.ts","../../src/services/rtc-configurations.ts","../../src/services/webrtc.ts","../../src/services/storage.ts","../../src/services/chat.ts","../../src/assets/Circle.png","../../src/components/connection-card.vue","../../src/components/control-buttons.vue","../../src/components/chat-modal.vue","../../src/components/games/TicTacToe.vue","../../src/components/games/RockPaperScissors.vue","../../src/components/games/WordGalaxy.vue","../../src/components/games-modal.vue","../../src/components/donation-modal.vue","../../src/components/starfield.vue","../../src/components/audio/AudioOutput.vue","../../src/views/HomeView.vue","../../src/router/index.ts","../../src/main.ts"],"sourcesContent":["<template>\n  <div class=\"app-container\">\n    <RouterView />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { RouterView } from 'vue-router'\n</script>\n\n<style>\n@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n\nbody {\n  font-family: 'Inter', sans-serif;\n  margin: 0;\n  padding: 0;\n  background-color: #3A2273; /* Ø®Ù„ÙÙŠØ© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© */\n  min-height: 100vh;\n  color: white;\n  overflow-x: hidden;\n}\n\n.app-container {\n  background: linear-gradient(to bottom right, #4c1d95, #6d28d9, #7c3aed);\n  min-height: 100vh;\n  width: 100%;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n}\n\n/* Animations */\n.animate-pulse-slow {\n  animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n.animate-float {\n  animation: float 6s ease-in-out infinite;\n}\n\n@keyframes float {\n  0%, 100% { \n    transform: translateY(0); \n  }\n  50% { \n    transform: translateY(-10px); \n  }\n}\n\n/* Button styles */\nbutton {\n  transition: all 0.2s ease;\n}\n\nbutton:active {\n  transform: scale(0.95);\n}\n\n/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 6px;\n}\n\n::-webkit-scrollbar-track {\n  background: rgba(76, 29, 149, 0.3);\n  border-radius: 10px;\n}\n\n::-webkit-scrollbar-thumb {\n  background: rgba(124, 58, 237, 0.6);\n  border-radius: 10px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: rgba(124, 58, 237, 0.8);\n}\n</style>\n","import { ref, onMounted, onUnmounted } from 'vue';\nimport { io, Socket } from 'socket.io-client';\n\n// Determine the API URL based on environment\nconst getApiUrl = () => {\n  // In production, use the same domain (as the server serves the client)\n  if (import.meta.env.PROD) {\n    // When running on Railway, the client is served by the server,\n    // so we use relative URL in production\n    return window.location.origin;\n  }\n  \n  // For development, use the configured API URL or default\n  return import.meta.env.VITE_API_URL || 'http://localhost:3000';\n};\n\n// Socket instance\nconst socket = ref<Socket | null>(null);\nconst userId = ref<string | null>(null);\nconst isConnected = ref(false);\nlet pingInterval: ReturnType<typeof setInterval> | null = null;\n\n/**\n * Socket service for managing real-time connections\n */\nexport function useSocket() {\n  onMounted(() => {\n    if (!socket.value) {\n      initializeSocket();\n    }\n  });\n\n  onUnmounted(() => {\n    // Clean up socket connection when component is unmounted\n    // But don't disconnect completely - just remove listeners from this instance\n    if (socket.value) {\n      cleanupSocketListeners();\n    }\n    \n    // Clear ping interval\n    if (pingInterval) {\n      clearInterval(pingInterval);\n      pingInterval = null;\n    }\n  });\n\n  // Initialize the socket connection\n  function initializeSocket() {\n    const apiUrl = getApiUrl();\n    console.log(`Connecting to socket server at: ${apiUrl}`);\n    \n    // Try to get previously stored user ID\n    const storedUserId = localStorage.getItem('spacechat_user_id');\n    console.log('Retrieved stored user ID:', storedUserId);\n    \n    // Connect to socket.io server\n    socket.value = io(apiUrl, {\n      autoConnect: true,\n      reconnection: true,\n      reconnectionAttempts: Infinity, // Try to reconnect forever\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000, // Max delay between reconnections\n      timeout: 30000, // Increased timeout to 30 seconds\n      transports: ['websocket', 'polling'], // Prefer WebSocket but fallback to polling\n      extraHeaders: {\n        'X-Client-Version': '1.0.0', // Helps identify client versions for debugging\n      },\n      // Add stored user ID in query params for immediate identification\n      query: storedUserId ? { userId: storedUserId } : undefined,\n      // Path settings - uncomment if needed for specific server setup\n      // path: '/socket.io/',\n      forceNew: false, // Reuse existing connection if possible\n      rememberUpgrade: true, // Remember websocket connection between page refreshes\n      // Added to enhance connection behind proxies and firewalls\n      withCredentials: true\n    });\n\n    setupSocketListeners();\n    \n    // Setup ping/pong to keep connection alive and updating last seen time\n    startPingInterval();\n  }\n  \n  // Setup ping interval\n  function startPingInterval() {\n    // Clear existing interval if any\n    if (pingInterval) {\n      clearInterval(pingInterval);\n    }\n    \n    // Start new interval - ping every 30 seconds\n    pingInterval = setInterval(() => {\n      if (socket.value && isConnected.value) {\n        socket.value.emit('ping');\n      }\n    }, 30000);\n  }\n\n  // Set up all socket event listeners\n  function setupSocketListeners() {\n    if (!socket.value) return;\n\n    // Set up event listeners\n    socket.value.on('connect', () => {\n      console.log('Socket connected');\n      isConnected.value = true;\n      \n      // Get stored user ID from localStorage if available\n      const storedUserId = localStorage.getItem('spacechat_user_id');\n      \n      // Get user ID from the server after connecting\n      socket.value?.emit('user:identify', \n        { prevUserId: storedUserId || undefined }, \n        (id: string) => {\n          console.log('Identified with server, user ID:', id);\n          userId.value = id;\n          \n          // Store user ID in localStorage for reconnection\n          localStorage.setItem('spacechat_user_id', id);\n      });\n      \n      // Request online count update\n      socket.value?.emit('get-online-count');\n    });\n\n    socket.value.on('disconnect', () => {\n      console.log('Socket disconnected');\n      isConnected.value = false;\n    });\n\n    socket.value.on('reconnect', (attemptNumber: number) => {\n      console.log(`Socket reconnected after ${attemptNumber} attempts`);\n      isConnected.value = true;\n      \n      // Re-identify with the server and refresh state\n      const storedUserId = localStorage.getItem('spacechat_user_id');\n      if (storedUserId) {\n        socket.value?.emit('user:identify', { prevUserId: storedUserId }, (id: string) => {\n          console.log('Re-identified with server after reconnection, user ID:', id);\n          userId.value = id;\n          \n          // Update stored ID if different\n          if (id !== storedUserId) {\n            localStorage.setItem('spacechat_user_id', id);\n          }\n          \n          // Re-request online count\n          socket.value?.emit('get-online-count');\n        });\n      }\n    });\n\n    socket.value.on('reconnect_attempt', (attemptNumber: number) => {\n      console.log(`Socket reconnection attempt ${attemptNumber}`);\n    });\n\n    socket.value.on('reconnect_error', (error: Error) => {\n      console.error('Socket reconnection error:', error);\n    });\n\n    socket.value.on('reconnect_failed', () => {\n      console.error('Socket reconnection failed');\n      \n      // Try to initialize socket again after a delay\n      setTimeout(() => {\n        if (!isConnected.value) {\n          console.log('Attempting to reinitialize socket connection...');\n          cleanupSocketListeners();\n          initializeSocket();\n        }\n      }, 5000);\n    });\n\n    socket.value.on('error', (error: Error) => {\n      console.error('Socket error:', error);\n    });\n    \n    // Handle pong response\n    socket.value.on('pong', () => {\n      // Connection is active, nothing to do\n    });\n    \n    // Handle user ID from server\n    socket.value.on('user-id', (id: string) => {\n      console.log('Received user ID from server:', id);\n      userId.value = id;\n      // Store user ID in localStorage for reconnection\n      localStorage.setItem('spacechat_user_id', id);\n    });\n  }\n\n  // Clean up all socket listeners\n  function cleanupSocketListeners() {\n    if (!socket.value) return;\n    \n    socket.value.off('connect');\n    socket.value.off('disconnect');\n    socket.value.off('reconnect');\n    socket.value.off('reconnect_attempt');\n    socket.value.off('reconnect_error');\n    socket.value.off('reconnect_failed');\n    socket.value.off('error');\n    socket.value.off('user-id');\n    socket.value.off('pong');\n  }\n\n  // Force reconnection\n  function reconnect() {\n    if (socket.value) {\n      console.log('Forcing socket reconnection...');\n      socket.value.disconnect();\n      socket.value.connect();\n    } else {\n      initializeSocket();\n    }\n  }\n\n  return { \n    socket, \n    isConnected, \n    userId,\n    reconnect \n  };\n}\n","/**\n * ØªÙƒÙˆÙŠÙ†Ø§Øª WebRTC Ø§Ù„Ù…Ø­Ø³Ù†Ø©\n * \n * ÙŠØ­ØªÙˆÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ ØªÙƒÙˆÙŠÙ†Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ù„Ù€ WebRTC ØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡Ø§ \n * Ù„ØªØ¹Ù…Ù„ ÙÙŠ Ø¸Ø±ÙˆÙ Ù…Ø®ØªÙ„ÙØ© Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ§Øª\n */\n\n// Ø®ÙˆØ§Ø¯Ù… TURN Ù…Ø¯ÙÙˆØ¹Ø© ÙˆÙ…ÙˆØ«ÙˆÙ‚Ø© (ÙŠØªØ·Ù„Ø¨ ØªÙƒÙˆÙŠÙ† Ø­Ø³Ø§Ø¨Ø§Øª ØµØ§Ù„Ø­Ø©)\nconst TURN_CREDENTIAL_EXPIRY = 86400; // 24 hours\nconst TURN_USERNAME = `${Date.now() + TURN_CREDENTIAL_EXPIRY}:spacechat`;\nconst TURN_PASSWORD = 'openrelayproject'; // ÙŠØ¬Ø¨ ØªØºÙŠÙŠØ±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¥Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ø¹ØªÙ…Ø§Ø¯ Ø­Ù‚ÙŠÙ‚ÙŠØ©\n\n// Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠ Ù…Ø¹ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ØªÙˆØ§Ø²Ù†Ø© Ù…Ù† Ø®ÙˆØ§Ø¯Ù… STUN/TURN\nexport const standardRtcConfiguration: RTCConfiguration = {\n  iceServers: [\n    // Ø®ÙˆØ§Ø¯Ù… TURN Ù…ÙˆØ«ÙˆÙ‚Ø© Ù„Ù„ØªØºÙ„Ø¨ Ø¹Ù„Ù‰ NAT\n    {\n      urls: [\n        'turns:global.relay.metered.ca:443', // TURN over TLS\n        'turn:global.relay.metered.ca:443?transport=tcp', // TURN over TCP\n        'turn:global.relay.metered.ca:80?transport=tcp', // TURN over TCP port 80\n        'turn:global.relay.metered.ca:80' // TURN over UDP port 80\n      ],\n      username: TURN_USERNAME,\n      credential: TURN_PASSWORD\n    },\n    // Ø®ÙˆØ§Ø¯Ù… TURN Ù…ÙˆØ«ÙˆÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø©\n    {\n      urls: [\n        'turn:relay.metered.ca:80', // TURN over UDP\n        'turn:relay.metered.ca:443', // TURN over TCP\n        'turns:relay.metered.ca:443' // TURN over TLS\n      ],\n      username: 'dbc12a',\n      credential: 'c84ded89b281ae42'\n    },\n    // Ø®ÙˆØ§Ø¯Ù… Twilio ÙƒØ®ÙŠØ§Ø± Ø«Ø§Ù„Ø«\n    {\n      urls: [\n        'turn:global.turn.twilio.com:3478?transport=tcp',\n        'turn:global.turn.twilio.com:3478?transport=udp',\n        'turns:global.turn.twilio.com:443?transport=tcp'\n      ],\n      username: 'openrelayproject',\n      credential: 'openrelayproject'\n    },\n    // Ø®ÙˆØ§Ø¯Ù… STUN Ø¹Ø§Ù…Ø©\n    { urls: 'stun:stun.l.google.com:19302' },\n    { urls: 'stun:stun1.l.google.com:19302' },\n    { urls: 'stun:stun2.l.google.com:19302' },\n    { urls: 'stun:stun3.l.google.com:19302' },\n    { urls: 'stun:stun4.l.google.com:19302' },\n    { urls: 'stun:stun.cloudflare.com:3478' }, // Ø®Ø§Ø¯Ù… Cloudflare STUN\n    { urls: 'stun:openrelay.metered.ca:80' }\n  ],\n  iceCandidatePoolSize: 10,\n  iceTransportPolicy: 'all',\n  bundlePolicy: 'max-bundle',\n  rtcpMuxPolicy: 'require'\n};\n\n// ØªÙƒÙˆÙŠÙ† TURN ÙÙ‚Ø· Ù„Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„ØµØ¹Ø¨Ø© ÙˆØ§Ù„Ø¬Ø¯Ø±Ø§Ù† Ø§Ù„Ù†Ø§Ø±ÙŠØ© Ø§Ù„Ù…Ù‚ÙŠØ¯Ø©\nexport const turnOnlyRtcConfiguration: RTCConfiguration = {\n  iceServers: [\n    // Ø®ÙŠØ§Ø± TURN Ø£ÙˆÙ„\n    {\n      urls: [\n        'turns:global.relay.metered.ca:443', // TURN over TLS (Ø§Ù„Ø£ÙƒØ«Ø± Ù†Ø¬Ø§Ø­Ù‹Ø§ Ø®Ù„Ù Ø¬Ø¯Ø±Ø§Ù† Ø§Ù„Ø­Ù…Ø§ÙŠØ©)\n        'turn:global.relay.metered.ca:443?transport=tcp', // TURN over TCP\n        'turn:global.relay.metered.ca:80?transport=tcp', // TURN Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° 80\n        'turns:relay.metered.ca:443' // Ù†Ø³Ø®Ø© Ø¨Ø¯ÙŠÙ„Ø©\n      ],\n      username: TURN_USERNAME,\n      credential: TURN_PASSWORD\n    },\n    // Ø¨Ø¯ÙŠÙ„ Ø¢Ø®Ø±\n    {\n      urls: [\n        'turn:relay.metered.ca:443?transport=tcp',\n        'turns:relay.metered.ca:443'\n      ],\n      username: 'dbc12a',\n      credential: 'c84ded89b281ae42'\n    },\n    // Ø®ÙŠØ§Ø± Twilio ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©\n    {\n      urls: [\n        'turns:global.turn.twilio.com:443?transport=tcp'\n      ],\n      username: 'openrelayproject',\n      credential: 'openrelayproject'\n    }\n  ],\n  iceCandidatePoolSize: 10,\n  iceTransportPolicy: 'relay', // Ø¥Ø¬Ø¨Ø§Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙˆØ§Ø¯Ù… TURN ÙÙ‚Ø·\n  bundlePolicy: 'max-bundle',\n  rtcpMuxPolicy: 'require'\n};\n\n// ØªÙƒÙˆÙŠÙ† Ø³Ø±ÙŠØ¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø¹Ø¯Ø¯ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø®ÙˆØ§Ø¯Ù… Ù„Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹\nexport const fastRtcConfiguration: RTCConfiguration = {\n  iceServers: [\n    { urls: [\n        'stun:stun.l.google.com:19302',\n        'stun:stun.cloudflare.com:3478'\n      ]\n    },\n    {\n      urls: [\n        'turn:relay.metered.ca:443?transport=tcp',\n      ],\n      username: 'dbc12a',\n      credential: 'c84ded89b281ae42'\n    }\n  ],\n  iceCandidatePoolSize: 5,\n  iceTransportPolicy: 'all',\n  bundlePolicy: 'max-bundle',\n  rtcpMuxPolicy: 'require'\n};\n\n// ØªÙƒÙˆÙŠÙ† Ù…Ø­Ø³Ù† Ù„Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©\nexport const localRtcConfiguration: RTCConfiguration = {\n  iceServers: [\n    { urls: 'stun:stun.l.google.com:19302' }\n  ],\n  iceCandidatePoolSize: 3,\n  iceTransportPolicy: 'all',\n  bundlePolicy: 'max-bundle',\n  rtcpMuxPolicy: 'require'\n}; ","import { ref, onUnmounted, shallowRef, watch, computed } from 'vue';\nimport { useSocket } from './socket';\nimport { Socket } from 'socket.io-client';\nimport { \n  standardRtcConfiguration, \n  fastRtcConfiguration, \n  turnOnlyRtcConfiguration, \n  localRtcConfiguration\n} from './rtc-configurations';\n\ninterface ConnectionPreferences {\n  vibe?: string;\n  language?: string;\n  preferSameLanguage?: boolean;\n}\n\n// Use standard configuration by default\nlet currentRtcConfig: RTCConfiguration = standardRtcConfiguration;\nconst rtcConfiguration = currentRtcConfig;\n\n// Singleton instances for WebRTC to ensure persistence across component lifecycles\nlet globalPeerConnection: RTCPeerConnection | null = null;\nlet globalLocalStream: MediaStream | null = null;\nlet globalRemoteStream: MediaStream | null = null;\nconst globalConnectionState = ref<string>('new');\nconst globalIsAudioMuted = ref<boolean>(false);\nconst globalPartnerId = ref<string | null>(null);\n\n// Add debug flag\nconst DEBUG = true;\n\n// Debugging info storage\nlet lastConnectionError: string = '';\nlet failureReason: string = '';\nlet peerConnectionStats: any = null;\n\n// Adding variables to control the connection\nlet isNegotiating = false; // Prevent offer/answer overlap\nlet isRestartingIce = false; // Control ICE restart\nlet connectionRetryCount = 0; // Number of connection retry attempts\nconst MAX_CONNECTION_RETRIES = 15; // Increased number of attempts from 10 to 15\nlet pendingCandidates: RTCIceCandidate[] = []; // List of pending ICE candidates\n\n// Adding stability variables\nlet heartbeatInterval: number | null = null;\nlet trackCheckInterval: number | null = null;\nlet connectionMonitorInterval: number | null = null;\nconst HEARTBEAT_INTERVAL = 5000; // Increased from 3000 to 5000\nconst TRACK_CHECK_INTERVAL = 5000; // Increased from 3000 to 5000\nconst CONNECTION_MONITOR_INTERVAL = 8000; // Increased from 5000 to 8000\nconst CONNECTION_STABILITY_THRESHOLD = 15000; // Increased from 10000 to 15000 seconds before considering the connection stable\n\n// Add constants for connection timeouts\nconst CONNECTION_TIMEOUT = 15000; // Increased from 8000 to 15000\nconst RECONNECT_DELAY = 1000; // Increased from 500 to 1000\n\n// Get connection statistics\nasync function getConnectionStats(): Promise<any> {\n  if (!globalPeerConnection) {\n    return { error: 'No peer connection available' };\n  }\n  \n  try {\n    const stats: any = {};\n    const statsReport = await globalPeerConnection.getStats();\n    \n    statsReport.forEach((report: any) => {\n      if (report.type === 'transport') {\n        stats.transport = {\n          bytesReceived: report.bytesReceived,\n          bytesSent: report.bytesSent,\n          dtlsState: report.dtlsState,\n          selectedCandidatePairId: report.selectedCandidatePairId\n        };\n      } else if (report.type === 'candidate-pair' && report.selected) {\n        stats.selectedCandidatePair = {\n          localCandidateId: report.localCandidateId,\n          remoteCandidateId: report.remoteCandidateId,\n          state: report.state,\n          availableOutgoingBitrate: report.availableOutgoingBitrate\n        };\n      } else if (report.type === 'local-candidate' || report.type === 'remote-candidate') {\n        if (!stats.candidates) stats.candidates = [];\n        stats.candidates.push({\n          type: report.type,\n          id: report.id,\n          ip: report.ip,\n          port: report.port,\n          protocol: report.protocol,\n          candidateType: report.candidateType\n        });\n      } else if (report.type === 'media-source' || report.type === 'track' || report.type === 'media-playout') {\n        if (!stats.media) stats.media = [];\n        stats.media.push({\n          type: report.type,\n          id: report.id,\n          kind: report.kind,\n          audioLevel: report.audioLevel,\n          trackIdentifier: report.trackIdentifier\n        });\n      }\n    });\n    \n    return stats;\n  } catch (error) {\n    console.error('[WebRTC] Error getting stats:', error);\n    return { error: 'Failed to get stats: ' + error };\n  }\n}\n\n// Update connection statistics periodically\nfunction startStatsCollection() {\n  // Clear any existing timer\n  stopStatsCollection();\n  \n  // Start a new timer to collect stats every 5 seconds\n  const statsTimer = setInterval(async () => {\n    if (globalPeerConnection && \n        (globalConnectionState.value === 'connected' || \n         globalConnectionState.value === 'connecting')) {\n      peerConnectionStats = await getConnectionStats();\n      if (DEBUG) console.log('[WebRTC] Connection stats:', peerConnectionStats);\n    } else {\n      stopStatsCollection();\n    }\n  }, 5000);\n  \n  // Store the timer ID globally\n  (window as any).__webrtcStatsTimer = statsTimer;\n}\n\n// Stop stats collection\nfunction stopStatsCollection() {\n  const timer = (window as any).__webrtcStatsTimer;\n  if (timer) {\n    clearInterval(timer);\n    (window as any).__webrtcStatsTimer = null;\n  }\n}\n\n// Diagnose connection issues\nfunction diagnoseConnectionIssues(): string {\n  if (!globalPeerConnection) {\n    return 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ù†Ø¸ÙŠØ± Ø¥Ù„Ù‰ Ù†Ø¸ÙŠØ±. Ø¬Ø±Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.';\n  }\n  \n  // Check for specific issues\n  if (failureReason) {\n    return `ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${failureReason}`;\n  }\n  \n  if (lastConnectionError) {\n    return `Ø¢Ø®Ø± Ø®Ø·Ø£: ${lastConnectionError}`;\n  }\n  \n  if (!globalLocalStream || globalLocalStream.getAudioTracks().length === 0) {\n    return 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª ÙˆØ¥Ø°Ù† Ø§Ù„Ù…ØªØµÙØ­.';\n  }\n  \n  if (!globalRemoteStream || globalRemoteStream.getAudioTracks().length === 0) {\n    return 'Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… ØµÙˆØª Ù…Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±. Ù‚Ø¯ ØªÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ø¯ÙŠÙ‡Ù….';\n  }\n  \n  const state = globalPeerConnection.connectionState || globalPeerConnection.iceConnectionState;\n  \n  // Check candidate types to diagnose NAT/firewall issues\n  const candidateInfo = {\n    localCandidates: (window as any).__localIceCandidates?.length || 0,\n    remoteCandidates: (window as any).__remoteIceCandidates?.length || 0,\n    hasLocalRelay: false,\n    hasRemoteRelay: false,\n    hasLocalServerReflexive: false,\n    hasRemoteServerReflexive: false\n  };\n  \n  // Check if we have TURN candidates (relay) which are critical for NAT traversal\n  if ((window as any).__localIceCandidates) {\n    for (const candidate of (window as any).__localIceCandidates) {\n      if (candidate.candidate.includes('typ relay')) {\n        candidateInfo.hasLocalRelay = true;\n      }\n      if (candidate.candidate.includes('typ srflx')) {\n        candidateInfo.hasLocalServerReflexive = true;\n      }\n    }\n  }\n  \n  if ((window as any).__remoteIceCandidates) {\n    for (const candidate of (window as any).__remoteIceCandidates) {\n      if (candidate.candidate.includes('typ relay')) {\n        candidateInfo.hasRemoteRelay = true;\n      }\n      if (candidate.candidate.includes('typ srflx')) {\n        candidateInfo.hasRemoteServerReflexive = true;\n      }\n    }\n  }\n  \n  // Provide specific diagnostic based on connection state and candidates\n  switch (state) {\n    case 'new':\n      return 'Ø§Ù„Ø§ØªØµØ§Ù„ Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...';\n    case 'connecting':\n      // Provide more specific info about the connection attempt\n      if (candidateInfo.localCandidates === 0) {\n        return 'Ù„Ù… ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù…Ø±Ø´Ø­Ø§Øª ICE Ø§Ù„Ù…Ø­Ù„ÙŠØ©. Ù‚Ø¯ ØªÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©.';\n      }\n      \n      if (!candidateInfo.hasLocalRelay && !candidateInfo.hasLocalServerReflexive) {\n        return 'Ù„Ù… ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù…Ø±Ø´Ø­Ø§Øª STUN/TURN. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…Ù†ÙØ° UDP 19302 ØºÙŠØ± Ù…Ø­Ø¸ÙˆØ± ÙÙŠ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©.';\n      }\n      \n      if (candidateInfo.localCandidates > 0 && candidateInfo.remoteCandidates === 0) {\n        return 'ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù…Ø±Ø´Ø­Ø§Øª ICE Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆÙ„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ù…Ø±Ø´Ø­Ø§Øª Ù…Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ø¨Ø¹Ø¯. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„.';\n      }\n      \n      return 'ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„. Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ù‡Ø°Ø§ Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø­Ø³Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©.';\n    case 'connected':\n      return 'ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø¥Ø°Ø§ ÙƒÙ†Øª Ù„Ø§ ØªØ³Ù…Ø¹ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙÙŠ Ù…ØªØµÙØ­Ùƒ.';\n    case 'disconnected':\n      return 'Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¤Ù‚ØªÙ‹Ø§. Ø¬Ø§Ø± Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„...';\n    case 'failed':\n      // More detailed failure diagnosis\n      if (!candidateInfo.hasLocalRelay && !candidateInfo.hasRemoteRelay) {\n        return 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„. Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙˆØ§Ø¯Ù… TURN. Ù‡Ø°Ø§ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø£Ùˆ ØªÙƒÙˆÙŠÙ† NAT. Ø­Ø§ÙˆÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ù† Ø´Ø¨ÙƒØ© Ø£Ø®Ø±Ù‰.';\n      }\n      \n      if (candidateInfo.hasLocalRelay && candidateInfo.hasRemoteRelay) {\n        return 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø±ØºÙ… ÙˆØ¬ÙˆØ¯ Ù…Ø±Ø´Ø­Ø§Øª TURN. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ ØªØ¹Ø·Ù„ ÙÙŠ Ø®Ø¯Ù…Ø© TURN.';\n      }\n      \n      return 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§ØªØµØ§Ù„.';\n    case 'closed':\n      return 'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';\n    default:\n      return `Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©: ${state}. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.`;\n  }\n}\n\n/**\n * WebRTC service for audio calls\n */\nexport function useWebRTC() {\n  const { socket, userId } = useSocket();\n  \n  // Use shallow refs to the global objects\n  const peerConnection = shallowRef<RTCPeerConnection | null>(globalPeerConnection);\n  const localStream = shallowRef<MediaStream | null>(globalLocalStream);\n  const remoteStream = shallowRef<MediaStream | null>(globalRemoteStream);\n  const connectionState = globalConnectionState;\n  const isAudioMuted = globalIsAudioMuted;\n  const partnerId = globalPartnerId;\n  \n  // Audio constraints\n  const audioConstraints = ref<MediaTrackConstraints>({\n    echoCancellation: true,\n    noiseSuppression: true\n  });\n  \n  /**\n   * Initialize local media stream (microphone)\n   */\n  const initializeLocalStream = async (): Promise<MediaStream> => {\n    try {\n      if (globalLocalStream) {\n        if (DEBUG) console.log('[WebRTC] Using existing local stream');\n        \n        // Check if audio tracks are still active\n        const audioTracks = globalLocalStream.getAudioTracks();\n        if (audioTracks.length === 0 || !audioTracks[0].enabled) {\n          if (DEBUG) console.log('[WebRTC] Existing stream has no active audio tracks, requesting new stream');\n          // If no active audio tracks, get a new stream\n          globalLocalStream.getTracks().forEach(track => track.stop());\n          globalLocalStream = null;\n        } else {\n          return globalLocalStream;\n        }\n      }\n      \n      if (DEBUG) console.log('[WebRTC] Requesting access to microphone with specific constraints');\n      \n      // Try with more specific audio constraints for better quality\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n          sampleRate: 48000,\n          channelCount: 2\n        },\n        video: false\n      });\n      \n      // Double check that we got audio tracks\n      if (stream.getAudioTracks().length === 0) {\n        console.error('[WebRTC] No audio tracks found in stream');\n        throw new Error('No audio tracks available');\n      }\n      \n      if (DEBUG) {\n        console.log('[WebRTC] Local stream acquired successfully');\n        console.log('[WebRTC] Audio tracks:', stream.getAudioTracks().length);\n        const tracks = stream.getAudioTracks();\n        tracks.forEach(track => {\n          console.log(`[WebRTC] Track: ${track.label}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n          console.log('[WebRTC] Track settings:', JSON.stringify(track.getSettings()));\n        });\n      }\n      \n      // Ensure all tracks are enabled\n      stream.getTracks().forEach(track => {\n        track.enabled = true;\n      });\n      \n      globalLocalStream = stream;\n      localStream.value = stream;\n      return stream;\n    } catch (error) {\n      console.error('[WebRTC] Error accessing microphone:', error);\n      \n      // Try with simpler constraints as fallback\n      try {\n        if (DEBUG) console.log('[WebRTC] Trying fallback with simpler constraints');\n        const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });\n        \n        if (stream.getAudioTracks().length === 0) {\n          throw new Error('No audio tracks available');\n        }\n        \n        globalLocalStream = stream;\n        localStream.value = stream;\n        return stream;\n      } catch (fallbackError) {\n        console.error('[WebRTC] Fallback also failed:', fallbackError);\n        throw new Error('Could not access microphone. Please check permissions.');\n      }\n    }\n  };\n  \n  /**\n   * Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªØµØ§Ù„ RTCPeerConnection Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±\n   */\n  const createPeerConnection = (): RTCPeerConnection => {\n    // Cleanup any existing connection\n    if (globalPeerConnection) {\n      try {\n        globalPeerConnection.close();\n        // Clear any global references to the connection and streams\n        globalPeerConnection = null;\n        if (globalRemoteStream) {\n          globalRemoteStream.getTracks().forEach(track => {\n            track.stop();\n          });\n          globalRemoteStream = null;\n        }\n      } catch (err) {\n        console.error('[WebRTC] Error cleaning up old peer connection:', err);\n      }\n    }\n\n    try {\n      // Create a new RTCPeerConnection with our configuration\n    const pc = new RTCPeerConnection(rtcConfiguration);\n    \n      // On negotiation needed\n      pc.onnegotiationneeded = async (event) => {\n        if (DEBUG) console.log('[WebRTC] Negotiation needed event', event);\n        \n        if (!canSetLocalDescription(pc) || isNegotiating) {\n          if (DEBUG) console.log('[WebRTC] Skipping negotiation - already in progress or not in stable state');\n          return;\n        }\n        \n        isNegotiating = true;\n        \n        try {\n          if (DEBUG) console.log('[WebRTC] Starting negotiation');\n          startNegotiation();\n        } catch (err) {\n          console.error('[WebRTC] Negotiation error:', err);\n          failureReason = `Negotiation error: ${err}`;\n          isNegotiating = false;\n        }\n      };\n      \n      // Track ICE connection state changes\n      pc.oniceconnectionstatechange = () => {\n        if (DEBUG) console.log('[WebRTC] ICE Connection state changed to:', pc.iceConnectionState);\n        \n        if (pc.iceConnectionState === 'connected' || pc.iceConnectionState === 'completed') {\n          // We have a connection! Clear any previous failures and reset retry counter\n          failureReason = '';\n          connectionRetryCount = 0;\n          \n          // Start monitoring the connection\n          startConnectionMonitoring();\n          // Start collecting stats for debugging\n          startStatsCollection();\n          \n        } else if (pc.iceConnectionState === 'disconnected' || pc.iceConnectionState === 'failed' || pc.iceConnectionState === 'closed') {\n          updateGlobalState(pc.iceConnectionState);\n          \n          if (DEBUG) console.log('[WebRTC] ICE Connection terminated:', pc.iceConnectionState);\n          \n          // If we have a partner ID and socket, notify them of connection state change\n          if (globalPartnerId.value && socket.value) {\n            socket.value.emit('webrtc-connection-state', { \n              to: globalPartnerId.value, \n              state: pc.iceConnectionState,\n              reason: 'ice-connection-state-change'\n            });\n          }\n          \n          // If the connection has failed or closed, update global state after a short delay\n          // This gives time for any recovery mechanisms to kick in\n          if (pc.iceConnectionState === 'failed' || pc.iceConnectionState === 'closed') {\n            setTimeout(() => {\n              // Only update if we're still in bad state\n              if (pc.iceConnectionState === 'failed' || pc.iceConnectionState === 'closed') {\n                updateGlobalState('failed');\n              }\n            }, 2000);\n          }\n        }\n      };\n\n      // ICE candidate events\n      pc.onicecandidate = (event) => {\n        if (event.candidate) {\n          if (DEBUG) console.log('[WebRTC] New ICE candidate:', event.candidate);\n          \n          // Store local candidates for diagnostics\n          if (!(window as any).__localIceCandidates) {\n            (window as any).__localIceCandidates = [];\n          }\n          (window as any).__localIceCandidates.push(event.candidate);\n          \n          if (partnerId.value) {\n            // Send the ICE candidate to the peer\n            socket.value?.emit('webrtc-signal', {\n              type: 'ice-candidate',\n              candidate: event.candidate,\n              to: partnerId.value\n            });\n          } else {\n            // No partner ID yet, store the candidate for later\n            pendingCandidates.push(event.candidate);\n            if (DEBUG) console.log('[WebRTC] Storing ICE candidate for later. Total pending:', pendingCandidates.length);\n          }\n        } else {\n          // ICE gathering is complete\n          if (DEBUG) console.log('[WebRTC] ICE gathering complete');\n          \n          // If we have pending candidates and a partner ID, send them now\n          if (pendingCandidates.length > 0 && partnerId.value) {\n            pendingCandidates.forEach(candidate => {\n              socket.value?.emit('webrtc-signal', {\n                type: 'ice-candidate',\n                candidate,\n                to: partnerId.value\n              });\n            });\n            if (DEBUG) console.log(`[WebRTC] Sent ${pendingCandidates.length} pending ICE candidates`);\n            pendingCandidates = [];\n          }\n        }\n      };\n\n      // ICE gathering state change\n      pc.onicegatheringstatechange = () => {\n        if (DEBUG) console.log('[WebRTC] ICE gathering state changed to:', pc.iceGatheringState);\n      };\n      \n      // Connection state change (modern browsers only)\n      pc.onconnectionstatechange = () => {\n        if (DEBUG) console.log('[WebRTC] Connection state changed to:', pc.connectionState);\n        \n        updateGlobalState(pc.connectionState);\n        \n        if (pc.connectionState === 'connected') {\n          // Clear any previous failure reasons\n          failureReason = '';\n          connectionRetryCount = 0;\n        } else if (pc.connectionState === 'failed' || pc.connectionState === 'disconnected' || pc.connectionState === 'closed') {\n          if (pc.connectionState === 'failed' && !failureReason) {\n            failureReason = 'PeerConnection failed';\n          }\n        }\n      };\n      \n      // Signaling state change\n      pc.onsignalingstatechange = () => {\n        if (DEBUG) console.log('[WebRTC] Signaling state changed to:', pc.signalingState);\n        \n        if (pc.signalingState === 'stable') {\n          isNegotiating = false;\n        }\n      };\n      \n      // Track events - add incoming tracks to the remote stream\n      pc.ontrack = (event) => {\n        if (DEBUG) console.log('[WebRTC] Track received:', event.track);\n        \n        // Create remote stream if needed\n        if (!globalRemoteStream) {\n          globalRemoteStream = new MediaStream();\n          remoteStream.value = globalRemoteStream;\n          console.log('[WebRTC] Created new remote stream');\n        }\n        \n        // Add the track to the stream\n        globalRemoteStream.addTrack(event.track);\n        console.log(`[WebRTC] Added ${event.track.kind} track to remote stream, now has ${globalRemoteStream.getTracks().length} tracks`);\n        \n        // Verify tracks were added properly\n        setTimeout(() => {\n          if (globalRemoteStream) {\n            const tracks = globalRemoteStream.getTracks();\n            console.log(`[WebRTC] Remote stream has ${tracks.length} tracks after adding`);\n            tracks.forEach(track => {\n              console.log(`[WebRTC] Track: ${track.kind}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n              if (track.kind === 'audio' && (!track.enabled || track.muted)) {\n                console.log('[WebRTC] ğŸ”´ Found disabled or muted audio track, enabling it');\n                track.enabled = true;\n              }\n            });\n          }\n        }, 500);\n        \n        // Log track stats\n        if (DEBUG) {\n          event.track.onunmute = () => {\n            console.log('[WebRTC] Track unmuted:', event.track.kind);\n          };\n          \n          event.track.onmute = () => {\n            console.log('[WebRTC] Track muted:', event.track.kind);\n            // Auto unmute if track gets muted for some reason\n            event.track.enabled = true;\n          };\n          \n          event.track.onended = () => {\n            console.log('[WebRTC] Track ended:', event.track.kind);\n          };\n        }\n      };\n      \n      // Set up connection timeout handling\n      setupConnectionTimeout(pc);\n      \n      // Store the connection globally\n    globalPeerConnection = pc;\n    \n    return pc;\n    } catch (error) {\n      console.error('[WebRTC] Error creating peer connection:', error);\n      lastConnectionError = `Creation error: ${error}`;\n      failureReason = 'Failed to create connection';\n      updateGlobalState('failed');\n      throw error;\n    }\n  };\n  \n  /**\n   * Create an offer and send it to the target peer\n   */\n  const createOffer = async (targetPartnerId: string | null): Promise<any> => {\n    // Clear any existing connection timeout\n    if ((window as any).__webrtcConnectionTimeout) {\n      clearTimeout((window as any).__webrtcConnectionTimeout);\n    }\n    \n    if (!targetPartnerId) {\n      const errorMsg = 'Cannot create offer: No target partner ID provided';\n      console.error(`[WebRTC] ${errorMsg}`);\n      lastConnectionError = errorMsg;\n      return { error: errorMsg };\n    }\n    \n    if (!socket.value) {\n      const errorMsg = 'Cannot create offer: socket not available';\n      console.error(`[WebRTC] ${errorMsg}`);\n      lastConnectionError = errorMsg;\n      return { error: errorMsg };\n    }\n    \n    // Make sure we have access to the microphone before creating an offer\n    if (!globalLocalStream) {\n      try {\n        if (DEBUG) console.log('[WebRTC] Initializing local stream before creating offer');\n        await initializeLocalStream();\n      } catch (error) {\n        console.error('[WebRTC] Failed to initialize local stream:', error);\n        lastConnectionError = `Failed to access microphone: ${error}`;\n        return { error: `Failed to access microphone: ${error}` };\n      }\n    }\n    \n    if (DEBUG) console.log(`[WebRTC] Creating offer for partner: ${targetPartnerId}`);\n    \n    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªÙØ§ÙˆØ¶ Ø¬Ø§Ø±Ù\n    if (isNegotiating) {\n      console.warn('[WebRTC] Negotiation already in progress, deferring new offer');\n      \n      // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ±\n      return new Promise(resolve => {\n        setTimeout(async () => {\n          if (!isNegotiating) {\n            resolve(await createOffer(targetPartnerId));\n          } else {\n            resolve({ waiting: 'Negotiation in progress' });\n          }\n        }, 1000);\n      });\n    }\n    \n    // Mark that we are negotiating\n    isNegotiating = true;\n    globalPartnerId.value = targetPartnerId;\n    partnerId.value = targetPartnerId;\n    \n    try {\n      // Store the partner ID\n      if (DEBUG) console.log(`[WebRTC] Setting partner ID: ${targetPartnerId}`);\n      \n      // Ø¥Ø¹Ø§Ø¯Ø© ØªÙƒÙˆÙŠÙ† WebRTC Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø¸ÙŠÙ\n      const pc = createPeerConnection();\n      \n      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©\n      if (globalLocalStream) {\n        if (DEBUG) {\n          console.log('[WebRTC] Adding local tracks to connection');\n          console.log(`[WebRTC] Local stream has ${globalLocalStream.getTracks().length} tracks`);\n        }\n        \n        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø±Ø³Ù„ÙŠÙ† Ø¥Ø°Ø§ ÙƒØ§Ù†ÙˆØ§ Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† Ø¨Ø§Ù„ÙØ¹Ù„\n        const localMediaStream: MediaStream = globalLocalStream;\n        if (pc.getSenders().length > 0) {\n          if (DEBUG) console.log('[WebRTC] Replacing existing senders');\n          let i = 0;\n          localMediaStream.getTracks().forEach((track: MediaStreamTrack) => {\n            if (pc.getSenders()[i]) {\n              pc.getSenders()[i].replaceTrack(track);\n              i++;\n            } else {\n              pc.addTrack(track, localMediaStream);\n            }\n          });\n        } else {\n          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø¹Ø§Ø¯ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©\n          localMediaStream.getTracks().forEach((track: MediaStreamTrack) => {\n            pc.addTrack(track, localMediaStream);\n          });\n        }\n      } else {\n        console.error('[WebRTC] No local stream to add tracks from');\n        // Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ¯ÙÙ‚ Ù…Ø­Ù„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n        await initializeLocalStream();\n        if (globalLocalStream) {\n          const localMediaStream: MediaStream = globalLocalStream;\n          localMediaStream.getTracks().forEach((track: MediaStreamTrack) => {\n            pc.addTrack(track, localMediaStream);\n          });\n        }\n      }\n      \n      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n      globalConnectionState.value = 'connecting';\n      connectionState.value = 'connecting';\n      \n      // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ù…Ø¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©\n      if (DEBUG) console.log('[WebRTC] Creating offer');\n      const offer = await pc.createOffer({\n        offerToReceiveAudio: true,\n        offerToReceiveVideo: false,\n      });\n      \n      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØµÙ Ø§Ù„Ù…Ø­Ù„ÙŠ\n      if (DEBUG) console.log('[WebRTC] Setting local description');\n      await pc.setLocalDescription(offer);\n      \n      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Trickle ICE Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØ¬Ù…ÙŠØ¹\n      // Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ø±Ø¶ ÙÙˆØ±Ù‹Ø§ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù…Ø±Ø´Ø­Ø§Øª ICE Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¹Ù†Ø¯ ØªÙˆÙ„ÙŠØ¯Ù‡Ø§\n      if (socket.value && targetPartnerId) {\n        if (DEBUG) console.log('[WebRTC] Sending immediate offer using Trickle ICE');\n        \n        // Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ\n        socket.value.emit('voice-offer', {\n          offer: pc.localDescription,\n          to: targetPartnerId\n        });\n        \n        // Ø¥Ø¶Ø§ÙØ© Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯\n        socket.value.emit('webrtc-signal', {\n          type: 'offer',\n          offer: pc.localDescription,\n          to: targetPartnerId\n        });\n      }\n      \n      // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¤Ù‚Øª Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„Ø§ØªØµØ§Ù„\n      setupConnectionTimeout(pc);\n      \n      // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n      startConnectionMonitoring();\n      \n      if (DEBUG) console.log('[WebRTC] Offer creation complete');\n      return { success: true };\n    } catch (error) {\n      console.error('[WebRTC] Error creating offer:', error);\n      lastConnectionError = `Error creating offer: ${error}`;\n      isNegotiating = false;\n      return { error: `Failed to create offer: ${error}` };\n    } finally {\n      // Mark that we are done negotiating\n      setTimeout(() => {\n        isNegotiating = false;\n      }, 2000);\n    }\n  };\n  \n  // Helper function to wait for ICE gathering to complete\n  const waitForIceGatheringComplete = (pc: RTCPeerConnection): Promise<void> => {\n    if (pc.iceGatheringState === 'complete') {\n      if (DEBUG) console.log('[WebRTC] ICE gathering already complete');\n      return Promise.resolve();\n    }\n    \n    return new Promise<void>((resolve) => {\n      const checkState = () => {\n        if (pc.iceGatheringState === 'complete') {\n          pc.removeEventListener('icegatheringstatechange', checkState);\n          resolve();\n        }\n      };\n      \n      pc.addEventListener('icegatheringstatechange', checkState);\n      \n      // ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù…Ù† 2000 Ø¥Ù„Ù‰ 1000 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©\n      // Ø³ÙŠØªÙ… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ØªÙƒØªÙ…Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¹\n      setTimeout(() => {\n        pc.removeEventListener('icegatheringstatechange', checkState);\n        if (DEBUG) console.log('[WebRTC] ICE gathering timed out, but continuing anyway');\n        resolve();\n      }, 1000);\n    });\n  };\n  \n  /**\n   * Handle an incoming WebRTC offer\n   */\n  const handleOffer = async (offer: RTCSessionDescriptionInit, targetPartnerId: string): Promise<void> => {\n    if (!socket.value) {\n      console.error('[WebRTC] Cannot handle offer: socket not available');\n      return;\n    }\n    \n    if (DEBUG) {\n      console.log('[WebRTC] Received offer from:', targetPartnerId);\n      console.log('[WebRTC] Offer SDP:', offer.sdp);\n    }\n    \n    // Store the partner ID\n    globalPartnerId.value = targetPartnerId;\n    partnerId.value = targetPartnerId;\n    \n    try {\n      // Make sure we have access to the microphone\n      if (!globalLocalStream) {\n        if (DEBUG) console.log('[WebRTC] Initializing local stream before handling offer');\n        await initializeLocalStream();\n      }\n      \n      // Ø¥Ø¹Ø§Ø¯Ø© ØªÙƒÙˆÙŠÙ† Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§ØªØµØ§Ù„ WebRTC\n      const pc = createPeerConnection();\n      \n      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©\n      if (globalLocalStream) {\n        const senders = pc.getSenders();\n        if (senders.length === 0) {\n          if (DEBUG) console.log('[WebRTC] Adding local tracks to connection');\n          globalLocalStream.getTracks().forEach(track => {\n            pc.addTrack(track, globalLocalStream!);\n          });\n        } else {\n          if (DEBUG) console.log('[WebRTC] Senders already exist, not adding tracks again');\n        }\n      }\n      \n      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n      globalConnectionState.value = 'connecting';\n      connectionState.value = 'connecting';\n      \n      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØµÙ Ø§Ù„Ø¨Ø¹ÙŠØ¯ (Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ§Ø±Ø¯)\n      if (DEBUG) console.log('[WebRTC] Setting remote description (offer)');\n      await pc.setRemoteDescription(new RTCSessionDescription(offer));\n      \n      // Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ø±Ø´Ø­ÙŠ ICE Ù…Ø¹Ù„Ù‚ÙŠÙ†\n      if (pendingCandidates.length > 0) {\n        if (DEBUG) console.log(`[WebRTC] Adding ${pendingCandidates.length} pending ICE candidates`);\n        for (const candidate of pendingCandidates) {\n          try {\n            await pc.addIceCandidate(candidate);\n          } catch (error) {\n            console.error('[WebRTC] Error adding pending ICE candidate:', error);\n          }\n\n        }\n        pendingCandidates = [];\n      }\n      \n      // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¬Ø§Ø¨Ø©\n      if (DEBUG) console.log('[WebRTC] Creating answer');\n      const answer = await pc.createAnswer({\n        offerToReceiveAudio: true\n      });\n      \n      if (DEBUG) console.log('[WebRTC] Answer SDP:', answer.sdp);\n      \n      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØµÙ Ø§Ù„Ù…Ø­Ù„ÙŠ (Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©)\n      if (DEBUG) console.log('[WebRTC] Setting local description (answer)');\n      await pc.setLocalDescription(answer);\n      \n      // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠÙ† Ù…ÙƒÙˆÙ‘Ù†ÙˆÙ† Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ØµÙˆØª\n      pc.getTransceivers().forEach(transceiver => {\n        if (transceiver.receiver.track.kind === 'audio') {\n          console.log('[WebRTC] Ensuring audio transceiver is set to receive');\n          if (transceiver.direction !== 'sendrecv' && transceiver.direction !== 'recvonly') {\n            try {\n              transceiver.direction = 'sendrecv';\n            } catch (error) {\n              console.error('[WebRTC] Could not update transceiver direction:', error);\n            }\n          }\n        }\n      });\n      \n      // Ø§Ù†ØªØ¸Ø§Ø± Ø¬Ù…Ø¹ Ù…Ø±Ø´Ø­ÙŠ ICE\n      await waitForIceGatheringComplete(pc);\n      \n      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø±ÙŠÙƒ\n      if (DEBUG) console.log('[WebRTC] Sending answer to:', targetPartnerId);\n      socket.value.emit('voice-answer', {\n        answer: pc.localDescription,\n        to: targetPartnerId\n      });\n      \n      // Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø£ÙŠØ¶Ø§\n      socket.value.emit('webrtc-signal', {\n        type: 'answer',\n        answer: pc.localDescription,\n        to: targetPartnerId\n      });\n      \n      // ØªØ¹ÙŠÙŠÙ† Ù…Ø¤Ù‚Øª Ù„Ù„Ø§ØªØµØ§Ù„\n      setupConnectionTimeout(pc);\n      \n      // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n      startConnectionMonitoring();\n      \n      if (DEBUG) console.log('[WebRTC] Offer handling and answer creation complete');\n    } catch (error) {\n      console.error('[WebRTC] Error handling offer:', error);\n      lastConnectionError = `Error handling offer: ${error}`;\n      \n      // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ÙØªØ±Ø© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„\n      setTimeout(() => {\n        if (socket.value && partnerId.value) {\n          console.log('[WebRTC] Re-negotiating after offer error');\n          createOffer(partnerId.value);\n        }\n      }, 2000);\n    }\n  };\n  \n  /**\n   * Handle an incoming answer\n   */\n  const handleAnswer = async (answer: RTCSessionDescriptionInit): Promise<void> => {\n    try {\n      if (!globalPeerConnection) {\n        if (DEBUG) console.log('[WebRTC] Cannot handle answer: no peer connection available');\n        return;\n      }\n\n      // ØªÙˆØ«ÙŠÙ‚ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©\n      const currentState = globalPeerConnection.signalingState;\n      if (DEBUG) console.log(`[WebRTC] Current signaling state before handling answer: ${currentState}`);\n\n      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ù‚Ø¨Ù„ ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØµÙ Ø§Ù„Ø¨Ø¹ÙŠØ¯\n      if (currentState === 'have-local-offer') {\n        if (DEBUG) console.log('[WebRTC] Setting remote description from answer');\n        try {\n          await globalPeerConnection.setRemoteDescription(new RTCSessionDescription(answer));\n          if (DEBUG) console.log('[WebRTC] Remote description set successfully, signaling state now: ' + globalPeerConnection.signalingState);\n        } catch (error: any) {\n          console.error('[WebRTC] Error setting remote description:', error);\n          \n          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ Ù…ØªØ¹Ù„Ù‚Ù‹Ø§ Ø¨Ø­Ø§Ù„Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©ØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø­Ø§Ù„Ø©\n          if (error.toString().includes('InvalidStateError')) {\n            console.warn('[WebRTC] Invalid state error, attempting to recover');\n            \n            // Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø­Ø¸Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            \n            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n            if (globalPeerConnection.signalingState === 'have-local-offer') {\n              try {\n                if (DEBUG) console.log('[WebRTC] Retrying set remote description after delay');\n                await globalPeerConnection.setRemoteDescription(new RTCSessionDescription(answer));\n                if (DEBUG) console.log('[WebRTC] Remote description set successfully on retry');\n              } catch (retryError) {\n                console.error('[WebRTC] Final error setting remote description:', retryError);\n                // Ù„Ø§ Ù†Ø±Ù…ÙŠ Ø§Ù„Ø®Ø·Ø£ Ù‡Ù†Ø§ Ù„ØªØ¬Ù†Ø¨ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©\n              }\n            } else {\n              console.warn(`[WebRTC] Cannot set remote answer, wrong state: ${globalPeerConnection.signalingState}`);\n            }\n          }\n        }\n      } else {\n        console.warn(`[WebRTC] Cannot set remote description: wrong signaling state: ${currentState}`);\n        \n        // Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ø­Ø§Ù„Ø© Ù…Ø³ØªÙ‚Ø±Ø©ØŒ Ù‚Ø¯ Ù†ÙƒÙˆÙ† Ø¹Ø§Ù„Ø¬Ù†Ø§ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ø£Ùˆ ÙØ§ØªÙ†Ø§ Ø§Ù„Ø¹Ø±Ø¶\n        if (currentState === 'stable') {\n          if (DEBUG) console.log('[WebRTC] Already in stable state, ignoring answer');\n        } else if (currentState === 'have-remote-offer') {\n          console.warn('[WebRTC] We have a remote offer but received an answer - signaling confusion');\n          // ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ù„ØªØµØ­ÙŠØ­ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª\n          if (connectionRetryCount < MAX_CONNECTION_RETRIES) {\n            connectionRetryCount++;\n            if (DEBUG) console.log(`[WebRTC] Resetting connection due to signaling confusion (${connectionRetryCount}/${MAX_CONNECTION_RETRIES})`);\n            closeConnection();\n            \n            // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©\n            setTimeout(() => {\n              if (partnerId.value) {\n                createOffer(partnerId.value);\n              }\n            }, 2000);\n          }\n        }\n      }\n    } catch (error) {\n      console.error('[WebRTC] Error handling answer:', error);\n      lastConnectionError = `Error handling answer: ${error}`;\n      \n      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚Ù‡\n      if (DEBUG) console.log('[WebRTC] Attempting to recover from answer error');\n      if (connectionRetryCount < MAX_CONNECTION_RETRIES) {\n        await attemptConnectionRecovery();\n      }\n    }\n  };\n  \n  /**\n   * Toggle microphone mute state\n   */\n  const toggleMicrophone = async (): Promise<boolean> => {\n    // Ø¹ÙƒØ³ Ø­Ø§Ù„Ø© ÙƒØªÙ… Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠØ©\n    const shouldMute = !globalIsAudioMuted.value;\n    \n    // Ø­Ø§Ù„Ø© ÙƒØªÙ… Ø§Ù„ØµÙˆØª\n    if (shouldMute) {\n      if (DEBUG) console.log('[WebRTC] Muting microphone - stopping all tracks');\n      \n      // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØµÙˆØª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©\n      if (globalLocalStream) {\n        globalLocalStream.getAudioTracks().forEach(track => {\n          track.stop();\n        });\n        \n        // ØªØµÙÙŠØ± Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©\n        globalLocalStream = null;\n        localStream.value = null;\n      }\n      \n      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© ÙƒØªÙ… Ø§Ù„ØµÙˆØª\n      globalIsAudioMuted.value = true;\n      \n      return false; // Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ø§Ù„Ø¢Ù† Ù…ÙƒØªÙˆÙ…\n    } \n    // Ø­Ø§Ù„Ø© Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØª\n    else {\n      if (DEBUG) console.log('[WebRTC] Unmuting microphone - requesting new permission');\n      \n      try {\n        // Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ stream Ù…ÙˆØ¬ÙˆØ¯\n        if (globalLocalStream) {\n          globalLocalStream.getTracks().forEach(track => track.stop());\n          globalLocalStream = null;\n          localStream.value = null;\n        }\n        \n        // Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø¬Ø¯ÙŠØ¯\n        const stream = await navigator.mediaDevices.getUserMedia({\n          audio: {\n            echoCancellation: true,\n            noiseSuppression: true,\n            autoGainControl: true\n          },\n          video: false\n        });\n        \n        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§Ø±Ø§Øª ØµÙˆØªÙŠØ©\n        if (stream.getAudioTracks().length === 0) {\n          throw new Error('No audio tracks available');\n        }\n        \n        // ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯\n        globalLocalStream = stream;\n        localStream.value = stream;\n        \n        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø§ØªØµØ§Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§\n        if (globalPeerConnection && stream) {\n          try {\n            const senders = globalPeerConnection.getSenders();\n            const audioSender = senders.find(sender => sender.track && sender.track.kind === 'audio');\n            \n            if (audioSender) {\n              const audioTrack = stream.getAudioTracks()[0];\n              if (audioTrack) {\n                audioSender.replaceTrack(audioTrack);\n              }\n            } else if (stream.getAudioTracks().length > 0) {\n              stream.getAudioTracks().forEach(track => {\n                if (globalPeerConnection) {\n                  globalPeerConnection.addTrack(track, stream);\n                }\n              });\n            }\n          } catch (trackError) {\n            console.error('[WebRTC] Error adding audio tracks:', trackError);\n            // Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø­ØªÙ‰ Ù…Ø¹ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª\n          }\n        }\n        \n        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© ÙƒØªÙ… Ø§Ù„ØµÙˆØª - Ù…Ù‡Ù…!\n        globalIsAudioMuted.value = false;\n        \n        return true; // Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ø§Ù„Ø¢Ù† ØºÙŠØ± Ù…ÙƒØªÙˆÙ…\n      } catch (error) {\n        console.error('[WebRTC] Error unmuting microphone:', error);\n        \n        // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ø§Ù„ØµÙˆØªØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø®ÙŠØ§Ø±Ø§Øª Ø£Ø¨Ø³Ø·\n        try {\n          const fallbackStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n          globalLocalStream = fallbackStream;\n          localStream.value = fallbackStream;\n          globalIsAudioMuted.value = false;\n          return true;\n        } catch (fallbackError) {\n          console.error('[WebRTC] Fallback microphone access also failed:', fallbackError);\n          return false;\n        }\n      }\n    }\n  };\n  \n  /**\n   * Close and cleanup the peer connection\n   */\n  const closeConnection = (): void => {\n    if (DEBUG) console.log('[WebRTC] Closing connection');\n    \n    // Stop all activity\n    stopConnectionHeartbeat();\n    stopConnectionMonitoring();\n    \n      if (globalPeerConnection) {\n        try {\n        // Remove all event listeners\n        globalPeerConnection.ontrack = null;\n        globalPeerConnection.onicecandidate = null;\n        globalPeerConnection.oniceconnectionstatechange = null;\n        globalPeerConnection.onicegatheringstatechange = null;\n        globalPeerConnection.onsignalingstatechange = null;\n        globalPeerConnection.onconnectionstatechange = null;\n        \n        // Stop all transceivers if supported\n        try {\n          if (globalPeerConnection.getTransceivers) {\n            globalPeerConnection.getTransceivers().forEach(transceiver => {\n              if (transceiver.stop) {\n                transceiver.stop();\n              }\n            });\n          }\n        } catch (e) {\n          // Ignore errors\n        }\n        \n        // Close the connection\n          globalPeerConnection.close();\n        if (DEBUG) console.log('[WebRTC] Peer connection closed');\n      } catch (error) {\n        console.error('[WebRTC] Error closing peer connection:', error);\n      }\n      \n      // Reset the global reference\n          globalPeerConnection = null;\n    }\n    \n    // Clear any remote tracks\n          if (globalRemoteStream) {\n            globalRemoteStream.getTracks().forEach(track => {\n              track.stop();\n            });\n      globalRemoteStream = new MediaStream();\n      remoteStream.value = globalRemoteStream;\n    }\n    \n    // Reset state\n    globalConnectionState.value = 'closed';\n    connectionState.value = 'closed';\n  };\n  \n  /**\n   * Close and cleanup all media streams\n   */\n  const cleanup = (): void => {\n    if (DEBUG) console.log('[WebRTC] Full cleanup initiated');\n    closeConnection();\n    \n    if (globalLocalStream) {\n      if (DEBUG) console.log('[WebRTC] Stopping local stream tracks');\n      globalLocalStream.getTracks().forEach(track => {\n        track.stop();\n      });\n      globalLocalStream = null;\n      localStream.value = null;\n    }\n    \n    if (DEBUG) console.log('[WebRTC] Cleanup complete');\n  };\n  \n  /**\n   * Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬ÙŠ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙˆÙŠØ¨ Ø³ÙˆÙƒØª\n   */\n  function setupSocketListeners() {\n    if (!socket.value) {\n      if (DEBUG) console.log('[WebRTC] No socket available, cannot set up listeners');\n        return;\n      }\n      \n    if (DEBUG) console.log('[WebRTC] Setting up socket listeners');\n    \n    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ† Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±\n    socket.value.off('webrtc-signal');\n    socket.value.off('ice-candidate');\n    socket.value.off('partner-disconnected');\n    socket.value.off('webrtc-connection-failed');\n    socket.value.off('connection-timeout');\n    socket.value.off('webrtc-connection-state');\n    \n    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ…ÙŠÙ† Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙŠ Ù„Ù… ØªØ¹Ø¯ Ù…Ø³ØªØ®Ø¯Ù…Ø©\n    socket.value.off('voice-offer');\n    socket.value.off('voice-answer');\n    \n    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¥Ø´Ø§Ø±Ø© WebRTC (offer, answer)\n    socket.value.on('webrtc-signal', async (data: { type: string, offer?: RTCSessionDescriptionInit, answer?: RTCSessionDescriptionInit, from: string }) => {\n      if (DEBUG) console.log(`[WebRTC] Received ${data.type} signal from ${data.from}`);\n      \n      // Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø§Ù„Ø´Ø±ÙŠÙƒ\n      globalPartnerId.value = data.from;\n      partnerId.value = data.from;\n      \n      // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ø±Ø¶\n      if (data.type === 'offer' && data.offer) {\n        try {\n          await handleOffer(data.offer, data.from);\n        } catch (error) {\n          console.error('[WebRTC] Error handling offer:', error);\n          lastConnectionError = `Error handling offer: ${error}`;\n          \n          // Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„\n          if (socket.value) {\n            socket.value.emit('webrtc-connection-failed', {\n              to: data.from,\n              reason: `Failed to handle offer: ${error}`\n            });\n          }\n        }\n      }\n      // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©\n      else if (data.type === 'answer' && data.answer) {\n        try {\n          await handleAnswer(data.answer);\n        } catch (error) {\n          console.error('[WebRTC] Error handling answer:', error);\n          lastConnectionError = `Error handling answer: ${error}`;\n          \n          // Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„\n          if (socket.value) {\n            socket.value.emit('webrtc-connection-failed', {\n              to: data.from,\n              reason: `Failed to handle answer: ${error}`\n            });\n          }\n        }\n      }\n    });\n    \n    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø§Ø±Ø© Ù…Ø±Ø´Ø­Ø§Øª ICE\n    socket.value.on('ice-candidate', async (data: { candidate: RTCIceCandidate, from: string }) => {\n      if (DEBUG) console.log(`[WebRTC] Received ICE candidate from ${data.from}`);\n      \n      if (data.from !== partnerId.value) {\n        if (DEBUG) console.log('[WebRTC] Ignoring ICE candidate from different partner');\n          return;\n        }\n      \n      try {\n        await handleIceCandidate(data.candidate);\n      } catch (error) {\n        console.error('[WebRTC] Error handling ICE candidate:', error);\n        lastConnectionError = `Error handling ICE candidate: ${error}`;\n      }\n    });\n    \n    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨ÙØ´Ù„ Ø§ØªØµØ§Ù„ WebRTC\n    socket.value.on('webrtc-connection-failed', (data: { from: string, reason: string }) => {\n      if (DEBUG) console.log(`[WebRTC] Connection failed notification from ${data.from}: ${data.reason}`);\n      \n      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆÙ…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n      if (connectionRetryCount < MAX_CONNECTION_RETRIES) {\n        connectionRetryCount++;\n        console.log(`[WebRTC] Partner reported connection failure. Retry ${connectionRetryCount}/${MAX_CONNECTION_RETRIES}`);\n        \n        // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„\n        if (data.from === partnerId.value) {\n          setTimeout(() => {\n            if (partnerId.value && socket.value) {\n              createOffer(data.from);\n            }\n          }, RECONNECT_DELAY);\n        }\n      } else {\n        globalConnectionState.value = 'failed';\n        stopConnectionHeartbeat();\n        lastConnectionError = `Partner reported failure: ${data.reason}`;\n      }\n    });\n    \n    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§ØªØµØ§Ù„ Ø§Ù„Ø´Ø±ÙŠÙƒ\n    socket.value.on('partner-disconnected', (data: any = {}) => {\n      if (DEBUG) console.log('[WebRTC] Partner disconnected event:', data);\n      \n      // Ø¥ØºÙ„Ø§Ù‚ Ø§ØªØµØ§Ù„ WebRTC\n      closeConnection();\n      \n      // Ø¥ÙŠÙ‚Ø§Ù ÙƒØ§ÙØ© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\n      stopConnectionHeartbeat();\n      stopConnectionMonitoring();\n      stopStatsCollection();\n      \n      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª\n      globalPartnerId.value = null;\n      partnerId.value = null;\n      \n      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©\n      globalConnectionState.value = 'closed';\n      connectionState.value = 'closed';\n      \n      if (DEBUG) {\n        if (data && data.reason) {\n          console.log(`[WebRTC] Disconnection reason: ${data.reason}`);\n        }\n        console.log('[WebRTC] WebRTC connection fully closed due to partner disconnection');\n      }\n    });\n    \n    // Handle WebRTC connection state changes from other party\n    socket.value.on('webrtc-connection-state', (data: { state: string, from: string, reason: string }) => {\n      if (DEBUG) console.log(`[WebRTC] Received connection state update from partner: ${data.state} (reason: ${data.reason})`);\n      \n      // If we received a notification that the other party's connection is broken\n      if (data.state === 'failed' || data.state === 'closed' || data.state === 'disconnected') {\n        // Update our own state\n        if (data.state === 'failed' || data.state === 'closed') {\n          updateGlobalState('failed');\n          \n          // Close our local connection if it's still open\n          if (globalPeerConnection && globalPeerConnection.connectionState !== 'closed') {\n            console.log('[WebRTC] Closing local connection due to remote state:', data.state);\n            closeConnection();\n          }\n        } else {\n          // Just log for disconnected state, might recover\n          console.log('[WebRTC] Partner connection state is disconnected, waiting to see if it recovers');\n        }\n      }\n    });\n  }\n  \n  // Setup the socket listeners when this hook is used\n  setupSocketListeners();\n  \n  // Clean up resources when component is unmounted\n  onUnmounted(() => {\n    // We don't close connections here anymore to maintain call during component changes\n    // Instead, we just remove our local references\n    peerConnection.value = null;\n    localStream.value = null;\n    remoteStream.value = null;\n  });\n  \n  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ù†Ø¨Ø¶Ø§Øª Ø§ØªØµØ§Ù„ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„\n  function startConnectionHeartbeat() {\n    if (heartbeatInterval) {\n      clearInterval(heartbeatInterval);\n    }\n    \n    // Ø¨Ø¯Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ù†Ø¨Ø¶Ø§Øª Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø´Ø·Ù‹Ø§\n    heartbeatInterval = window.setInterval(() => {\n      if (globalPeerConnection && \n          (globalConnectionState.value === 'connected' || \n           globalConnectionState.value === 'connecting')) {\n        \n        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ù†Ø§Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙƒÙ†Ø¨Ø¶Ø© Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø´Ø·Ù‹Ø§\n        try {\n          const channel = globalPeerConnection.createDataChannel(`heartbeat_${Date.now()}`);\n          \n          // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©\n          setTimeout(() => {\n            try {\n              channel.close();\n            } catch (e) {\n              // ØªØ¬Ø§Ù‡Ù„ Ø£ÙŠ Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚\n            }\n          }, 1000);\n          \n          if (DEBUG) console.log('[WebRTC] Heartbeat sent to keep connection alive');\n          \n          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§ØªØµØ§Ù„ ÙÙŠ Ø­Ø§Ù„Ø© \"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„\" Ù„ÙØªØ±Ø© Ø·ÙˆÙŠÙ„Ø©ØŒ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ´Ø®ÙŠØµÙŠ\n          if (globalConnectionState.value === 'connecting' && connectionRetryCount > 3) {\n            console.log('[WebRTC] Connection stuck in connecting state. Diagnostic report:');\n            console.log(getConnectionDiagnosticReport());\n          }\n        } catch (e) {\n          // ØªØ¬Ø§Ù‡Ù„ Ø£Ø®Ø·Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ù†Ø§Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ù…ØºÙ„Ù‚Ù‹Ø§ Ø¨Ø§Ù„ÙØ¹Ù„\n        }\n        \n        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª\n        checkAndFixTracks();\n      } else {\n        stopConnectionHeartbeat();\n      }\n    }, HEARTBEAT_INTERVAL) as unknown as number;\n  }\n\n  // Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¨Ø¶Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„\n  function stopConnectionHeartbeat() {\n    if (heartbeatInterval) {\n      clearInterval(heartbeatInterval);\n      heartbeatInterval = null;\n    }\n  }\n\n  /**\n   * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª ÙˆØ¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©\n   */\n  function checkAndFixTracks() {\n    if (!globalPeerConnection || !globalRemoteStream) {\n      if (DEBUG) console.log('[WebRTC] Cannot fix tracks: missing connection or stream');\n      return false;\n    }\n    \n    if (DEBUG) console.log('[WebRTC] Checking and fixing tracks');\n    \n    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø±Ø³Ù„ÙŠÙ† (Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©)\n    const senders = globalPeerConnection.getSenders();\n    if (senders.length === 0 && globalLocalStream) {\n      if (DEBUG) console.log('[WebRTC] No senders found, re-adding local tracks');\n      \n      globalLocalStream.getTracks().forEach((track: MediaStreamTrack) => {\n        globalPeerConnection?.addTrack(track, globalLocalStream!);\n      });\n    } else if (senders.length > 0 && globalLocalStream) {\n      if (DEBUG) console.log(`[WebRTC] Found ${senders.length} senders, checking state`);\n      \n      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø±Ø³Ù„ÙŠÙ† ÙŠØ³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©\n      const localTracks = globalLocalStream.getTracks();\n      senders.forEach((sender) => {\n        if (sender.track && sender.track.readyState !== 'live') {\n          const matchingLocalTrack = localTracks.find(track => track.kind === sender.track?.kind);\n          if (matchingLocalTrack) {\n            if (DEBUG) console.log(`[WebRTC] Replacing inactive track with active one`);\n            sender.replaceTrack(matchingLocalTrack);\n          }\n        }\n      });\n    }\n    \n    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠÙ† (Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø©)\n    const receivers = globalPeerConnection.getReceivers();\n    if (receivers.length > 0) {\n      if (DEBUG) console.log(`[WebRTC] Found ${receivers.length} receivers`);\n      \n      let hasAudioReceiver = false;\n      receivers.forEach((receiver) => {\n        if (receiver.track && receiver.track.kind === 'audio') {\n          hasAudioReceiver = true;\n          \n          // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¨Ø¹ÙŠØ¯\n          const trackInStream = globalRemoteStream?.getTracks().some(t => t.id === receiver.track?.id);\n          if (!trackInStream && globalRemoteStream) {\n            if (DEBUG) console.log('[WebRTC] Adding missing track to remote stream');\n            globalRemoteStream.addTrack(receiver.track);\n          }\n        }\n      });\n      \n      if (!hasAudioReceiver) {\n        if (DEBUG) console.log('[WebRTC] No audio receivers found!');\n      }\n    }\n    \n    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ\n    updateDebugInfo();\n    \n    // ÙØ­Øµ ÙˆØ¥ØµÙ„Ø§Ø­ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØµÙˆØªÙŠ\n    diagnoseAndFixAudioIssues();\n  }\n  \n  /**\n   * ÙØ­Øµ ÙˆØ¥ØµÙ„Ø§Ø­ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØµÙˆØªÙŠ\n   * ØªØ³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØµÙˆØª ÙˆØ¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©\n   */\n  function diagnoseAndFixAudioIssues() {\n    if (DEBUG) console.log('[WebRTC] ğŸ” Diagnosing audio connection issues');\n    \n    // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n    if (!globalPeerConnection) {\n      if (DEBUG) console.log('[WebRTC] ğŸ”´ No peer connection exists');\n      return false;\n    }\n    \n    if (DEBUG) {\n      console.log(`[WebRTC] Connection state: ${globalPeerConnection.connectionState}`);\n      console.log(`[WebRTC] ICE connection state: ${globalPeerConnection.iceConnectionState}`);\n      console.log(`[WebRTC] Signaling state: ${globalPeerConnection.signalingState}`);\n    }\n    \n    // ÙØ­Øµ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„Ø©\n    const receivers = globalPeerConnection.getReceivers();\n    console.log(`[WebRTC] Connection has ${receivers.length} receivers`);\n    \n    let foundAudioReceiver = false;\n    let audioReceiverStats = {};\n    \n    // Ø­ØµØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª Ù„Ù„ØªØ´Ø®ÙŠØµ\n    globalPeerConnection.getStats().then((stats) => {\n      stats.forEach((report) => {\n        if (report.type === 'inbound-rtp' && report.kind === 'audio') {\n          audioReceiverStats = report;\n          console.log('[WebRTC] Audio receiver stats:', report);\n          \n          // ÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø­Ø²Ù… ØµÙˆØªÙŠØ©\n          if (report.packetsReceived === 0 || report.bytesReceived === 0) {\n            console.log('[WebRTC] ğŸ”´ Warning: No audio packets received!');\n          } else {\n            console.log(`[WebRTC] âœ… Receiving audio: ${report.packetsReceived} packets, ${report.bytesReceived} bytes`);\n          }\n        }\n      });\n    }).catch(e => console.error('[WebRTC] Error getting stats:', e));\n    \n    receivers.forEach((receiver, i) => {\n      const track = receiver.track;\n      if (track && track.kind === 'audio') {\n        foundAudioReceiver = true;\n        console.log(`[WebRTC] Audio receiver ${i} - Track: ${track.label}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n        \n        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ø·Ù„Ø©\n        if (!track.enabled || track.muted) {\n          console.log('[WebRTC] ğŸŸ  Found disabled/muted audio track, enabling it');\n          track.enabled = true;\n        }\n        \n        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ù…Ø³Ø§Ø±\n        track.onmute = () => {\n          console.log('[WebRTC] Track muted event - automatically unmuting');\n          track.enabled = true;\n        };\n        \n        track.onended = () => {\n          console.log('[WebRTC] Track ended event - attempting to recreate connection');\n          if (!isRestartingIce && globalPeerConnection && globalPeerConnection.connectionState === 'connected') {\n            attemptConnectionRecovery();\n          }\n        };\n      }\n    });\n    \n    if (!foundAudioReceiver) {\n      console.log('[WebRTC] ğŸ”´ No audio receivers found. Remote party may not be sending audio.');\n      \n      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ±Ø§Ù†Ø³ÙŠÙØ±Ø² - ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ù‡Ø§ Ù„Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±\n      const transceivers = globalPeerConnection.getTransceivers();\n      let fixedTransceivers = false;\n      \n      transceivers.forEach((transceiver) => {\n        console.log(`[WebRTC] Transceiver direction: ${transceiver.direction}, currentDirection: ${transceiver.currentDirection}`);\n        \n        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØªØ±Ø§Ù†Ø³ÙŠÙØ± Ù…Ù‡ÙŠØ¦ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ØµÙˆØª\n        if (transceiver.direction === 'sendonly' || transceiver.direction === 'inactive') {\n          try {\n            console.log('[WebRTC] ğŸŸ  Fixing transceiver direction to sendrecv');\n            transceiver.direction = 'sendrecv';\n            fixedTransceivers = true;\n          } catch (e) {\n            console.error('[WebRTC] Error updating transceiver direction:', e);\n          }\n        }\n      });\n      \n      // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙØ§ÙˆØ¶ Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ ØªØ±Ø§Ù†Ø³ÙŠÙØ±Ø²\n      if (fixedTransceivers && !isNegotiating) {\n        console.log('[WebRTC] Triggering renegotiation after fixing transceivers');\n        startNegotiation();\n      }\n      \n      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ Ø­Ø§Ù„Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ØµÙˆØª\n      if (globalPeerConnection.connectionState === 'connected') {\n        console.log('[WebRTC] ğŸŸ  Connection is established but no audio receivers. Checking SDP parameters...');\n        \n        // Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­Ù‹Ø§\n        if (!isNegotiating && partnerId.value) {\n          console.log('[WebRTC] Trying to recover audio by sending refresh signal');\n          socket.value?.emit('webrtc-signal', {\n            type: 'refresh-tracks',\n            to: partnerId.value\n          });\n        }\n      }\n    }\n    \n    // ÙØ­Øµ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø­Ù„ÙŠØ©\n    if (globalLocalStream) {\n      const localAudioTracks = globalLocalStream.getAudioTracks();\n      console.log(`[WebRTC] Local stream has ${localAudioTracks.length} audio tracks`);\n      \n      if (localAudioTracks.length === 0) {\n        // Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³Ø§Ø±Ø§Øª ØµÙˆØª Ù…Ø­Ù„ÙŠØ©ØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†\n        console.log('[WebRTC] ğŸ”´ No local audio tracks! Trying to reinitialize microphone...');\n        initializeLocalStream().then(() => {\n          if (globalPeerConnection && globalPeerConnection.connectionState === 'connected') {\n            console.log('[WebRTC] Added new local audio tracks, restarting connection');\n            // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©\n            startNegotiation();\n          }\n        }).catch(e => console.error('[WebRTC] Failed to reinitialize local stream:', e));\n      } else {\n        localAudioTracks.forEach((track, i) => {\n          console.log(`[WebRTC] Local audio track ${i}: ${track.label}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n          \n          // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù…ÙØ¹Ù„Ø© (Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ Ù‚Ø§Ù… Ø¨ÙƒØªÙ…Ù‡Ø§ Ø¹Ù…Ø¯Ù‹Ø§)\n          if (!track.enabled && !globalIsAudioMuted.value) {\n            console.log('[WebRTC] ğŸŸ  Local track disabled but not muted by user, enabling it');\n            track.enabled = true;\n          }\n        });\n      }\n    } else {\n      console.log('[WebRTC] ğŸ”´ No local stream available');\n    }\n    \n    // ÙØ­Øµ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø©\n    if (globalRemoteStream) {\n      const remoteAudioTracks = globalRemoteStream.getAudioTracks();\n      console.log(`[WebRTC] Remote stream has ${remoteAudioTracks.length} audio tracks`);\n      \n      remoteAudioTracks.forEach((track, i) => {\n        console.log(`[WebRTC] Remote audio track ${i}: ${track.label}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n        \n        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ø·Ù„Ø©\n        if (!track.enabled || track.muted) {\n          console.log('[WebRTC] ğŸŸ  Found disabled remote audio track, enabling it');\n          track.enabled = true;\n        }\n        \n        if (track.readyState !== 'live') {\n          console.log('[WebRTC] ğŸ”´ Remote track not live! ReadyState:', track.readyState);\n          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ù†ÙØ³Ù‡ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Øª\n          const matchingReceiver = globalPeerConnection ? Array.from(globalPeerConnection.getReceivers()).find(\n            receiver => receiver.track && receiver.track.id === track.id\n          ) : null;\n          \n          if (!matchingReceiver) {\n            console.log('[WebRTC] Remote track not found in receivers, attempting to recreate connection');\n            if (globalPeerConnection && globalPeerConnection.connectionState === 'connected' && !isNegotiating) {\n              startNegotiation();\n            }\n          }\n        }\n      });\n      \n      if (remoteAudioTracks.length === 0) {\n        console.log('[WebRTC] ğŸ”´ No audio tracks in remote stream. Checking for receivers...');\n        \n        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¨Ø¹ÙŠØ¯\n        const audioReceivers = globalPeerConnection ? Array.from(globalPeerConnection.getReceivers())\n          .filter(receiver => receiver.track && receiver.track.kind === 'audio') : [];\n        \n        if (audioReceivers.length > 0) {\n          console.log('[WebRTC] Found audio receivers but they are not in remote stream. Adding them now.');\n          audioReceivers.forEach(receiver => {\n            if (receiver.track && globalRemoteStream) {\n              console.log('[WebRTC] Adding track from receiver to remote stream:', receiver.track.id);\n              globalRemoteStream.addTrack(receiver.track);\n            }\n          });\n          \n          // ØªØ­Ø¯ÙŠØ« Ù…ØªØºÙŠØ± Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¨Ø¹ÙŠØ¯ Ù„Ù„Ù…ÙƒÙˆÙ†Ø§Øª\n          remoteStream.value = globalRemoteStream;\n        }\n      }\n    } else if (globalPeerConnection && globalPeerConnection.getReceivers().length > 0) {\n      console.log('[WebRTC] ğŸ”´ No remote stream but receivers exist! Creating new remote stream');\n      \n      // Ø¥Ù†Ø´Ø§Ø¡ ØªØ¯ÙÙ‚ Ø¨Ø¹ÙŠØ¯ Ø¬Ø¯ÙŠØ¯\n      globalRemoteStream = new MediaStream();\n      \n      // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Øª\n      const audioReceivers = Array.from(globalPeerConnection.getReceivers())\n        .filter(receiver => receiver.track && receiver.track.kind === 'audio');\n      \n      if (audioReceivers.length > 0) {\n        audioReceivers.forEach(receiver => {\n          if (receiver.track && globalRemoteStream) {\n            console.log('[WebRTC] Adding track to new remote stream:', receiver.track.id);\n            globalRemoteStream.addTrack(receiver.track);\n          }\n        });\n      }\n      \n      // ØªØ­Ø¯ÙŠØ« Ù…ØªØºÙŠØ± Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¨Ø¹ÙŠØ¯ Ù„Ù„Ù…ÙƒÙˆÙ†Ø§Øª\n      remoteStream.value = globalRemoteStream;\n    } else {\n      console.log('[WebRTC] ğŸ”´ No remote stream or receivers available');\n    }\n    \n    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„ØµÙˆØªÙŠ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ø¨Ø¹ÙŠØ¯\n    setTimeout(() => {\n      const audioElements = document.querySelectorAll('audio');\n      if (audioElements.length > 0 && globalRemoteStream) {\n        console.log(`[WebRTC] Found ${audioElements.length} audio elements, ensuring they use remote stream`);\n        Array.from(audioElements).forEach((audioEl, i) => {\n          if (audioEl.srcObject !== globalRemoteStream) {\n            console.log(`[WebRTC] Audio element ${i} not using correct stream, updating`);\n            audioEl.srcObject = globalRemoteStream;\n            audioEl.muted = false;\n            audioEl.volume = 1.0;\n            \n            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª\n            audioEl.play().catch(e => console.log('[WebRTC] Error playing audio:', e));\n          }\n        });\n      }\n    }, 100);\n    \n    // Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ù‡Ø§\n    setTimeout(checkAndFixTracks, 3000);\n    \n    return true;\n  }\n  \n  // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯ Ø§Ù†Ù‚Ø·Ø§Ø¹\n  async function attemptConnectionRecovery() {\n    if (!globalPeerConnection || !partnerId.value) {\n        return;\n      }\n    \n    if (DEBUG) console.log('[WebRTC] Attempting connection recovery');\n    \n    try {\n      // Ø¢Ù„ÙŠØ© Ø³Ø±ÙŠØ¹Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØ§ÙˆØ¶Ø© ÙˆØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø§ØªØµØ§Ù„\n      isRestartingIce = true;\n      \n      // ØªØ¨Ø¯ÙŠÙ„ ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø®Ø§Ø¯Ù… Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø§ØªØµØ§Ù„\n      if (currentRtcConfig === standardRtcConfiguration) {\n        currentRtcConfig = fastRtcConfiguration;\n        console.log('[WebRTC] Switching to fast configuration for quicker connection');\n      } else if (connectionRetryCount > 5) {\n        // Ø¥Ø°Ø§ ÙØ´Ù„Øª Ø¹Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø§ØªØŒ Ø§Ø³ØªØ®Ø¯Ù… ØªÙƒÙˆÙŠÙ† TURN ÙÙ‚Ø·\n        currentRtcConfig = turnOnlyRtcConfiguration;\n        console.log('[WebRTC] Switching to TURN-only configuration');\n      }\n      \n      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ ICE Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±\n      if (globalPeerConnection.restartIce) {\n        globalPeerConnection.restartIce();\n        \n        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØªÙ…ÙƒÙŠÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ ICE\n        const offer = await globalPeerConnection.createOffer({ \n          iceRestart: true,\n          offerToReceiveAudio: true\n        });\n        \n        await globalPeerConnection.setLocalDescription(offer);\n        \n        if (socket.value) {\n          // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ø±Ø¶ ÙÙˆØ±Ø§Ù‹ Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø±\n          socket.value.emit('offer', {\n            offer: globalPeerConnection.localDescription,\n            to: partnerId.value\n          });\n          \n          // Ø£ÙŠØ¶Ø§ Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯\n          socket.value.emit('webrtc-signal', {\n            type: 'offer',\n            offer: globalPeerConnection.localDescription,\n            to: partnerId.value\n          });\n        }\n      }\n      \n      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ù„Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©\n      setTimeout(() => {\n        isRestartingIce = false;\n      }, 500);\n      \n    } catch (error) {\n      console.error('[WebRTC] Recovery attempt failed:', error);\n      isRestartingIce = false;\n      \n      // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©\n      if (connectionRetryCount < MAX_CONNECTION_RETRIES) {\n        setTimeout(() => {\n          closeConnection();\n          if (partnerId.value) {\n            createOffer(partnerId.value);\n          }\n        }, 200);\n      }\n    }\n  }\n  \n  // Ø¥ØªØ§Ø­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø¨Ø± ÙƒØ§Ø¦Ù† Ø¹Ø§Ù…\n  function updateDebugInfo() {\n    if (typeof window !== 'undefined') {\n      (window as any).__webrtc_debug = {\n        connectionState: globalConnectionState.value,\n        connectionRetryCount,\n        lastConnectionError,\n        failureReason,\n        isNegotiating,\n        isRestartingIce,\n        pendingCandidates: pendingCandidates.length,\n        hasLocalTracks: globalLocalStream ? globalLocalStream.getAudioTracks().length > 0 : false,\n        hasRemoteTracks: globalRemoteStream ? globalRemoteStream.getAudioTracks().length > 0 : false\n      };\n    }\n  }\n\n  // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©\n  watch(() => globalConnectionState.value, () => {\n    updateDebugInfo();\n  });\n  \n  // Ø¯Ø§Ù„Ø© Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¬ÙˆØ¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n  function startConnectionMonitoring() {\n    if (connectionMonitorInterval) {\n      clearInterval(connectionMonitorInterval);\n    }\n    \n    // ØªØªØ¨Ø¹ Ù…Ø±Ø´Ø­Ø§Øª ICE Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆØ§Ù„Ø¨Ø¹ÙŠØ¯Ø© Ù„Ù„ØªØ´Ø®ÙŠØµ\n    if (typeof window !== 'undefined') {\n      (window as any).__localIceCandidates = [];\n      (window as any).__remoteIceCandidates = [];\n      (window as any).__iceCandidatePairs = [];\n    }\n    \n    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù…Ø±Ø´Ø­Ø§Øª ICE Ø§Ù„Ù…Ø­Ù„ÙŠØ©\n    if (globalPeerConnection) {\n      globalPeerConnection.onicecandidate = (event) => {\n        if (event.candidate) {\n          if (DEBUG) console.log('[WebRTC] ICE candidate generated:', event.candidate.candidate);\n          \n          // Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø´Ø­ Ù„Ù„ØªØ´Ø®ÙŠØµ\n          if (typeof window !== 'undefined') {\n            (window as any).__localIceCandidates = (window as any).__localIceCandidates || [];\n            (window as any).__localIceCandidates.push({\n              candidate: event.candidate.candidate,\n              timestamp: Date.now()\n            });\n          }\n          \n          // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø±Ø´Ø­ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±\n          if (socket.value && partnerId.value) {\n            if (DEBUG) console.log('[WebRTC] Sending ICE candidate to partner');\n            socket.value.emit('ice-candidate', {\n              candidate: event.candidate,\n              to: partnerId.value\n            });\n          }\n        }\n      };\n    }\n    \n    connectionMonitorInterval = window.setInterval(async () => {\n      if (!globalPeerConnection || globalConnectionState.value !== 'connecting' && globalConnectionState.value !== 'connected') {\n        stopConnectionMonitoring();\n        return;\n      }\n      \n      try {\n        // Ø¬Ù…Ø¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§ØªØµØ§Ù„\n        const stats = await getConnectionStats();\n        \n        // ØªØªØ¨Ø¹ Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…Ø±Ø´Ø­Ø§Øª ICE\n        if (stats && stats.iceCandidatePairs) {\n          if (typeof window !== 'undefined') {\n            (window as any).__iceCandidatePairs = stats.iceCandidatePairs;\n          }\n        }\n        \n        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n        checkConnectionHealth(stats);\n      } catch (error) {\n        console.error('[WebRTC] Error monitoring connection:', error);\n      }\n    }, CONNECTION_MONITOR_INTERVAL) as unknown as number;\n  }\n\n  // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n  function stopConnectionMonitoring() {\n    if (connectionMonitorInterval) {\n      clearInterval(connectionMonitorInterval);\n      connectionMonitorInterval = null;\n    }\n  }\n\n  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª\n  function checkConnectionHealth(stats: any) {\n    if (!stats || stats.error) return;\n    \n    // ÙØ­Øµ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØµÙˆØª\n    const hasAudioIssues = !stats.media || stats.media.length === 0 || \n                           !stats.media.some((m: any) => m.kind === 'audio' && m.audioLevel > 0);\n    \n    // ÙØ­Øµ Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†\n    const hasCandidatePairIssues = !stats.selectedCandidatePair || \n                                  stats.selectedCandidatePair.state !== 'succeeded';\n    \n    if (hasAudioIssues || hasCandidatePairIssues) {\n      if (DEBUG) console.log('[WebRTC] Connection health issues detected, trying to fix...');\n      \n      // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª\n      checkAndFixTracks();\n      \n      // Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø±Øª Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„\n      if (globalConnectionState.value === 'connected' && connectionRetryCount < MAX_CONNECTION_RETRIES) {\n        connectionRetryCount++;\n        if (DEBUG) console.log(`[WebRTC] Attempting connection improvement (${connectionRetryCount}/${MAX_CONNECTION_RETRIES})`);\n        \n        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ø±ÙŠÙ‚Ø© Ø£ÙƒØ«Ø± Ù„Ø·ÙÙ‹Ø§ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§ØªØµØ§Ù„\n        if (globalPeerConnection && globalPeerConnection.getTransceivers) {\n          globalPeerConnection.getTransceivers().forEach(transceiver => {\n            if (transceiver.sender && transceiver.sender.track && transceiver.sender.track.kind === 'audio') {\n              transceiver.sender.setParameters({\n                ...transceiver.sender.getParameters(),\n                degradationPreference: 'maintain-framerate'\n              });\n            }\n          });\n        }\n      }\n    }\n  }\n  \n  // Add a new function to explicitly handle connection timeout\n  function setupConnectionTimeout(pc: RTCPeerConnection): void {\n    if (!partnerId.value) return;\n    \n    // Clear any existing connection timeout\n    if ((window as any).__webrtcConnectionTimeout) {\n      clearTimeout((window as any).__webrtcConnectionTimeout);\n    }\n    \n    // ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„ØªØ³Ø±ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª\n    const quickTimeout = 5000; // 5 Ø«ÙˆØ§Ù†ÙŠ ÙÙ‚Ø· Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø£ÙˆÙ„\n    \n    // Set a quick first timeout to try fast configuration quickly\n    (window as any).__webrtcConnectionTimeout = setTimeout(() => {\n      if (pc.connectionState === 'connecting' || pc.connectionState === 'new') {\n        if (DEBUG) console.log(`[WebRTC] Connection not established after ${quickTimeout/1000} seconds, trying fast config`);\n        \n        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø§ØªØµØ§Ù„\n        currentRtcConfig = fastRtcConfiguration;\n        \n        if (partnerId.value && !isNegotiating) {\n          // Ù…Ø­Ø§ÙˆÙ„Ø© Ø³Ø±ÙŠØ¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯\n          createOffer(partnerId.value);\n        }\n        \n        // Set a second timeout for TURN-only config\n        (window as any).__webrtcConnectionTimeout = setTimeout(() => {\n          if (pc.connectionState === 'connecting' || pc.connectionState === 'new') {\n            if (DEBUG) console.log(`[WebRTC] Connection still not established, trying TURN-only config`);\n        \n        // Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØ´Ø®ÙŠØµÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©\n        const candidateInfo = {\n          localCandidates: (window as any).__localIceCandidates?.length || 0,\n          remoteCandidates: (window as any).__remoteIceCandidates?.length || 0,\n          iceCandidatePairsCount: (window as any).__iceCandidatePairs?.length || 0\n        };\n        \n        console.log('[WebRTC] Connection diagnostic info:', JSON.stringify(candidateInfo));\n            \n            // ØªØºÙŠÙŠØ± Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø¥Ù„Ù‰ Ø®ÙˆØ§Ø¯Ù… TURN ÙÙ‚Ø· Ù„Ù„Ø§ØªØµØ§Ù„ ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØµØ¹Ø¨Ø©\n            currentRtcConfig = turnOnlyRtcConfiguration;\n            \n            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ¨Ø¯Ø¡ Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯\n          closeConnection();\n          \n            if (partnerId.value) {\n              setTimeout(() => {\n              createOffer(partnerId.value);\n              }, 200);\n            }\n        }\n        }, 5000); // 5 Ø«ÙˆØ§Ù†ÙŠ Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªÙƒÙˆÙŠÙ† TURN\n      }\n    }, quickTimeout);\n  }\n  \n  // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ± ØªØ´Ø®ÙŠØµÙŠ Ø´Ø§Ù…Ù„\n  function getConnectionDiagnosticReport(): string {\n    const peerConn = globalPeerConnection;\n    const report = [];\n    \n    report.push(`Connection State: ${peerConn?.connectionState || 'none'}`);\n    report.push(`Signaling State: ${peerConn?.signalingState || 'none'}`);\n    report.push(`ICE Connection State: ${peerConn?.iceConnectionState || 'none'}`);\n    report.push(`ICE Gathering State: ${peerConn?.iceGatheringState || 'none'}`);\n    report.push(`Reconnection Attempts: ${connectionRetryCount}/${MAX_CONNECTION_RETRIES}`);\n    report.push(`Last Error: ${lastConnectionError || 'none'}`);\n    report.push(`Local Audio Tracks: ${globalLocalStream?.getAudioTracks().length || 0}`);\n    report.push(`Remote Audio Tracks: ${globalRemoteStream?.getAudioTracks().length || 0}`);\n    report.push(`Local Candidates: ${(window as any).__localIceCandidates?.length || 0}`);\n    report.push(`Remote Candidates: ${(window as any).__remoteIceCandidates?.length || 0}`);\n    report.push(`Is Negotiating: ${isNegotiating}`);\n    report.push(`Is Restarting ICE: ${isRestartingIce}`);\n    \n    return report.join('\\n');\n  }\n  \n  /**\n   * Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø±Ø´Ø­ ICE Ù…Ù† Ø§Ù„Ù†Ø¸ÙŠØ± Ø§Ù„Ø¨Ø¹ÙŠØ¯\n   */\n  const handleIceCandidate = async (candidate: RTCIceCandidate): Promise<void> => {\n    if (!globalPeerConnection) {\n      if (DEBUG) console.log('[WebRTC] Received ICE candidate but no peer connection exists');\n        return;\n      }\n      \n      try {\n      if (DEBUG) console.log('[WebRTC] Adding received ICE candidate:', candidate.candidate);\n      \n      // Store remote candidates for diagnostics\n      if (!(window as any).__remoteIceCandidates) {\n        (window as any).__remoteIceCandidates = [];\n      }\n      (window as any).__remoteIceCandidates.push(candidate);\n      \n      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ÙˆØµÙ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†\n      if (!globalPeerConnection.remoteDescription || !globalPeerConnection.localDescription) {\n        if (DEBUG) console.log('[WebRTC] Delaying ICE candidate addition until descriptions are set');\n        \n        // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø±Ø´Ø­ Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø¹Ø¯ Ø¶Ø¨Ø· Ø§Ù„ÙˆØµÙ\n        setTimeout(async () => {\n          if (globalPeerConnection && globalPeerConnection.remoteDescription) {\n            if (DEBUG) console.log('[WebRTC] Adding delayed ICE candidate after timeout');\n            try {\n              await globalPeerConnection.addIceCandidate(candidate);\n      } catch (error) {\n              console.error('[WebRTC] Error adding delayed ICE candidate:', error);\n            }\n          }\n        }, 1000);\n        \n        return;\n      }\n      \n      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±Ø´Ø­\n      await globalPeerConnection.addIceCandidate(candidate);\n      \n      if (DEBUG) console.log('[WebRTC] Successfully added ICE candidate');\n    } catch (error) {\n      console.error('[WebRTC] Error adding ICE candidate:', error);\n      lastConnectionError = `Error adding ICE candidate: ${error}`;\n      \n      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø«Ø§Ù†ÙŠØ© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ±\n      setTimeout(async () => {\n        if (globalPeerConnection && globalPeerConnection.remoteDescription) {\n          if (DEBUG) console.log('[WebRTC] Retrying to add ICE candidate after error');\n          try {\n            await globalPeerConnection.addIceCandidate(candidate);\n            if (DEBUG) console.log('[WebRTC] Successfully added ICE candidate on retry');\n          } catch (retryError) {\n            console.error('[WebRTC] Error adding ICE candidate on retry:', retryError);\n          }\n        }\n      }, 2000);\n    }\n  };\n  \n  // ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ù…ÙƒØ±Ø±Ø©\n  \n  /**\n   * Ø¨Ø¯Ø¡ ØªÙØ§ÙˆØ¶ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ WebRTC\n   */\n  function startNegotiation(): void {\n    if (!globalPeerConnection || !partnerId.value || isNegotiating) {\n      if (DEBUG) console.log('[WebRTC] Cannot start negotiation: missing connection, partner ID, or already negotiating');\n      return;\n    }\n    \n    if (DEBUG) console.log('[WebRTC] Starting new negotiation');\n    isNegotiating = true;\n    \n    try {\n      // Ø¨Ø¯Ø¡ ØªÙØ§ÙˆØ¶ Ø¬Ø¯ÙŠØ¯ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶\n      globalPeerConnection.createOffer({\n        offerToReceiveAudio: true,\n        offerToReceiveVideo: false,\n      })\n      .then(offer => {\n        if (!globalPeerConnection) return;\n        return globalPeerConnection.setLocalDescription(offer);\n      })\n      .then(() => {\n        if (!globalPeerConnection || !socket.value || !partnerId.value) return;\n        \n        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙŠØ¯\n        socket.value.emit('voice-offer', {\n          offer: globalPeerConnection.localDescription,\n          to: partnerId.value\n        });\n        \n        if (DEBUG) console.log('[WebRTC] Sent renegotiation offer');\n      })\n      .catch(error => {\n        console.error('[WebRTC] Error during negotiation:', error);\n      })\n      .finally(() => {\n        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù„Ù… Ø¨Ø¹Ø¯ ÙØªØ±Ø©\n        setTimeout(() => {\n          isNegotiating = false;\n        }, 2000);\n      });\n    } catch (error) {\n      console.error('[WebRTC] Failed to start negotiation:', error);\n      isNegotiating = false;\n    }\n  }\n  \n  // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ\n  const diagnosticReport = {\n    connectionState: globalConnectionState.value,\n    iceCandidatesGenerated: pendingCandidates.length,\n    localStreamActive: !!globalLocalStream && globalLocalStream.active,\n    remoteStreamActive: !!globalRemoteStream && globalRemoteStream.active,\n    localTracks: globalLocalStream ? globalLocalStream.getAudioTracks().length : 0,\n    remoteTracks: globalRemoteStream ? globalRemoteStream.getAudioTracks().length : 0,\n    connectionRetries: connectionRetryCount,\n    lastError: lastConnectionError || failureReason || '',\n    isAudioMuted: globalIsAudioMuted.value,\n    forceReconnect: () => {\n      if (globalPeerConnection && globalConnectionState.value !== 'new') {\n        attemptConnectionRecovery();\n        return true;\n      }\n      return false;\n    }\n  };\n  \n  return {\n    socket,\n    peerConnection,\n    remoteStream,\n    localStream,\n    connectionState,\n    isAudioMuted,\n    partnerId,\n    createOffer,\n    handleOffer,\n    handleAnswer,\n    handleIceCandidate,\n    toggleMicrophone,\n    closeConnection,\n    initializeLocalStream,\n    cleanup,\n    diagnosticReport\n  };\n}\n\n// Fix for signaling state check\nfunction isSignalingStateStable(pc: RTCPeerConnection): boolean {\n  return pc.signalingState === 'stable';\n}\n\n// Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØµÙ Ø§Ù„Ù…Ø­Ù„ÙŠ\nfunction canSetLocalDescription(pc: RTCPeerConnection): boolean {\n  return pc.signalingState === 'stable' || pc.signalingState === 'have-remote-offer';\n}\n\n// Function to update the global connection state in a centralized way\nfunction updateGlobalState(state: string): void {\n  // Only update if state actually changed\n  if (globalConnectionState.value !== state) {\n    if (DEBUG) console.log(`[WebRTC] Connection state changing from ${globalConnectionState.value} to ${state}`);\n    globalConnectionState.value = state;\n    \n    // Additional state-specific actions\n    if (state === 'connected' || state === 'completed') {\n      // Reset failure tracking when we connect successfully\n      failureReason = '';\n      lastConnectionError = '';\n      connectionRetryCount = 0;\n      \n      // Log success for debugging\n      console.log('[WebRTC] Connection established successfully');\n    } \n    else if (state === 'failed' || state === 'disconnected') {\n      console.warn(`[WebRTC] Connection ${state}: ${failureReason || 'Unknown reason'}`);\n      \n      // Track failures\n      if (state === 'failed') {\n        connectionRetryCount++;\n        console.log(`[WebRTC] Connection failure count: ${connectionRetryCount}/${MAX_CONNECTION_RETRIES}`);\n      }\n    }\n  }\n}\n","import { ref } from 'vue';\r\n\r\n// Check if localStorage is available\r\nfunction isLocalStorageAvailable(): boolean {\r\n  const test = 'test';\r\n  try {\r\n    localStorage.setItem(test, test);\r\n    localStorage.removeItem(test);\r\n    return true;\r\n  } catch (e) {\r\n    console.error('localStorage is not available:', e);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * A wrapper for localStorage with error handling\r\n */\r\nexport function useLocalStorage() {\r\n  const isAvailable = ref(isLocalStorageAvailable());\r\n  \r\n  /**\r\n   * Set an item in localStorage\r\n   */\r\n  function setItem(key: string, value: string): void {\r\n    if (!isAvailable.value) {\r\n      console.warn('localStorage is not available, cannot set item');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      localStorage.setItem(key, value);\r\n    } catch (error) {\r\n      console.error('Failed to set localStorage item:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Get an item from localStorage\r\n   */\r\n  function getItem(key: string): string | null {\r\n    if (!isAvailable.value) {\r\n      console.warn('localStorage is not available, cannot get item');\r\n      return null;\r\n    }\r\n    \r\n    try {\r\n      return localStorage.getItem(key);\r\n    } catch (error) {\r\n      console.error('Failed to get localStorage item:', error);\r\n      return null;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Remove an item from localStorage\r\n   */\r\n  function removeItem(key: string): void {\r\n    if (!isAvailable.value) {\r\n      console.warn('localStorage is not available, cannot remove item');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      localStorage.removeItem(key);\r\n    } catch (error) {\r\n      console.error('Failed to remove localStorage item:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Clear all items from localStorage\r\n   */\r\n  function clear(): void {\r\n    if (!isAvailable.value) {\r\n      console.warn('localStorage is not available, cannot clear storage');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      localStorage.clear();\r\n    } catch (error) {\r\n      console.error('Failed to clear localStorage:', error);\r\n    }\r\n  }\r\n  \r\n  return {\r\n    isAvailable,\r\n    setItem,\r\n    getItem,\r\n    removeItem,\r\n    clear\r\n  };\r\n}\r\n\r\n/**\r\n * Save a call record to history\r\n * @param partnerId The ID of the call partner\r\n * @param duration The call duration in seconds\r\n * @param gamesPlayed Array of games played during the call\r\n */\r\nexport function saveCallToHistory(partnerId: string, duration: number, gamesPlayed: string[] = []): void {\r\n  const { getItem, setItem } = useLocalStorage();\r\n  \r\n  try {\r\n    // Get existing history\r\n    const existingHistory = getItem('callHistory');\r\n    let history: any[] = [];\r\n    \r\n    if (existingHistory) {\r\n      history = JSON.parse(existingHistory);\r\n    }\r\n    \r\n    // Create new history entry\r\n    const newEntry = {\r\n      partnerId,\r\n      timestamp: new Date().toISOString(),\r\n      duration,\r\n      gamesPlayed\r\n    };\r\n    \r\n    // Add to history (at the beginning)\r\n    history.unshift(newEntry);\r\n    \r\n    // Limit history to last 20 entries\r\n    if (history.length > 20) {\r\n      history = history.slice(0, 20);\r\n    }\r\n    \r\n    // Save updated history\r\n    setItem('callHistory', JSON.stringify(history));\r\n  } catch (error) {\r\n    console.error('Error saving call to history:', error);\r\n  }\r\n}\r\n","import { ref, watch, shallowRef } from 'vue';\r\nimport { useSocket } from './socket';\r\nimport { useLocalStorage } from './storage';\r\n\r\n// Types\r\nexport interface ChatMessage {\r\n  sender: 'me' | 'partner';\r\n  text: string;\r\n  timestamp: number;\r\n}\r\n\r\n// Global state for chat\r\nconst allMessages = ref<Record<string, ChatMessage[]>>({});\r\nconst currentPartnerId = ref<string | null>(null);\r\nconst unreadMessages = ref<Record<string, boolean>>({});\r\nconst isListening = ref(false);\r\n\r\n// Debug flag\r\nconst DEBUG = true;\r\n\r\n// Create a singleton instance to ensure the service is only initialized once\r\nlet isInitialized = false;\r\n\r\n/**\r\n * Centralized chat service to handle messaging across components\r\n */\r\nexport function useChat() {\r\n  const { socket, userId } = useSocket();\r\n  const storage = useLocalStorage();\r\n\r\n  // Initialize the service if not already done\r\n  if (!isInitialized) {\r\n    if (DEBUG) console.log('[ChatService] Initializing chat service');\r\n    initializeChatService();\r\n    isInitialized = true;\r\n  } else {\r\n    if (DEBUG) console.log('[ChatService] Using existing chat service instance');\r\n  }\r\n\r\n  /**\r\n   * Initialize the chat service\r\n   */\r\n  function initializeChatService() {\r\n    // Set up global socket listeners\r\n    setupGlobalSocketListeners();\r\n\r\n    // Load all saved chats from localStorage\r\n    loadAllChats();\r\n\r\n    // Watch for changes to messages and save them\r\n    watch(allMessages, () => {\r\n      saveAllChats();\r\n    }, { deep: true });\r\n\r\n    // When socket changes (after reconnection), ensure we're still listening\r\n    watch(() => socket.value, (newSocket) => {\r\n      if (newSocket && !isListening.value) {\r\n        if (DEBUG) console.log('[ChatService] Socket reconnected, setting up listeners again');\r\n        setupGlobalSocketListeners();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set up global socket listeners for chat messages\r\n   */\r\n  function setupGlobalSocketListeners() {\r\n    if (!socket.value) {\r\n      if (DEBUG) console.log('[ChatService] No socket available, cannot set up listeners');\r\n      return;\r\n    }\r\n    \r\n    if (isListening.value) {\r\n      // Remove existing listeners to prevent duplicates\r\n      if (DEBUG) console.log('[ChatService] Removing existing chat-message listener');\r\n      socket.value.off('chat-message');\r\n      isListening.value = false;\r\n    }\r\n\r\n    if (DEBUG) console.log('[ChatService] Setting up chat-message listener');\r\n    \r\n    // Listen for incoming messages globally\r\n    socket.value.on('chat-message', (data: { text: string; from: string; timestamp: number }) => {\r\n      if (DEBUG) console.log('[ChatService] Received chat message:', data);\r\n      \r\n      // Create conversation key\r\n      const partnerId = data.from;\r\n      const conversationKey = getConversationKey(partnerId);\r\n\r\n      if (DEBUG) console.log(`[ChatService] Conversation key: ${conversationKey}, current partner: ${currentPartnerId.value}`);\r\n\r\n      // Initialize conversation if it doesn't exist\r\n      if (!allMessages.value[conversationKey]) {\r\n        allMessages.value[conversationKey] = [];\r\n      }\r\n\r\n      // Add message to conversation\r\n      allMessages.value[conversationKey].push({\r\n        sender: 'partner',\r\n        text: data.text,\r\n        timestamp: data.timestamp || Date.now()\r\n      });\r\n\r\n      // Mark as unread if it's not the current conversation\r\n      if (partnerId !== currentPartnerId.value) {\r\n        unreadMessages.value[partnerId] = true;\r\n        if (DEBUG) console.log(`[ChatService] Marked message from ${partnerId} as unread`);\r\n      }\r\n\r\n      // Save to localStorage\r\n      saveAllChats();\r\n      \r\n      if (DEBUG) console.log(`[ChatService] Updated messages:`, allMessages.value[conversationKey]);\r\n    });\r\n\r\n    isListening.value = true;\r\n    if (DEBUG) console.log('[ChatService] Chat message listener setup complete');\r\n  }\r\n\r\n  /**\r\n   * Set the current partner ID\r\n   */\r\n  function setCurrentPartner(partnerId: string | null) {\r\n    if (DEBUG) console.log(`[ChatService] Setting current partner: ${partnerId}`);\r\n    currentPartnerId.value = partnerId;\r\n\r\n    // Clear unread messages for this partner\r\n    if (partnerId) {\r\n      unreadMessages.value[partnerId] = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send a message to the current partner\r\n   */\r\n  function sendMessage(text: string, toPartnerId: string | null = null) {\r\n    // Use specified partner or current partner\r\n    const partnerId = toPartnerId || currentPartnerId.value;\r\n    \r\n    if (!partnerId || !text.trim() || !socket.value) {\r\n      if (DEBUG) console.log(`[ChatService] Cannot send message: partnerId=${partnerId}, text=${text.trim() ? 'present' : 'empty'}, socket=${socket.value ? 'present' : 'not present'}`);\r\n      return false;\r\n    }\r\n\r\n    if (DEBUG) console.log(`[ChatService] Sending message to ${partnerId}: ${text}`);\r\n\r\n    // Create conversation key\r\n    const conversationKey = getConversationKey(partnerId);\r\n\r\n    // Initialize conversation if it doesn't exist\r\n    if (!allMessages.value[conversationKey]) {\r\n      allMessages.value[conversationKey] = [];\r\n    }\r\n\r\n    // Add message to our local state\r\n    const timestamp = Date.now();\r\n    allMessages.value[conversationKey].push({\r\n      sender: 'me',\r\n      text: text.trim(),\r\n      timestamp\r\n    });\r\n\r\n    // Send message to partner\r\n    socket.value.emit('chat-message', {\r\n      text: text.trim(),\r\n      to: partnerId\r\n    });\r\n    \r\n    if (DEBUG) console.log(`[ChatService] Message sent, current messages:`, allMessages.value[conversationKey]);\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get messages for a specific partner\r\n   */\r\n  function getMessages(partnerId: string | null): ChatMessage[] {\r\n    if (!partnerId) return [];\r\n\r\n    const conversationKey = getConversationKey(partnerId);\r\n    const messages = allMessages.value[conversationKey] || [];\r\n    \r\n    if (DEBUG) console.log(`[ChatService] Getting messages for ${partnerId}, found ${messages.length} messages`);\r\n    return messages;\r\n  }\r\n\r\n  /**\r\n   * Check if there are unread messages from a partner\r\n   */\r\n  function hasUnreadMessages(partnerId: string | null): boolean {\r\n    if (!partnerId) return false;\r\n    const hasUnread = !!unreadMessages.value[partnerId];\r\n    if (DEBUG) console.log(`[ChatService] Checking unread for ${partnerId}: ${hasUnread}`);\r\n    return hasUnread;\r\n  }\r\n\r\n  /**\r\n   * Mark messages as read for a partner\r\n   */\r\n  function markAsRead(partnerId: string | null) {\r\n    if (!partnerId) return;\r\n    if (DEBUG) console.log(`[ChatService] Marking messages as read for ${partnerId}`);\r\n    unreadMessages.value[partnerId] = false;\r\n  }\r\n\r\n  /**\r\n   * Get a unique key for a conversation\r\n   */\r\n  function getConversationKey(partnerId: string): string {\r\n    if (!userId.value) return partnerId;\r\n    \r\n    // Create a consistent key regardless of who initiated the chat\r\n    const ids = [userId.value, partnerId].sort();\r\n    return `${ids[0]}_${ids[1]}`;\r\n  }\r\n\r\n  /**\r\n   * Save all chats to localStorage\r\n   */\r\n  function saveAllChats() {\r\n    if (!storage.isAvailable.value) {\r\n      if (DEBUG) console.log('[ChatService] localStorage not available, cannot save chats');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Save messages\r\n      storage.setItem('chat_messages', JSON.stringify(allMessages.value));\r\n      \r\n      // Save unread status\r\n      storage.setItem('chat_unread', JSON.stringify(unreadMessages.value));\r\n      \r\n      if (DEBUG) console.log('[ChatService] Saved chats to localStorage');\r\n    } catch (error) {\r\n      console.error('[ChatService] Failed to save chats:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load all saved chats from localStorage\r\n   */\r\n  function loadAllChats() {\r\n    if (!storage.isAvailable.value) {\r\n      if (DEBUG) console.log('[ChatService] localStorage not available, cannot load chats');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Load messages\r\n      const savedMessages = storage.getItem('chat_messages');\r\n      if (savedMessages) {\r\n        allMessages.value = JSON.parse(savedMessages);\r\n        if (DEBUG) console.log('[ChatService] Loaded messages from localStorage:', Object.keys(allMessages.value).length, 'conversations');\r\n      }\r\n\r\n      // Load unread status\r\n      const savedUnread = storage.getItem('chat_unread');\r\n      if (savedUnread) {\r\n        unreadMessages.value = JSON.parse(savedUnread);\r\n        if (DEBUG) console.log('[ChatService] Loaded unread status from localStorage');\r\n      }\r\n    } catch (error) {\r\n      console.error('[ChatService] Failed to load chats:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear chat history for a specific partner\r\n   */\r\n  function clearChat(partnerId: string) {\r\n    if (!partnerId) return;\r\n\r\n    const conversationKey = getConversationKey(partnerId);\r\n    if (allMessages.value[conversationKey]) {\r\n      allMessages.value[conversationKey] = [];\r\n      saveAllChats();\r\n      if (DEBUG) console.log(`[ChatService] Cleared chat for ${partnerId}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all chat history\r\n   */\r\n  function clearAllChats() {\r\n    allMessages.value = {};\r\n    unreadMessages.value = {};\r\n    saveAllChats();\r\n    if (DEBUG) console.log('[ChatService] Cleared all chats');\r\n  }\r\n\r\n  // Return the public API\r\n  return {\r\n    messages: allMessages,  // Removed shallowRef to ensure reactivity\r\n    unreadMessages: unreadMessages,  // Removed shallowRef\r\n    currentPartnerId,\r\n    setCurrentPartner,\r\n    sendMessage,\r\n    getMessages,\r\n    hasUnreadMessages,\r\n    markAsRead,\r\n    clearChat,\r\n    clearAllChats\r\n  };\r\n} ","export default \"__VITE_ASSET__65661ab2__\"","<template>\n  <div class=\"bg-white/5 backdrop-blur-sm rounded-2xl p-4 sm:p-6 text-center border border-white/10\">\n    <transition \n      :name=\"getTransitionName\" \n      mode=\"out-in\"\n      @before-leave=\"beforeLeave\"\n      @enter=\"enter\"\n      @after-enter=\"afterEnter\">\n      <!-- Disconnected/Ready State -->\n      <div v-if=\"status === 'disconnected'\" key=\"disconnected\">\n        <div class=\"status-container\">\n          <div class=\"status-circle\">\n            <img src=\"@/assets/Circle.png\" alt=\"Connection Circle\" class=\"circle-image\" />\n            <div class=\"thin-ring idle-ring\"></div>\n          </div>\n        </div>\n        <h2 class=\"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white\">Ready to Connect</h2>\n        <p class=\"text-xs sm:text-sm text-gray-300\">Press \"Next\" to find someone to talk with</p>\n      </div>\n\n      <!-- Searching State -->\n      <div v-else-if=\"status === 'searching'\" key=\"searching\">\n        <div class=\"status-container\">\n          <div class=\"status-circle\">\n            <img src=\"@/assets/Circle.png\" alt=\"Connection Circle\" class=\"circle-image pulse-effect\" />\n            <div class=\"thin-ring search-ring\"></div>\n          </div>\n        </div>\n        <h2 class=\"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white\">Searching...</h2>\n        <p class=\"text-xs sm:text-sm text-gray-300\">Looking for someone to talk to</p>\n      </div>\n\n      <!-- Matched State -->\n      <div v-else-if=\"status === 'matched'\" key=\"matched\">\n        <div class=\"status-container\">\n          <div class=\"status-circle\">\n            <img src=\"@/assets/Circle.png\" alt=\"Connection Circle\" class=\"circle-image fast-rotate\" />\n            <div class=\"thin-ring match-ring\"></div>\n          </div>\n        </div>\n        <h2 class=\"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white\">{{ partnerInfo?.vibe ? getVibeDisplayName(partnerInfo.vibe) : 'Match Found!' }}</h2>\n        <div v-if=\"partnerInfo\" class=\"flex items-center justify-center gap-2 text-gray-300\">\n          <span class=\"text-lg sm:text-xl\">{{ partnerInfo.flag || 'ğŸŒ' }}</span>\n          <span class=\"text-xs sm:text-sm font-medium\">{{ partnerInfo.country }}</span>\n        </div>\n        <p class=\"text-xs sm:text-sm text-yellow-400 mt-1 sm:mt-2\">Setting up voice connection...</p>\n      </div>\n\n      <!-- Connected State -->\n      <div v-else-if=\"status === 'connected'\" key=\"connected\">\n        <div class=\"status-container\">\n          <div class=\"status-circle\">\n            <img src=\"@/assets/Circle.png\" alt=\"Connection Circle\" class=\"circle-image\" />\n            <div class=\"thin-ring connect-ring\"></div>\n          </div>\n        </div>\n        <h2 class=\"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white\">{{ partnerInfo?.vibe ? getVibeDisplayName(partnerInfo.vibe) : 'Connected!' }}</h2>\n        <div v-if=\"partnerInfo\" class=\"flex items-center justify-center gap-2 text-gray-300\">\n          <span class=\"text-lg sm:text-xl\">{{ partnerInfo.flag || 'ğŸŒ' }}</span>\n          <span class=\"text-xs sm:text-sm font-medium\">{{ partnerInfo.country }}</span>\n        </div>\n        <p class=\"text-xs sm:text-sm text-green-400 mt-1 sm:mt-2\">You can talk now</p>\n      </div>\n    </transition>\n    \n    <!-- Connection Status Indicator -->\n    <div v-if=\"showStatus && status !== 'disconnected'\" class=\"mt-3 sm:mt-4 text-xs\">\n      <div class=\"flex items-center justify-center gap-1 sm:gap-2\">\n        <span :class=\"{\n          'text-green-400': status === 'connected',\n          'text-yellow-400': status === 'matched',\n          'text-blue-400': status === 'searching'\n        }\">â—</span>\n        <span class=\"text-gray-300\">{{ connectionStatusText }}</span>\n      </div>\n      \n      <!-- Error message if exists -->\n      <p v-if=\"errorMessage\" class=\"text-red-400 mt-1 text-xs\">{{ errorMessage }}</p>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref, watch } from 'vue';\n\ninterface PartnerInfo {\n  flag?: string;\n  country?: string;\n  id?: string;\n  vibe?: string;\n}\n\nconst props = defineProps({\n  status: {\n    type: String,\n    default: 'disconnected', // 'searching', 'matched', 'connected', 'disconnected'\n  },\n  partnerInfo: {\n    type: Object as () => PartnerInfo | null,\n    default: null\n  },\n  errorMessage: {\n    type: String,\n    default: ''\n  },\n  showStatus: {\n    type: Boolean,\n    default: true\n  }\n});\n\n// ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ°\nconst lastStatus = ref(props.status);\n\nwatch(() => props.status, (newStatus, oldStatus) => {\n  lastStatus.value = oldStatus;\n});\n\n// ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¸Ğ¼Ñ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ° Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾ Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ\nconst getTransitionName = computed(() => {\n  if (lastStatus.value === 'disconnected' && props.status === 'searching') {\n    return 'idle-to-search';\n  } else if (lastStatus.value === 'searching' && props.status === 'matched') {\n    return 'search-to-match';\n  } else if (lastStatus.value === 'matched' && props.status === 'connected') {\n    return 'match-to-connect';\n  } else if (props.status === 'disconnected') {\n    return 'to-idle';\n  } else {\n    return 'fade';\n  }\n});\n\n// Hooks Ğ´Ğ»Ñ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¾Ğ²\nconst beforeLeave = (el: Element) => {\n  // ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ„Ñ„ĞµĞºÑ‚Ñ‹ Ğ¿ĞµÑ€ĞµĞ´ Ğ¸ÑÑ‡ĞµĞ·Ğ½Ğ¾Ğ²ĞµĞ½Ğ¸ĞµĞ¼ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°\n};\n\nconst enter = (el: Element, done: () => void) => {\n  // ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ„Ñ„ĞµĞºÑ‚Ñ‹ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾ÑĞ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°\n};\n\nconst afterEnter = (el: Element) => {\n  // ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ„Ñ„ĞµĞºÑ‚Ñ‹ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾ÑĞ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°\n};\n\n// Computed text for connection status\nconst connectionStatusText = computed(() => {\n  switch (props.status) {\n    case 'searching': return 'Searching...';\n    case 'matched': return 'Partner found, connecting...';\n    case 'connected': return 'Connected';\n    default: return 'Disconnected';\n  }\n});\n\nconst getVibeDisplayName = (vibe: string) => {\n  // ØªØ­ÙˆÙŠÙ„ Ù‚ÙŠÙ… Ø§Ù„ÙØ§ÙŠØ¨ Ø¥Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ø¹Ø±Ø¶ Ø³Ù‡Ù„Ø© Ø§Ù„ÙÙ‡Ù…\n  switch (vibe.toLowerCase()) {\n    case 'any':\n      return 'Go With the Flow';\n    case 'chill':\n      return 'Chill';\n    case 'fun':\n      return 'Fun';\n    case 'curious':\n      return 'Curious';\n    case 'creative':\n      return 'Creative';\n    default:\n      return vibe; // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙ‡Ø§\n  }\n};\n</script>\n\n<style scoped>\n/* Base Container and Circle Styles */\n.status-container {\n  position: relative;\n  width: 90px;\n  height: 90px;\n  margin: 0 auto 15px;\n  z-index: 1;\n  transition: all 0.5s ease;\n}\n\n@media (min-width: 640px) {\n  .status-container {\n    width: 100px;\n    height: 100px;\n    margin: 0 auto 20px;\n  }\n}\n\n.status-circle {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  overflow: visible;\n  z-index: 2;\n  box-shadow: none;\n  transition: all 0.3s ease;\n  background: transparent;\n}\n\n.circle-image {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  border-radius: 50%;\n  filter: none;\n  background: transparent;\n  transition: all 0.5s ease;\n}\n\n/* Thin Ring - Common for all states */\n.thin-ring {\n  position: absolute;\n  top: -0.05px;\n  left: -0.05px;\n  right: -0.05px;\n  bottom: -0.05px;\n  border-radius: 50%;\n  border: 0.05px solid transparent;\n  background-origin: border-box;\n  background-clip: border-box;\n  box-sizing: border-box;\n  z-index: -1;\n}\n\n/* Idle State - Pulsing visibility */\n.idle-ring {\n  background-image: linear-gradient(90deg, #9c27b0, #3498db);\n  animation: fade-ring 3s ease-in-out infinite;\n}\n\n/* Searching State */\n.search-ring {\n  background-image: linear-gradient(90deg, #3498db, #9c27b0);\n  animation: rotate-ring 3s linear infinite;\n}\n\n/* Matching State */\n.match-ring {\n  background-image: linear-gradient(90deg, #9c27b0, #3498db);\n  animation: rotate-ring 1.5s linear infinite;\n}\n\n/* Connected State */\n.connect-ring {\n  background-image: linear-gradient(90deg, #3498db, #2ecc71, #3498db);\n  animation: rotate-ring 4s linear infinite;\n}\n\n/* Ring animations */\n@keyframes rotate-ring {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes fade-ring {\n  0%, 100% {\n    opacity: 0.2;\n  }\n  50% {\n    opacity: 1;\n  }\n}\n\n/* Searching State - Pulsing effect */\n.pulse-effect {\n  animation: pulse 2s ease-in-out infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    transform: scale(1);\n  }\n  50% {\n    transform: scale(1.1);\n  }\n}\n\n/* Matching State - Fast Rotation effect */\n.fast-rotate {\n  animation: fast-rotate 2s linear infinite;\n}\n\n@keyframes fast-rotate {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n/* Transition animations */\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.25s ease, transform 0.25s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n  opacity: 0;\n  transform: translateY(5px);\n}\n\n/* Idle to Search transition */\n.idle-to-search-enter-active {\n  transition: all 0.3s ease;\n}\n\n.idle-to-search-leave-active {\n  transition: all 0.2s ease;\n}\n\n.idle-to-search-enter-from {\n  opacity: 0;\n  transform: scale(0.95);\n}\n\n.idle-to-search-leave-to {\n  opacity: 0;\n  transform: scale(1.05);\n}\n\n/* Search to Match transition */\n.search-to-match-enter-active {\n  transition: all 0.3s ease;\n}\n\n.search-to-match-leave-active {\n  transition: all 0.2s ease;\n}\n\n.search-to-match-enter-from {\n  opacity: 0;\n  transform: scale(0.95);\n}\n\n.search-to-match-leave-to {\n  opacity: 0;\n  transform: scale(1.05);\n}\n\n/* Match to Connect transition */\n.match-to-connect-enter-active {\n  transition: all 0.3s ease;\n}\n\n.match-to-connect-leave-active {\n  transition: all 0.2s ease;\n}\n\n.match-to-connect-enter-from {\n  opacity: 0;\n  transform: scale(0.95);\n}\n\n.match-to-connect-leave-to {\n  opacity: 0;\n  transform: scale(1.05);\n}\n\n/* To Idle transition */\n.to-idle-enter-active {\n  transition: all 0.3s ease;\n}\n\n.to-idle-leave-active {\n  transition: all 0.2s ease;\n}\n\n.to-idle-enter-from {\n  opacity: 0;\n  transform: scale(0.95);\n}\n\n.to-idle-leave-to {\n  opacity: 0;\n  transform: scale(1.05);\n}\n</style> ","<template>\n  <div class=\"space-y-3 sm:space-y-4 px-2\">\n    <!-- Main Control Buttons -->\n    <div class=\"flex justify-center items-center gap-2 sm:gap-3 md:gap-4\">\n      <!-- Mute Button -->\n      <button\n        @click=\"toggleMute\"\n        class=\"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center transition-all shadow-xl transform hover:scale-110\"\n        :class=\"isMuted ? 'bg-gradient-to-r from-red-400 to-pink-400 shadow-red-400/70' : 'bg-gradient-to-r from-emerald-400 to-green-400 hover:from-green-400 hover:to-emerald-400 shadow-emerald-400/70'\"\n        :disabled=\"isProcessing\"\n      >\n        <div class=\"relative\">\n          <span v-if=\"!isMuted\" class=\"text-white text-base sm:text-lg md:text-xl\">ğŸ¤</span>\n          <span v-else class=\"text-white text-base sm:text-lg md:text-xl\">ğŸ”‡</span>\n          <span v-if=\"isProcessing\" class=\"absolute -top-1 -right-1 w-2 h-2 sm:w-3 sm:h-3 bg-yellow-300 rounded-full animate-pulse\"></span>\n        </div>\n      </button>\n\n      <!-- Next/Find Partner Button -->\n      <button\n        @click=\"$emit('find-next')\"\n        class=\"w-14 h-14 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-gradient-to-r from-orange-400 to-yellow-400 hover:from-yellow-400 hover:to-orange-400 rounded-full flex items-center justify-center shadow-2xl shadow-orange-400/80 transition-all transform hover:scale-110\"\n      >\n        <span class=\"text-white text-xl sm:text-2xl md:text-3xl\">ğŸ“</span>\n      </button>\n\n      <!-- Chat Button -->\n      <button\n        @click=\"$emit('toggle-chat')\"\n        :disabled=\"isDisabled\"\n        class=\"w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center shadow-xl transition-all transform hover:scale-110\"\n        :class=\"isDisabled ? 'bg-gray-600 cursor-not-allowed opacity-50' : 'bg-gradient-to-r from-blue-400 to-cyan-400 hover:from-cyan-400 hover:to-blue-400 shadow-blue-400/70'\"\n      >\n        <span class=\"text-white text-base sm:text-lg md:text-xl\">ğŸ’¬</span>\n      </button>\n    </div>\n\n    <!-- Secondary Controls -->\n    <div class=\"flex flex-wrap justify-center gap-1.5 sm:gap-2 md:gap-3\">\n      <button\n        @click=\"$emit('toggle-games')\"\n        class=\"bg-gradient-to-r from-purple-400 to-pink-400 hover:from-pink-400 hover:to-purple-400 rounded-full px-2.5 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-purple-400/70 transition-all transform hover:scale-110 whitespace-nowrap\"\n      >\n        ğŸ® Games\n      </button>\n      <button\n        @click=\"$emit('toggle-history')\"\n        class=\"bg-gradient-to-r from-indigo-400 to-blue-400 hover:from-blue-400 hover:to-indigo-400 rounded-full px-2.5 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-indigo-400/70 transition-all transform hover:scale-110 whitespace-nowrap\"\n      >\n        ğŸ“ History\n      </button>\n      <button\n        @click=\"$emit('toggle-donation')\"\n        class=\"bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-orange-400 hover:to-yellow-400 rounded-full px-2.5 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-yellow-400/70 transition-all animate-pulse transform hover:scale-110 whitespace-nowrap\"\n      >\n        â¤ï¸ Support\n      </button>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue';\n\nconst props = defineProps({\n  isMuted: {\n    type: Boolean,\n    default: false\n  },\n  isDisabled: {\n    type: Boolean,\n    default: true\n  }\n});\n\nconst emit = defineEmits([\n  'toggle-mute',\n  'find-next',\n  'toggle-chat',\n  'toggle-games',\n  'toggle-history',\n  'toggle-donation'\n]);\n\n// Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø±Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©\nconst isProcessing = ref(false);\n\n// Enhanced mute toggle function to ensure audio works properly\nfunction toggleMute() {\n  if (isProcessing.value) return; // Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø±Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©\n  \n  isProcessing.value = true;\n  emit('toggle-mute');\n  \n  // ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ù‚ÙÙ„ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©\n  setTimeout(() => {\n    isProcessing.value = false;\n  }, 200); // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ù…Ù† 500 Ø¥Ù„Ù‰ 200 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©\n  \n  // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¨Ø¹Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…\n  setTimeout(() => {\n    try {\n      const audioElement = document.querySelector('audio');\n      if (audioElement && audioElement.paused) {\n        audioElement.play().catch(err => {\n          console.warn('Could not auto-play audio after mute toggle:', err);\n        });\n      }\n    } catch (error) {\n      console.error('Error trying to auto-play:', error);\n    }\n  }, 300);\n}\n</script> ","<template>\r\n  <div v-if=\"isOpen\" class=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n    <div class=\"bg-gray-900 rounded-lg w-full max-w-md mx-auto h-[80vh] flex flex-col\">\r\n      <!-- Header -->\r\n      <div class=\"flex items-center justify-between p-4 border-b border-gray-700\">\r\n        <div class=\"flex items-center\">\r\n          <span class=\"text-white text-lg font-medium\">ğŸ’¬ Chat</span>\r\n        </div>\r\n        <button \r\n          @click=\"$emit('close')\" \r\n          class=\"text-gray-400 hover:text-white\"\r\n        >\r\n          âœ•\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- Messages -->\r\n      <div class=\"flex-1 p-4 overflow-y-auto\" ref=\"messagesContainerRef\">\r\n        <div v-if=\"messages.length === 0\" class=\"h-full flex items-center justify-center text-gray-500\">\r\n          <div class=\"text-center\">\r\n            <p>No messages yet</p>\r\n            <p class=\"text-sm mt-1\">Send a message to start the conversation</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div v-else class=\"space-y-2\">\r\n          <div \r\n            v-for=\"message in messages\" \r\n            :key=\"message.id\"\r\n            class=\"rounded-lg p-3 max-w-[80%]\"\r\n            :class=\"message.isOwn \r\n              ? 'bg-blue-700 ml-auto' \r\n              : 'bg-gray-700 mr-auto'\"\r\n          >\r\n            <div class=\"flex justify-between gap-2\">\r\n              <span class=\"text-sm\" :class=\"message.isOwn ? 'text-blue-200' : 'text-gray-200'\">\r\n                {{ message.isOwn ? 'You' : 'Partner' }}\r\n              </span>\r\n              <span class=\"text-xs text-gray-400\">\r\n                {{ formatTime(message.timestamp) }}\r\n              </span>\r\n            </div>\r\n            <p class=\"mt-1 text-white break-words\">{{ message.message }}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Input -->\r\n      <div class=\"p-3 border-t border-gray-700\">\r\n        <form @submit.prevent=\"sendMessage\" class=\"flex gap-2\">\r\n          <input\r\n            v-model=\"currentMessage\"\r\n            type=\"text\"\r\n            placeholder=\"Type a message...\"\r\n            class=\"flex-1 bg-gray-800 border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n            :disabled=\"!isConnected\"\r\n          />\r\n          <button\r\n            type=\"submit\"\r\n            class=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            :disabled=\"!isConnected || !currentMessage.trim()\"\r\n          >\r\n            Send\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted, watch, nextTick } from 'vue';\r\n\r\ninterface Message {\r\n  id: string;\r\n  message: string;\r\n  isOwn: boolean;\r\n  timestamp: number;\r\n}\r\n\r\nconst props = defineProps({\r\n  isOpen: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  isConnected: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  messages: {\r\n    type: Array as () => Message[],\r\n    default: () => []\r\n  }\r\n});\r\n\r\nconst emit = defineEmits(['close', 'send-message']);\r\n\r\nconst currentMessage = ref('');\r\nconst messagesContainerRef = ref<HTMLElement | null>(null);\r\n\r\nconst sendMessage = () => {\r\n  if (currentMessage.value.trim() && props.isConnected) {\r\n    emit('send-message', currentMessage.value);\r\n    currentMessage.value = '';\r\n  }\r\n};\r\n\r\nconst scrollToBottom = async () => {\r\n  await nextTick();\r\n  if (messagesContainerRef.value) {\r\n    messagesContainerRef.value.scrollTop = messagesContainerRef.value.scrollHeight;\r\n  }\r\n};\r\n\r\nconst formatTime = (timestamp: number): string => {\r\n  return new Date(timestamp).toLocaleTimeString([], { \r\n    hour: '2-digit', \r\n    minute: '2-digit' \r\n  });\r\n};\r\n\r\nwatch(() => props.messages, () => {\r\n  scrollToBottom();\r\n}, { deep: true });\r\n\r\nwatch(() => props.isOpen, (newVal) => {\r\n  if (newVal) {\r\n    scrollToBottom();\r\n  }\r\n});\r\n\r\nonMounted(() => {\r\n  if (props.isOpen) {\r\n    scrollToBottom();\r\n  }\r\n});\r\n</script> ","<template>\n  <div class=\"w-full p-2\">\n    <!-- Game Header -->\n    <div class=\"flex justify-between items-center mb-4\">\n      <h2 class=\"text-xl font-bold text-purple-400\">Tic Tac Toe</h2>\n      <div class=\"text-white text-sm px-3 py-1 rounded-full\" \n        :class=\"{\n          'bg-yellow-600/30': gameState === 'waiting',\n          'bg-green-600/30': isMyTurn && gameState === 'playing',\n          'bg-red-600/30': !isMyTurn && gameState === 'playing',\n          'bg-purple-600/30': winner\n        }\">\n        <span v-if=\"gameState === 'waiting'\" class=\"text-yellow-300 animate-pulse\">\n          Waiting for partner...\n        </span>\n        <span v-else-if=\"winner\">\n          {{ winner === playerSymbol ? 'You Won! ğŸ‰' : winner === 'tie' ? \"It's a Tie! ğŸ¤\" : 'You Lost! ğŸ˜¢' }}\n        </span>\n        <span v-else>\n          {{ isMyTurn ? 'Your Turn' : \"Partner's Turn\" }}\n        </span>\n      </div>\n    </div>\n    \n    <!-- Game Board -->\n    <div class=\"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 mb-4\">\n      <div class=\"flex flex-col items-center\" :class=\"{'opacity-70': gameState === 'waiting' || (!isMyTurn && !winner)}\">\n        <!-- Player Info -->\n        <div class=\"mb-4 text-center\">\n          <div class=\"flex items-center justify-center gap-4\">\n            <div :class=\"{'ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800': playerSymbol === 'X'}\" \n                class=\"w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-lg font-bold\">\n              X\n            </div>\n            <div class=\"text-center\">\n              <p class=\"text-gray-300 text-sm\">You are</p>\n              <p class=\"font-bold text-lg\" :class=\"{'text-blue-400': playerSymbol === 'X', 'text-green-400': playerSymbol === 'O'}\">\n                {{ playerSymbol }}\n              </p>\n            </div>\n            <div :class=\"{'ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800': playerSymbol === 'O'}\" \n                class=\"w-10 h-10 rounded-full bg-green-600 flex items-center justify-center text-lg font-bold\">\n              O\n            </div>\n          </div>\n        </div>\n        \n        <!-- Board -->\n        <div class=\"grid grid-cols-3 gap-3 mb-4\">\n          <button \n            v-for=\"(cell, index) in board\" \n            :key=\"index\"\n            @click=\"makeMove(index)\"\n            :disabled=\"cell !== '' || !isMyTurn || winner !== null || gameState === 'waiting'\"\n            class=\"w-20 h-20 rounded-lg flex items-center justify-center text-3xl font-bold transition-all duration-300\"\n            :class=\"{\n              'bg-gray-700 hover:bg-gray-600': cell === '' && isMyTurn && !winner && gameState !== 'waiting',\n              'bg-gray-700/50': cell === '' && (!isMyTurn || winner !== null || gameState === 'waiting'),\n              'bg-blue-600/20': cell === 'X',\n              'bg-green-600/20': cell === 'O',\n              'cursor-not-allowed': cell !== '' || !isMyTurn || winner !== null || gameState === 'waiting',\n              'hover:bg-purple-700/50': isMyTurn && cell === '' && !winner && gameState === 'playing'\n            }\"\n          >\n            <span v-if=\"cell === 'X'\" class=\"text-blue-400\">X</span>\n            <span v-else-if=\"cell === 'O'\" class=\"text-green-400\">O</span>\n          </button>\n        </div>\n        \n        <!-- Game Result Actions -->\n        <div v-if=\"winner\" class=\"text-center mt-4 animate__animated animate__fadeIn\">\n          <button \n            @click=\"resetGame\" \n            class=\"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm transition-colors mb-2\"\n          >\n            Play Again\n          </button>\n        </div>\n        \n        <!-- Waiting Message -->\n        <div v-if=\"gameState === 'waiting'\" class=\"text-center mt-4\">\n          <div class=\"bg-yellow-600/20 rounded-lg p-4 animate-pulse\">\n            <p class=\"text-yellow-300 mb-1\">Waiting for your partner to join...</p>\n            <p class=\"text-sm text-gray-300\">You'll play as <span class=\"font-bold text-blue-400\">X</span></p>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Game Controls -->\n    <div class=\"flex justify-between\">\n      <button \n        @click=\"$emit('back')\" \n        class=\"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors\"\n      >\n        Back to Games\n      </button>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue';\nimport { useSocket } from '@/services/socket';\n\nconst props = defineProps({\n  partnerId: {\n    type: String,\n    required: true\n  },\n  isFirstPlayer: {\n    type: Boolean,\n    default: true\n  }\n});\n\nconst emit = defineEmits(['back', 'error']);\n\nconst { socket } = useSocket();\n\n// Game state\nconst gameState = ref<'waiting' | 'playing' | 'finished'>('waiting');\nconst board = ref<string[]>(['', '', '', '', '', '', '', '', '']);\nconst playerSymbol = ref(props.isFirstPlayer ? 'X' : 'O');\nconst partnerSymbol = ref(props.isFirstPlayer ? 'O' : 'X');\nconst currentTurn = ref('X'); // X always goes first\nconst winner = ref<string | null>(null);\nconst connectionLostTimeout = ref<number | null>(null);\nconst lastMoveTime = ref<number>(Date.now());\n\n// Constants\nconst CONNECTION_TIMEOUT = 30000; // 30 seconds without moves considered disconnection\n\n// Computed property to determine if it's the current player's turn\nconst isMyTurn = computed(() => {\n  return currentTurn.value === playerSymbol.value;\n});\n\n// Make a move\nconst makeMove = (index: number) => {\n  if (\n    gameState.value !== 'playing' || \n    board.value[index] !== '' || \n    !isMyTurn.value || \n    winner.value !== null\n  ) return;\n  \n  try {\n    // Update the board locally\n    board.value[index] = playerSymbol.value;\n    currentTurn.value = partnerSymbol.value;\n    lastMoveTime.value = Date.now();\n      \n    // Send the move to the partner\n    socket.value?.emit('game-move', {\n      gameType: 'tic-tac-toe',\n      move: index,\n      to: props.partnerId\n    });\n    \n    // Check for a winner\n    checkWinner();\n    \n    // Reset connection timeout\n    startConnectionTimeout();\n  } catch (error) {\n    handleError(\"Failed to make a move. Please try again.\");\n  }\n};\n\n// Check for a winner\nconst checkWinner = () => {\n  const winPatterns = [\n    [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows\n    [0, 3, 6], [1, 4, 7], [2, 5, 8], // columns\n    [0, 4, 8], [2, 4, 6]             // diagonals\n  ];\n  \n  // Check for winning combinations\n  for (const pattern of winPatterns) {\n    const [a, b, c] = pattern;\n    if (\n      board.value[a] && \n      board.value[a] === board.value[b] && \n      board.value[a] === board.value[c]\n    ) {\n      winner.value = board.value[a];\n      gameState.value = 'finished';\n      \n      // Clear connection timeout\n      if (connectionLostTimeout.value) {\n        clearTimeout(connectionLostTimeout.value);\n        connectionLostTimeout.value = null;\n      }\n      \n      return;\n    }\n  }\n  \n  // Check for a tie\n  if (!board.value.includes('')) {\n    winner.value = 'tie';\n    gameState.value = 'finished';\n    \n    // Clear connection timeout\n    if (connectionLostTimeout.value) {\n      clearTimeout(connectionLostTimeout.value);\n      connectionLostTimeout.value = null;\n    }\n  }\n};\n\n// Reset the game\nconst resetGame = () => {\n  try {\n    board.value = ['', '', '', '', '', '', '', '', ''];\n    currentTurn.value = 'X'; // X always starts\n    winner.value = null;\n    gameState.value = 'playing';\n    lastMoveTime.value = Date.now();\n    \n    // Send reset to the partner\n    socket.value?.emit('game-reset', {\n      gameType: 'tic-tac-toe',\n      to: props.partnerId\n    });\n    \n    // Start connection timeout\n    startConnectionTimeout();\n  } catch (error) {\n    handleError(\"Failed to reset the game. Please try again.\");\n  }\n};\n\n// Handle errors\nconst handleError = (message: string) => {\n  console.error(`Tic-Tac-Toe Error: ${message}`);\n  emit('error', message);\n};\n\n// Start connection timeout\nconst startConnectionTimeout = () => {\n  // Clear any existing timeout\n  if (connectionLostTimeout.value) {\n    clearTimeout(connectionLostTimeout.value);\n  }\n  \n  // Only set timeout if the game is in progress and not finished\n  if (gameState.value === 'playing' && !winner.value) {\n    connectionLostTimeout.value = window.setTimeout(() => {\n      // Check if no moves for a while\n      if (Date.now() - lastMoveTime.value > CONNECTION_TIMEOUT) {\n        handleError(\"Connection with your partner appears to be lost. The game will be closed.\");\n        emit('back');\n      }\n    }, CONNECTION_TIMEOUT);\n  }\n};\n\n// Watch for changes in the first player status\nwatch(() => props.isFirstPlayer, (newValue) => {\n  playerSymbol.value = newValue ? 'X' : 'O';\n  partnerSymbol.value = newValue ? 'O' : 'X';\n  \n  // If we're the second player, we're already in a playing state\n  if (!newValue) {\n    gameState.value = 'playing';\n  }\n});\n\n// Setup socket event handlers\nonMounted(() => {\n  try {\n    // Partner joined\n    socket.value?.on('game-partner-joined', (data: any) => {\n      if (data.from === props.partnerId && data.gameType === 'tic-tac-toe') {\n        console.log('Partner joined the game!', data);\n        gameState.value = 'playing';\n        lastMoveTime.value = Date.now();\n        \n        // Start connection timeout\n        startConnectionTimeout();\n      }\n    });\n    \n    // Handle partner moves\n    socket.value?.on('game-move', (data: any) => {\n      if (data.from === props.partnerId && data.gameType === 'tic-tac-toe') {\n        const moveIndex = data.move;\n        \n        if (\n          typeof moveIndex === 'number' && \n          moveIndex >= 0 && \n          moveIndex < 9 &&\n          board.value[moveIndex] === ''\n        ) {\n          board.value[moveIndex] = partnerSymbol.value;\n          currentTurn.value = playerSymbol.value;\n          lastMoveTime.value = Date.now();\n          \n          // Check for a winner\n          checkWinner();\n          \n          // Reset connection timeout\n          startConnectionTimeout();\n        } else {\n          handleError(\"Received invalid move from partner.\");\n        }\n      }\n    });\n    \n    // Handle game reset\n    socket.value?.on('game-reset', (data: any) => {\n      if (data.from === props.partnerId && data.gameType === 'tic-tac-toe') {\n        board.value = ['', '', '', '', '', '', '', '', ''];\n        currentTurn.value = 'X'; // X always starts\n        winner.value = null;\n        gameState.value = 'playing';\n        lastMoveTime.value = Date.now();\n        \n        // Start connection timeout\n        startConnectionTimeout();\n      }\n    });\n    \n    // Special case for second player: set game to playing immediately\n    if (!props.isFirstPlayer) {\n      gameState.value = 'playing';\n    }\n  } catch (error) {\n    handleError(\"Failed to initialize game connection.\");\n  }\n});\n\n// Clean up event listeners and timeouts\nonUnmounted(() => {\n  socket.value?.off('game-partner-joined');\n  socket.value?.off('game-move');\n  socket.value?.off('game-reset');\n  \n  // Clear connection timeout\n  if (connectionLostTimeout.value) {\n    clearTimeout(connectionLostTimeout.value);\n    connectionLostTimeout.value = null;\n  }\n});\n</script>\n\n<style scoped>\n.animate-pulse {\n  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n</style> ","<template>\n  <div class=\"w-full p-2\">\n    <!-- Game Header -->\n    <div class=\"flex justify-between items-center mb-4\">\n      <h2 class=\"text-xl font-bold text-purple-400\">\n        <span class=\"hidden sm:inline\">Rock Paper Scissors</span>\n        <span class=\"sm:hidden\">RPS Game</span>\n      </h2>\n      <div class=\"text-white text-sm px-3 py-1 rounded-full backdrop-blur-sm shadow-lg\" \n        :class=\"{\n          'bg-yellow-600/40 border border-yellow-500/30': gameState === 'waiting',\n          'bg-green-600/40 border border-green-500/30': gameState === 'ready',\n          'bg-blue-600/40 border border-blue-500/30': gameState === 'choosing',\n          'bg-purple-600/40 border border-purple-500/30': gameState === 'result'\n        }\">\n        <span v-if=\"gameState === 'waiting'\" class=\"text-yellow-300 animate-pulse flex items-center\">\n          <span class=\"inline-block w-2 h-2 bg-yellow-400 rounded-full mr-2 animate-ping\"></span>\n          Waiting...\n        </span>\n        <span v-else-if=\"gameState === 'ready'\" class=\"flex items-center\">\n          <span class=\"inline-block w-2 h-2 bg-green-400 rounded-full mr-2\"></span>\n          Ready!\n        </span>\n        <span v-else-if=\"gameState === 'choosing'\" class=\"flex items-center\">\n          <span class=\"inline-block w-2 h-2 bg-blue-400 rounded-full mr-2\"></span>\n          Choose\n        </span>\n        <span v-else-if=\"gameState === 'result'\" class=\"flex items-center\">\n          <span class=\"inline-block w-2 h-2 bg-purple-400 rounded-full mr-2\"></span>\n          {{ resultText }}\n        </span>\n      </div>\n    </div>\n    \n    <!-- Game Board -->\n    <div class=\"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 md:p-6 mb-4 border border-gray-700/50 shadow-xl\">\n      <div class=\"flex flex-col items-center\" :class=\"{'opacity-70': gameState === 'waiting'}\">\n        <!-- Score Board -->\n        <div class=\"flex justify-center items-center gap-4 md:gap-8 mb-6 w-full\">\n          <div class=\"text-center p-2 bg-blue-900/20 rounded-lg backdrop-blur-sm border border-blue-800/30 min-w-[70px]\">\n            <div class=\"text-sm text-gray-300 mb-1\">You</div>\n            <div class=\"text-2xl font-bold text-blue-400\">{{ playerScore }}</div>\n          </div>\n          <div class=\"text-center px-4 py-2 bg-gray-700/50 rounded-lg border border-gray-600/30\">\n            <div class=\"text-sm text-gray-300\">Round</div>\n            <div class=\"text-xl font-bold text-white\">{{ roundNumber }}</div>\n          </div>\n          <div class=\"text-center p-2 bg-green-900/20 rounded-lg backdrop-blur-sm border border-green-800/30 min-w-[70px]\">\n            <div class=\"text-sm text-gray-300 mb-1\">Partner</div>\n            <div class=\"text-2xl font-bold text-green-400\">{{ partnerScore }}</div>\n          </div>\n        </div>\n        \n        <!-- Game Area -->\n        <div class=\"w-full mb-4\">\n          <!-- Result Display -->\n          <div v-if=\"gameState === 'result'\" class=\"flex flex-col items-center mb-6 animate__animated animate__fadeIn\">\n            <div class=\"flex justify-center items-center gap-6 md:gap-10 mb-6\">\n              <div class=\"text-center\">\n                <div class=\"w-20 h-20 md:w-24 md:h-24 bg-blue-500/20 rounded-full flex items-center justify-center text-4xl md:text-5xl mb-2 shadow-lg border border-blue-400/30 transform transition-all\" \n                  :class=\"{'scale-110 ring-2 ring-blue-400 ring-opacity-50': result === 'win'}\">\n                  {{ getEmoji(playerChoice) }}\n                </div>\n                <div class=\"text-sm text-blue-400\">You</div>\n              </div>\n              <div class=\"text-2xl font-bold text-white bg-gray-700/50 rounded-full h-10 w-10 flex items-center justify-center\">VS</div>\n              <div class=\"text-center\">\n                <div class=\"w-20 h-20 md:w-24 md:h-24 bg-green-500/20 rounded-full flex items-center justify-center text-4xl md:text-5xl mb-2 shadow-lg border border-green-400/30 transform transition-all\"\n                  :class=\"{'scale-110 ring-2 ring-green-400 ring-opacity-50': result === 'lose'}\">\n                  {{ getEmoji(partnerChoice) }}\n                </div>\n                <div class=\"text-sm text-green-400\">Partner</div>\n              </div>\n            </div>\n            <div class=\"text-xl font-bold mb-4 py-2 px-4 rounded-lg\" :class=\"{\n              'bg-yellow-500/10 text-yellow-400 border border-yellow-500/30': result === 'tie',\n              'bg-green-500/10 text-green-400 border border-green-500/30': result === 'win',\n              'bg-red-500/10 text-red-400 border border-red-500/30': result === 'lose'\n            }\">\n              {{ resultText }}\n            </div>\n            <button \n              @click=\"playAgain\" \n              class=\"mt-2 px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95\"\n            >\n              Play Again\n            </button>\n          </div>\n          \n          <!-- Choice Selection -->\n          <div v-else-if=\"gameState === 'choosing'\" class=\"animate__animated animate__fadeIn\">\n            <div class=\"text-center mb-6\">\n              <p class=\"text-lg text-white mb-1\">Choose your move:</p>\n              <div class=\"inline-block px-3 py-1 rounded-full bg-gray-700/70 text-sm text-gray-300 mb-2\">\n                Time: <span class=\"font-mono text-white\" :class=\"{'text-red-400': countdownTimer <= 3}\">{{ countdownTimer }}s</span>\n              </div>\n            </div>\n            \n            <div class=\"flex justify-center items-center gap-3 md:gap-6\">\n              <button \n                v-for=\"choice in choices\" \n                :key=\"choice.value\"\n                @click=\"makeChoice(choice.value)\"\n                class=\"w-[90px] h-[90px] md:w-24 md:h-24 rounded-lg flex flex-col items-center justify-center transition-all shadow-lg hover:shadow-xl\"\n                :class=\"{\n                  'bg-blue-600/30 border border-blue-500/30 scale-105': playerChoice === choice.value, \n                  'bg-gray-800/80 border border-gray-700/50 hover:bg-gray-700/70 hover:scale-105 active:scale-95': playerChoice !== choice.value\n                }\"\n              >\n                <span class=\"text-4xl mb-2\">{{ choice.emoji }}</span>\n                <span class=\"text-xs text-gray-300\">{{ choice.name }}</span>\n              </button>\n            </div>\n          </div>\n          \n          <!-- Waiting for Partner -->\n          <div v-else-if=\"gameState === 'waiting'\" class=\"text-center\">\n            <div class=\"bg-yellow-600/20 rounded-lg p-4 border border-yellow-500/30 shadow-lg animate-pulse\">\n              <div class=\"w-16 h-16 mx-auto mb-3 relative\">\n                <div class=\"absolute inset-0 bg-yellow-500/20 rounded-full animate-ping\"></div>\n                <div class=\"absolute inset-2 bg-yellow-500/30 rounded-full animate-ping animation-delay-300\"></div>\n                <div class=\"absolute inset-4 bg-yellow-500/40 rounded-full animate-ping animation-delay-600\"></div>\n                <div class=\"absolute inset-0 flex items-center justify-center\">\n                  <span class=\"text-2xl\">ğŸ‘¥</span>\n                </div>\n              </div>\n              <p class=\"text-yellow-300 mb-1 font-medium\">Waiting for your partner to join...</p>\n              <p class=\"text-sm text-gray-300\">Game will start automatically</p>\n            </div>\n          </div>\n          \n          <!-- Ready to Play -->\n          <div v-else-if=\"gameState === 'ready'\" class=\"text-center\">\n            <div class=\"bg-green-600/20 rounded-lg p-4 border border-green-500/30 shadow-lg mb-4\">\n              <div class=\"w-16 h-16 mx-auto mb-3 flex items-center justify-center bg-green-500/30 rounded-full\">\n                <span class=\"text-2xl\">ğŸ®</span>\n              </div>\n              <p class=\"text-lg text-white mb-1\">Both players are ready!</p>\n              <p class=\"text-sm text-gray-300 mb-4\">Prepare for an epic battle</p>\n            </div>\n            <button \n              @click=\"startRound\" \n              class=\"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95\"\n            >\n              Start Game\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Game Controls -->\n    <div class=\"flex justify-between\">\n      <button \n        @click=\"$emit('back')\" \n        class=\"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95\"\n      >\n        Back to Games\n      </button>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue';\nimport { useSocket } from '@/services/socket';\n\nconst props = defineProps({\n  partnerId: {\n    type: String,\n    required: true\n  },\n  partnerReady: {\n    type: Boolean,\n    default: false\n  }\n});\n\nconst emit = defineEmits(['back', 'error']);\n\nconst { socket } = useSocket();\n\n// Game constants\nconst CHOICE_TIMEOUT = 10; // seconds to make a choice\nconst choices = [\n  { value: 'rock', name: 'Rock', emoji: 'ğŸ‘Š' },\n  { value: 'paper', name: 'Paper', emoji: 'âœ‹' },\n  { value: 'scissors', name: 'Scissors', emoji: 'âœŒï¸' }\n];\n\n// Game state\nconst gameState = ref<'waiting' | 'ready' | 'choosing' | 'result'>('waiting');\nconst playerChoice = ref<string | null>(null);\nconst partnerChoice = ref<string | null>(null);\nconst playerScore = ref(0);\nconst partnerScore = ref(0);\nconst roundNumber = ref(1);\nconst result = ref<'win' | 'lose' | 'tie' | null>(null);\nconst countdownTimer = ref(CHOICE_TIMEOUT);\nconst countdownInterval = ref<number | null>(null);\n\n// Computed properties\nconst resultText = computed(() => {\n  if (result.value === 'win') return 'You Win!';\n  if (result.value === 'lose') return 'You Lose!';\n  if (result.value === 'tie') return 'It\\'s a Tie!';\n  return '';\n});\n\n// Get emoji for a choice\nconst getEmoji = (choice: string | null) => {\n  if (!choice) return 'â“';\n  const found = choices.find(c => c.value === choice);\n  return found ? found.emoji : 'â“';\n};\n\n// Start a new round\nconst startRound = () => {\n  gameState.value = 'choosing';\n  playerChoice.value = null;\n  partnerChoice.value = null;\n  result.value = null;\n  startCountdown();\n  \n  // Notify partner\n  socket.value?.emit('game-start-round', {\n    gameType: 'rock-paper-scissors',\n    to: props.partnerId,\n    round: roundNumber.value\n  });\n};\n\n// Make a choice\nconst makeChoice = (choice: string) => {\n  playerChoice.value = choice;\n  \n  // Send choice to partner\n  socket.value?.emit('game-move', {\n    gameType: 'rock-paper-scissors',\n    move: {\n      choice,\n      round: roundNumber.value\n    },\n    to: props.partnerId\n  });\n  \n  // If both players have chosen, determine the result\n  if (partnerChoice.value) {\n    determineResult();\n  }\n};\n\n// Determine the winner\nconst determineResult = () => {\n  if (!playerChoice.value || !partnerChoice.value) return;\n  \n  stopCountdown();\n  gameState.value = 'result';\n  \n  if (playerChoice.value === partnerChoice.value) {\n    result.value = 'tie';\n  } else if (\n    (playerChoice.value === 'rock' && partnerChoice.value === 'scissors') ||\n    (playerChoice.value === 'paper' && partnerChoice.value === 'rock') ||\n    (playerChoice.value === 'scissors' && partnerChoice.value === 'paper')\n  ) {\n    result.value = 'win';\n    playerScore.value++;\n  } else {\n    result.value = 'lose';\n    partnerScore.value++;\n  }\n  \n  // Increment round number for next round\n  roundNumber.value++;\n};\n\n// Play again\nconst playAgain = () => {\n  startRound();\n};\n\n// Start countdown timer\nconst startCountdown = () => {\n  countdownTimer.value = CHOICE_TIMEOUT;\n  \n  if (countdownInterval.value) {\n    clearInterval(countdownInterval.value);\n  }\n  \n  countdownInterval.value = window.setInterval(() => {\n    countdownTimer.value--;\n    \n    if (countdownTimer.value <= 0) {\n      stopCountdown();\n      \n      // If player hasn't chosen, choose randomly\n      if (!playerChoice.value) {\n        const randomIndex = Math.floor(Math.random() * choices.length);\n        makeChoice(choices[randomIndex].value);\n      }\n    }\n  }, 1000);\n};\n\n// Stop countdown timer\nconst stopCountdown = () => {\n  if (countdownInterval.value) {\n    clearInterval(countdownInterval.value);\n    countdownInterval.value = null;\n  }\n};\n\n// Handle socket events\nonMounted(() => {\n  // Set initial game state based on whether partner is ready\n  if (props.partnerReady) {\n    gameState.value = 'ready';\n  }\n  \n  // Listen for partner's moves\n  socket.value?.on('game-move', (data: any) => {\n    if (data.from === props.partnerId && data.gameType === 'rock-paper-scissors') {\n      partnerChoice.value = data.move.choice;\n      \n      // If both players have chosen, determine the result\n      if (playerChoice.value) {\n        determineResult();\n      }\n    }\n  });\n  \n  // Listen for game start\n  socket.value?.on('game-start-round', (data: any) => {\n    if (data.from === props.partnerId && data.gameType === 'rock-paper-scissors') {\n      gameState.value = 'choosing';\n      playerChoice.value = null;\n      partnerChoice.value = null;\n      result.value = null;\n      roundNumber.value = data.round;\n      startCountdown();\n    }\n  });\n  \n  // Listen for partner joining\n  socket.value?.on('game-partner-joined', (data: any) => {\n    if (data.from === props.partnerId) {\n      gameState.value = 'ready';\n    }\n  });\n  \n  // Listen for partner leaving\n  socket.value?.on('game-partner-left', () => {\n    gameState.value = 'waiting';\n    stopCountdown();\n    emit('error', 'Your partner has left the game.');\n  });\n  \n  // Listen for game reset\n  socket.value?.on('game-reset', (data: any) => {\n    if (data.from === props.partnerId && data.gameType === 'rock-paper-scissors') {\n      playerScore.value = 0;\n      partnerScore.value = 0;\n      roundNumber.value = 1;\n      gameState.value = 'ready';\n    }\n  });\n});\n\n// Clean up\nonUnmounted(() => {\n  stopCountdown();\n  \n  // Remove event listeners\n  socket.value?.off('game-move');\n  socket.value?.off('game-start-round');\n  socket.value?.off('game-partner-joined');\n  socket.value?.off('game-partner-left');\n  socket.value?.off('game-reset');\n});\n</script>\n\n<style scoped>\n.animate__animated {\n  animation-duration: 0.5s;\n}\n\n.animate__fadeIn {\n  animation-name: fadeIn;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n.animate-ping {\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n@keyframes ping {\n  0% {\n    transform: scale(1);\n    opacity: 0.8;\n  }\n  75%, 100% {\n    transform: scale(1.5);\n    opacity: 0;\n  }\n}\n\n.animation-delay-300 {\n  animation-delay: 0.3s;\n}\n\n.animation-delay-600 {\n  animation-delay: 0.6s;\n}\n</style> ","<template>\n  <div class=\"w-full p-2\" dir=\"auto\">\n    <!-- Game Header -->\n    <div class=\"flex justify-between items-center mb-4\">\n      <h2 class=\"text-xl font-bold text-purple-400\">\n        <span class=\"hidden sm:inline\">Word Galaxy</span>\n        <span class=\"sm:hidden\">Word Game</span>\n      </h2>\n      <div class=\"text-white text-sm px-3 py-1 rounded-full backdrop-blur-sm shadow-lg\" \n        :class=\"{\n          'bg-yellow-600/40 border border-yellow-500/30': gameState === 'waiting',\n          'bg-green-600/40 border border-green-500/30': gameState === 'setup',\n          'bg-blue-600/40 border border-blue-500/30': gameState === 'guessing',\n          'bg-purple-600/40 border border-purple-500/30': gameState === 'complete'\n        }\">\n        <span v-if=\"gameState === 'waiting'\" class=\"text-yellow-300 animate-pulse flex items-center\">\n          <span class=\"inline-block w-2 h-2 bg-yellow-400 rounded-full mr-2 animate-ping\"></span>\n          Waiting...\n        </span>\n        <span v-else-if=\"gameState === 'setup'\" class=\"flex items-center\">\n          <span class=\"inline-block w-2 h-2 bg-green-400 rounded-full mr-2\"></span>\n          Setup\n        </span>\n        <span v-else-if=\"gameState === 'guessing'\" class=\"flex items-center\">\n          <span class=\"inline-block w-2 h-2 bg-blue-400 rounded-full mr-2\"></span>\n          Guessing\n        </span>\n        <span v-else-if=\"gameState === 'complete'\" class=\"flex items-center\">\n          <span class=\"inline-block w-2 h-2 bg-purple-400 rounded-full mr-2\"></span>\n          Complete!\n        </span>\n      </div>\n    </div>\n    \n    <!-- Game Board -->\n    <div class=\"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 md:p-6 mb-4 border border-gray-700/50 shadow-xl\">\n      <div class=\"flex flex-col items-center\" :class=\"{'opacity-70': gameState === 'waiting'}\">\n        <!-- Game Statistics -->\n        <div class=\"flex justify-center items-center gap-4 md:gap-8 mb-6 w-full\">\n          <div class=\"text-center p-2 bg-blue-900/20 rounded-lg backdrop-blur-sm border border-blue-800/30 min-w-[80px]\">\n            <div class=\"text-sm text-gray-300 mb-1\">Attempts</div>\n            <div class=\"text-2xl font-bold text-blue-400\">{{ attemptCount }}/{{ maxAttempts }}</div>\n          </div>\n          <div v-if=\"gameState === 'guessing' && !isWordCreator\" class=\"text-center px-4 py-2 bg-gray-700/50 rounded-lg border border-gray-600/30\">\n            <div class=\"text-sm text-gray-300\">Time</div>\n            <div class=\"text-xl font-bold\" :class=\"{'text-red-400': timer < 10, 'text-yellow-400': timer < 20, 'text-white': timer >= 20}\">{{ timer }}s</div>\n          </div>\n          <div class=\"text-center p-2 bg-green-900/20 rounded-lg backdrop-blur-sm border border-green-800/30 min-w-[80px]\">\n            <div class=\"text-sm text-gray-300 mb-1\">Score</div>\n            <div class=\"text-2xl font-bold text-green-400\">{{ isWordCreator ? creatorScore : guesserScore }}</div>\n          </div>\n          <div class=\"text-center p-2 bg-purple-900/20 rounded-lg backdrop-blur-sm border border-purple-800/30 min-w-[80px]\">\n            <div class=\"text-sm text-gray-300 mb-1\">Round</div>\n            <div class=\"text-2xl font-bold text-purple-400\">{{ roundCount }}</div>\n          </div>\n        </div>\n        \n        <!-- Game Area -->\n        <div class=\"w-full mb-4\">\n          <!-- Word Setup (Word Creator) -->\n          <div v-if=\"gameState === 'setup' && isWordCreator\" class=\"animate__animated animate__fadeIn\">\n            <div class=\"text-center mb-6\">\n              <div class=\"w-16 h-16 mx-auto mb-3 flex items-center justify-center bg-green-500/30 rounded-full\">\n                <span class=\"text-2xl\">ğŸ’¬</span>\n              </div>\n              <h3 class=\"text-xl font-bold text-white mb-2\">Create a Word</h3>\n              <p class=\"text-gray-300 mb-4\">Enter a word for your partner to guess</p>\n            </div>\n            \n            <div class=\"bg-gray-700/50 rounded-lg p-4 mb-4\">\n              <div class=\"mb-4\">\n                <label class=\"block text-gray-300 text-sm mb-2\">Your Word:</label>\n                <input \n                  v-model=\"secretWord\" \n                  :dir=\"isArabicWord(secretWord) ? 'rtl' : 'ltr'\"\n                  class=\"w-full bg-gray-900 text-white px-4 py-2 rounded border border-gray-600 focus:border-purple-500 focus:outline-none\"\n                  placeholder=\"Enter a word...\"\n                  maxlength=\"15\"\n                  :disabled=\"gameState !== 'setup'\"\n                  @input=\"validateSecretWord\"\n                />\n                <p v-if=\"wordError\" class=\"text-xs text-red-400 mt-1\">{{ wordError }}</p>\n                <p v-else class=\"text-xs text-gray-400 mt-1\">The word should be 3-15 letters long</p>\n              </div>\n              \n              <div class=\"mb-4\">\n                <label class=\"block text-gray-300 text-sm mb-2\">Difficulty:</label>\n                <div class=\"flex gap-2\">\n                  <button\n                    @click=\"difficulty = 'easy'\"\n                    class=\"flex-1 px-4 py-2 rounded-lg text-sm transition-all\"\n                    :class=\"difficulty === 'easy' ? 'bg-green-600 text-white' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'\"\n                  >\n                    Easy\n                  </button>\n                  <button\n                    @click=\"difficulty = 'medium'\"\n                    class=\"flex-1 px-4 py-2 rounded-lg text-sm transition-all\"\n                    :class=\"difficulty === 'medium' ? 'bg-yellow-600 text-white' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'\"\n                  >\n                    Medium\n                  </button>\n                  <button\n                    @click=\"difficulty = 'hard'\"\n                    class=\"flex-1 px-4 py-2 rounded-lg text-sm transition-all\"\n                    :class=\"difficulty === 'hard' ? 'bg-red-600 text-white' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'\"\n                  >\n                    Hard\n                  </button>\n                </div>\n              </div>\n            </div>\n            \n            <div class=\"text-center\">\n              <button \n                @click=\"startGame\" \n                class=\"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:pointer-events-none\"\n                :disabled=\"!isValidWord\"\n              >\n                Start Game\n              </button>\n            </div>\n          </div>\n          \n          <!-- Waiting for Word Setup (Guesser) -->\n          <div v-else-if=\"gameState === 'setup' && !isWordCreator\" class=\"animate__animated animate__fadeIn\">\n            <div class=\"text-center mb-6\">\n              <div class=\"w-16 h-16 mx-auto mb-3 relative\">\n                <div class=\"absolute inset-0 bg-blue-500/20 rounded-full animate-ping\"></div>\n                <div class=\"absolute inset-2 bg-blue-500/30 rounded-full animate-ping animation-delay-300\"></div>\n                <div class=\"absolute inset-0 flex items-center justify-center\">\n                  <span class=\"text-2xl\">ğŸ”¤</span>\n                </div>\n              </div>\n              <h3 class=\"text-xl font-bold text-white mb-2\">Get Ready!</h3>\n              <p class=\"text-gray-300\">Your partner is creating a word for you to guess...</p>\n            </div>\n            \n            <div class=\"bg-gray-700/50 rounded-lg p-4 mb-4\">\n              <h4 class=\"font-bold text-white mb-2\">How to Play:</h4>\n              <ul class=\"text-gray-300 text-sm space-y-2 list-disc pl-4\">\n                <li>Your partner will create a secret word</li>\n                <li>You'll see a blurred version of the word</li>\n                <li>Type guesses to reveal more letters</li>\n                <li>You need to guess the word before the timer runs out</li>\n                <li>You win if you guess correctly, your partner wins if you don't</li>\n              </ul>\n            </div>\n          </div>\n          \n          <!-- Guessing View (Guesser) -->\n          <div v-else-if=\"gameState === 'guessing' && !isWordCreator\" class=\"animate__animated animate__fadeIn\">\n            <div class=\"mb-6\">\n              <div class=\"bg-gray-700/50 rounded-lg p-4 shadow-inner mb-4\">\n                <div class=\"flex justify-between items-center mb-2\">\n                  <span class=\"text-sm text-gray-400\">The Secret Word:</span>\n                  <span class=\"text-xs text-gray-400\">{{ revealedCount }}/{{ secretWordLength }} letters revealed</span>\n                </div>\n                \n                <div class=\"flex justify-center gap-1 md:gap-2 flex-wrap\" :dir=\"currentWordDirection\">\n                  <div \n                    v-for=\"(char, index) in blurredWord\" \n                    :key=\"index\"\n                    class=\"w-8 h-10 md:w-10 md:h-12 flex items-center justify-center rounded bg-gray-800/80 border text-lg md:text-xl font-bold\"\n                    :class=\"char === '_' ? 'border-gray-700 text-gray-500' : 'border-purple-500 text-white'\"\n                  >\n                    {{ char }}\n                  </div>\n                </div>\n              </div>\n              \n              <div class=\"mb-4\">\n                <label class=\"block text-gray-300 text-sm mb-2\">Your Guess:</label>\n                <div class=\"flex gap-2\">\n                  <input \n                    v-model=\"currentGuess\" \n                    :dir=\"isArabicWord(currentGuess) || isArabicWord(secretWord.value) ? 'rtl' : 'ltr'\"\n                    class=\"flex-1 bg-gray-900 text-white px-4 py-2 rounded-l border border-gray-600 focus:border-purple-500 focus:outline-none\"\n                    placeholder=\"Type your guess...\"\n                    :maxlength=\"secretWordLength\"\n                    @keyup.enter=\"submitGuess\"\n                    @input=\"validateGuess\"\n                  />\n                  <button \n                    @click=\"submitGuess\" \n                    class=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-r transition-all\"\n                    :disabled=\"!currentGuess || currentGuess.length !== secretWordLength\"\n                  >\n                    Submit\n                  </button>\n                </div>\n                <p v-if=\"guessError\" class=\"text-xs text-red-400 mt-1\">{{ guessError }}</p>\n                <p v-else class=\"text-xs text-gray-400 mt-1\">\n                  {{ attemptsLeft }} attempts remaining\n                </p>\n              </div>\n              \n              <div class=\"bg-gray-700/30 rounded-lg p-3 max-h-28 overflow-y-auto\">\n                <p v-if=\"guessHistory.length === 0\" class=\"text-gray-400 italic text-sm\">Your previous guesses will appear here...</p>\n                <div v-for=\"(guess, index) in guessHistory\" :key=\"index\" class=\"text-sm flex items-center mb-1\">\n                  <span class=\"text-gray-400 w-5\">{{ index + 1 }}.</span>\n                  <span :dir=\"isArabicWord(guess.word) || isArabicWord(secretWord.value) ? 'rtl' : 'ltr'\" class=\"text-gray-300 mr-2\">{{ guess.word }}</span>\n                  <span class=\"text-xs px-1.5 py-0.5 rounded\" :class=\"getMatchClass(guess.matches)\">\n                    {{ guess.matches }} matching\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <!-- Word Creator View -->\n          <div v-else-if=\"gameState === 'guessing' && isWordCreator\" class=\"animate__animated animate__fadeIn\">\n            <div class=\"bg-gray-700/50 rounded-lg p-4 mb-4\">\n              <div class=\"flex justify-between items-center mb-2\">\n                <span class=\"text-gray-300\">Your Secret Word:</span>\n                <span class=\"text-white font-bold\" :dir=\"isArabicWord(secretWord) ? 'rtl' : 'ltr'\">{{ secretWord }}</span>\n              </div>\n              \n              <div class=\"flex justify-center gap-1 md:gap-2 flex-wrap\" :dir=\"currentWordDirection\">\n                <div \n                  v-for=\"(char, index) in secretWord\" \n                  :key=\"index\"\n                  class=\"w-8 h-10 md:w-10 md:h-12 flex items-center justify-center rounded border border-purple-500 text-lg md:text-xl font-bold\"\n                  :class=\"revealedLetters.includes(index) ? 'bg-purple-600/30 text-white' : 'bg-gray-800 text-gray-500'\"\n                >\n                  {{ char }}\n                </div>\n              </div>\n              \n              <div class=\"mt-4 text-sm text-gray-300\">\n                <p v-if=\"timerStarted\">\n                  <span class=\"text-yellow-400 font-bold\">Time remaining:</span> {{ timer }}s\n                </p>\n                <p class=\"mt-2\">\n                  <span class=\"text-purple-400 font-bold\">Status:</span>\n                  {{ partnerStatus }}\n                </p>\n              </div>\n            </div>\n            \n            <div class=\"bg-gray-700/30 rounded-lg p-3 max-h-36 overflow-y-auto\">\n              <p v-if=\"guessHistory.length === 0\" class=\"text-gray-400 italic text-sm\">Partner's guesses will appear here...</p>\n              <div v-for=\"(guess, index) in guessHistory\" :key=\"index\" class=\"text-sm flex items-center mb-1\">\n                <span class=\"text-gray-400 w-5\">{{ index + 1 }}.</span>\n                <span :dir=\"isArabicWord(guess.word) ? 'rtl' : 'ltr'\" class=\"text-gray-300 mr-2\">{{ guess.word }}</span>\n                <span class=\"text-xs px-1.5 py-0.5 rounded\" :class=\"getMatchClass(guess.matches)\">\n                  {{ guess.matches }} matching\n                </span>\n              </div>\n            </div>\n          </div>\n          \n          <!-- Game Complete View -->\n          <div v-else-if=\"gameState === 'complete'\" class=\"animate__animated animate__fadeIn\">\n            <div class=\"text-center mb-6\">\n              <div class=\"w-20 h-20 mx-auto mb-4 flex items-center justify-center bg-purple-500/30 rounded-full\">\n                <span class=\"text-3xl\">{{ isWinner ? 'ğŸ‰' : 'ğŸ”' }}</span>\n              </div>\n              \n              <h3 class=\"text-2xl font-bold text-white mb-2\">\n                {{ isWinner ? 'You Won!' : 'You Lost!' }}\n              </h3>\n              \n              <div class=\"bg-gray-700/50 rounded-lg p-4 mb-4\">\n                <p class=\"text-gray-300 mb-2\">The secret word was:</p>\n                <div class=\"text-2xl font-bold text-purple-400 mb-2\" dir=\"rtl\">{{ secretWord }}</div>\n                \n                <p v-if=\"isWinner\" class=\"text-green-400 mt-4\">\n                  {{ isWordCreator ? 'Your partner couldn\\'t solve it!' : 'Solved in ' + attemptCount + ' attempts!' }}\n                </p>\n                <p v-else class=\"text-yellow-400 mt-4\">\n                  {{ isWordCreator ? 'Your partner solved it!' : 'Better luck next time!' }}\n                </p>\n              </div>\n              \n              <div class=\"bg-gray-700/50 rounded-lg p-4 mb-4\">\n                <h4 class=\"text-lg font-bold text-white mb-2\">Scores</h4>\n                <div class=\"flex justify-between items-center\">\n                  <div>\n                    <p class=\"text-gray-300\">You:</p>\n                    <p class=\"text-xl font-bold text-green-400\">{{ isWordCreator ? creatorScore : guesserScore }}</p>\n                  </div>\n                  <div>\n                    <p class=\"text-gray-300\">Partner:</p>\n                    <p class=\"text-xl font-bold text-blue-400\">{{ isWordCreator ? guesserScore : creatorScore }}</p>\n                  </div>\n                </div>\n                <p class=\"text-xs text-gray-400 mt-2\">Points are saved until you exit the game</p>\n              </div>\n              \n              <button \n                @click=\"playAgain\" \n                class=\"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95\"\n              >\n                Play Again\n              </button>\n            </div>\n          </div>\n          \n          <!-- Waiting for Partner -->\n          <div v-else-if=\"gameState === 'waiting'\" class=\"text-center\">\n            <div class=\"bg-yellow-600/20 rounded-lg p-4 border border-yellow-500/30 shadow-lg animate-pulse\">\n              <div class=\"w-16 h-16 mx-auto mb-3 relative\">\n                <div class=\"absolute inset-0 bg-yellow-500/20 rounded-full animate-ping\"></div>\n                <div class=\"absolute inset-2 bg-yellow-500/30 rounded-full animate-ping animation-delay-300\"></div>\n                <div class=\"absolute inset-4 bg-yellow-500/40 rounded-full animate-ping animation-delay-600\"></div>\n                <div class=\"absolute inset-0 flex items-center justify-center\">\n                  <span class=\"text-2xl\">ğŸ‘¥</span>\n                </div>\n              </div>\n              <p class=\"text-yellow-300 mb-1 font-medium\">Waiting for your partner to join...</p>\n              <p class=\"text-sm text-gray-300\">Game will start automatically</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Game Rules Collapse -->\n    <div class=\"mb-4\">\n      <button \n        @click=\"showRules = !showRules\" \n        class=\"w-full flex justify-between items-center bg-gray-700/50 hover:bg-gray-700 px-4 py-2 rounded-lg text-white text-sm transition-colors\"\n      >\n        <span>Game Rules & How to Play</span>\n        <span>{{ showRules ? 'â–²' : 'â–¼' }}</span>\n      </button>\n      \n      <div v-if=\"showRules\" class=\"bg-gray-800/60 mt-2 p-4 rounded-lg border border-gray-700 text-sm text-gray-300 animate__animated animate__fadeIn\">\n        <h4 class=\"font-bold text-white mb-2\">Word Galaxy Rules:</h4>\n        <ul class=\"list-disc pl-4 space-y-2 mb-4\">\n          <li>One player creates a secret word (3-15 letters)</li>\n          <li>The other player tries to guess the word</li>\n          <li>The guesser can see a blurred version of the word that gradually reveals itself with correct guesses</li>\n          <li>Each guess reveals letters that are in the correct position</li>\n          <li>The guesser has a limited number of attempts and time based on difficulty:\n            <ul class=\"list-disc pl-4 mt-1\">\n              <li><span class=\"text-green-400\">Easy:</span> 10 attempts, 60 seconds</li>\n              <li><span class=\"text-yellow-400\">Medium:</span> 8 attempts, 45 seconds</li>\n              <li><span class=\"text-red-400\">Hard:</span> 6 attempts, 30 seconds</li>\n            </ul>\n          </li>\n          <li>The word creator can give hints verbally through voice chat</li>\n          <li>If the guesser solves the word, they win. If they run out of time or attempts, the word creator wins</li>\n        </ul>\n        \n        <h4 class=\"font-bold text-white mb-2\">Tips:</h4>\n        <ul class=\"list-disc pl-4 space-y-1\">\n          <li><span class=\"text-blue-400\">For the Guesser:</span> Pay attention to revealed letters</li>\n          <li><span class=\"text-purple-400\">For the Word Creator:</span> Give helpful but not too obvious hints through voice</li>\n          <li>Work together to have fun!</li>\n        </ul>\n      </div>\n    </div>\n    \n    <!-- Game Controls -->\n    <div class=\"flex justify-between\">\n      <button \n        @click=\"leaveGame\" \n        class=\"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95\"\n      >\n        Back to Games\n      </button>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted, onUnmounted, watch } from 'vue';\nimport { useSocket } from '@/services/socket';\n\nconst props = defineProps({\n  partnerId: {\n    type: String,\n    required: true\n  },\n  partnerReady: {\n    type: Boolean,\n    default: false\n  }\n});\n\nconst emit = defineEmits(['back', 'error']);\n\nconst { socket, userId } = useSocket();\n\n// UI state\nconst showRules = ref(false);\nconst wordError = ref('');\nconst guessError = ref('');\n\n// Game state\nconst gameState = ref<'waiting' | 'setup' | 'guessing' | 'complete'>('waiting');\nconst isWordCreator = ref(false);\nconst secretWord = ref('');\nconst secretWordLength = ref(0);\nconst blurredWord = ref<string[]>([]);\nconst revealedLetters = ref<number[]>([]);\nconst revealedCount = ref(0);\nconst difficulty = ref<'easy' | 'medium' | 'hard'>('medium');\nconst currentGuess = ref('');\nconst guessHistory = ref<{word: string, matches: number}[]>([]);\nconst attemptCount = ref(0);\nconst isWinner = ref(false);\nconst score = ref(0);\nconst partnerStatus = ref('Watching you set up the game...');\n\n// New score tracking\nconst guesserScore = ref(0);\nconst creatorScore = ref(0);\nconst roundCount = ref(1);\nconst roundScores = ref<{creator: number, guesser: number}[]>([]);\n\n// Timer\nconst timer = ref(0);\nconst timerInterval = ref<number | null>(null);\nconst timerStarted = ref(false);\n\n// Difficulty settings\nconst difficultySettings = {\n  easy: { attempts: 10, time: 60, multiplier: 1 },\n  medium: { attempts: 8, time: 45, multiplier: 1.5 },\n  hard: { attempts: 6, time: 30, multiplier: 2 }\n};\n\n// Helper function to detect if text contains Arabic\nconst isArabicWord = (text: string): boolean => {\n  const arabicPattern = /[\\u0600-\\u06FF]/;\n  return arabicPattern.test(text);\n};\n\n// Helper function to check if input contains only valid characters (Arabic or English letters)\nconst isValidCharacters = (text: string): boolean => {\n  // Arabic letters (Ø§-ÙŠ) or English letters (a-z, A-Z) only\n  const validCharsRegex = /^[a-zA-Z\\u0600-\\u06FF]+$/;\n  return validCharsRegex.test(text);\n};\n\n// Get current word direction based on content\nconst currentWordDirection = computed(() => {\n  if (!secretWord.value) return 'ltr';\n  return isArabicWord(secretWord.value) ? 'rtl' : 'ltr';\n});\n\n// Validate the secret word\nconst validateSecretWord = () => {\n  // Clear previous error\n  wordError.value = '';\n  \n  // Check for minimum length\n  if (secretWord.value.length > 0 && secretWord.value.length < 3) {\n    wordError.value = 'The word must be at least 3 letters';\n    return;\n  }\n  \n  // Check for valid characters (only Arabic or English letters)\n  if (secretWord.value.length > 0 && !isValidCharacters(secretWord.value)) {\n    // Filter to keep only valid characters\n    secretWord.value = secretWord.value.replace(/[^a-zA-Z\\u0600-\\u06FF]/g, '');\n    wordError.value = 'Only Arabic or English letters are allowed';\n  }\n};\n\n// Validate the user's guess\nconst validateGuess = () => {\n  // Clear previous error\n  guessError.value = '';\n  \n  // Check length\n  if (currentGuess.value.length > 0 && currentGuess.value.length !== secretWordLength.value) {\n    guessError.value = `The word must be ${secretWordLength.value} letters long`;\n    return;\n  }\n  \n  // Check for valid characters (only Arabic or English letters)\n  if (currentGuess.value.length > 0 && !isValidCharacters(currentGuess.value)) {\n    // Filter to keep only valid characters\n    currentGuess.value = currentGuess.value.replace(/[^a-zA-Z\\u0600-\\u06FF]/g, '');\n    guessError.value = 'Only Arabic or English letters are allowed';\n  }\n};\n\n// Computed properties\nconst maxAttempts = computed(() => {\n  return difficultySettings[difficulty.value].attempts;\n});\n\nconst maxTime = computed(() => {\n  return difficultySettings[difficulty.value].time;\n});\n\nconst attemptsLeft = computed(() => {\n  return maxAttempts.value - attemptCount.value;\n});\n\nconst isValidWord = computed(() => {\n  // Allow Arabic and English words, minimum 3 letters, and only valid characters\n  return secretWord.value.length >= 3 && \n         secretWord.value.length <= 15 && \n         isValidCharacters(secretWord.value) &&\n         !wordError.value;\n});\n\n// Start the game with the created word\nconst startGame = () => {\n  if (!isValidWord.value) return;\n  \n  // Convert word to lowercase and trim spaces\n  secretWord.value = secretWord.value.trim();\n  \n  // Send the word and settings to partner\n  socket.value?.emit('game-word-setup', {\n    gameType: 'word-galaxy',\n    to: props.partnerId,\n    wordLength: secretWord.value.length,\n    difficulty: difficulty.value\n  });\n  \n  // Initialize game state\n  gameState.value = 'guessing';\n  secretWordLength.value = secretWord.value.length;\n  initializeBlurredWord();\n};\n\n// Initialize the blurred word with underscores\nconst initializeBlurredWord = () => {\n  blurredWord.value = Array(secretWordLength.value).fill('_');\n  revealedLetters.value = [];\n  revealedCount.value = 0;\n};\n\n// Start the timer\nconst startTimer = () => {\n  if (timerInterval.value) {\n    clearInterval(timerInterval.value);\n  }\n  \n  timer.value = maxTime.value;\n  timerStarted.value = true;\n  \n  timerInterval.value = window.setInterval(() => {\n    timer.value--;\n    \n    if (timer.value <= 0) {\n      stopTimer();\n      \n      // Time's up, guesser loses\n      if (!isWordCreator.value) {\n        gameState.value = 'complete';\n        isWinner.value = false;\n        \n        // Notify partner\n        socket.value?.emit('game-move', {\n          gameType: 'word-galaxy',\n          move: {\n            type: 'timeout'\n          },\n          to: props.partnerId\n        });\n      }\n    }\n  }, 1000);\n};\n\n// Stop the timer\nconst stopTimer = () => {\n  if (timerInterval.value) {\n    clearInterval(timerInterval.value);\n    timerInterval.value = null;\n  }\n};\n\n// Submit a guess (guesser)\nconst submitGuess = () => {\n  if (!currentGuess.value || currentGuess.value.length !== secretWordLength.value) return;\n  \n  // Validate input - only allow Arabic or English letters\n  if (!isValidCharacters(currentGuess.value)) {\n    // Filter to keep only valid characters\n    currentGuess.value = currentGuess.value.replace(/[^a-zA-Z\\u0600-\\u06FF]/g, '');\n    guessError.value = 'Only Arabic or English letters are allowed';\n    return;\n  }\n  \n  const guess = currentGuess.value.trim();\n  guessError.value = '';\n  \n  // Send guess to partner\n  socket.value?.emit('game-move', {\n    gameType: 'word-galaxy',\n    move: {\n      type: 'guess',\n      word: guess\n    },\n    to: props.partnerId\n  });\n  \n  // Clear current guess\n  currentGuess.value = '';\n  \n  // Increment attempt count\n  attemptCount.value++;\n  \n  // Check if out of attempts\n  if (attemptCount.value >= maxAttempts.value) {\n    gameState.value = 'complete';\n    isWinner.value = false;\n    stopTimer();\n    \n    // Notify partner\n    socket.value?.emit('game-move', {\n      gameType: 'word-galaxy',\n      move: {\n        type: 'out-of-attempts'\n      },\n      to: props.partnerId\n    });\n  }\n};\n\n// Process a guess (word creator)\nconst processGuess = (guess: string) => {\n  const targetWord = secretWord.value;\n  const guessWord = guess;\n  \n  // Count matching positions\n  let matches = 0;\n  const newRevealed: number[] = [...revealedLetters.value];\n  \n  // Check if we're handling an Arabic word\n  const isArabic = isArabicWord(targetWord);\n  \n  // For Arabic words, we need to adjust the comparison to account for RTL direction\n  if (isArabic) {\n    for (let i = 0; i < targetWord.length; i++) {\n      // For Arabic, the letter comparison should be done with consideration of RTL order\n      // If the target word index i matches the guess word index i, mark it as a match\n      if (guessWord[i] === targetWord[i]) {\n        matches++;\n        if (!newRevealed.includes(i)) {\n          newRevealed.push(i);\n        }\n      }\n    }\n  } else {\n    // For non-Arabic words, use the original logic\n    for (let i = 0; i < targetWord.length; i++) {\n      if (guessWord[i] === targetWord[i]) {\n        matches++;\n        if (!newRevealed.includes(i)) {\n          newRevealed.push(i);\n        }\n      }\n    }\n  }\n  \n  // Update revealed letters\n  revealedLetters.value = newRevealed;\n  revealedCount.value = newRevealed.length;\n  \n  // Add to guess history - use the actual guessed word\n  guessHistory.value.push({\n    word: guessWord,\n    matches: matches\n  });\n  \n  // Update partner status\n  partnerStatus.value = `Made guess: \"${guessWord}\" (${matches} matches)`;\n  \n  // Award points to word creator for wrong guesses (if not fully correct)\n  if (matches < targetWord.length) {\n    // Word creator gets 10 points for each wrong guess\n    const pointsEarned = 10 * difficultySettings[difficulty.value].multiplier;\n    creatorScore.value += Math.round(pointsEarned);\n  }\n  \n  // Send result back to guesser - send the actual secret word for revealed positions\n  // but also include the original guess for the history\n  socket.value?.emit('game-guess-result', {\n    gameType: 'word-galaxy',\n    to: props.partnerId,\n    result: {\n      word: targetWord, // Send actual word for letter revealing\n      originalGuess: guessWord, // Send original guess for history display\n      matches: matches,\n      revealedPositions: newRevealed,\n      isCorrect: matches === targetWord.length,\n      creatorEarnedPoints: matches < targetWord.length ? Math.round(10 * difficultySettings[difficulty.value].multiplier) : 0\n    }\n  });\n  \n  // Check if word is guessed\n  if (matches === targetWord.length) {\n    // If the word is correct, show the entire word\n    blurredWord.value = targetWord.split('');\n    revealedCount.value = secretWordLength.value;\n    \n    gameState.value = 'complete';\n    isWinner.value = false; // Creator loses when word is guessed correctly\n    secretWord.value = targetWord;\n    stopTimer();\n    \n    // Calculate score\n    calculateScore();\n  }\n};\n\n// Handle guess result (guesser)\nconst handleGuessResult = (result: {\n  word: string;\n  originalGuess?: string;\n  matches: number;\n  revealedPositions: number[];\n  isCorrect: boolean;\n  creatorEarnedPoints?: number;\n}) => {\n  // Update guess history with the original guess if available, otherwise current guess\n  guessHistory.value.push({\n    word: result.originalGuess || currentGuess.value, // Use originalGuess from server or fallback to currentGuess\n    matches: result.matches\n  });\n  \n  // Update partner's score if they earned points\n  if (result.creatorEarnedPoints) {\n    creatorScore.value += result.creatorEarnedPoints;\n  }\n  \n  // Update revealed letters - Fix: Only update positions that are newly revealed\n  for (let i = 0; i < secretWordLength.value; i++) {\n    if (result.revealedPositions.includes(i)) {\n      blurredWord.value[i] = result.word[i]; // Use target word for revealing\n    }\n  }\n  \n  revealedCount.value = result.revealedPositions.length;\n  \n  // Check if word is guessed\n  if (result.isCorrect) {\n    // If the word is correct, show the entire word\n    blurredWord.value = result.word.split('');\n    revealedCount.value = secretWordLength.value;\n    \n    gameState.value = 'complete';\n    isWinner.value = true;\n    secretWord.value = result.word;\n    stopTimer();\n    \n    // Calculate score\n    calculateScore();\n  }\n};\n\n// Calculate score based on performance\nconst calculateScore = () => {\n  if (isWinner.value) {\n    // Guesser wins and gets points\n    if (!isWordCreator.value) {\n      // Base score for correct guess\n      const baseScore = 50;\n      \n      // Difficulty multiplier\n      const difficultyMultiplier = difficultySettings[difficulty.value].multiplier;\n      \n      // Calculate bonus based on attempts left (more attempts left = higher bonus)\n      const attemptBonus = (maxAttempts.value - attemptCount.value) * 5;\n      \n      // Calculate bonus based on time left\n      const timeBonus = Math.round(timer.value / 3);\n      \n      // Calculate final score\n      const earnedPoints = Math.round((baseScore + attemptBonus + timeBonus) * difficultyMultiplier);\n      guesserScore.value += earnedPoints;\n      \n      // Send score update to partner\n      socket.value?.emit('game-score-update', {\n        gameType: 'word-galaxy',\n        to: props.partnerId,\n        guesserScore: guesserScore.value,\n        creatorScore: creatorScore.value\n      });\n    }\n  } else {\n    // Word creator wins if guesser fails\n    if (isWordCreator.value) {\n      // Base score for stumping the guesser\n      const baseScore = 30;\n      \n      // Difficulty multiplier\n      const difficultyMultiplier = difficultySettings[difficulty.value].multiplier;\n      \n      // Calculate final score\n      const earnedPoints = Math.round(baseScore * difficultyMultiplier);\n      creatorScore.value += earnedPoints;\n      \n      // Send score update to partner\n      socket.value?.emit('game-score-update', {\n        gameType: 'word-galaxy',\n        to: props.partnerId,\n        guesserScore: guesserScore.value,\n        creatorScore: creatorScore.value\n      });\n    }\n  }\n  \n  // Save round score - simplified to avoid complex calculations that might be inaccurate\n  roundScores.value.push({\n    creator: isWordCreator.value && !isWinner.value ? Math.round(30 * difficultySettings[difficulty.value].multiplier) : 0,\n    guesser: !isWordCreator.value && isWinner.value ? Math.round((50 + (maxAttempts.value - attemptCount.value) * 5 + Math.round(timer.value / 3)) * difficultySettings[difficulty.value].multiplier) : 0\n  });\n};\n\n// Get CSS class for match count display\nconst getMatchClass = (matches: number) => {\n  if (matches === 0) return 'bg-red-500/30 text-red-300';\n  if (matches === secretWordLength.value) return 'bg-green-500/30 text-green-300';\n  if (matches >= secretWordLength.value / 2) return 'bg-yellow-500/30 text-yellow-300';\n  return 'bg-blue-500/30 text-blue-300';\n};\n\n// Play again\nconst playAgain = () => {\n  // Reset game state\n  gameState.value = 'setup';\n  secretWord.value = '';\n  blurredWord.value = [];\n  revealedLetters.value = [];\n  revealedCount.value = 0;\n  currentGuess.value = '';\n  guessHistory.value = [];\n  attemptCount.value = 0;\n  isWinner.value = false;\n  score.value = 0;\n  timerStarted.value = false;\n  \n  // Increment round counter\n  roundCount.value++;\n  \n  // Swap roles - Ù…Ù‡Ù…: Ù‡Ø°Ø§ Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·ØŒ ÙˆÙ„Ø§ ÙŠÙ†Ø¨ØºÙŠ Ø£Ù† ÙŠØ¹ÙƒØ³ Ø§Ù„Ø·Ø±ÙØ§Ù† Ø£Ø¯ÙˆØ§Ø±Ù‡Ù…Ø§\n  const previousRole = isWordCreator.value;\n  isWordCreator.value = !previousRole;\n  \n  console.log(`Play Again clicked: Round ${roundCount.value}, Swapping roles - I was ${previousRole ? 'creator' : 'guesser'}, now I am ${isWordCreator.value ? 'creator' : 'guesser'}`);\n  \n  // Notify partner with instructions to switch to the opposite role\n  socket.value?.emit('game-reset', {\n    gameType: 'word-galaxy',\n    to: props.partnerId,\n    swapRoles: false, // Ù†Ø­Ù† Ù„Ø§ Ù†Ø±ÙŠØ¯ Ø£Ù† ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø´Ø±ÙŠÙƒ Ø¨ØªØ¨Ø¯ÙŠÙ„ Ø¯ÙˆØ±Ù‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\n    shouldBeCreator: !isWordCreator.value, // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ø¹ÙƒØ³ Ø¯ÙˆØ±Ù†Ø§ Ø§Ù„Ø­Ø§Ù„ÙŠ\n    roundCount: roundCount.value,\n    guesserScore: guesserScore.value,\n    creatorScore: creatorScore.value\n  });\n};\n\n// Handle leaving the game\nconst leaveGame = () => {\n  // Send a simple notification to partner that we're leaving the game menu\n  // but we don't want to use game-leave-room which triggers the partner left event\n  socket.value?.emit('game-leave-notification', {\n    gameType: 'word-galaxy',\n    to: props.partnerId,\n    message: 'User left the game but still in the chat'\n  });\n  \n  // Return to game selection\n  emit('back');\n};\n\n// Handle socket events\nonMounted(() => {\n  // Set initial game state based on whether partner is ready\n  if (props.partnerReady) {\n    gameState.value = 'setup';\n    \n    // Instead of random assignment, use deterministic assignment based on user IDs\n    // This ensures consistent roles between the two players\n    if (roundCount.value === 1) {\n      // Compare user IDs to deterministically assign roles\n      // This guarantees different roles as the comparison will yield opposite results for each player\n      const myId = userId.value || '';\n      const partnerId = props.partnerId || '';\n      \n      // Use alphabetical comparison to deterministically assign roles\n      // If my ID comes before partner's ID, I'm the word creator\n      isWordCreator.value = myId < partnerId;\n      \n      console.log(`Role assignment: My ID ${myId}, Partner ID ${partnerId}, I am ${isWordCreator.value ? 'word creator' : 'guesser'}`);\n    }\n  }\n  \n  // Word setup\n  socket.value?.on('game-word-setup', (data: any) => {\n    if (data.from === props.partnerId && data.gameType === 'word-galaxy') {\n      // Initialize game with received word length\n      secretWordLength.value = data.wordLength;\n      difficulty.value = data.difficulty;\n      gameState.value = 'guessing';\n      isWordCreator.value = false;\n      \n      // Set up blurred word\n      initializeBlurredWord();\n      \n      // Start the timer\n      startTimer();\n    }\n  });\n  \n  // Handle score updates\n  socket.value?.on('game-score-update', (data: any) => {\n    if (data.from === props.partnerId && data.gameType === 'word-galaxy') {\n      // Update scores from partner\n      if (data.guesserScore !== undefined) {\n        guesserScore.value = data.guesserScore;\n      }\n      if (data.creatorScore !== undefined) {\n        creatorScore.value = data.creatorScore;\n      }\n    }\n  });\n  \n  // Handle moves (guesses, timeouts)\n  socket.value?.on('game-move', (data: any) => {\n    if (data.from === props.partnerId && data.gameType === 'word-galaxy') {\n      const move = data.move;\n      \n      if (move.type === 'guess') {\n        // Process the guess (word creator)\n        processGuess(move.word);\n      } else if (move.type === 'timeout') {\n        // Partner ran out of time (word creator wins)\n        gameState.value = 'complete';\n        isWinner.value = true;\n        partnerStatus.value = 'Ran out of time!';\n        \n        // Award points to creator for winning by timeout\n        calculateScore();\n      } else if (move.type === 'out-of-attempts') {\n        // Partner ran out of attempts (word creator wins)\n        gameState.value = 'complete';\n        isWinner.value = true;\n        partnerStatus.value = 'Ran out of attempts!';\n        \n        // Award points to creator for winning by attempts\n        calculateScore();\n      }\n    }\n  });\n  \n  // Handle guess results\n  socket.value?.on('game-guess-result', (data: any) => {\n    if (data.from === props.partnerId && data.gameType === 'word-galaxy') {\n      handleGuessResult(data.result);\n    }\n  });\n  \n  // Handle partner joining\n  socket.value?.on('game-partner-joined', (data: any) => {\n    if (data.from === props.partnerId) {\n      gameState.value = 'setup';\n      \n      // Use same deterministic assignment on join to ensure consistency\n      if (roundCount.value === 1) {\n        const myId = userId.value || '';\n        const partnerId = props.partnerId || '';\n        \n        // Use alphabetical comparison to deterministically assign roles\n        isWordCreator.value = myId < partnerId;\n        \n        console.log(`Partner joined: My ID ${myId}, Partner ID ${partnerId}, I am ${isWordCreator.value ? 'word creator' : 'guesser'}`);\n      }\n    }\n  });\n  \n  // Handle partner leaving\n  socket.value?.on('game-partner-left', () => {\n    gameState.value = 'waiting';\n    stopTimer();\n    emit('error', 'Your partner has left the game.');\n  });\n  \n  // Handle game reset\n  socket.value?.on('game-reset', (data: any) => {\n    if (data.from === props.partnerId && data.gameType === 'word-galaxy') {\n      console.log(`Received game-reset from partner with data:`, \n        JSON.stringify({\n          roundCount: data.roundCount,\n          shouldBeCreator: data.shouldBeCreator\n        })\n      );\n      \n      // Reset game state\n      gameState.value = 'setup';\n      secretWord.value = '';\n      blurredWord.value = [];\n      revealedLetters.value = [];\n      revealedCount.value = 0;\n      currentGuess.value = '';\n      guessHistory.value = [];\n      attemptCount.value = 0;\n      isWinner.value = false;\n      score.value = 0;\n      stopTimer();\n      timerStarted.value = false;\n      \n      // Sync round count and scores\n      if (data.roundCount) {\n        roundCount.value = data.roundCount;\n      }\n      if (data.guesserScore !== undefined) {\n        guesserScore.value = data.guesserScore;\n      }\n      if (data.creatorScore !== undefined) {\n        creatorScore.value = data.creatorScore;\n      }\n      \n      // IMPORTANT: Always respect the role specified by the partner\n      if (data.shouldBeCreator !== undefined) {\n        const previousRole = isWordCreator.value;\n        isWordCreator.value = data.shouldBeCreator;\n        console.log(`Reset from partner: Round ${roundCount.value}, Changing role from ${previousRole ? 'creator' : 'guesser'} to ${isWordCreator.value ? 'creator' : 'guesser'}`);\n      }\n    }\n  });\n  \n  // Handle notifications (non-critical messages)\n  socket.value?.on('game-notification', (data: any) => {\n    if (data.from === props.partnerId && data.gameType === 'word-galaxy') {\n      console.log(`Game notification from partner: ${data.message}`);\n      \n      // We could show this to the user if needed\n      // For now, we just log it and continue the game\n    }\n  });\n});\n\n// Clean up socket listeners and timers\nonUnmounted(() => {\n  stopTimer();\n  \n  socket.value?.off('game-word-setup');\n  socket.value?.off('game-move');\n  socket.value?.off('game-guess-result');\n  socket.value?.off('game-score-update');\n  socket.value?.off('game-partner-joined');\n  socket.value?.off('game-partner-left');\n  socket.value?.off('game-reset');\n  socket.value?.off('game-notification');\n});\n\n// Computed property for game result\nconst gameResult = computed(() => {\n  if (gameState.value !== 'complete') return null;\n  \n  if (isWordCreator.value) {\n    // Word creator's perspective\n    return isWinner.value ? 'failed' : 'guessed';\n  } else {\n    // Guesser's perspective\n    return isWinner.value ? 'guessed' : 'failed';\n  }\n});\n</script>\n\n<style scoped>\n.animate__animated {\n  animation-duration: 0.5s;\n}\n\n.animate__fadeIn {\n  animation-name: fadeIn;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n.animate-ping {\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n@keyframes ping {\n  0% {\n    transform: scale(1);\n    opacity: 0.8;\n  }\n  75%, 100% {\n    transform: scale(1.5);\n    opacity: 0;\n  }\n}\n\n.animation-delay-300 {\n  animation-delay: 0.3s;\n}\n\n.animation-delay-600 {\n  animation-delay: 0.6s;\n}\n</style> ","<template>\n  <div v-if=\"isOpen\" class=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4\">\n    <div class=\"bg-[#1e1e2e] rounded-lg w-full max-w-md mx-auto shadow-2xl relative overflow-hidden\">\n      <!-- Header -->\n      <div class=\"flex items-center justify-between p-3 border-b border-gray-800\">\n        <div class=\"flex items-center gap-2\">\n          <span class=\"text-purple-400 text-xl\">ğŸ®</span>\n          <h2 class=\"text-xl font-semibold text-[#a881fc]\">Space Games</h2>\n        </div>\n        <button \n          @click=\"$emit('close')\" \n          class=\"text-gray-400 hover:text-white text-lg\"\n        >\n          âœ•\n        </button>\n      </div>\n      \n      <!-- Debug Info - HIDDEN -->\n      <div v-if=\"false\" class=\"bg-black/50 text-xs text-gray-400 p-1 border-b border-gray-800\">\n        Status: {{ debugInfo }}\n      </div>\n      \n      <!-- Game Select View -->\n      <div v-if=\"!selectedGame\" class=\"p-4\">\n        <!-- Games Grid -->\n        <div class=\"grid grid-cols-2 gap-4 mb-4\">\n          <!-- Rock Paper Scissors -->\n          <button \n            class=\"bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative\"\n            :class=\"{'opacity-50 cursor-not-allowed': !isConnected}\"\n            :disabled=\"!isConnected\"\n            @click=\"selectGame('rock-paper-scissors')\"\n          >\n            <div class=\"bg-yellow-500 text-white w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl\">ğŸ‘Š</div>\n            <div class=\"text-white font-medium\">Rock Paper Scissors</div>\n            <div class=\"text-xs text-gray-400\">vs Partner</div>\n          </button>\n          \n          <!-- Word Galaxy -->\n          <button \n            class=\"bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative\"\n            :class=\"{'opacity-50 cursor-not-allowed': !isConnected}\"\n            :disabled=\"!isConnected\"\n            @click=\"selectGame('word-galaxy')\"\n          >\n            <div class=\"bg-white text-gray-800 w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl\">ğŸ’¬</div>\n            <div class=\"text-white font-medium\">Word Galaxy</div>\n            <div class=\"text-xs text-gray-400\">Word Guessing Game</div>\n          </button>\n          \n          <!-- Tic Tac Toe -->\n          <button \n            class=\"bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative\"\n            :class=\"{'opacity-50 cursor-not-allowed': !isConnected}\"\n            :disabled=\"!isConnected\"\n            @click=\"selectGame('tic-tac-toe')\"\n          >\n            <div class=\"bg-red-600 text-white w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl\">â­•</div>\n            <div class=\"text-white font-medium\">Tic-Tac-Toe</div>\n            <div class=\"text-xs text-gray-400\">vs Partner</div>\n          </button>\n          \n          <!-- Future Game -->\n          <button \n            class=\"bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center relative\"\n            :class=\"{'opacity-50 cursor-not-allowed': true}\"\n            disabled\n          >\n            <div class=\"absolute inset-0 flex items-center justify-center bg-[#2e2e42]/80 rounded-lg\">\n              <span class=\"bg-purple-500 text-white text-xs px-2 py-1 rounded-md font-medium\">Coming Soon</span>\n            </div>\n            <div class=\"bg-purple-600 text-white w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl\">ğŸ²</div>\n            <div class=\"text-white font-medium\">Mystery Game</div>\n            <div class=\"text-xs text-gray-400\">More Fun Ahead</div>\n          </button>\n        </div>\n        \n        <!-- Connection Notice -->\n        <p class=\"text-center text-sm text-gray-400 mt-2\">\n          Connect to play with others\n        </p>\n      </div>\n      \n      <!-- Error Message -->\n      <div v-else-if=\"errorMessage\" class=\"text-center p-6\">\n        <div class=\"mb-4\">\n          <div class=\"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-2\">\n            <span class=\"text-2xl\">âš ï¸</span>\n          </div>\n          <h3 class=\"text-xl font-bold mb-2 text-red-400\">Game Error</h3>\n          <p class=\"text-gray-300\">{{ errorMessage }}</p>\n        </div>\n        \n        <button \n          @click=\"closeGame\" \n          class=\"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors mt-2\"\n        >\n          Back to Games\n        </button>\n      </div>\n      \n      <!-- Game View -->\n      <div v-else>\n        <TicTacToe\n          v-if=\"selectedGame === 'tic-tac-toe'\"\n          :partnerId=\"partnerId\"\n          :isFirstPlayer=\"isFirstPlayer\"\n          :partnerReady=\"partnerReady\"\n          @back=\"closeGame\"\n          @error=\"handleGameError\"\n        />\n        <RockPaperScissors\n          v-if=\"selectedGame === 'rock-paper-scissors'\"\n          :partnerId=\"partnerId\"\n          :partnerReady=\"partnerReady\"\n          @back=\"closeGame\"\n          @error=\"handleGameError\"\n        />\n        <WordGalaxy\n          v-if=\"selectedGame === 'word-galaxy'\"\n          :partnerId=\"partnerId\"\n          :partnerReady=\"partnerReady\"\n          @back=\"closeGame\"\n          @error=\"handleGameError\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onUnmounted, watch } from 'vue';\nimport { useSocket } from '@/services/socket';\nimport TicTacToe from './games/TicTacToe.vue';\nimport RockPaperScissors from './games/RockPaperScissors.vue';\nimport WordGalaxy from './games/WordGalaxy.vue';\n\nconst { socket, userId } = useSocket();\n\nconst props = defineProps({\n  isOpen: {\n    type: Boolean,\n    default: false\n  },\n  partnerId: {\n    type: String,\n    required: true\n  },\n  isConnected: {\n    type: Boolean,\n    default: false\n  }\n});\n\nconst emit = defineEmits(['close']);\n\n// Game state\nconst selectedGame = ref<string | null>(null);\nconst errorMessage = ref<string | null>(null);\nconst isFirstPlayer = ref(true);\nconst gameRoomId = ref<string | null>(null);\nconst partnerReady = ref(false);\nconst debugInfo = ref<string>('');\n\n// Debug helper - only logs to console, not UI\nconst logDebugInfo = (msg: string) => {\n  console.log(`[Game Debug] ${msg}`);\n  debugInfo.value = msg;\n};\n\n// Select a game\nconst selectGame = (gameType: string) => {\n  if (!props.isConnected) return;\n  \n  logDebugInfo(`Starting game: ${gameType} with partner: ${props.partnerId}`);\n  \n  errorMessage.value = null;\n  selectedGame.value = gameType;\n  isFirstPlayer.value = true;\n  partnerReady.value = false;\n  \n  // Create a deterministic room ID based on user IDs\n  // This ensures both users try to join the same room\n  const userIds = [userId.value, props.partnerId].sort();\n  gameRoomId.value = `${gameType}-${userIds[0]}-${userIds[1]}`;\n  \n  logDebugInfo(`Created game room: ${gameRoomId.value}`);\n  \n  // Join the game room\n  socket.value?.emit('game-join-room', {\n    gameType,\n    roomId: gameRoomId.value,\n    to: props.partnerId,\n    isFirstPlayer: true\n  });\n};\n\n// Close game\nconst closeGame = () => {\n  // Notify partner that we're leaving the game but still in chat\n  if (gameRoomId.value && props.partnerId) {\n    socket.value?.emit('game-leave-notification', {\n      gameType: selectedGame.value || 'unknown',\n      to: props.partnerId,\n      message: 'Your partner returned to the game menu'\n    });\n    \n    // Also leave the room to clean up server resources\n    socket.value?.emit('game-leave-room', {\n      roomId: gameRoomId.value,\n      to: props.partnerId\n    });\n  }\n  \n  // Reset state\n  selectedGame.value = null;\n  errorMessage.value = null;\n  isFirstPlayer.value = true;\n  gameRoomId.value = null;\n  partnerReady.value = false;\n};\n\n// Handle game error\nconst handleGameError = (error: string) => {\n  errorMessage.value = error;\n  logDebugInfo(`Error: ${error}`);\n};\n\n// Set up socket event listeners\nonMounted(() => {\n  logDebugInfo('Setting up game events');\n  \n  // Handle game invites and room joins\n  socket.value?.on('game-room-invite', (data: any) => {\n    if (data.from === props.partnerId) {\n      logDebugInfo(`Received invitation to join game room: ${data.roomId}`);\n      gameRoomId.value = data.roomId;\n      selectedGame.value = data.gameType;\n      isFirstPlayer.value = false; // We're joining, so we're the second player\n      \n      // Join the room\n      socket.value?.emit('game-join-room', {\n        gameType: data.gameType,\n        roomId: data.roomId,\n        to: props.partnerId,\n        isFirstPlayer: false\n      });\n    }\n  });\n  \n  // Handle game partner joined\n  socket.value?.on('game-partner-joined', (data: any) => {\n    if (data.from === props.partnerId) {\n      logDebugInfo(`Partner joined the game: ${data.gameType}`);\n      partnerReady.value = true;\n    }\n  });\n  \n  // Handle errors\n  socket.value?.on('game-error', (data: any) => {\n    if (data.from === 'system' || data.from === props.partnerId) {\n      errorMessage.value = data.message || \"An error occurred in the game.\";\n      logDebugInfo(`Game error: ${data.message}`);\n    }\n  });\n  \n  // Handle partner leaving\n  socket.value?.on('game-partner-left', (data: any) => {\n    if (selectedGame.value) {\n      errorMessage.value = \"Your partner left the game.\";\n      logDebugInfo('Partner left the game');\n      selectedGame.value = null;\n    }\n  });\n  \n  // Handle notifications\n  socket.value?.on('game-notification', (data: any) => {\n    if (data.from === props.partnerId) {\n      logDebugInfo(`Notification from partner: ${data.message}`);\n    }\n  });\n});\n\n// Clean up event listeners\nonUnmounted(() => {\n  socket.value?.off('game-room-invite');\n  socket.value?.off('game-partner-joined');\n  socket.value?.off('game-error');\n  socket.value?.off('game-partner-left');\n  socket.value?.off('game-notification');\n  \n  // Leave any active game room\n  if (gameRoomId.value) {\n    socket.value?.emit('game-leave-room', {\n      roomId: gameRoomId.value,\n      to: props.partnerId\n    });\n  }\n});\n\n// Watch for dialog close to reset game state\nwatch(() => props.isOpen, (isOpen) => {\n  if (!isOpen) {\n    closeGame();\n  }\n});\n</script>\n\n<style scoped>\n/* No custom styles needed */\n</style>","<template>\r\n  <div v-if=\"isOpen\" class=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n    <div class=\"bg-gray-900 rounded-lg w-full max-w-md mx-auto p-6\">\r\n      <!-- Header -->\r\n      <div class=\"flex items-center justify-between mb-6\">\r\n        <div class=\"flex items-center gap-2\">\r\n          <span class=\"text-red-400 text-xl\">â¤ï¸</span>\r\n          <h2 class=\"text-lg font-semibold text-violet-400\">Support SpaceTalk</h2>\r\n        </div>\r\n        <button \r\n          @click=\"$emit('close')\" \r\n          class=\"text-gray-400 hover:text-white text-lg\"\r\n        >\r\n          âœ•\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- Content -->\r\n      <div class=\"mb-6 text-center\">\r\n        <p class=\"text-gray-300\">Keep SpaceTalk free for everyone</p>\r\n      </div>\r\n      \r\n      <!-- Donation Options -->\r\n      <div class=\"grid grid-cols-3 gap-4 mb-6\">\r\n        <button \r\n          :class=\"[\r\n            'bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform',\r\n            selectedAmount === 5 ? 'ring-2 ring-emerald-500 scale-105' : ''\r\n          ]\"\r\n          @click=\"selectAmount(5)\"\r\n        >\r\n          <div class=\"text-lg font-bold text-white\">$5</div>\r\n          <div class=\"text-sm text-gray-400\">Coffee</div>\r\n        </button>\r\n        \r\n        <button \r\n          :class=\"[\r\n            'bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform',\r\n            selectedAmount === 15 ? 'ring-2 ring-emerald-500 scale-105' : ''\r\n          ]\"\r\n          @click=\"selectAmount(15)\"\r\n        >\r\n          <div class=\"text-lg font-bold text-white\">$15</div>\r\n          <div class=\"text-sm text-gray-400\">Fuel</div>\r\n        </button>\r\n        \r\n        <button \r\n          :class=\"[\r\n            'bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform',\r\n            selectedAmount === 50 ? 'ring-2 ring-emerald-500 scale-105' : ''\r\n          ]\"\r\n          @click=\"selectAmount(50)\"\r\n        >\r\n          <div class=\"text-lg font-bold text-white\">$50</div>\r\n          <div class=\"text-sm text-gray-400\">Rocket</div>\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- Development Info -->\r\n      <div class=\"flex justify-center items-center gap-1 mb-6\">\r\n        <span class=\"text-yellow-400\">â­</span>\r\n        <span class=\"text-sm text-gray-300\">Boost development</span>\r\n      </div>\r\n      \r\n      <!-- Donate Button -->\r\n      <button \r\n        class=\"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-3 rounded-lg transition-colors mb-2 active:scale-95 transform duration-150\"\r\n        @click=\"openPayPal\"\r\n      >\r\n        Donate via PayPal\r\n      </button>\r\n      \r\n      <!-- Secure Payment Notice -->\r\n      <div class=\"text-xs text-gray-500 text-center\">\r\n        Secure payments via PayPal\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref } from 'vue';\r\n\r\ndefineProps({\r\n  isOpen: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n});\r\n\r\nconst emit = defineEmits(['close']);\r\n\r\nconst selectedAmount = ref(15);\r\n\r\nconst selectAmount = (amount: number) => {\r\n  selectedAmount.value = amount;\r\n};\r\n\r\nconst openPayPal = () => {\r\n  // Redirect to the specified PayPal link with the selected amount\r\n  window.open(`https://www.paypal.com/paypalme/spacetalk/${selectedAmount.value}`, '_blank');\r\n  emit('close');\r\n};\r\n</script> ","<template>\n  <div class=\"fixed inset-0 overflow-hidden pointer-events-none\">\n    <div v-for=\"star in stars\" :key=\"star.id\" \n         class=\"absolute rounded-full bg-white\" \n         :style=\"{\n           width: `${star.size}px`,\n           height: `${star.size}px`,\n           top: `${star.y}%`,\n           left: `${star.x}%`,\n           opacity: star.opacity,\n           boxShadow: `0 0 ${star.size * 2}px rgba(255, 255, 255, ${star.opacity})`,\n           animation: `twinkle ${star.duration}s infinite ease-in-out`\n         }\">\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted } from 'vue';\n\ninterface Star {\n  id: number;\n  x: number;\n  y: number;\n  size: number;\n  opacity: number;\n  duration: number;\n}\n\nconst stars = ref<Star[]>([]);\n\nonMounted(() => {\n  generateStars();\n});\n\nconst generateStars = () => {\n  const numStars = 50;\n  const newStars: Star[] = [];\n  \n  for (let i = 0; i < numStars; i++) {\n    newStars.push({\n      id: i,\n      x: Math.random() * 100,\n      y: Math.random() * 100,\n      size: Math.random() * 2 + 1,\n      opacity: Math.random() * 0.7 + 0.3,\n      duration: Math.random() * 8 + 2\n    });\n  }\n  \n  stars.value = newStars;\n};\n</script>\n\n<style scoped>\n@keyframes twinkle {\n  0%, 100% {\n    opacity: 0.3;\n    transform: scale(0.8);\n  }\n  50% {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n</style>\n ","<template>\n  <div>\n    <!-- Hidden audio element that does all the heavy lifting - this is the most important part -->\n    <audio ref=\"audioElement\" autoplay playsinline class=\"hidden\"></audio>\n    \n    <!-- Only show debug panel during development -->\n    <div v-if=\"DEBUG\" class=\"fixed bottom-4 right-4 z-50 text-xs bg-gray-800/70 p-3 rounded-lg text-white\">\n      <div class=\"flex items-center gap-2 mb-1\">\n        <span v-if=\"isPlaying\" class=\"text-green-300 animate-pulse\">â—</span>\n        <span v-else class=\"text-red-300\">â—</span>\n        <span>{{ isPlaying ? 'Audio Active' : 'Audio Inactive' }}</span>\n      </div>\n      <div class=\"grid grid-cols-2 gap-x-3 gap-y-1\">\n        <span>Connection:</span>\n        <span :class=\"{\n          'text-green-400': correctedConnectionState === 'connected', \n          'text-yellow-400': correctedConnectionState === 'connecting', \n          'text-red-400': correctedConnectionState === 'failed' || correctedConnectionState === 'disconnected'\n        }\">{{ correctedConnectionState }}</span>\n        \n        <span>Stream:</span>\n        <span :class=\"{'text-green-400': hasRemoteStream, 'text-red-400': !hasRemoteStream}\">\n          {{ hasRemoteStream ? 'Available' : 'Not Available' }}\n        </span>\n        \n        <span>Tracks:</span>\n        <span>{{ tracksCount }}</span>\n      </div>\n      <div class=\"mt-2 flex justify-between\">\n        <button @click=\"checkAudioTracks\" class=\"text-xs bg-purple-700 hover:bg-purple-600 text-white px-2 py-1 rounded-full\">\n          Debug\n        </button>\n        <button @click=\"forceTryPlayAudio\" class=\"text-xs bg-blue-600 hover:bg-blue-500 text-white px-2 py-1 rounded-full\">\n          Play Audio\n        </button>\n        <button @click=\"forceReconnectStream\" class=\"text-xs bg-green-600 hover:bg-green-500 text-white px-2 py-1 rounded-full\">\n          Reconnect\n      </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onBeforeUnmount, watch, computed } from 'vue';\nimport { useWebRTC } from '@/services/webrtc';\n\n// Debug flag\nconst DEBUG = false; // Change to false for production\n\nconst props = defineProps({\n  showControls: {\n    type: Boolean,\n    default: true\n  }\n});\n\nconst { remoteStream, connectionState, partnerId, isAudioMuted } = useWebRTC();\nconst audioElement = ref<HTMLAudioElement | null>(null);\nconst volume = ref(0.8); // Default volume\nconst isPlaying = ref(false);\nconst reconnectAttempts = ref(0);\nconst maxReconnectAttempts = 10; // Increased number of attempts\n\n// Check if we have a remote stream\nconst hasRemoteStream = computed(() => {\n  const streamExists = remoteStream.value !== null;\n  // Use a safe method to check for tracks\n  const hasTracks = streamExists && remoteStream.value ? remoteStream.value.getAudioTracks().length > 0 : false;\n  const hasEnabledTracks = hasTracks && remoteStream.value ? remoteStream.value.getAudioTracks().some(track => track.enabled) : false;\n  \n  // Diagnostic log\n  if (DEBUG && streamExists && remoteStream.value) {\n    console.log(`[AudioOutput] Stream status: tracks=${remoteStream.value.getAudioTracks().length}, enabled=${hasEnabledTracks}`);\n  }\n  \n  return hasEnabledTracks;\n});\n\n// Get track count for display - shows only active tracks\nconst tracksCount = computed(() => {\n  if (!remoteStream.value) return 0;\n  \n  // Count only active tracks\n  return remoteStream.value.getAudioTracks().filter(track => \n    track.enabled && track.readyState === 'live'\n  ).length;\n});\n\n// Corrected connection state based on actual audio status\nconst correctedConnectionState = computed(() => {\n  // If audio is playing, the connection must be \"connected\" regardless of the official state\n  if (isPlaying.value && hasRemoteStream.value) {\n    return 'connected';\n  }\n  \n  // If the official connection state is \"connected\" but no audio, there's a problem\n  if (connectionState.value === 'connected' && !hasRemoteStream.value && !isPlaying.value) {\n    // Try reconnecting audio after a short delay\n    setTimeout(connectAudioStream, 500);\n  }\n  \n  return connectionState.value;\n});\n\n// Watch for changes to the remote stream\nwatch(() => remoteStream.value, (newStream) => {\n  if (DEBUG) {\n    console.log('[AudioOutput] Remote stream changed:', newStream ? 'Stream available' : 'No stream');\n    if (newStream) {\n      const tracks = newStream.getTracks();\n      console.log(`[AudioOutput] Remote stream has ${tracks.length} tracks`);\n      tracks.forEach(track => {\n        console.log(`[AudioOutput] Track: ${track.kind}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n      });\n    }\n  }\n  \n  // When we get a new stream, connect it immediately\n  connectAudioStream();\n  \n  // Reset reconnect attempts when stream changes\n  reconnectAttempts.value = 0;\n  \n  // Try to play immediately\n  setTimeout(tryPlayAudio, 500);\n});\n\n// Watch mute state to ensure it's respected\nwatch(() => isAudioMuted.value, (muted) => {\n  if (DEBUG) console.log(`[AudioOutput] Audio mute state changed to: ${muted}`);\n  \n  // Ensure audio plays when unmuting if we have a stream\n  if (!muted && remoteStream.value && audioElement.value) {\n    setTimeout(() => {\n      if (audioElement.value && audioElement.value.paused) {\n        audioElement.value.play().catch(err => {\n          if (DEBUG) console.warn('[AudioOutput] Could not auto-play after unmute:', err);\n        });\n      }\n    }, 300);\n  }\n});\n\n// Watch connection state\nwatch(() => connectionState.value, (newState) => {\n  if (DEBUG) console.log(`[AudioOutput] WebRTC connection state changed to: ${newState}`);\n  \n  if (newState === 'connected') {\n    // Try to play the audio when connection is established\n    setTimeout(() => {\n      connectAudioStream();\n      tryPlayAudio();\n    }, 1000);\n  } else if (newState === 'new' || newState === 'connecting') {\n    // Connection is being established\n    reconnectAttempts.value = 0;\n  } else if (newState === 'disconnected' || newState === 'failed') {\n    // Connection was lost - try reconnecting\n    reconnectStream();\n  }\n});\n\n// Watch for partner ID changes to reset state\nwatch(() => partnerId.value, (newPartnerId) => {\n  if (DEBUG) console.log(`[AudioOutput] Partner ID changed: ${newPartnerId}`);\n  \n  // Reset status when partner changes\n  isPlaying.value = false;\n  reconnectAttempts.value = 0;\n  \n  if (!newPartnerId) {\n    // No partner, stop audio\n    if (audioElement.value) {\n      audioElement.value.srcObject = null;\n    }\n  }\n});\n\nonMounted(() => {\n  if (DEBUG) console.log('[AudioOutput] Component mounted');\n  connectAudioStream();\n  \n  // Set up audio play monitoring\n  if (audioElement.value) {\n    audioElement.value.onplaying = () => {\n      if (DEBUG) console.log('[AudioOutput] Audio started playing');\n      isPlaying.value = true;\n    };\n    \n    audioElement.value.onpause = () => {\n      if (DEBUG) console.log('[AudioOutput] Audio paused');\n      isPlaying.value = false;\n    };\n    \n    audioElement.value.onended = () => {\n      if (DEBUG) console.log('[AudioOutput] Audio ended');\n      isPlaying.value = false;\n    };\n    \n    audioElement.value.onerror = (e) => {\n      console.error('[AudioOutput] Audio error:', e);\n      isPlaying.value = false;\n    };\n    \n    // Set initial volume\n    audioElement.value.volume = volume.value;\n  }\n  \n  // Add visibility change listener to handle page visibility changes\n  document.addEventListener('visibilitychange', handleVisibilityChange);\n  \n  // Start checking for audio every 5 seconds\n  startAudioCheck();\n});\n\nonBeforeUnmount(() => {\n  if (DEBUG) console.log('[AudioOutput] Component unmounting, cleaning up');\n  \n  // Clean up resources\n  if (audioElement.value) {\n    audioElement.value.srcObject = null;\n  }\n  \n  // Remove event listeners\n  document.removeEventListener('visibilitychange', handleVisibilityChange);\n  \n  // Clear any intervals\n  stopAudioCheck();\n});\n\n// Start periodic checks for audio\nlet audioCheckInterval: number | null = null;\nfunction startAudioCheck() {\n  stopAudioCheck(); // Clear any existing interval\n  \n  audioCheckInterval = window.setInterval(() => {\n    if (!isPlaying.value && hasRemoteStream.value && connectionState.value === 'connected') {\n      if (DEBUG) console.log('[AudioOutput] Periodic check: Audio not playing, trying to reconnect');\n      connectAudioStream();\n      tryPlayAudio();\n    }\n  }, 5000) as unknown as number;\n}\n\nfunction stopAudioCheck() {\n  if (audioCheckInterval) {\n    clearInterval(audioCheckInterval);\n    audioCheckInterval = null;\n  }\n}\n\n// Handle visibility change (when user switches tabs)\nfunction handleVisibilityChange() {\n  if (document.visibilityState === 'visible') {\n    if (DEBUG) console.log('[AudioOutput] Page became visible, trying to reconnect audio');\n    // Try to reconnect audio when page becomes visible again\n    connectAudioStream();\n    setTimeout(() => {\n      if (!isPlaying.value && hasRemoteStream.value) {\n        tryPlayAudio();\n      }\n    }, 500);\n  }\n}\n\n// Connect the audio stream to the audio element\nfunction connectAudioStream() {\n  if (!audioElement.value) {\n    if (DEBUG) console.log('[AudioOutput] No audio element ref available');\n    return;\n  }\n  \n  if (remoteStream.value) {\n    if (DEBUG) {\n      const audioTracks = remoteStream.value.getAudioTracks();\n      console.log(`[AudioOutput] Connecting remote stream with ${audioTracks.length} audio tracks`);\n      \n      audioTracks.forEach(track => {\n        console.log(`[AudioOutput] Audio track: ${track.label}, enabled: ${track.enabled}, readyState: ${track.readyState}`);\n      });\n    }\n    \n    // Always set the stream to ensure it's connected properly\n    audioElement.value.srcObject = remoteStream.value;\n    \n    // Make sure tracks are enabled\n    remoteStream.value.getAudioTracks().forEach(track => {\n      track.enabled = true;\n    });\n    \n    // Try to play the audio\n    tryPlayAudio();\n  } else {\n    if (DEBUG) console.log('[AudioOutput] No remote stream to connect');\n    audioElement.value.srcObject = null;\n    isPlaying.value = false;\n  }\n}\n\n// Try to play audio with retry logic\nasync function tryPlayAudio() {\n  if (!audioElement.value || !audioElement.value.srcObject) {\n    if (DEBUG) console.log('[AudioOutput] Cannot play: no audio element or srcObject');\n    return;\n  }\n  \n  try {\n    if (DEBUG) console.log(`[AudioOutput] Attempting to play audio (attempt ${reconnectAttempts.value + 1})`);\n    \n    // Check if we have audio tracks and they're enabled\n    const hasTracks = remoteStream.value && remoteStream.value.getAudioTracks().length > 0;\n    if (!hasTracks) {\n      if (DEBUG) console.log('[AudioOutput] No audio tracks available in remote stream');\n    }\n    \n    // Try to play\n    await audioElement.value.play();\n    \n    isPlaying.value = true;\n    reconnectAttempts.value = 0;\n    if (DEBUG) console.log('[AudioOutput] Audio playing successfully');\n  } catch (error) {\n    console.error('[AudioOutput] Error playing audio:', error);\n    isPlaying.value = false;\n    \n    // Check if this is a user interaction error\n    if (error instanceof DOMException && error.name === 'NotAllowedError') {\n      console.warn('[AudioOutput] Audio play was blocked by browser policy, user interaction needed');\n    }\n    \n    // Retry automatically with increasing delay if not manually triggered\n    if (reconnectAttempts.value < maxReconnectAttempts) {\n      reconnectAttempts.value++;\n      const delay = reconnectAttempts.value * 1000; // Increasing delay\n      \n      if (DEBUG) console.log(`[AudioOutput] Will retry playing in ${delay}ms`);\n      setTimeout(tryPlayAudio, delay);\n    } else {\n      console.warn('[AudioOutput] Max retry attempts reached, manual play required');\n    }\n  }\n}\n\n// Function to explicitly reconnect stream\nfunction reconnectStream() {\n  reconnectAttempts.value = 0;\n  if (DEBUG) console.log('[AudioOutput] Manual reconnect requested');\n  \n  if (audioElement.value) {\n    audioElement.value.srcObject = null;\n  }\n  \n  setTimeout(() => {\n    connectAudioStream();\n    tryPlayAudio();\n  }, 500);\n}\n\n// Update audio volume\nfunction updateVolume() {\n  if (audioElement.value) {\n    audioElement.value.volume = volume.value;\n    if (DEBUG) console.log(`[AudioOutput] Volume set to ${volume.value}`);\n  }\n}\n\n// New function to check audio tracks\nfunction checkAudioTracks() {\n  if (remoteStream.value) {\n    const tracks = remoteStream.value.getAudioTracks();\n    console.log(`[AudioOutput] Remote stream has ${tracks.length} audio tracks`);\n    tracks.forEach(track => {\n      console.log(`[AudioOutput] Track: ${track.kind}, enabled: ${track.enabled}, muted: ${track.muted}, readyState: ${track.readyState}`);\n    });\n  }\n}\n\n// Force reconnect with reset state\nfunction forceReconnectStream() {\n  reconnectAttempts.value = 0;\n  if (DEBUG) console.log('[AudioOutput] Manual reconnect requested');\n  \n  if (audioElement.value) {\n    audioElement.value.srcObject = null;\n  }\n  \n  setTimeout(() => {\n    connectAudioStream();\n    tryPlayAudio();\n  }, 500);\n}\n\n// Force try play audio\nfunction forceTryPlayAudio() {\n  if (DEBUG) console.log('[AudioOutput] Manual play requested');\n  // Reset playing state\n  isPlaying.value = false;\n  \n  // Try to play with user interaction\n  setTimeout(() => {\n    tryPlayAudio();\n  }, 100);\n}\n</script>\n\n<style scoped>\n.audio-controls {\n  transition: all 0.3s ease;\n}\n\n.animate-pulse {\n  animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n/* Style the range input (volume slider) */\ninput[type=\"range\"]::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  appearance: none;\n  width: 12px;\n  height: 12px;\n  background: #fff;\n  border-radius: 50%;\n  cursor: pointer;\n}\n\ninput[type=\"range\"]::-moz-range-thumb {\n  width: 12px;\n  height: 12px;\n  background: #fff;\n  border-radius: 50%;\n  cursor: pointer;\n}\n\n.hidden {\n  display: none;\n}\n</style> ","<template>\n  <div class=\"min-h-screen font-sans\">\n    <!-- Purple glow effects -->\n    <div class=\"fixed inset-0 pointer-events-none\">\n      <div class=\"absolute top-1/4 left-1/4 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl animate-pulse\"></div>\n      <div class=\"absolute top-1/3 right-1/3 w-24 h-24 bg-violet-500/20 rounded-full blur-2xl animate-pulse delay-1000\"></div>\n      <div class=\"absolute bottom-1/4 left-1/3 w-28 h-28 bg-indigo-500/20 rounded-full blur-3xl animate-pulse delay-2000\"></div>\n      <div class=\"absolute top-1/2 right-1/4 w-20 h-20 bg-fuchsia-500/20 rounded-full blur-2xl animate-pulse delay-500\"></div>\n    </div>\n    \n    <Starfield />\n    \n    <div class=\"relative min-h-screen z-10 text-white\">\n      <!-- Header -->\n      <header class=\"p-4 border-b border-white/10\">\n        <div class=\"max-w-4xl mx-auto\">\n          <!-- Logo -->\n          <div class=\"text-center mb-4\">\n            <div class=\"inline-flex items-center gap-2\">\n              <div class=\"w-6 h-6 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center shadow-lg shadow-cyan-500/50\">\n                <span class=\"text-white text-xs\">âœ¨</span>\n              </div>\n              <h1 class=\"text-lg font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent drop-shadow-lg\">\n                SpaceTalk.live\n              </h1>\n            </div>\n          </div>\n\n          <!-- Statistics -->\n          <div class=\"flex justify-center gap-2 mb-3\">\n            <div class=\"bg-green-500/20 rounded-full px-2 py-1 text-xs flex items-center gap-1\">\n              <div class=\"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse\"></div>\n              <span>{{ onlineCount }} online</span>\n            </div>\n            <div v-if=\"dailyConnections > 0\" class=\"bg-purple-500/20 rounded-full px-2 py-1 text-xs\">\n              Today: {{ dailyConnections }} voices\n            </div>\n          </div>\n\n          <!-- Vibe Selector -->\n          <div class=\"grid grid-cols-2 gap-2 text-xs relative\">\n            <div class=\"relative\" ref=\"vibeDropdownRef\">\n              <div @click=\"toggleVibeDropdown\" class=\"cursor-pointer bg-purple-500/20 border border-purple-500/30 rounded-full h-8 flex items-center justify-between px-3 text-xs shadow-lg shadow-purple-500/20 text-white hover:bg-purple-500/30 active:scale-95 transition-all duration-150\">\n                <span class=\"flex items-center\">\n                  {{ getVibeEmoji(selectedVibe) }} {{ getVibeText(selectedVibe) }}\n                </span>\n                <span class=\"ml-2 text-xs transition-transform duration-300\" :class=\"{ 'rotate-180': showVibeDropdown }\">â–¼</span>\n              </div>\n              \n              <!-- Dropdown -->\n              <div v-if=\"showVibeDropdown\" class=\"absolute top-full left-0 mt-1 w-full bg-gray-800/95 backdrop-blur-md border border-gray-700 rounded-xl shadow-xl z-20 overflow-hidden transition-all duration-200 animate-dropdown\">\n                <div class=\"py-1\">\n                  <div\n                    v-for=\"vibe in vibes\" \n                    :key=\"vibe.value\"\n                    @click=\"selectVibe(vibe.value)\"\n                    class=\"px-3 py-2 hover:bg-gray-700/80 cursor-pointer transition-colors flex items-center gap-2\"\n                    :class=\"{'bg-gray-700/70': selectedVibe === vibe.value}\"\n                  >\n                    <span class=\"text-sm\">{{ vibe.emoji }}</span>\n                    <span>{{ vibe.text }}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            <button\n              @click=\"isFiltersOpen = true\"\n              class=\"bg-violet-500/20 border border-violet-500/30 rounded-full h-8 px-3 text-xs hover:bg-violet-500/30 active:scale-95 transition-all duration-150 shadow-lg shadow-violet-500/20\"\n            >\n              ğŸ” Filters\n            </button>\n          </div>\n        </div>\n      </header>\n\n      <!-- Main Content Area -->\n      <main class=\"flex-1 p-4\">\n        <div class=\"max-w-md mx-auto space-y-6\">\n          <!-- Connection Status Card -->\n          <connection-card \n            :status=\"connectionStatus\" \n            :partner-info=\"partnerInfo\" \n            :error-message=\"connectionError\"\n            :show-status=\"true\"\n          />\n\n          <!-- Auto-reconnect option -->\n          <div class=\"flex items-center justify-center gap-2 mb-4\">\n            <input\n              type=\"checkbox\"\n              id=\"auto-reconnect\"\n              v-model=\"autoReconnect\"\n              class=\"w-3 h-3 rounded border-gray-600 bg-gray-700 text-emerald-500 focus:ring-emerald-500 focus:ring-1\"\n            />\n            <label for=\"auto-reconnect\" class=\"text-xs text-gray-400 cursor-pointer\">\n              Auto-reconnect to others\n            </label>\n          </div>\n\n          <!-- Control Buttons -->\n          <control-buttons\n            :is-muted=\"isMuted\"\n            :is-disabled=\"connectionStatus !== 'connected'\"\n            @toggle-mute=\"toggleMute\"\n            @find-next=\"findNext\"\n            @toggle-chat=\"toggleChat\"\n            @toggle-games=\"isGamesOpen = true\"\n            @toggle-history=\"isHistoryOpen = true\"\n            @toggle-donation=\"isDonationOpen = true\"\n          />\n\n          <!-- Quote -->\n          <div class=\"text-center\">\n            <p class=\"text-xs text-gray-400 italic\">\"{{ currentQuote }}\"</p>\n          </div>\n        </div>\n      </main>\n\n      <!-- Guidelines Section -->\n      <footer class=\"p-4 border-t border-white/10\">\n        <div class=\"max-w-md mx-auto text-center space-y-2\">\n          <h3 class=\"text-sm font-semibold text-emerald-400\">Community Guidelines</h3>\n          <div class=\"text-xs text-gray-300 space-y-1\">\n            <p>â€¢ Must be 18+ years old to use this service</p>\n            <p>â€¢ Be respectful and kind to other users</p>\n            <p>â€¢ No harassment, hate speech, or inappropriate content</p>\n            <p>â€¢ Report any misconduct using the report feature</p>\n            <p>â€¢ Your privacy and safety are our priority</p>\n          </div>\n          <p class=\"text-xs text-gray-400 mt-3\">\n            By using SpaceTalk.live, you agree to follow these guidelines\n          </p>\n          \n          <!-- Links Section -->\n          <div class=\"flex justify-center gap-3 mt-4 text-xs\">\n            <a href=\"#\" class=\"bg-cyan-500/20 border border-cyan-500/30 rounded-full px-3 py-1.5 text-cyan-300 hover:text-cyan-200 hover:bg-cyan-500/30 transition-all shadow-lg shadow-cyan-500/20\">\n              â„¹ï¸ About\n            </a>\n            <a href=\"https://instagram.com\" target=\"_blank\" class=\"bg-pink-500/20 border border-pink-500/30 rounded-full px-3 py-1.5 text-pink-300 hover:text-pink-200 hover:bg-pink-500/30 transition-all shadow-lg shadow-pink-500/20\">\n              ğŸ“· Instagram\n            </a>\n            <a href=\"https://facebook.com\" target=\"_blank\" class=\"bg-blue-500/20 border border-blue-500/30 rounded-full px-3 py-1.5 text-blue-300 hover:text-blue-200 hover:bg-blue-500/30 transition-all shadow-lg shadow-blue-500/20\">\n              ğŸ“˜ Facebook\n            </a>\n            <a href=\"mailto:contact@spacetalk.live\" class=\"bg-emerald-500/20 border border-emerald-500/30 rounded-full px-3 py-1.5 text-emerald-300 hover:text-emerald-200 hover:bg-emerald-500/30 transition-all shadow-lg shadow-emerald-500/20\">\n              ğŸ“§ Contact\n            </a>\n          </div>\n        </div>\n      </footer>\n    </div>\n\n    <!-- Call History Modal -->\n    <div v-if=\"isHistoryOpen\" class=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <div class=\"bg-gray-800 rounded-2xl p-6 w-full max-w-sm\">\n        <div class=\"flex justify-between items-center mb-4\">\n          <h2 class=\"text-lg font-semibold text-indigo-400\">ğŸ“ Call History</h2>\n          <button\n            @click=\"isHistoryOpen = false\"\n            class=\"text-gray-400 hover:text-white text-xl\"\n          >\n            âœ•\n          </button>\n        </div>\n\n        <div class=\"space-y-3\">\n          <div v-if=\"callHistory.length === 0\" class=\"text-center py-8\">\n            <p class=\"text-gray-400 text-sm\">No recent calls</p>\n            <p class=\"text-xs text-gray-500 mt-1\">Your last 3 conversations will appear here</p>\n          </div>\n          \n          <div\n            v-else\n            v-for=\"(call, index) in callHistory\"\n            :key=\"call.id\"\n            class=\"bg-gray-700 rounded-lg p-3 flex items-center justify-between hover:bg-gray-600 transition-colors\"\n          >\n            <div class=\"flex items-center gap-3\">\n              <span class=\"text-2xl\">{{ call.flag }}</span>\n              <div>\n                <p class=\"text-white text-sm font-medium\">{{ call.country }}</p>\n                <p class=\"text-gray-400 text-xs\">\n                  {{ formatTime(call.timestamp) }}\n                </p>\n              </div>\n            </div>\n            <div class=\"text-xs text-gray-500\">\n              #{{ index + 1 }}\n            </div>\n          </div>\n        </div>\n\n        <p v-if=\"callHistory.length > 0\" class=\"text-xs text-gray-500 text-center mt-4\">\n          History clears when you leave the page\n        </p>\n      </div>\n    </div>\n\n    <!-- Filters Modal -->\n    <div v-if=\"isFiltersOpen\" class=\"fixed inset-0 bg-black/50 flex items-center justify-center z-20 p-4\">\n      <div class=\"bg-gray-800 rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto relative\">\n        <div class=\"flex justify-between items-center mb-6\">\n          <h2 class=\"text-lg font-semibold text-emerald-400\">Filters & Preferences</h2>\n          <button\n            @click=\"isFiltersOpen = false\"\n            class=\"text-gray-400 hover:text-white text-xl\"\n          >\n            âœ•\n          </button>\n        </div>\n\n        <div class=\"space-y-6\">\n          <!-- Preferred Countries -->\n          <div>\n            <label class=\"block text-sm font-medium mb-3 text-emerald-400\">Preferred Countries</label>\n            <div class=\"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide\">\n              <p v-if=\"preferredCountries.length === 0\" class=\"text-xs text-gray-400 p-2\">No countries selected</p>\n              <div v-else class=\"flex flex-wrap gap-2\">\n                <span \n                  v-for=\"countryCode in preferredCountries\" \n                  :key=\"countryCode\"\n                  class=\"bg-emerald-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1\"\n                >\n                  <span class=\"flag-icon\">{{ getCountryFlag(countryCode) }}</span> {{ getCountryName(countryCode) }}\n                  <button\n                    @click=\"removePreferredCountry(countryCode)\"\n                    class=\"text-emerald-200 hover:text-white ml-1\"\n                  >\n                    âœ•\n                  </button>\n                </span>\n              </div>\n            </div>\n            \n            <div class=\"mt-2 relative preferred-dropdown\" ref=\"preferredDropdownRef\">\n              <div @click=\"togglePreferredDropdown\" class=\"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white\">\n                <span class=\"text-gray-300\">Add preferred country...</span>\n                <span class=\"ml-1\">â–¼</span>\n              </div>\n            </div>\n            <p class=\"text-xs text-gray-400 mt-2\">You'll be matched only with users from these countries</p>\n          </div>\n\n          <!-- Blocked Countries -->\n          <div>\n            <label class=\"block text-sm font-medium mb-3 text-red-400\">Blocked Countries</label>\n            <div class=\"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide\">\n              <p v-if=\"blockedCountries.length === 0\" class=\"text-xs text-gray-400 p-2\">No countries blocked</p>\n              <div v-else class=\"flex flex-wrap gap-2\">\n                <span \n                  v-for=\"countryCode in blockedCountries\" \n                  :key=\"countryCode\"\n                  class=\"bg-red-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1\"\n                >\n                  <span class=\"flag-icon\">{{ getCountryFlag(countryCode) }}</span> {{ getCountryName(countryCode) }}\n                  <button\n                    @click=\"removeBlockedCountry(countryCode)\"\n                    class=\"text-red-200 hover:text-white ml-1\"\n                  >\n                    âœ•\n                  </button>\n                </span>\n              </div>\n            </div>\n            \n            <div class=\"mt-2 relative blocked-dropdown\" ref=\"blockedDropdownRef\">\n              <div @click=\"toggleBlockedDropdown\" class=\"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white\">\n                <span class=\"text-gray-300\">Add blocked country...</span>\n                <span class=\"ml-1\">â–¼</span>\n              </div>\n            </div>\n            <p class=\"text-xs text-gray-400 mt-2\">You won't be matched with users from these countries</p>\n          </div>\n        </div>\n        \n        <div class=\"flex gap-2 mt-8\">\n          <button\n            @click=\"clearFilters\"\n            class=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg text-sm transition-colors\"\n          >\n            Clear All\n          </button>\n          <button\n            @click=\"applyFilters\"\n            class=\"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-lg text-sm transition-colors\"\n          >\n            Apply Filters\n          </button>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Dropdown lists outside the filters modal -->\n    <div v-if=\"showPreferredDropdown\" class=\"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer preferred-outer\">\n      <div class=\"py-1 w-full\">\n        <div v-if=\"availableCountriesForPreferred.length === 0\" class=\"text-xs text-gray-400 px-3 py-2\">No more countries available</div>\n        <div \n          v-for=\"country in availableCountriesForPreferred\" \n          :key=\"country.value\"\n          @click=\"() => { addPreferredCountry(country.value); togglePreferredDropdown(); }\"\n          class=\"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2\"\n        >\n          <span class=\"flag-icon w-6 text-center\">{{ country.flag }}</span>\n          <span class=\"text-sm\">{{ country.name }}</span>\n        </div>\n      </div>\n    </div>\n    \n    <div v-if=\"showBlockedDropdown\" class=\"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer blocked-outer\">\n      <div class=\"py-1 w-full\">\n        <div v-if=\"availableCountriesForBlocked.length === 0\" class=\"text-xs text-gray-400 px-3 py-2\">No more countries available</div>\n        <div \n          v-for=\"country in availableCountriesForBlocked\" \n          :key=\"country.value\"\n          @click=\"() => { addBlockedCountry(country.value); toggleBlockedDropdown(); }\"\n          class=\"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2\"\n        >\n          <span class=\"flag-icon w-6 text-center\">{{ country.flag }}</span>\n          <span class=\"text-sm\">{{ country.name }}</span>\n        </div>\n      </div>\n    </div>\n\n    <!-- Modals -->\n    <chat-modal\n      :is-open=\"isChatOpen\"\n      @close=\"isChatOpen = false\"\n      :messages=\"chatMessages\"\n      @send-message=\"sendChatMessage\"\n      :is-connected=\"connectionStatus === 'connected'\"\n    />\n    \n    <games-modal\n      :is-open=\"isGamesOpen\"\n      @close=\"isGamesOpen = false\"\n      :is-connected=\"connectionStatus === 'connected'\"\n      @select-game=\"selectGame\"\n      :partner-id=\"partnerId || ''\"\n      :initial-game-room-id=\"gameRoomId\"\n    />\n    \n    <donation-modal\n      :is-open=\"isDonationOpen\"\n      @close=\"isDonationOpen = false\"\n    />\n    \n    <!-- Audio component integrated with controls but not directly visible -->\n    <div class=\"hidden\" v-if=\"connectionStatus === 'connected'\">\n      <AudioOutput :showControls=\"false\" />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onBeforeUnmount, computed, watch, nextTick } from 'vue';\nimport { useSocket } from '@/services/socket';\nimport { useWebRTC } from '@/services/webrtc';\nimport { useChat } from '@/services/chat';\nimport { useRoute } from 'vue-router';\n\n// Components\nimport ConnectionCard from '@/components/connection-card.vue';\nimport ControlButtons from '@/components/control-buttons.vue';\nimport ChatModal from '@/components/chat-modal.vue';\nimport GamesModal from '@/components/games-modal.vue';\nimport DonationModal from '@/components/donation-modal.vue';\nimport SelectVue from '@/components/ui/select.vue';\nimport Starfield from '@/components/starfield.vue';\nimport AudioOutput from '@/components/audio/AudioOutput.vue';\n\n// State management\nconst connectionStatus = ref<string>('disconnected'); // disconnected, searching, matched, connected\nconst partnerId = ref<string | null>(null);\nconst partnerInfo = ref<any>(null);\nconst connectionError = ref<string>(''); // Add variable for error messages\nconst isMuted = ref(false);\nlet connectionCheckInterval: ReturnType<typeof setInterval> | null = null; // Add interval for checking connection status\n\n// UI state\nconst isChatOpen = ref(false);\nconst isGamesOpen = ref(false);\nconst isDonationOpen = ref(false);\nconst isHistoryOpen = ref(false);\nconst isFiltersOpen = ref(false);\nconst onlineCount = ref(0);\nconst dailyConnections = ref(0);\nconst autoReconnect = ref(false);\nconst chatMessages = ref<Array<{id: string; message: string; isOwn: boolean; timestamp: number}>>([]);\nconst callHistory = ref<Array<{id: string; country: string; flag: string; timestamp: number}>>([]);\n\n// Filter options\nconst selectedVibe = ref('any');\nconst showVibeDropdown = ref(false);\nconst preferredCountries = ref<string[]>([]);\nconst blockedCountries = ref<string[]>([]);\nconst tempCountrySelect = ref('');\nconst tempBlockedSelect = ref('');\nconst showPreferredDropdown = ref(false);\nconst showBlockedDropdown = ref(false);\n\n// Vibes options\nconst vibes = [\n  { value: 'any', text: 'Go With the Flow', emoji: 'ğŸŒŸ' },\n  { value: 'chill', text: 'Chill', emoji: 'ğŸ˜Œ' },\n  { value: 'fun', text: 'Fun', emoji: 'ğŸ‰' },\n  { value: 'curious', text: 'Curious', emoji: 'ğŸ¤”' },\n  { value: 'creative', text: 'Creative', emoji: 'ğŸ¨' }\n];\n\n// Temporary countries list until API is loaded\nconst countries = ref<any[]>([\n  { value: 'any', label: 'ğŸŒ Any Country', name: 'Any Country', flag: 'ğŸŒ' },\n  { value: 'ae', label: 'ğŸ‡¦ğŸ‡ª UAE', name: 'United Arab Emirates', flag: 'ğŸ‡¦ğŸ‡ª' },\n  { value: 'af', label: 'ğŸ‡¦ğŸ‡« Afghanistan', name: 'Afghanistan', flag: 'ğŸ‡¦ğŸ‡«' },\n  { value: 'al', label: 'ğŸ‡¦ğŸ‡± Albania', name: 'Albania', flag: 'ğŸ‡¦ğŸ‡±' },\n  { value: 'dz', label: 'ğŸ‡©ğŸ‡¿ Algeria', name: 'Algeria', flag: 'ğŸ‡©ğŸ‡¿' },\n  { value: 'ar', label: 'ğŸ‡¦ğŸ‡· Argentina', name: 'Argentina', flag: 'ğŸ‡¦ğŸ‡·' },\n  { value: 'au', label: 'ğŸ‡¦ğŸ‡º Australia', name: 'Australia', flag: 'ğŸ‡¦ğŸ‡º' },\n  { value: 'at', label: 'ğŸ‡¦ğŸ‡¹ Austria', name: 'Austria', flag: 'ğŸ‡¦ğŸ‡¹' },\n  { value: 'bh', label: 'ğŸ‡§ğŸ‡­ Bahrain', name: 'Bahrain', flag: 'ğŸ‡§ğŸ‡­' },\n  { value: 'bd', label: 'ğŸ‡§ğŸ‡© Bangladesh', name: 'Bangladesh', flag: 'ğŸ‡§ğŸ‡©' },\n  { value: 'be', label: 'ğŸ‡§ğŸ‡ª Belgium', name: 'Belgium', flag: 'ğŸ‡§ğŸ‡ª' },\n  { value: 'br', label: 'ğŸ‡§ğŸ‡· Brazil', name: 'Brazil', flag: 'ğŸ‡§ğŸ‡·' },\n  { value: 'ca', label: 'ğŸ‡¨ğŸ‡¦ Canada', name: 'Canada', flag: 'ğŸ‡¨ğŸ‡¦' },\n  { value: 'cn', label: 'ğŸ‡¨ğŸ‡³ China', name: 'China', flag: 'ğŸ‡¨ğŸ‡³' },\n  { value: 'dk', label: 'ğŸ‡©ğŸ‡° Denmark', name: 'Denmark', flag: 'ğŸ‡©ğŸ‡°' },\n  { value: 'eg', label: 'ğŸ‡ªğŸ‡¬ Egypt', name: 'Egypt', flag: 'ğŸ‡ªğŸ‡¬' },\n  { value: 'fi', label: 'ğŸ‡«ğŸ‡® Finland', name: 'Finland', flag: 'ğŸ‡«ğŸ‡®' },\n  { value: 'fr', label: 'ğŸ‡«ğŸ‡· France', name: 'France', flag: 'ğŸ‡«ğŸ‡·' },\n  { value: 'de', label: 'ğŸ‡©ğŸ‡ª Germany', name: 'Germany', flag: 'ğŸ‡©ğŸ‡ª' },\n  { value: 'gr', label: 'ğŸ‡¬ğŸ‡· Greece', name: 'Greece', flag: 'ğŸ‡¬ğŸ‡·' },\n  { value: 'hk', label: 'ğŸ‡­ğŸ‡° Hong Kong', name: 'Hong Kong', flag: 'ğŸ‡­ğŸ‡°' },\n  { value: 'hu', label: 'ğŸ‡­ğŸ‡º Hungary', name: 'Hungary', flag: 'ğŸ‡­ğŸ‡º' },\n  { value: 'in', label: 'ğŸ‡®ğŸ‡³ India', name: 'India', flag: 'ğŸ‡®ğŸ‡³' },\n  { value: 'id', label: 'ğŸ‡®ğŸ‡© Indonesia', name: 'Indonesia', flag: 'ğŸ‡®ğŸ‡©' },\n  { value: 'ir', label: 'ğŸ‡®ğŸ‡· Iran', name: 'Iran', flag: 'ğŸ‡®ğŸ‡·' },\n  { value: 'iq', label: 'ğŸ‡®ğŸ‡¶ Iraq', name: 'Iraq', flag: 'ğŸ‡®ğŸ‡¶' },\n  { value: 'ie', label: 'ğŸ‡®ğŸ‡ª Ireland', name: 'Ireland', flag: 'ğŸ‡®ğŸ‡ª' },\n  { value: 'it', label: 'ğŸ‡®ğŸ‡¹ Italy', name: 'Italy', flag: 'ğŸ‡®ğŸ‡¹' },\n  { value: 'jp', label: 'ğŸ‡¯ğŸ‡µ Japan', name: 'Japan', flag: 'ğŸ‡¯ğŸ‡µ' },\n  { value: 'jo', label: 'ğŸ‡¯ğŸ‡´ Jordan', name: 'Jordan', flag: 'ğŸ‡¯ğŸ‡´' },\n  { value: 'kz', label: 'ğŸ‡°ğŸ‡¿ Kazakhstan', name: 'Kazakhstan', flag: 'ğŸ‡°ğŸ‡¿' },\n  { value: 'kr', label: 'ğŸ‡°ğŸ‡· Korea', name: 'South Korea', flag: 'ğŸ‡°ğŸ‡·' },\n  { value: 'kw', label: 'ğŸ‡°ğŸ‡¼ Kuwait', name: 'Kuwait', flag: 'ğŸ‡°ğŸ‡¼' },\n  { value: 'lb', label: 'ğŸ‡±ğŸ‡§ Lebanon', name: 'Lebanon', flag: 'ğŸ‡±ğŸ‡§' },\n  { value: 'ly', label: 'ğŸ‡±ğŸ‡¾ Libya', name: 'Libya', flag: 'ğŸ‡±ğŸ‡¾' },\n  { value: 'my', label: 'ğŸ‡²ğŸ‡¾ Malaysia', name: 'Malaysia', flag: 'ğŸ‡²ğŸ‡¾' },\n  { value: 'mx', label: 'ğŸ‡²ğŸ‡½ Mexico', name: 'Mexico', flag: 'ğŸ‡²ğŸ‡½' },\n  { value: 'ma', label: 'ğŸ‡²ğŸ‡¦ Morocco', name: 'Morocco', flag: 'ğŸ‡²ğŸ‡¦' },\n  { value: 'nl', label: 'ğŸ‡³ğŸ‡± Netherlands', name: 'Netherlands', flag: 'ğŸ‡³ğŸ‡±' },\n  { value: 'nz', label: 'ğŸ‡³ğŸ‡¿ New Zealand', name: 'New Zealand', flag: 'ğŸ‡³ğŸ‡¿' },\n  { value: 'ng', label: 'ğŸ‡³ğŸ‡¬ Nigeria', name: 'Nigeria', flag: 'ğŸ‡³ğŸ‡¬' },\n  { value: 'no', label: 'ğŸ‡³ğŸ‡´ Norway', name: 'Norway', flag: 'ğŸ‡³ğŸ‡´' },\n  { value: 'om', label: 'ğŸ‡´ğŸ‡² Oman', name: 'Oman', flag: 'ğŸ‡´ğŸ‡²' },\n  { value: 'pk', label: 'ğŸ‡µğŸ‡° Pakistan', name: 'Pakistan', flag: 'ğŸ‡µğŸ‡°' },\n  { value: 'ps', label: 'ğŸ‡µğŸ‡¸ Palestine', name: 'Palestine', flag: 'ğŸ‡µğŸ‡¸' },\n  { value: 'ph', label: 'ğŸ‡µğŸ‡­ Philippines', name: 'Philippines', flag: 'ğŸ‡µğŸ‡­' },\n  { value: 'pl', label: 'ğŸ‡µğŸ‡± Poland', name: 'Poland', flag: 'ğŸ‡µğŸ‡±' },\n  { value: 'pt', label: 'ğŸ‡µğŸ‡¹ Portugal', name: 'Portugal', flag: 'ğŸ‡µğŸ‡¹' },\n  { value: 'qa', label: 'ğŸ‡¶ğŸ‡¦ Qatar', name: 'Qatar', flag: 'ğŸ‡¶ğŸ‡¦' },\n  { value: 'ro', label: 'ğŸ‡·ğŸ‡´ Romania', name: 'Romania', flag: 'ğŸ‡·ğŸ‡´' },\n  { value: 'ru', label: 'ğŸ‡·ğŸ‡º Russia', name: 'Russia', flag: 'ğŸ‡·ğŸ‡º' },\n  { value: 'sa', label: 'ğŸ‡¸ğŸ‡¦ Saudi Arabia', name: 'Saudi Arabia', flag: 'ğŸ‡¸ğŸ‡¦' },\n  { value: 'sg', label: 'ğŸ‡¸ğŸ‡¬ Singapore', name: 'Singapore', flag: 'ğŸ‡¸ğŸ‡¬' },\n  { value: 'za', label: 'ğŸ‡¿ğŸ‡¦ South Africa', name: 'South Africa', flag: 'ğŸ‡¿ğŸ‡¦' },\n  { value: 'es', label: 'ğŸ‡ªğŸ‡¸ Spain', name: 'Spain', flag: 'ğŸ‡ªğŸ‡¸' },\n  { value: 'sd', label: 'ğŸ‡¸ğŸ‡© Sudan', name: 'Sudan', flag: 'ğŸ‡¸ğŸ‡©' },\n  { value: 'se', label: 'ğŸ‡¸ğŸ‡ª Sweden', name: 'Sweden', flag: 'ğŸ‡¸ğŸ‡ª' },\n  { value: 'ch', label: 'ğŸ‡¨ğŸ‡­ Switzerland', name: 'Switzerland', flag: 'ğŸ‡¨ğŸ‡­' },\n  { value: 'sy', label: 'ğŸ‡¸ğŸ‡¾ Syria', name: 'Syria', flag: 'ğŸ‡¸ğŸ‡¾' },\n  { value: 'tw', label: 'ğŸ‡¹ğŸ‡¼ Taiwan', name: 'Taiwan', flag: 'ğŸ‡¹ğŸ‡¼' },\n  { value: 'th', label: 'ğŸ‡¹ğŸ‡­ Thailand', name: 'Thailand', flag: 'ğŸ‡¹ğŸ‡­' },\n  { value: 'tn', label: 'ğŸ‡¹ğŸ‡³ Tunisia', name: 'Tunisia', flag: 'ğŸ‡¹ğŸ‡³' },\n  { value: 'tr', label: 'ğŸ‡¹ğŸ‡· Turkey', name: 'Turkey', flag: 'ğŸ‡¹ğŸ‡·' },\n  { value: 'ua', label: 'ğŸ‡ºğŸ‡¦ Ukraine', name: 'Ukraine', flag: 'ğŸ‡ºğŸ‡¦' },\n  { value: 'gb', label: 'ğŸ‡¬ğŸ‡§ UK', name: 'United Kingdom', flag: 'ğŸ‡¬ğŸ‡§' },\n  { value: 'us', label: 'ğŸ‡ºğŸ‡¸ USA', name: 'United States', flag: 'ğŸ‡ºğŸ‡¸' },\n  { value: 'ye', label: 'ğŸ‡¾ğŸ‡ª Yemen', name: 'Yemen', flag: 'ğŸ‡¾ğŸ‡ª' }\n]);\n\n// Load all countries from API\nconst loadCountries = async () => {\n  try {\n    const response = await fetch('/api/countries');\n    if (!response.ok) {\n      throw new Error('Failed to load countries');\n    }\n    \n    let data = await response.json();\n    // Use static list if API fails\n    if (!data || data.length === 0) {\n      console.log('Using static countries list');\n      return;\n    }\n    \n    // Filter out Israel from the API results\n    data = data.filter((country: any) => country.value !== 'il');\n    \n    // Check if Palestine is in the list, add it if not\n    const hasPalestine = data.some((country: any) => country.value === 'ps');\n    if (!hasPalestine) {\n      data.push({ value: 'ps', label: 'ğŸ‡µğŸ‡¸ Palestine', name: 'Palestine', flag: 'ğŸ‡µğŸ‡¸' });\n    }\n    \n    // Make sure Egypt is in the list\n    const hasEgypt = data.some((country: any) => country.value === 'eg');\n    if (!hasEgypt) {\n      data.push({ value: 'eg', label: 'ğŸ‡ªğŸ‡¬ Egypt', name: 'Egypt', flag: 'ğŸ‡ªğŸ‡¬' });\n    }\n    \n    // Sort data alphabetically by name (after excluding 'any')\n    data.sort((a: any, b: any) => a.name.localeCompare(b.name));\n    \n    // Add \"any\" option to the beginning\n    countries.value = [\n      { value: 'any', label: 'ğŸŒ Any Country', name: 'Any Country', flag: 'ğŸŒ' },\n      ...data\n    ];\n    \n    console.log('Countries loaded:', countries.value.length);\n    console.log('Filtered out Israel and ensured Palestine and Egypt are included');\n  } catch (error) {\n    console.error('Failed to load countries list:', error);\n    // Static list is already loaded as fallback\n  }\n};\n\n// User's own country information\nconst userLocation = ref<{\n  country: string;\n  countryCode: string;\n  flag: string;\n} | null>(null);\n\n// Cosmic quotes\nconst cosmicQuotes = [\n  \"You're not alone in the universe.\",\n  \"Every voice carries a story from across the stars.\",\n  \"Connection transcends distance in the cosmic web.\",\n  \"Discover new worlds through conversation.\",\n  \"In space, every voice matters.\"\n];\nconst currentQuote = ref(cosmicQuotes[Math.floor(Math.random() * cosmicQuotes.length)]);\n\n// Initialize services\nconst socketService = useSocket();\nconst socket = socketService.socket;\nconst { isConnected } = socketService;\nconst { \n  remoteStream,\n  localStream,\n  connectionState: webRTCConnectionState,\n  createOffer, \n  handleOffer, \n  handleAnswer, \n  handleIceCandidate,\n  closeConnection,\n  toggleMicrophone,\n  initializeLocalStream\n} = useWebRTC();\nconst chat = useChat();\n\n// Extract route params\nconst route = useRoute();\nconst gameRoomId = ref(route.params.roomId as string || null);\n\n// If we came from a game link, automatically open the games modal\nwatch(() => gameRoomId.value, (newRoomId) => {\n  if (newRoomId) {\n    isGamesOpen.value = true;\n  }\n}, { immediate: true });\n\n// Computed properties for country selectors\nconst availableCountriesForPreferred = computed(() => {\n  // Show all countries when no preferred countries are selected\n  return countries.value.filter(c => \n    c.value !== 'any' && \n    !preferredCountries.value.includes(c.value) && \n    !blockedCountries.value.includes(c.value)\n  );\n});\n\nconst availableCountriesForBlocked = computed(() => {\n  // Show all countries when no blocked countries are selected\n  return countries.value.filter(c => \n    c.value !== 'any' && \n    !blockedCountries.value.includes(c.value) && \n    !preferredCountries.value.includes(c.value)\n  );\n});\n\n// Methods\nconst toggleMute = async () => {\n  const newValue = await toggleMicrophone();\n  if (isMuted.value !== !newValue) {\n    isMuted.value = !newValue;\n  }\n  \n  if (connectionStatus.value === 'connected') {\n    setTimeout(() => {\n      const audioElement = document.querySelector('audio');\n      if (audioElement && audioElement.paused) {\n        audioElement.play().catch(() => {});\n      }\n    }, 300);\n  }\n};\n\nconst findNext = async () => {\n  // If we don't have microphone access yet, request it\n  if (!localStream.value) {\n    try {\n      await initializeLocalStream();\n      console.log('Microphone initialized');\n    } catch (error) {\n      console.error('Failed to access microphone', error);\n      alert('Please allow microphone access to use voice chat');\n      return;\n    }\n  }\n  \n  // Handle next partner request\n  if (socket.value) {\n    // Show status of searching for a new partner\n    connectionStatus.value = 'searching';\n    \n    // If there's a current partner, disconnect from them first\n    if (partnerId.value) {\n      console.log('Disconnecting from current partner');\n      socket.value.emit('disconnect-partner');\n      partnerId.value = null;\n      partnerInfo.value = null;\n      chatMessages.value = [];\n      // Close current WebRTC connection\n      closeConnection();\n    }\n    \n    console.log('Finding new partner with preferences');\n    // Send request to join the waiting queue with user preferences\n    socket.value.emit('join-queue', {\n      vibe: selectedVibe.value,\n      preferences: {\n        preferredCountries: preferredCountries.value.length ? preferredCountries.value : undefined,\n        blockedCountries: blockedCountries.value.length ? blockedCountries.value : undefined\n      }\n    });\n    \n    dailyConnections.value++;\n  }\n};\n\nconst toggleChat = () => {\n  isChatOpen.value = !isChatOpen.value;\n  \n  // Mark messages as read when opening chat\n  if (isChatOpen.value && partnerId.value) {\n    chat.markAsRead(partnerId.value);\n  }\n};\n\nconst toggleGamesOpen = () => {\n  isGamesOpen.value = !isGamesOpen.value;\n};\n\nconst toggleDonationOpen = () => {\n  isDonationOpen.value = !isDonationOpen.value;\n};\n\nconst toggleHistoryOpen = () => {\n  isHistoryOpen.value = !isHistoryOpen.value;\n};\n\nconst toggleFiltersOpen = () => {\n  isFiltersOpen.value = !isFiltersOpen.value;\n};\n\nconst sendChatMessage = (message: string) => {\n  if (socket.value && partnerId.value) {\n    socket.value.emit('chat-message', { message, to: partnerId.value });\n    \n    chatMessages.value.push({\n      id: Date.now().toString(),\n      message,\n      isOwn: true,\n      timestamp: Date.now()\n    });\n  }\n};\n\nconst selectGame = (game: string) => {\n  console.log(`Selected game: ${game}`);\n  if (socket.value && partnerId.value) {\n    socket.value.emit('game-invite', { game, to: partnerId.value });\n  }\n};\n\n// Filter methods\nconst addPreferredCountry = (countryCode: string) => {\n  if (countryCode && !preferredCountries.value.includes(countryCode)) {\n    preferredCountries.value.push(countryCode);\n  }\n};\n\nconst removePreferredCountry = (countryCode: string) => {\n  preferredCountries.value = preferredCountries.value.filter(c => c !== countryCode);\n};\n\nconst addBlockedCountry = (countryCode: string) => {\n  if (countryCode && !blockedCountries.value.includes(countryCode)) {\n    blockedCountries.value.push(countryCode);\n    const countryName = getCountryName(countryCode);\n    console.log(`Added ${countryName} (${countryCode}) to blocked countries list`);\n    // Save immediately to persist changes\n    localStorage.setItem('blockedCountries', JSON.stringify(blockedCountries.value));\n  }\n};\n\nconst removeBlockedCountry = (countryCode: string) => {\n  blockedCountries.value = blockedCountries.value.filter(c => c !== countryCode);\n  const countryName = getCountryName(countryCode);\n  console.log(`Removed ${countryName} (${countryCode}) from blocked countries list`);\n  // Save immediately to persist changes\n  localStorage.setItem('blockedCountries', JSON.stringify(blockedCountries.value));\n};\n\nconst clearFilters = () => {\n  preferredCountries.value = [];\n  blockedCountries.value = [];\n  localStorage.removeItem('preferredCountries');\n  localStorage.removeItem('blockedCountries');\n};\n\nconst applyFilters = () => {\n  // Add diagnostic logs\n  console.log('Applying filters with the following settings:');\n  console.log('- Blocked countries:', blockedCountries.value.length ? blockedCountries.value : 'None');\n  console.log('- Preferred countries:', preferredCountries.value.length ? preferredCountries.value : 'None');\n  \n  isFiltersOpen.value = false;\n  saveFilterSettings();\n  restartMatching();\n};\n\n// Utility methods\nconst getCountryFlag = (countryCode: string): string => {\n  const country = countries.value.find(c => c.value === countryCode);\n  return country ? country.flag : 'ğŸ³ï¸';\n};\n\nconst getCountryName = (countryCode: string): string => {\n  const country = countries.value.find(c => c.value === countryCode);\n  return country ? country.name : 'Earth';\n};\n\nconst formatTime = (timestamp: number): string => {\n  return new Date(timestamp).toLocaleTimeString([], { \n    hour: '2-digit', \n    minute: '2-digit' \n  });\n};\n\n// Vibe selector functions\nconst toggleVibeDropdown = () => {\n  showVibeDropdown.value = !showVibeDropdown.value;\n};\n\nconst selectVibe = (value: string) => {\n  selectedVibe.value = value;\n  showVibeDropdown.value = false;\n};\n\nconst getVibeEmoji = (value: string) => {\n  const vibe = vibes.find(v => v.value === value);\n  return vibe ? vibe.emoji : 'ğŸŒŸ';\n};\n\nconst getVibeText = (value: string) => {\n  const vibe = vibes.find(v => v.value === value);\n  return vibe ? vibe.text : 'Go With the Flow';\n};\n\n// Toggle dropdown visibility\nconst preferredDropdownRef = ref<HTMLElement | null>(null);\nconst blockedDropdownRef = ref<HTMLElement | null>(null);\n\n// Update dropdown positions\nconst updateDropdownPosition = () => {\n  nextTick(() => {\n    const preferredDropdownRect = preferredDropdownRef.value?.getBoundingClientRect();\n    const blockedDropdownRect = blockedDropdownRef.value?.getBoundingClientRect();\n    \n    const preferredOuter = document.querySelector('.preferred-outer') as HTMLElement;\n    const blockedOuter = document.querySelector('.blocked-outer') as HTMLElement;\n    \n    if (preferredDropdownRect && preferredOuter) {\n      preferredOuter.style.left = `${preferredDropdownRect.left}px`;\n      preferredOuter.style.top = `${preferredDropdownRect.bottom + 5}px`;\n      preferredOuter.style.width = `${preferredDropdownRect.width}px`;\n    }\n    \n    if (blockedDropdownRect && blockedOuter) {\n      blockedOuter.style.left = `${blockedDropdownRect.left}px`;\n      blockedOuter.style.top = `${blockedDropdownRect.bottom + 5}px`;\n      blockedOuter.style.width = `${blockedDropdownRect.width}px`;\n    }\n  });\n};\n\nconst togglePreferredDropdown = () => {\n  showPreferredDropdown.value = !showPreferredDropdown.value;\n  if (showPreferredDropdown.value) {\n    showBlockedDropdown.value = false;\n    updateDropdownPosition();\n  }\n};\n\nconst toggleBlockedDropdown = () => {\n  showBlockedDropdown.value = !showBlockedDropdown.value;\n  if (showBlockedDropdown.value) {\n    showPreferredDropdown.value = false;\n    updateDropdownPosition();\n  }\n};\n\n// Save and load filter settings\nconst saveFilterSettings = () => {\n  // Save to localStorage for persistence\n  localStorage.setItem('preferredCountries', JSON.stringify(preferredCountries.value));\n  localStorage.setItem('blockedCountries', JSON.stringify(blockedCountries.value));\n};\n\nconst loadFilterSettings = () => {\n  try {\n    const savedPreferred = localStorage.getItem('preferredCountries');\n    const savedBlocked = localStorage.getItem('blockedCountries');\n    \n    if (savedPreferred) {\n      preferredCountries.value = JSON.parse(savedPreferred);\n    }\n    \n    if (savedBlocked) {\n      blockedCountries.value = JSON.parse(savedBlocked);\n    }\n  } catch (error) {\n    console.error('Error loading filter settings:', error);\n  }\n};\n\nconst restartMatching = () => {\n  if (socket.value && isConnected.value) {\n    console.log('Restarting matching with updated filters:', {\n      preferredCountries: preferredCountries.value,\n      blockedCountries: blockedCountries.value\n    });\n    \n    socket.value.emit('startMatching', {\n      preferredCountries: preferredCountries.value.length > 0 ? preferredCountries.value : null,\n      blockedCountries: blockedCountries.value // Always send this array, even if empty\n    });\n    \n    // Update UI to show searching state\n    connectionStatus.value = 'searching';\n    connectionError.value = '';\n  } else {\n    console.warn('Cannot restart matching - socket not connected');\n  }\n};\n\n// Watch connection status changes\nwatch(connectionStatus, (newStatus) => {\n  console.log(`Connection status changed to: ${newStatus}`);\n  \n  // Set up connection monitoring when connected\n  if (newStatus === 'connected') {\n    // Clear existing interval if any\n    if (connectionCheckInterval) {\n      clearInterval(connectionCheckInterval);\n    }\n    \n    // Create new interval that checks connection health\n    connectionCheckInterval = setInterval(() => {\n      // If we have a partner ID but no active WebRTC connection, something is wrong\n      if (partnerId.value && webRTCConnectionState.value !== 'connected') {\n        console.log('Connection health check: WebRTC not connected but partnerId exists');\n        \n        // Check how long the connection has been in a non-connected state\n        if (['failed', 'closed', 'disconnected'].includes(webRTCConnectionState.value)) {\n          console.log('Connection appears to be broken - resetting UI state');\n          connectionStatus.value = 'disconnected';\n          partnerId.value = null;\n          partnerInfo.value = null;\n        }\n      }\n    }, 2000); // Check every 2 seconds\n  } else if (newStatus === 'disconnected') {\n    // Clear the interval when disconnected\n    if (connectionCheckInterval) {\n      clearInterval(connectionCheckInterval);\n      connectionCheckInterval = null;\n    }\n  }\n});\n\n// Socket event setup\nonMounted(() => {\n  console.log('Home view mounted');\n  \n  // Load countries list\n  loadCountries();\n  \n  // Load saved preferences\n  try {\n    const savedPreferredCountries = localStorage.getItem('preferredCountries');\n    const savedBlockedCountries = localStorage.getItem('blockedCountries');\n    \n    if (savedPreferredCountries) {\n      preferredCountries.value = JSON.parse(savedPreferredCountries);\n    }\n    \n    if (savedBlockedCountries) {\n      blockedCountries.value = JSON.parse(savedBlockedCountries);\n    }\n  } catch (error) {\n    console.error('Error loading saved preferences:', error);\n  }\n  \n  // Set up socket.io event listeners\n  if (socket.value) {\n    // Add handler for filters-updated event\n    socket.value.on('filters-updated', (data: { success: boolean }) => {\n      if (data.success) {\n        console.log('Filters updated successfully on server');\n        // Toast notification could be added here\n      }\n    });\n\n    // Listen for user location data from server\n    socket.value.on('user-location', (locationData: any) => {\n      console.log('Received user location:', locationData);\n      \n      // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© ÙˆÙƒØ§Ù…Ù„Ø©\n      if (locationData && locationData.countryCode && locationData.country) {\n        userLocation.value = locationData;\n        \n        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù„Ø¯Ø§Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ Ø§Ø®ØªØ§Ø± Ø£ÙŠ Ø¨Ù„Ø¯\n        if (preferredCountries.value.length === 0 && locationData.countryCode !== 'unknown' && locationData.countryCode !== 'earth') {\n          console.log(`Adding user's country ${locationData.country} (${locationData.countryCode}) to preferred countries`);\n          preferredCountries.value.push(locationData.countryCode);\n          \n          // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\n          saveFilterSettings();\n        }\n        \n        // Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø¨Ù„Ø¯ Ø§Ù„Ù…ÙƒØªØ´Ù\n        console.log(`Your location: ${locationData.flag} ${locationData.country}`);\n      } else {\n        console.warn('Received incomplete location data:', locationData);\n      }\n    });\n\n    socket.value.on('online-count', (count: number) => {\n      onlineCount.value = count;\n    });\n    \n    socket.value.on('matched', (data: any) => {\n      console.log('Partner matched with event:', data);\n      \n      // Set the state to \"matched\" explicitly\n      connectionStatus.value = 'matched';\n      connectionError.value = ''; // Clear any previous error messages\n      \n      partnerId.value = data.partnerId;\n      partnerInfo.value = {\n        id: data.partnerId,\n        country: data.country || 'Earth',\n        countryCode: data.countryCode || 'unknown',\n        flag: data.flag || 'ğŸŒ',\n        vibe: data.vibe || 'any'\n      };\n      \n      // Add to call history\n      callHistory.value.unshift({\n        id: Date.now().toString(),\n        country: partnerInfo.value.country,\n        flag: partnerInfo.value.flag,\n        timestamp: Date.now()\n      });\n      \n      // Keep only last 3 entries\n      if (callHistory.value.length > 3) {\n        callHistory.value = callHistory.value.slice(0, 3);\n      }\n      \n      // Start WebRTC connection immediately without delay\n      if (data.partnerId) {\n        console.log('Initiating WebRTC connection with partner immediately');\n        const { createOffer } = useWebRTC();\n        createOffer(data.partnerId);\n        \n        // Make sure the state doesn't change to \"connected\" until audio is confirmed working\n        setTimeout(() => {\n          if (connectionStatus.value === 'matched' && webRTCConnectionState.value === 'connected') {\n            console.log('WebRTC connection established, updating UI state');\n            connectionStatus.value = 'connected';\n          }\n        }, 2000);\n      }\n    });\n\n    socket.value.on('direct-connection-established', (data: any) => {\n      console.log('Direct connection established:', data);\n      connectionStatus.value = 'connected';\n      partnerId.value = data.partnerId;\n              partnerInfo.value = {\n          id: data.partnerId,\n          country: data.country || 'Earth',\n          countryCode: data.countryCode || 'unknown',\n          flag: data.flag || 'ğŸŒ'\n        };\n    });\n    \n    socket.value.on('partner-disconnected', (data: any = {}) => {\n      console.log('Partner disconnected event received:', data);\n      \n      // Close WebRTC connection to ensure all media tracks are stopped\n      closeConnection();\n      \n      // Update UI state\n      connectionStatus.value = 'disconnected';\n      partnerId.value = null;\n      partnerInfo.value = null;\n      chatMessages.value = [];\n      \n      // Show a notification based on the reason for disconnection\n      let disconnectReason = '';\n      if (data && data.reason) {\n        switch (data.reason) {\n          case 'user-initiated':\n            disconnectReason = 'Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ø£Ù†Ù‡Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©';\n            break;\n          case 'connection-lost':\n            disconnectReason = 'Ø§Ù†Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±';\n            break;\n          default:\n            disconnectReason = 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©';\n        }\n        \n        // Display a temporary notification\n        connectionError.value = disconnectReason;\n        setTimeout(() => {\n          if (connectionError.value === disconnectReason) {\n            connectionError.value = '';\n          }\n        }, 5000);\n      }\n      \n      // If auto-reconnect is enabled, find a new partner\n      if (autoReconnect.value) {\n        setTimeout(() => {\n          if (connectionStatus.value === 'disconnected' && autoReconnect.value) {\n            findNext();\n          }\n        }, 2000);\n      }\n    });\n    \n    socket.value.on('chat-message', (data: any) => {\n      chatMessages.value.push({\n        id: Date.now().toString(),\n        message: data.message,\n        isOwn: false,\n        timestamp: Date.now()\n      });\n    });\n    \n    socket.value.on('error', (data: any) => {\n      console.error('Socket error:', data.message);\n      if (data.type === 'matching') {\n        connectionStatus.value = 'disconnected';\n      }\n    });\n\n    socket.value.on('voice-offer', handleVoiceOffer);\n    socket.value.on('voice-answer', handleVoiceAnswer);\n    socket.value.on('ice-candidate', processIceCandidateMessage);\n    \n    // Request online count when component mounts\n    socket.value.emit('get-online-count');\n  }\n\n  document.addEventListener('click', handleClickOutside);\n  window.addEventListener('resize', updateDropdownPosition);\n  document.addEventListener('scroll', updateDropdownPosition, true);\n  \n  // Check localStorage for saved filters\n  loadFilterSettings();\n});\n\nonBeforeUnmount(() => {\n  console.log('Home view unmounting, cleaning up connection');\n  closeConnection();\n  \n  // Clear connection check interval\n  if (connectionCheckInterval) {\n    clearInterval(connectionCheckInterval);\n    connectionCheckInterval = null;\n  }\n  \n  // Remove event listeners\n  if (socket.value) {\n    socket.value.off('online-count');\n    socket.value.off('matched');\n    socket.value.off('direct-connection-established');\n    socket.value.off('partner-disconnected');\n    socket.value.off('chat-message');\n    socket.value.off('error');\n    socket.value.off('voice-offer');\n    socket.value.off('voice-answer');\n    socket.value.off('ice-candidate');\n  }\n\n  document.removeEventListener('click', handleClickOutside);\n  window.removeEventListener('resize', updateDropdownPosition);\n  document.removeEventListener('scroll', updateDropdownPosition, true);\n});\n\n// WebRTC handling methods\nconst handleVoiceOffer = async (data: any) => {\n  console.log('Received voice offer - forwarding to WebRTC service');\n  // All operations are forwarded to the WebRTC service\n  handleOffer(data.offer, data.from);\n};\n\nconst handleVoiceAnswer = async (data: any) => {\n  console.log('Received voice answer - forwarding to WebRTC service');\n  // All operations are forwarded to the WebRTC service\n  handleAnswer(data.answer);\n};\n\nconst processIceCandidateMessage = async (data: any) => {\n  console.log('Received ICE candidate - forwarding to WebRTC service');\n  // All operations are forwarded to the WebRTC service\n  handleIceCandidate(data.candidate);\n};\n\n// WebRTC connection state monitor\nwatch(webRTCConnectionState, (newState, oldState) => {\n  console.log(`[HomeView] WebRTC connection state changed: ${oldState} -> ${newState}`);\n  \n  // Show connection status to the user\n  if (newState === 'connected' && connectionStatus.value === 'matched') {\n    // Don't change the status immediately, first make sure audio is working\n    setTimeout(() => {\n      // Check again that the connection is still connected\n      if (webRTCConnectionState.value === 'connected' && connectionStatus.value === 'matched') {\n        connectionStatus.value = 'connected';\n        connectionError.value = ''; // Clear any previous error messages\n        console.log('[HomeView] Successfully transitioned from matched to connected');\n      }\n    }, 1000); // Short delay to ensure connection stability\n  } else if (newState === 'failed') {\n    // Hide error message initially, show after 1 minute if still not connected\n    connectionError.value = '';\n    setTimeout(() => {\n      if (webRTCConnectionState.value === 'failed' && \n          (connectionStatus.value === 'matched' || connectionStatus.value === 'connected')) {\n        connectionError.value = 'Connection failed. Press \"Next\" to find a new partner.';\n      }\n    }, 60000); // 1 minute delay\n  } else if (newState === 'disconnected') {\n    // Only set error if we were in connected or matched state, but delay showing it\n    if (connectionStatus.value === 'connected' || connectionStatus.value === 'matched') {\n      connectionError.value = '';\n      setTimeout(() => {\n        // Only show error if we're still disconnected after 1 minute\n        if (webRTCConnectionState.value === 'disconnected' && \n            (connectionStatus.value === 'connected' || connectionStatus.value === 'matched')) {\n          connectionError.value = 'Connection lost. Trying to reconnect...';\n        }\n      }, 60000); // 1 minute delay\n    }\n  }\n});\n\n// Close dropdown when clicking outside\nconst vibeDropdownRef = ref<HTMLElement | null>(null);\n\nconst handleClickOutside = (event: MouseEvent) => {\n  const target = event.target as HTMLElement;\n  \n  if (vibeDropdownRef.value && !vibeDropdownRef.value.contains(target)) {\n    showVibeDropdown.value = false;\n  }\n\n  // Close country dropdown menus\n  if (showPreferredDropdown.value) {\n    const preferredBtn = preferredDropdownRef.value;\n    const preferredDropdown = document.querySelector('.preferred-outer');\n    if (preferredBtn && preferredDropdown && \n        !preferredBtn.contains(target) && \n        !preferredDropdown.contains(target)) {\n      showPreferredDropdown.value = false;\n    }\n  }\n  \n  if (showBlockedDropdown.value) {\n    const blockedBtn = blockedDropdownRef.value;\n    const blockedDropdown = document.querySelector('.blocked-outer');\n    if (blockedBtn && blockedDropdown && \n        !blockedBtn.contains(target) && \n        !blockedDropdown.contains(target)) {\n      showBlockedDropdown.value = false;\n    }\n  }\n};\n</script>\n\n<style scoped>\n/* Animation for the pulse effect */\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n.delay-500 {\n  animation-delay: 0.5s;\n}\n\n.delay-1000 {\n  animation-delay: 1s;\n}\n\n.delay-2000 {\n  animation-delay: 2s;\n}\n\n/* Hide scrollbar but allow scrolling */\n.scrollbar-hide {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width: none;  /* Firefox */\n}\n.scrollbar-hide::-webkit-scrollbar {\n  display: none;  /* Chrome, Safari, Opera */\n}\n\n/* Thin scrollbar style */\n.scrollbar-thin {\n  scrollbar-width: thin;\n}\n.scrollbar-thin::-webkit-scrollbar {\n  width: 3px;\n}\n.scrollbar-thin::-webkit-scrollbar-track {\n  background: transparent;\n}\n.scrollbar-thin::-webkit-scrollbar-thumb {\n  background-color: rgba(255, 255, 255, 0.2);\n  border-radius: 10px;\n}\n\n/* Flag icon styling */\n.flag-icon {\n  display: inline-block;\n  font-size: 1.1em;\n  line-height: 1;\n}\n\n.dropdown-outer {\n  min-width: 300px; /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ø£ÙƒØ¨Ø± */\n  width: max-content;\n  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);\n  animation: fadeIn 0.2s ease-out;\n  border-radius: 0.5rem;\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(-10px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n</style> ","import { createRouter, createWebHistory } from 'vue-router';\nimport HomeView from '../views/HomeView.vue';\n\nconst router = createRouter({\n  history: createWebHistory(import.meta.env.BASE_URL),\n  routes: [\n    {\n      path: '/',\n      name: 'home',\n      component: HomeView\n    },\n    {\n      path: '/game/:roomId',\n      name: 'game',\n      component: HomeView,\n      props: true\n    }\n  ]\n});\n\nexport default router; ","import './assets/main.css'\r\nimport './index.css'\r\n\r\nimport { createApp } from 'vue'\r\nimport App from './App.vue'\r\nimport router from './router'\r\n\r\nconst app = createApp(App)\r\n\r\napp.use(router)\r\n\r\napp.mount('#app')\r\n"],"names":["_openBlock","_createElementBlock","_hoisted_1","_createVNode","_unref","RouterView","getApiUrl","socket","ref","userId","isConnected","pingInterval","useSocket","onMounted","initializeSocket","onUnmounted","cleanupSocketListeners","apiUrl","storedUserId","io","setupSocketListeners","startPingInterval","_a","id","_b","attemptNumber","error","reconnect","TURN_CREDENTIAL_EXPIRY","TURN_USERNAME","TURN_PASSWORD","standardRtcConfiguration","turnOnlyRtcConfiguration","fastRtcConfiguration","currentRtcConfig","rtcConfiguration","globalPeerConnection","globalLocalStream","globalRemoteStream","globalConnectionState","globalIsAudioMuted","globalPartnerId","DEBUG","lastConnectionError","failureReason","peerConnectionStats","isNegotiating","isRestartingIce","connectionRetryCount","MAX_CONNECTION_RETRIES","pendingCandidates","connectionMonitorInterval","CONNECTION_MONITOR_INTERVAL","RECONNECT_DELAY","getConnectionStats","stats","report","startStatsCollection","stopStatsCollection","statsTimer","timer","useWebRTC","peerConnection","shallowRef","localStream","remoteStream","connectionState","isAudioMuted","partnerId","initializeLocalStream","audioTracks","track","stream","fallbackError","createPeerConnection","err","pc","event","canSetLocalDescription","startNegotiation","startConnectionMonitoring","updateGlobalState","candidate","tracks","setupConnectionTimeout","createOffer","targetPartnerId","errorMsg","resolve","localMediaStream","i","offer","waitForIceGatheringComplete","checkState","handleOffer","answer","transceiver","handleAnswer","currentState","retryError","closeConnection","attemptConnectionRecovery","toggleMicrophone","audioSender","sender","audioTrack","trackError","fallbackStream","stopConnectionMonitoring","cleanup","data","handleIceCandidate","checkAndFixTracks","senders","localTracks","matchingLocalTrack","receivers","hasAudioReceiver","receiver","t","updateDebugInfo","diagnoseAndFixAudioIssues","foundAudioReceiver","e","transceivers","fixedTransceivers","localAudioTracks","remoteAudioTracks","audioReceivers","audioElements","audioEl","watch","checkConnectionHealth","hasAudioIssues","m","hasCandidatePairIssues","quickTimeout","candidateInfo","_c","diagnosticReport","state","isLocalStorageAvailable","test","useLocalStorage","isAvailable","setItem","key","value","getItem","removeItem","clear","allMessages","currentPartnerId","unreadMessages","isListening","isInitialized","useChat","storage","initializeChatService","setupGlobalSocketListeners","loadAllChats","saveAllChats","newSocket","conversationKey","getConversationKey","setCurrentPartner","sendMessage","text","toPartnerId","timestamp","getMessages","messages","hasUnreadMessages","hasUnread","markAsRead","ids","savedMessages","savedUnread","clearChat","clearAllChats","_imports_0","props","__props","lastStatus","newStatus","oldStatus","getTransitionName","computed","beforeLeave","el","enter","done","afterEnter","connectionStatusText","getVibeDisplayName","vibe","_Transition","_hoisted_2","_cache","_createElementVNode","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_normalizeClass","_hoisted_16","_hoisted_17","emit","__emit","isProcessing","toggleMute","audioElement","$emit","currentMessage","messagesContainerRef","scrollToBottom","nextTick","formatTime","newVal","_Fragment","_renderList","message","$event","CONNECTION_TIMEOUT","gameState","board","playerSymbol","partnerSymbol","currentTurn","winner","connectionLostTimeout","lastMoveTime","isMyTurn","makeMove","index","checkWinner","startConnectionTimeout","handleError","winPatterns","pattern","a","b","c","resetGame","newValue","moveIndex","cell","CHOICE_TIMEOUT","choices","playerChoice","partnerChoice","playerScore","partnerScore","roundNumber","result","countdownTimer","countdownInterval","resultText","getEmoji","choice","found","startRound","startCountdown","makeChoice","determineResult","stopCountdown","playAgain","randomIndex","_d","_e","_createTextVNode","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","showRules","wordError","guessError","isWordCreator","secretWord","secretWordLength","blurredWord","revealedLetters","revealedCount","difficulty","currentGuess","guessHistory","attemptCount","isWinner","score","partnerStatus","guesserScore","creatorScore","roundCount","roundScores","timerInterval","timerStarted","difficultySettings","isArabicWord","isValidCharacters","currentWordDirection","validateSecretWord","validateGuess","maxAttempts","maxTime","attemptsLeft","isValidWord","startGame","initializeBlurredWord","startTimer","stopTimer","submitGuess","guess","processGuess","targetWord","guessWord","matches","newRevealed","pointsEarned","calculateScore","handleGuessResult","difficultyMultiplier","attemptBonus","timeBonus","earnedPoints","getMatchClass","previousRole","leaveGame","myId","move","_f","_g","_h","_hoisted_24","_hoisted_30","_hoisted_31","_hoisted_32","char","_hoisted_34","_hoisted_35","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","selectedGame","errorMessage","isFirstPlayer","gameRoomId","partnerReady","debugInfo","logDebugInfo","msg","selectGame","gameType","userIds","closeGame","handleGameError","isOpen","_createBlock","TicTacToe","RockPaperScissors","WordGalaxy","selectedAmount","selectAmount","amount","openPayPal","stars","generateStars","newStars","star","_normalizeStyle","maxReconnectAttempts","volume","isPlaying","reconnectAttempts","hasRemoteStream","connectAudioStream","newStream","tryPlayAudio","muted","newState","reconnectStream","newPartnerId","handleVisibilityChange","startAudioCheck","onBeforeUnmount","stopAudioCheck","audioCheckInterval","hasTracks","delay","connectionStatus","partnerInfo","connectionError","isMuted","connectionCheckInterval","isChatOpen","isGamesOpen","isDonationOpen","isHistoryOpen","isFiltersOpen","onlineCount","dailyConnections","autoReconnect","chatMessages","callHistory","selectedVibe","showVibeDropdown","preferredCountries","blockedCountries","showPreferredDropdown","showBlockedDropdown","vibes","countries","loadCountries","response","country","userLocation","cosmicQuotes","currentQuote","socketService","webRTCConnectionState","chat","route","useRoute","newRoomId","availableCountriesForPreferred","availableCountriesForBlocked","findNext","toggleChat","sendChatMessage","game","addPreferredCountry","countryCode","removePreferredCountry","addBlockedCountry","countryName","getCountryName","removeBlockedCountry","clearFilters","applyFilters","saveFilterSettings","restartMatching","getCountryFlag","toggleVibeDropdown","selectVibe","getVibeEmoji","v","getVibeText","preferredDropdownRef","blockedDropdownRef","updateDropdownPosition","preferredDropdownRect","blockedDropdownRect","preferredOuter","blockedOuter","togglePreferredDropdown","toggleBlockedDropdown","loadFilterSettings","savedPreferred","savedBlocked","savedPreferredCountries","savedBlockedCountries","locationData","count","disconnectReason","handleVoiceOffer","handleVoiceAnswer","processIceCandidateMessage","handleClickOutside","oldState","vibeDropdownRef","target","preferredBtn","preferredDropdown","blockedBtn","blockedDropdown","Starfield","ConnectionCard","ControlButtons","call","_hoisted_33","_hoisted_36","_hoisted_48","ChatModal","GamesModal","DonationModal","AudioOutput","router","createRouter","createWebHistory","HomeView","app","createApp","App"],"mappings":"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"}