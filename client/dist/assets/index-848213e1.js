var ja=Object.defineProperty;var qa=(t,n,e)=>n in t?ja(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var Ue=(t,n,e)=>(qa(t,typeof n!="symbol"?n+"":n,e),e);import{r as W,o as ze,a as ft,g as Qo,d as He,c as L,b as Qe,u as za,e as N,R as Ga,s as Pn,w as De,f as _e,h as Va,T as Ka,i as l,n as ie,t as K,j as ne,F as Ae,k as Pe,l as Zo,m as Rt,v as Vt,p as Jo,q as je,x as dt,y as Ya,z as cn,A as Rr,B as $r,C as Xa,D as Qa,E as Za,G as Ja,H as es}from"./vue-vendor-cc684da0.js";import{l as ts}from"./socket-vendor-d9998155.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}})();const ns=()=>window.location.origin,se=W(null),an=W(null),Dt=W(!1);let Ft=null;const Ht=W("idle"),bt=W(""),Ut=W(0),rs=10,os=1e3,as=1e4,ss=45e3,is=3e4;function Ie(){const t=!!Qo();se.value||n(),t&&(ze(()=>{se.value||n()}),ft(()=>{se.value&&o(),Ft&&(clearInterval(Ft),Ft=null)}));function n(){const c=ns(),u=localStorage.getItem("spacechat_user_id");se.value=ts(c,{autoConnect:!0,reconnection:!0,reconnectionAttempts:rs,reconnectionDelay:os,reconnectionDelayMax:as,timeout:is,transports:["websocket"],extraHeaders:{"X-Client-Version":"1.0.0"},query:u?{userId:u}:void 0,forceNew:!1,withCredentials:!0}),r(),e()}function e(){Ft&&clearInterval(Ft),Ft=setInterval(()=>{se.value&&Dt.value&&se.value.emit("heartbeat")},ss)}function r(){se.value&&(se.value.on("connect",()=>{var u,f;console.log("Socket connected"),Dt.value=!0;const c=localStorage.getItem("spacechat_user_id");(u=se.value)==null||u.emit("user:identify",{prevUserId:c||void 0},s=>{console.log("Identified with server, user ID:",s),an.value=s,localStorage.setItem("spacechat_user_id",s)}),(f=se.value)==null||f.emit("get-online-count")}),se.value.on("disconnect",()=>{console.log("Socket disconnected"),Dt.value=!1}),se.value.on("reconnect",c=>{var f;console.log(`Socket reconnected after ${c} attempts`),Dt.value=!0;const u=localStorage.getItem("spacechat_user_id");u&&((f=se.value)==null||f.emit("user:identify",{prevUserId:u},s=>{var i;console.log("Re-identified with server after reconnection, user ID:",s),an.value=s,s!==u&&localStorage.setItem("spacechat_user_id",s),(i=se.value)==null||i.emit("get-online-count")}))}),se.value.on("reconnect_attempt",c=>{console.log(`Socket reconnection attempt ${c}`)}),se.value.on("reconnect_error",c=>{console.error("Socket reconnection error:",c)}),se.value.on("reconnect_failed",()=>{console.error("Socket reconnection failed"),setTimeout(()=>{Dt.value||(console.log("Attempting to reinitialize socket connection..."),o(),n())},5e3)}),se.value.on("error",c=>{console.error("Socket error:",c)}),se.value.on("pong",()=>{}),se.value.on("user-id",c=>{console.log("Received user ID from server:",c),an.value=c,localStorage.setItem("spacechat_user_id",c)}),se.value.on("queue-timeout",c=>{console.log("Queue timeout:",c),Ht.value="timeout",bt.value="We couldn't find a suitable match in the allotted time. Please try again.",Ut.value=c.waitTime,window.dispatchEvent(new CustomEvent("queue-status-changed",{detail:{status:"timeout",message:bt.value,waitTime:c.waitTime}}))}),se.value.on("queue-waiting",c=>{console.log("Queue waiting notification:",c),Ht.value="waiting",bt.value="We're still looking for a match for you. Please wait...",Ut.value=c.waitTime,window.dispatchEvent(new CustomEvent("queue-status-changed",{detail:{status:"waiting",message:bt.value,waitTime:c.waitTime}}))}),se.value.on("matched",()=>{Ht.value="matched",bt.value="",Ut.value=0}),se.value.on("join-queue",()=>{Ht.value="waiting",bt.value="Looking for someone matching your preferences...",Ut.value=0}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&se.value&&se.value.connected&&(se.value.emit("heartbeat"),console.log("Tab became visible, sending heartbeat"))}))}function o(){se.value&&(se.value.off("connect"),se.value.off("disconnect"),se.value.off("reconnect"),se.value.off("reconnect_attempt"),se.value.off("reconnect_error"),se.value.off("reconnect_failed"),se.value.off("error"),se.value.off("user-id"),se.value.off("pong"),se.value.off("queue-timeout"),se.value.off("queue-waiting"))}function a(){se.value?(console.log("Forcing socket reconnection..."),se.value.disconnect(),se.value.connect()):n()}return{socket:se,userId:an,isConnected:Dt,queueStatus:Ht,queueMessage:bt,queueWaitTime:Ut,reconnect:a,isInSetupContext:t}}function ls(){const{socket:t}=Ie(),n=!!Qo(),e=W(!0),r=W(Date.now()),o=3e4,a=3e5;let c=0,u=null;const f=()=>{const d=Date.now();r.value=d,e.value=!0,d-c>o&&(c=d,t.value&&t.value.connected&&(t.value.emit("user-activity"),console.log("[ActivityTracker] تم إرسال تحديث النشاط للخادم"))),s()},s=()=>{u&&clearTimeout(u),u=window.setTimeout(()=>{e.value=!1,console.log("[ActivityTracker] المستخدم غير نشط الآن")},a)},i=()=>{["mousedown","mousemove","keydown","scroll","touchstart","click","touchmove"].forEach(b=>{document.addEventListener(b,f,{passive:!0})}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&f()}),f()},g=()=>{["mousedown","mousemove","keydown","scroll","touchstart","click","touchmove"].forEach(b=>{document.removeEventListener(b,f)}),document.removeEventListener("visibilitychange",f),u&&(clearTimeout(u),u=null)};return n?(ze(()=>{i()}),ft(()=>{g()})):i(),{isActive:e,lastActivity:r,updateActivity:f,setupEventListeners:i,cleanupEventListeners:g}}const cs={class:"app-container"},us=He({__name:"App",setup(t){return ls(),(n,e)=>(N(),L("div",cs,[Qe(za(Ga))]))}});function ea(t,n){return function(){return t.apply(n,arguments)}}const{toString:ds}=Object.prototype,{getPrototypeOf:Ir}=Object,{iterator:pn,toStringTag:ta}=Symbol,hn=(t=>n=>{const e=ds.call(n);return t[e]||(t[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),et=t=>(t=t.toLowerCase(),n=>hn(n)===t),bn=t=>n=>typeof n===t,{isArray:$t}=Array,Kt=bn("undefined");function fs(t){return t!==null&&!Kt(t)&&t.constructor!==null&&!Kt(t.constructor)&&qe(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const na=et("ArrayBuffer");function xs(t){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(t):n=t&&t.buffer&&na(t.buffer),n}const vs=bn("string"),qe=bn("function"),ra=bn("number"),yn=t=>t!==null&&typeof t=="object",gs=t=>t===!0||t===!1,un=t=>{if(hn(t)!=="object")return!1;const n=Ir(t);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(ta in t)&&!(pn in t)},ms=et("Date"),ps=et("File"),hs=et("Blob"),bs=et("FileList"),ys=t=>yn(t)&&qe(t.pipe),Cs=t=>{let n;return t&&(typeof FormData=="function"&&t instanceof FormData||qe(t.append)&&((n=hn(t))==="formdata"||n==="object"&&qe(t.toString)&&t.toString()==="[object FormData]"))},ws=et("URLSearchParams"),[Es,_s,As,Bs]=["ReadableStream","Request","Response","Headers"].map(et),ks=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Yt(t,n,{allOwnKeys:e=!1}={}){if(t===null||typeof t>"u")return;let r,o;if(typeof t!="object"&&(t=[t]),$t(t))for(r=0,o=t.length;r<o;r++)n.call(null,t[r],r,t);else{const a=e?Object.getOwnPropertyNames(t):Object.keys(t),c=a.length;let u;for(r=0;r<c;r++)u=a[r],n.call(null,t[u],u,t)}}function oa(t,n){n=n.toLowerCase();const e=Object.keys(t);let r=e.length,o;for(;r-- >0;)if(o=e[r],n===o.toLowerCase())return o;return null}const wt=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),aa=t=>!Kt(t)&&t!==wt;function Ar(){const{caseless:t}=aa(this)&&this||{},n={},e=(r,o)=>{const a=t&&oa(n,o)||o;un(n[a])&&un(r)?n[a]=Ar(n[a],r):un(r)?n[a]=Ar({},r):$t(r)?n[a]=r.slice():n[a]=r};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&Yt(arguments[r],e);return n}const Ds=(t,n,e,{allOwnKeys:r}={})=>(Yt(n,(o,a)=>{e&&qe(o)?t[a]=ea(o,e):t[a]=o},{allOwnKeys:r}),t),Fs=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Ts=(t,n,e,r)=>{t.prototype=Object.create(n.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:n.prototype}),e&&Object.assign(t.prototype,e)},Ss=(t,n,e,r)=>{let o,a,c;const u={};if(n=n||{},t==null)return n;do{for(o=Object.getOwnPropertyNames(t),a=o.length;a-- >0;)c=o[a],(!r||r(c,t,n))&&!u[c]&&(n[c]=t[c],u[c]=!0);t=e!==!1&&Ir(t)}while(t&&(!e||e(t,n))&&t!==Object.prototype);return n},Rs=(t,n,e)=>{t=String(t),(e===void 0||e>t.length)&&(e=t.length),e-=n.length;const r=t.indexOf(n,e);return r!==-1&&r===e},$s=t=>{if(!t)return null;if($t(t))return t;let n=t.length;if(!ra(n))return null;const e=new Array(n);for(;n-- >0;)e[n]=t[n];return e},Is=(t=>n=>t&&n instanceof t)(typeof Uint8Array<"u"&&Ir(Uint8Array)),Ps=(t,n)=>{const r=(t&&t[pn]).call(t);let o;for(;(o=r.next())&&!o.done;){const a=o.value;n.call(t,a[0],a[1])}},Ms=(t,n)=>{let e;const r=[];for(;(e=t.exec(n))!==null;)r.push(e);return r},Os=et("HTMLFormElement"),Ws=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,r,o){return r.toUpperCase()+o}),zr=(({hasOwnProperty:t})=>(n,e)=>t.call(n,e))(Object.prototype),Ns=et("RegExp"),sa=(t,n)=>{const e=Object.getOwnPropertyDescriptors(t),r={};Yt(e,(o,a)=>{let c;(c=n(o,a,t))!==!1&&(r[a]=c||o)}),Object.defineProperties(t,r)},Ls=t=>{sa(t,(n,e)=>{if(qe(t)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const r=t[e];if(qe(r)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},Hs=(t,n)=>{const e={},r=o=>{o.forEach(a=>{e[a]=!0})};return $t(t)?r(t):r(String(t).split(n)),e},Us=()=>{},js=(t,n)=>t!=null&&Number.isFinite(t=+t)?t:n;function qs(t){return!!(t&&qe(t.append)&&t[ta]==="FormData"&&t[pn])}const zs=t=>{const n=new Array(10),e=(r,o)=>{if(yn(r)){if(n.indexOf(r)>=0)return;if(!("toJSON"in r)){n[o]=r;const a=$t(r)?[]:{};return Yt(r,(c,u)=>{const f=e(c,o+1);!Kt(f)&&(a[u]=f)}),n[o]=void 0,a}}return r};return e(t,0)},Gs=et("AsyncFunction"),Vs=t=>t&&(yn(t)||qe(t))&&qe(t.then)&&qe(t.catch),ia=((t,n)=>t?setImmediate:n?((e,r)=>(wt.addEventListener("message",({source:o,data:a})=>{o===wt&&a===e&&r.length&&r.shift()()},!1),o=>{r.push(o),wt.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",qe(wt.postMessage)),Ks=typeof queueMicrotask<"u"?queueMicrotask.bind(wt):typeof process<"u"&&process.nextTick||ia,Ys=t=>t!=null&&qe(t[pn]),M={isArray:$t,isArrayBuffer:na,isBuffer:fs,isFormData:Cs,isArrayBufferView:xs,isString:vs,isNumber:ra,isBoolean:gs,isObject:yn,isPlainObject:un,isReadableStream:Es,isRequest:_s,isResponse:As,isHeaders:Bs,isUndefined:Kt,isDate:ms,isFile:ps,isBlob:hs,isRegExp:Ns,isFunction:qe,isStream:ys,isURLSearchParams:ws,isTypedArray:Is,isFileList:bs,forEach:Yt,merge:Ar,extend:Ds,trim:ks,stripBOM:Fs,inherits:Ts,toFlatObject:Ss,kindOf:hn,kindOfTest:et,endsWith:Rs,toArray:$s,forEachEntry:Ps,matchAll:Ms,isHTMLForm:Os,hasOwnProperty:zr,hasOwnProp:zr,reduceDescriptors:sa,freezeMethods:Ls,toObjectSet:Hs,toCamelCase:Ws,noop:Us,toFiniteNumber:js,findKey:oa,global:wt,isContextDefined:aa,isSpecCompliantForm:qs,toJSONObject:zs,isAsyncFn:Gs,isThenable:Vs,setImmediate:ia,asap:Ks,isIterable:Ys};function ce(t,n,e,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",n&&(this.code=n),e&&(this.config=e),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}M.inherits(ce,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:M.toJSONObject(this.config),code:this.code,status:this.status}}});const la=ce.prototype,ca={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{ca[t]={value:t}});Object.defineProperties(ce,ca);Object.defineProperty(la,"isAxiosError",{value:!0});ce.from=(t,n,e,r,o,a)=>{const c=Object.create(la);return M.toFlatObject(t,c,function(f){return f!==Error.prototype},u=>u!=="isAxiosError"),ce.call(c,t.message,n,e,r,o),c.cause=t,c.name=t.name,a&&Object.assign(c,a),c};const Xs=null;function Br(t){return M.isPlainObject(t)||M.isArray(t)}function ua(t){return M.endsWith(t,"[]")?t.slice(0,-2):t}function Gr(t,n,e){return t?t.concat(n).map(function(o,a){return o=ua(o),!e&&a?"["+o+"]":o}).join(e?".":""):n}function Qs(t){return M.isArray(t)&&!t.some(Br)}const Zs=M.toFlatObject(M,{},null,function(n){return/^is[A-Z]/.test(n)});function Cn(t,n,e){if(!M.isObject(t))throw new TypeError("target must be an object");n=n||new FormData,e=M.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(C,x){return!M.isUndefined(x[C])});const r=e.metaTokens,o=e.visitor||i,a=e.dots,c=e.indexes,f=(e.Blob||typeof Blob<"u"&&Blob)&&M.isSpecCompliantForm(n);if(!M.isFunction(o))throw new TypeError("visitor must be a function");function s(v){if(v===null)return"";if(M.isDate(v))return v.toISOString();if(M.isBoolean(v))return v.toString();if(!f&&M.isBlob(v))throw new ce("Blob is not supported. Use a Buffer instead.");return M.isArrayBuffer(v)||M.isTypedArray(v)?f&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function i(v,C,x){let p=v;if(v&&!x&&typeof v=="object"){if(M.endsWith(C,"{}"))C=r?C:C.slice(0,-2),v=JSON.stringify(v);else if(M.isArray(v)&&Qs(v)||(M.isFileList(v)||M.endsWith(C,"[]"))&&(p=M.toArray(v)))return C=ua(C),p.forEach(function(h,y){!(M.isUndefined(h)||h===null)&&n.append(c===!0?Gr([C],y,a):c===null?C:C+"[]",s(h))}),!1}return Br(v)?!0:(n.append(Gr(x,C,a),s(v)),!1)}const g=[],d=Object.assign(Zs,{defaultVisitor:i,convertValue:s,isVisitable:Br});function b(v,C){if(!M.isUndefined(v)){if(g.indexOf(v)!==-1)throw Error("Circular reference detected in "+C.join("."));g.push(v),M.forEach(v,function(p,m){(!(M.isUndefined(p)||p===null)&&o.call(n,p,M.isString(m)?m.trim():m,C,d))===!0&&b(p,C?C.concat(m):[m])}),g.pop()}}if(!M.isObject(t))throw new TypeError("data must be an object");return b(t),n}function Vr(t){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return n[r]})}function Pr(t,n){this._pairs=[],t&&Cn(t,this,n)}const da=Pr.prototype;da.append=function(n,e){this._pairs.push([n,e])};da.toString=function(n){const e=n?function(r){return n.call(this,r,Vr)}:Vr;return this._pairs.map(function(o){return e(o[0])+"="+e(o[1])},"").join("&")};function Js(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function fa(t,n,e){if(!n)return t;const r=e&&e.encode||Js;M.isFunction(e)&&(e={serialize:e});const o=e&&e.serialize;let a;if(o?a=o(n,e):a=M.isURLSearchParams(n)?n.toString():new Pr(n,e).toString(r),a){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class e0{constructor(){this.handlers=[]}use(n,e,r){return this.handlers.push({fulfilled:n,rejected:e,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){M.forEach(this.handlers,function(r){r!==null&&n(r)})}}const Kr=e0,xa={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},t0=typeof URLSearchParams<"u"?URLSearchParams:Pr,n0=typeof FormData<"u"?FormData:null,r0=typeof Blob<"u"?Blob:null,o0={isBrowser:!0,classes:{URLSearchParams:t0,FormData:n0,Blob:r0},protocols:["http","https","file","blob","url","data"]},Mr=typeof window<"u"&&typeof document<"u",kr=typeof navigator=="object"&&navigator||void 0,a0=Mr&&(!kr||["ReactNative","NativeScript","NS"].indexOf(kr.product)<0),s0=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),i0=Mr&&window.location.href||"http://localhost",l0=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Mr,hasStandardBrowserEnv:a0,hasStandardBrowserWebWorkerEnv:s0,navigator:kr,origin:i0},Symbol.toStringTag,{value:"Module"})),We={...l0,...o0};function c0(t,n){return Cn(t,new We.classes.URLSearchParams,Object.assign({visitor:function(e,r,o,a){return We.isNode&&M.isBuffer(e)?(this.append(r,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},n))}function u0(t){return M.matchAll(/\w+|\[(\w*)]/g,t).map(n=>n[0]==="[]"?"":n[1]||n[0])}function d0(t){const n={},e=Object.keys(t);let r;const o=e.length;let a;for(r=0;r<o;r++)a=e[r],n[a]=t[a];return n}function va(t){function n(e,r,o,a){let c=e[a++];if(c==="__proto__")return!0;const u=Number.isFinite(+c),f=a>=e.length;return c=!c&&M.isArray(o)?o.length:c,f?(M.hasOwnProp(o,c)?o[c]=[o[c],r]:o[c]=r,!u):((!o[c]||!M.isObject(o[c]))&&(o[c]=[]),n(e,r,o[c],a)&&M.isArray(o[c])&&(o[c]=d0(o[c])),!u)}if(M.isFormData(t)&&M.isFunction(t.entries)){const e={};return M.forEachEntry(t,(r,o)=>{n(u0(r),o,e,0)}),e}return null}function f0(t,n,e){if(M.isString(t))try{return(n||JSON.parse)(t),M.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(e||JSON.stringify)(t)}const Or={transitional:xa,adapter:["xhr","http","fetch"],transformRequest:[function(n,e){const r=e.getContentType()||"",o=r.indexOf("application/json")>-1,a=M.isObject(n);if(a&&M.isHTMLForm(n)&&(n=new FormData(n)),M.isFormData(n))return o?JSON.stringify(va(n)):n;if(M.isArrayBuffer(n)||M.isBuffer(n)||M.isStream(n)||M.isFile(n)||M.isBlob(n)||M.isReadableStream(n))return n;if(M.isArrayBufferView(n))return n.buffer;if(M.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let u;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return c0(n,this.formSerializer).toString();if((u=M.isFileList(n))||r.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return Cn(u?{"files[]":n}:n,f&&new f,this.formSerializer)}}return a||o?(e.setContentType("application/json",!1),f0(n)):n}],transformResponse:[function(n){const e=this.transitional||Or.transitional,r=e&&e.forcedJSONParsing,o=this.responseType==="json";if(M.isResponse(n)||M.isReadableStream(n))return n;if(n&&M.isString(n)&&(r&&!this.responseType||o)){const c=!(e&&e.silentJSONParsing)&&o;try{return JSON.parse(n)}catch(u){if(c)throw u.name==="SyntaxError"?ce.from(u,ce.ERR_BAD_RESPONSE,this,null,this.response):u}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:We.classes.FormData,Blob:We.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};M.forEach(["delete","get","head","post","put","patch"],t=>{Or.headers[t]={}});const Wr=Or,x0=M.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),v0=t=>{const n={};let e,r,o;return t&&t.split(`
`).forEach(function(c){o=c.indexOf(":"),e=c.substring(0,o).trim().toLowerCase(),r=c.substring(o+1).trim(),!(!e||n[e]&&x0[e])&&(e==="set-cookie"?n[e]?n[e].push(r):n[e]=[r]:n[e]=n[e]?n[e]+", "+r:r)}),n},Yr=Symbol("internals");function jt(t){return t&&String(t).trim().toLowerCase()}function dn(t){return t===!1||t==null?t:M.isArray(t)?t.map(dn):String(t)}function g0(t){const n=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=e.exec(t);)n[r[1]]=r[2];return n}const m0=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Mn(t,n,e,r,o){if(M.isFunction(r))return r.call(this,n,e);if(o&&(n=e),!!M.isString(n)){if(M.isString(r))return n.indexOf(r)!==-1;if(M.isRegExp(r))return r.test(n)}}function p0(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,e,r)=>e.toUpperCase()+r)}function h0(t,n){const e=M.toCamelCase(" "+n);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+e,{value:function(o,a,c){return this[r].call(this,n,o,a,c)},configurable:!0})})}class wn{constructor(n){n&&this.set(n)}set(n,e,r){const o=this;function a(u,f,s){const i=jt(f);if(!i)throw new Error("header name must be a non-empty string");const g=M.findKey(o,i);(!g||o[g]===void 0||s===!0||s===void 0&&o[g]!==!1)&&(o[g||f]=dn(u))}const c=(u,f)=>M.forEach(u,(s,i)=>a(s,i,f));if(M.isPlainObject(n)||n instanceof this.constructor)c(n,e);else if(M.isString(n)&&(n=n.trim())&&!m0(n))c(v0(n),e);else if(M.isObject(n)&&M.isIterable(n)){let u={},f,s;for(const i of n){if(!M.isArray(i))throw TypeError("Object iterator must return a key-value pair");u[s=i[0]]=(f=u[s])?M.isArray(f)?[...f,i[1]]:[f,i[1]]:i[1]}c(u,e)}else n!=null&&a(e,n,r);return this}get(n,e){if(n=jt(n),n){const r=M.findKey(this,n);if(r){const o=this[r];if(!e)return o;if(e===!0)return g0(o);if(M.isFunction(e))return e.call(this,o,r);if(M.isRegExp(e))return e.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,e){if(n=jt(n),n){const r=M.findKey(this,n);return!!(r&&this[r]!==void 0&&(!e||Mn(this,this[r],r,e)))}return!1}delete(n,e){const r=this;let o=!1;function a(c){if(c=jt(c),c){const u=M.findKey(r,c);u&&(!e||Mn(r,r[u],u,e))&&(delete r[u],o=!0)}}return M.isArray(n)?n.forEach(a):a(n),o}clear(n){const e=Object.keys(this);let r=e.length,o=!1;for(;r--;){const a=e[r];(!n||Mn(this,this[a],a,n,!0))&&(delete this[a],o=!0)}return o}normalize(n){const e=this,r={};return M.forEach(this,(o,a)=>{const c=M.findKey(r,a);if(c){e[c]=dn(o),delete e[a];return}const u=n?p0(a):String(a).trim();u!==a&&delete e[a],e[u]=dn(o),r[u]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const e=Object.create(null);return M.forEach(this,(r,o)=>{r!=null&&r!==!1&&(e[o]=n&&M.isArray(r)?r.join(", "):r)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,e])=>n+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...e){const r=new this(n);return e.forEach(o=>r.set(o)),r}static accessor(n){const r=(this[Yr]=this[Yr]={accessors:{}}).accessors,o=this.prototype;function a(c){const u=jt(c);r[u]||(h0(o,c),r[u]=!0)}return M.isArray(n)?n.forEach(a):a(n),this}}wn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);M.reduceDescriptors(wn.prototype,({value:t},n)=>{let e=n[0].toUpperCase()+n.slice(1);return{get:()=>t,set(r){this[e]=r}}});M.freezeMethods(wn);const Je=wn;function On(t,n){const e=this||Wr,r=n||e,o=Je.from(r.headers);let a=r.data;return M.forEach(t,function(u){a=u.call(e,a,o.normalize(),n?n.status:void 0)}),o.normalize(),a}function ga(t){return!!(t&&t.__CANCEL__)}function It(t,n,e){ce.call(this,t??"canceled",ce.ERR_CANCELED,n,e),this.name="CanceledError"}M.inherits(It,ce,{__CANCEL__:!0});function ma(t,n,e){const r=e.config.validateStatus;!e.status||!r||r(e.status)?t(e):n(new ce("Request failed with status code "+e.status,[ce.ERR_BAD_REQUEST,ce.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function b0(t){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return n&&n[1]||""}function y0(t,n){t=t||10;const e=new Array(t),r=new Array(t);let o=0,a=0,c;return n=n!==void 0?n:1e3,function(f){const s=Date.now(),i=r[a];c||(c=s),e[o]=f,r[o]=s;let g=a,d=0;for(;g!==o;)d+=e[g++],g=g%t;if(o=(o+1)%t,o===a&&(a=(a+1)%t),s-c<n)return;const b=i&&s-i;return b?Math.round(d*1e3/b):void 0}}function C0(t,n){let e=0,r=1e3/n,o,a;const c=(s,i=Date.now())=>{e=i,o=null,a&&(clearTimeout(a),a=null),t.apply(null,s)};return[(...s)=>{const i=Date.now(),g=i-e;g>=r?c(s,i):(o=s,a||(a=setTimeout(()=>{a=null,c(o)},r-g)))},()=>o&&c(o)]}const vn=(t,n,e=3)=>{let r=0;const o=y0(50,250);return C0(a=>{const c=a.loaded,u=a.lengthComputable?a.total:void 0,f=c-r,s=o(f),i=c<=u;r=c;const g={loaded:c,total:u,progress:u?c/u:void 0,bytes:f,rate:s||void 0,estimated:s&&u&&i?(u-c)/s:void 0,event:a,lengthComputable:u!=null,[n?"download":"upload"]:!0};t(g)},e)},Xr=(t,n)=>{const e=t!=null;return[r=>n[0]({lengthComputable:e,total:t,loaded:r}),n[1]]},Qr=t=>(...n)=>M.asap(()=>t(...n)),w0=We.hasStandardBrowserEnv?((t,n)=>e=>(e=new URL(e,We.origin),t.protocol===e.protocol&&t.host===e.host&&(n||t.port===e.port)))(new URL(We.origin),We.navigator&&/(msie|trident)/i.test(We.navigator.userAgent)):()=>!0,E0=We.hasStandardBrowserEnv?{write(t,n,e,r,o,a){const c=[t+"="+encodeURIComponent(n)];M.isNumber(e)&&c.push("expires="+new Date(e).toGMTString()),M.isString(r)&&c.push("path="+r),M.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function _0(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function A0(t,n){return n?t.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):t}function pa(t,n,e){let r=!_0(n);return t&&(r||e==!1)?A0(t,n):n}const Zr=t=>t instanceof Je?{...t}:t;function Et(t,n){n=n||{};const e={};function r(s,i,g,d){return M.isPlainObject(s)&&M.isPlainObject(i)?M.merge.call({caseless:d},s,i):M.isPlainObject(i)?M.merge({},i):M.isArray(i)?i.slice():i}function o(s,i,g,d){if(M.isUndefined(i)){if(!M.isUndefined(s))return r(void 0,s,g,d)}else return r(s,i,g,d)}function a(s,i){if(!M.isUndefined(i))return r(void 0,i)}function c(s,i){if(M.isUndefined(i)){if(!M.isUndefined(s))return r(void 0,s)}else return r(void 0,i)}function u(s,i,g){if(g in n)return r(s,i);if(g in t)return r(void 0,s)}const f={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:u,headers:(s,i,g)=>o(Zr(s),Zr(i),g,!0)};return M.forEach(Object.keys(Object.assign({},t,n)),function(i){const g=f[i]||o,d=g(t[i],n[i],i);M.isUndefined(d)&&g!==u||(e[i]=d)}),e}const ha=t=>{const n=Et({},t);let{data:e,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:a,headers:c,auth:u}=n;n.headers=c=Je.from(c),n.url=fa(pa(n.baseURL,n.url,n.allowAbsoluteUrls),t.params,t.paramsSerializer),u&&c.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let f;if(M.isFormData(e)){if(We.hasStandardBrowserEnv||We.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((f=c.getContentType())!==!1){const[s,...i]=f?f.split(";").map(g=>g.trim()).filter(Boolean):[];c.setContentType([s||"multipart/form-data",...i].join("; "))}}if(We.hasStandardBrowserEnv&&(r&&M.isFunction(r)&&(r=r(n)),r||r!==!1&&w0(n.url))){const s=o&&a&&E0.read(a);s&&c.set(o,s)}return n},B0=typeof XMLHttpRequest<"u",k0=B0&&function(t){return new Promise(function(e,r){const o=ha(t);let a=o.data;const c=Je.from(o.headers).normalize();let{responseType:u,onUploadProgress:f,onDownloadProgress:s}=o,i,g,d,b,v;function C(){b&&b(),v&&v(),o.cancelToken&&o.cancelToken.unsubscribe(i),o.signal&&o.signal.removeEventListener("abort",i)}let x=new XMLHttpRequest;x.open(o.method.toUpperCase(),o.url,!0),x.timeout=o.timeout;function p(){if(!x)return;const h=Je.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders()),w={data:!u||u==="text"||u==="json"?x.responseText:x.response,status:x.status,statusText:x.statusText,headers:h,config:t,request:x};ma(function(F){e(F),C()},function(F){r(F),C()},w),x=null}"onloadend"in x?x.onloadend=p:x.onreadystatechange=function(){!x||x.readyState!==4||x.status===0&&!(x.responseURL&&x.responseURL.indexOf("file:")===0)||setTimeout(p)},x.onabort=function(){x&&(r(new ce("Request aborted",ce.ECONNABORTED,t,x)),x=null)},x.onerror=function(){r(new ce("Network Error",ce.ERR_NETWORK,t,x)),x=null},x.ontimeout=function(){let y=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const w=o.transitional||xa;o.timeoutErrorMessage&&(y=o.timeoutErrorMessage),r(new ce(y,w.clarifyTimeoutError?ce.ETIMEDOUT:ce.ECONNABORTED,t,x)),x=null},a===void 0&&c.setContentType(null),"setRequestHeader"in x&&M.forEach(c.toJSON(),function(y,w){x.setRequestHeader(w,y)}),M.isUndefined(o.withCredentials)||(x.withCredentials=!!o.withCredentials),u&&u!=="json"&&(x.responseType=o.responseType),s&&([d,v]=vn(s,!0),x.addEventListener("progress",d)),f&&x.upload&&([g,b]=vn(f),x.upload.addEventListener("progress",g),x.upload.addEventListener("loadend",b)),(o.cancelToken||o.signal)&&(i=h=>{x&&(r(!h||h.type?new It(null,t,x):h),x.abort(),x=null)},o.cancelToken&&o.cancelToken.subscribe(i),o.signal&&(o.signal.aborted?i():o.signal.addEventListener("abort",i)));const m=b0(o.url);if(m&&We.protocols.indexOf(m)===-1){r(new ce("Unsupported protocol "+m+":",ce.ERR_BAD_REQUEST,t));return}x.send(a||null)})},D0=(t,n)=>{const{length:e}=t=t?t.filter(Boolean):[];if(n||e){let r=new AbortController,o;const a=function(s){if(!o){o=!0,u();const i=s instanceof Error?s:this.reason;r.abort(i instanceof ce?i:new It(i instanceof Error?i.message:i))}};let c=n&&setTimeout(()=>{c=null,a(new ce(`timeout ${n} of ms exceeded`,ce.ETIMEDOUT))},n);const u=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(s=>{s.unsubscribe?s.unsubscribe(a):s.removeEventListener("abort",a)}),t=null)};t.forEach(s=>s.addEventListener("abort",a));const{signal:f}=r;return f.unsubscribe=()=>M.asap(u),f}},F0=D0,T0=function*(t,n){let e=t.byteLength;if(!n||e<n){yield t;return}let r=0,o;for(;r<e;)o=r+n,yield t.slice(r,o),r=o},S0=async function*(t,n){for await(const e of R0(t))yield*T0(e,n)},R0=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const n=t.getReader();try{for(;;){const{done:e,value:r}=await n.read();if(e)break;yield r}}finally{await n.cancel()}},Jr=(t,n,e,r)=>{const o=S0(t,n);let a=0,c,u=f=>{c||(c=!0,r&&r(f))};return new ReadableStream({async pull(f){try{const{done:s,value:i}=await o.next();if(s){u(),f.close();return}let g=i.byteLength;if(e){let d=a+=g;e(d)}f.enqueue(new Uint8Array(i))}catch(s){throw u(s),s}},cancel(f){return u(f),o.return()}},{highWaterMark:2})},En=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ba=En&&typeof ReadableStream=="function",$0=En&&(typeof TextEncoder=="function"?(t=>n=>t.encode(n))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),ya=(t,...n)=>{try{return!!t(...n)}catch{return!1}},I0=ba&&ya(()=>{let t=!1;const n=new Request(We.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!n}),eo=64*1024,Dr=ba&&ya(()=>M.isReadableStream(new Response("").body)),gn={stream:Dr&&(t=>t.body)};En&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(n=>{!gn[n]&&(gn[n]=M.isFunction(t[n])?e=>e[n]():(e,r)=>{throw new ce(`Response type '${n}' is not supported`,ce.ERR_NOT_SUPPORT,r)})})})(new Response);const P0=async t=>{if(t==null)return 0;if(M.isBlob(t))return t.size;if(M.isSpecCompliantForm(t))return(await new Request(We.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(M.isArrayBufferView(t)||M.isArrayBuffer(t))return t.byteLength;if(M.isURLSearchParams(t)&&(t=t+""),M.isString(t))return(await $0(t)).byteLength},M0=async(t,n)=>{const e=M.toFiniteNumber(t.getContentLength());return e??P0(n)},O0=En&&(async t=>{let{url:n,method:e,data:r,signal:o,cancelToken:a,timeout:c,onDownloadProgress:u,onUploadProgress:f,responseType:s,headers:i,withCredentials:g="same-origin",fetchOptions:d}=ha(t);s=s?(s+"").toLowerCase():"text";let b=F0([o,a&&a.toAbortSignal()],c),v;const C=b&&b.unsubscribe&&(()=>{b.unsubscribe()});let x;try{if(f&&I0&&e!=="get"&&e!=="head"&&(x=await M0(i,r))!==0){let w=new Request(n,{method:"POST",body:r,duplex:"half"}),D;if(M.isFormData(r)&&(D=w.headers.get("content-type"))&&i.setContentType(D),w.body){const[F,T]=Xr(x,vn(Qr(f)));r=Jr(w.body,eo,F,T)}}M.isString(g)||(g=g?"include":"omit");const p="credentials"in Request.prototype;v=new Request(n,{...d,signal:b,method:e.toUpperCase(),headers:i.normalize().toJSON(),body:r,duplex:"half",credentials:p?g:void 0});let m=await fetch(v,d);const h=Dr&&(s==="stream"||s==="response");if(Dr&&(u||h&&C)){const w={};["status","statusText","headers"].forEach(j=>{w[j]=m[j]});const D=M.toFiniteNumber(m.headers.get("content-length")),[F,T]=u&&Xr(D,vn(Qr(u),!0))||[];m=new Response(Jr(m.body,eo,F,()=>{T&&T(),C&&C()}),w)}s=s||"text";let y=await gn[M.findKey(gn,s)||"text"](m,t);return!h&&C&&C(),await new Promise((w,D)=>{ma(w,D,{data:y,headers:Je.from(m.headers),status:m.status,statusText:m.statusText,config:t,request:v})})}catch(p){throw C&&C(),p&&p.name==="TypeError"&&/Load failed|fetch/i.test(p.message)?Object.assign(new ce("Network Error",ce.ERR_NETWORK,t,v),{cause:p.cause||p}):ce.from(p,p&&p.code,t,v)}}),Fr={http:Xs,xhr:k0,fetch:O0};M.forEach(Fr,(t,n)=>{if(t){try{Object.defineProperty(t,"name",{value:n})}catch{}Object.defineProperty(t,"adapterName",{value:n})}});const to=t=>`- ${t}`,W0=t=>M.isFunction(t)||t===null||t===!1,Ca={getAdapter:t=>{t=M.isArray(t)?t:[t];const{length:n}=t;let e,r;const o={};for(let a=0;a<n;a++){e=t[a];let c;if(r=e,!W0(e)&&(r=Fr[(c=String(e)).toLowerCase()],r===void 0))throw new ce(`Unknown adapter '${c}'`);if(r)break;o[c||"#"+a]=r}if(!r){const a=Object.entries(o).map(([u,f])=>`adapter ${u} `+(f===!1?"is not supported by the environment":"is not available in the build"));let c=n?a.length>1?`since :
`+a.map(to).join(`
`):" "+to(a[0]):"as no adapter specified";throw new ce("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return r},adapters:Fr};function Wn(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new It(null,t)}function no(t){return Wn(t),t.headers=Je.from(t.headers),t.data=On.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ca.getAdapter(t.adapter||Wr.adapter)(t).then(function(r){return Wn(t),r.data=On.call(t,t.transformResponse,r),r.headers=Je.from(r.headers),r},function(r){return ga(r)||(Wn(t),r&&r.response&&(r.response.data=On.call(t,t.transformResponse,r.response),r.response.headers=Je.from(r.response.headers))),Promise.reject(r)})}const wa="1.10.0",_n={};["object","boolean","number","function","string","symbol"].forEach((t,n)=>{_n[t]=function(r){return typeof r===t||"a"+(n<1?"n ":" ")+t}});const ro={};_n.transitional=function(n,e,r){function o(a,c){return"[Axios v"+wa+"] Transitional option '"+a+"'"+c+(r?". "+r:"")}return(a,c,u)=>{if(n===!1)throw new ce(o(c," has been removed"+(e?" in "+e:"")),ce.ERR_DEPRECATED);return e&&!ro[c]&&(ro[c]=!0,console.warn(o(c," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(a,c,u):!0}};_n.spelling=function(n){return(e,r)=>(console.warn(`${r} is likely a misspelling of ${n}`),!0)};function N0(t,n,e){if(typeof t!="object")throw new ce("options must be an object",ce.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let o=r.length;for(;o-- >0;){const a=r[o],c=n[a];if(c){const u=t[a],f=u===void 0||c(u,a,t);if(f!==!0)throw new ce("option "+a+" must be "+f,ce.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new ce("Unknown option "+a,ce.ERR_BAD_OPTION)}}const fn={assertOptions:N0,validators:_n},it=fn.validators;class mn{constructor(n){this.defaults=n||{},this.interceptors={request:new Kr,response:new Kr}}async request(n,e){try{return await this._request(n,e)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const a=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(n,e){typeof n=="string"?(e=e||{},e.url=n):e=n||{},e=Et(this.defaults,e);const{transitional:r,paramsSerializer:o,headers:a}=e;r!==void 0&&fn.assertOptions(r,{silentJSONParsing:it.transitional(it.boolean),forcedJSONParsing:it.transitional(it.boolean),clarifyTimeoutError:it.transitional(it.boolean)},!1),o!=null&&(M.isFunction(o)?e.paramsSerializer={serialize:o}:fn.assertOptions(o,{encode:it.function,serialize:it.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),fn.assertOptions(e,{baseUrl:it.spelling("baseURL"),withXsrfToken:it.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let c=a&&M.merge(a.common,a[e.method]);a&&M.forEach(["delete","get","head","post","put","patch","common"],v=>{delete a[v]}),e.headers=Je.concat(c,a);const u=[];let f=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(e)===!1||(f=f&&C.synchronous,u.unshift(C.fulfilled,C.rejected))});const s=[];this.interceptors.response.forEach(function(C){s.push(C.fulfilled,C.rejected)});let i,g=0,d;if(!f){const v=[no.bind(this),void 0];for(v.unshift.apply(v,u),v.push.apply(v,s),d=v.length,i=Promise.resolve(e);g<d;)i=i.then(v[g++],v[g++]);return i}d=u.length;let b=e;for(g=0;g<d;){const v=u[g++],C=u[g++];try{b=v(b)}catch(x){C.call(this,x);break}}try{i=no.call(this,b)}catch(v){return Promise.reject(v)}for(g=0,d=s.length;g<d;)i=i.then(s[g++],s[g++]);return i}getUri(n){n=Et(this.defaults,n);const e=pa(n.baseURL,n.url,n.allowAbsoluteUrls);return fa(e,n.params,n.paramsSerializer)}}M.forEach(["delete","get","head","options"],function(n){mn.prototype[n]=function(e,r){return this.request(Et(r||{},{method:n,url:e,data:(r||{}).data}))}});M.forEach(["post","put","patch"],function(n){function e(r){return function(a,c,u){return this.request(Et(u||{},{method:n,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}mn.prototype[n]=e(),mn.prototype[n+"Form"]=e(!0)});const xn=mn;class Nr{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(a){e=a});const r=this;this.promise.then(o=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](o);r._listeners=null}),this.promise.then=o=>{let a;const c=new Promise(u=>{r.subscribe(u),a=u}).then(o);return c.cancel=function(){r.unsubscribe(a)},c},n(function(a,c,u){r.reason||(r.reason=new It(a,c,u),e(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const e=this._listeners.indexOf(n);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const n=new AbortController,e=r=>{n.abort(r)};return this.subscribe(e),n.signal.unsubscribe=()=>this.unsubscribe(e),n.signal}static source(){let n;return{token:new Nr(function(o){n=o}),cancel:n}}}const L0=Nr;function H0(t){return function(e){return t.apply(null,e)}}function U0(t){return M.isObject(t)&&t.isAxiosError===!0}const Tr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Tr).forEach(([t,n])=>{Tr[n]=t});const j0=Tr;function Ea(t){const n=new xn(t),e=ea(xn.prototype.request,n);return M.extend(e,xn.prototype,n,{allOwnKeys:!0}),M.extend(e,n,null,{allOwnKeys:!0}),e.create=function(o){return Ea(Et(t,o))},e}const Be=Ea(Wr);Be.Axios=xn;Be.CanceledError=It;Be.CancelToken=L0;Be.isCancel=ga;Be.VERSION=wa;Be.toFormData=Cn;Be.AxiosError=ce;Be.Cancel=Be.CanceledError;Be.all=function(n){return Promise.all(n)};Be.spread=H0;Be.isAxiosError=U0;Be.mergeConfig=Et;Be.AxiosHeaders=Je;Be.formToJSON=t=>va(M.isHTMLForm(t)?new FormData(t):t);Be.getAdapter=Ca.getAdapter;Be.HttpStatusCode=j0;Be.default=Be;const oo=Be,_a=`${Date.now()+86400}:spacechat`,Aa="temporary_credential";let Ba=!1;async function q0(){try{const t={}.VITE_API_URL||window.location.origin;console.log(`Fetching TURN credentials from ${t}/api/turn-credentials`);const n=new AbortController,e=setTimeout(()=>n.abort(),5e3),r=await oo.get(`${t}/api/turn-credentials`,{signal:n.signal,timeout:5e3});return clearTimeout(e),r.data&&r.data.success&&r.data.rtcConfig?(Ba=!0,console.log("Successfully fetched TURN credentials from server"),r.data.rtcConfig):(console.warn("Server returned invalid TURN credentials format, using fallback"),null)}catch(t){return oo.isAxiosError(t)?t.code==="ECONNABORTED"||t.message.includes("timeout")?console.error("TURN credentials request timed out"):t.response?console.error(`TURN credentials request failed with status ${t.response.status}`):t.request?console.error("TURN credentials request made but no response received"):console.error("Failed to fetch TURN credentials:",t.message):console.error("Failed to fetch TURN credentials, using fallback:",t),null}}const Lr={iceServers:[{urls:["turns:global.relay.metered.ca:443","turn:global.relay.metered.ca:443?transport=tcp","turn:global.relay.metered.ca:80?transport=tcp","turn:global.relay.metered.ca:80"],username:_a,credential:Aa},{urls:["turn:relay.metered.ca:80","turn:relay.metered.ca:443","turns:relay.metered.ca:443"],username:"dbc12a",credential:"c84ded89b281ae42"},{urls:["turn:global.turn.twilio.com:3478?transport=tcp","turn:global.turn.twilio.com:3478?transport=udp","turns:global.turn.twilio.com:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"},{urls:"stun:openrelay.metered.ca:80"},{urls:"stun:stun.stunprotocol.org:3478"},{urls:"stun:stun.voip.blackberry.com:3478"}],iceCandidatePoolSize:15,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},ao={iceServers:[{urls:["turns:global.relay.metered.ca:443","turn:global.relay.metered.ca:443?transport=tcp","turn:global.relay.metered.ca:80?transport=tcp","turns:relay.metered.ca:443"],username:_a,credential:Aa},{urls:["turn:relay.metered.ca:443?transport=tcp","turns:relay.metered.ca:443"],username:"dbc12a",credential:"c84ded89b281ae42"},{urls:["turns:global.turn.twilio.com:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"},{urls:["turn:numb.viagenie.ca:3478?transport=tcp","turns:numb.viagenie.ca:443?transport=tcp"],username:"webrtc@live.com",credential:"muazkh"}],iceCandidatePoolSize:15,iceTransportPolicy:"relay",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},so={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun.cloudflare.com:3478","stun:stun.stunprotocol.org:3478"]},{urls:["turn:relay.metered.ca:443?transport=tcp","turn:global.relay.metered.ca:80"],username:"dbc12a",credential:"c84ded89b281ae42"}],iceCandidatePoolSize:8,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};async function z0(){if(!Ba){const t=await q0();if(t)return t}return Lr}function G0(){const t="test";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(n){return console.error("localStorage is not available:",n),!1}}function ka(){const t=W(G0());function n(a,c){if(!t.value){console.warn("localStorage is not available, cannot set item");return}try{localStorage.setItem(a,c)}catch(u){console.error("Failed to set localStorage item:",u)}}function e(a){if(!t.value)return console.warn("localStorage is not available, cannot get item"),null;try{return localStorage.getItem(a)}catch(c){return console.error("Failed to get localStorage item:",c),null}}function r(a){if(!t.value){console.warn("localStorage is not available, cannot remove item");return}try{localStorage.removeItem(a)}catch(c){console.error("Failed to remove localStorage item:",c)}}function o(){if(!t.value){console.warn("localStorage is not available, cannot clear storage");return}try{localStorage.clear()}catch(a){console.error("Failed to clear localStorage:",a)}}return{isAvailable:t,setItem:n,getItem:e,removeItem:r,clear:o}}function Gt(){const{getItem:t,setItem:n}=ka(),e="spacechat_microphone_muted";function r(c){n(e,c?"true":"false")}function o(){const c=t(e);return c===null?null:c==="true"}function a(c){return new Promise(async u=>{try{const f=o();f!==null&&(console.log(`[Storage] Found saved microphone state: ${f?"muted":"unmuted"}`),f===!0&&await c())}catch(f){console.error("[Storage] Error applying saved microphone state:",f)}u()})}return{saveMicrophoneState:r,getSavedMicrophoneState:o,applySavedMicrophoneState:a}}let Ct=Lr;const Da=W(Ct);z0().then(t=>{Ct=t,Da.value=t,console.log("Loaded optimal WebRTC configuration from server")}).catch(t=>{console.error("Failed to load optimal configuration, using fallback:",t)});let Z=null,oe=null,le=null;const $e=W("new"),Ve=W(!1),Ke=W(null),re=!0;let Le="",Ze="",io=null,Me=!1,sn=!1,Oe=0;const yt=15;let Ye=[],Tt=null;const V0=8e3,K0=800;let qt=null,lt=0;const Nn=5,Y0=1e3;async function Fa(){if(!Z)return{error:"No peer connection available"};try{const t={};return(await Z.getStats()).forEach(e=>{e.type==="transport"?t.transport={bytesReceived:e.bytesReceived,bytesSent:e.bytesSent,dtlsState:e.dtlsState,selectedCandidatePairId:e.selectedCandidatePairId}:e.type==="candidate-pair"&&e.selected?t.selectedCandidatePair={localCandidateId:e.localCandidateId,remoteCandidateId:e.remoteCandidateId,state:e.state,availableOutgoingBitrate:e.availableOutgoingBitrate}:e.type==="local-candidate"||e.type==="remote-candidate"?(t.candidates||(t.candidates=[]),t.candidates.push({type:e.type,id:e.id,ip:e.ip,port:e.port,protocol:e.protocol,candidateType:e.candidateType})):(e.type==="media-source"||e.type==="track"||e.type==="media-playout")&&(t.media||(t.media=[]),t.media.push({type:e.type,id:e.id,kind:e.kind,audioLevel:e.audioLevel,trackIdentifier:e.trackIdentifier}))}),t}catch(t){return console.error("[WebRTC] Error getting stats:",t),{error:"Failed to get stats: "+t}}}function X0(){Sr();const t=setInterval(async()=>{Z&&($e.value==="connected"||$e.value==="connecting")?(io=await Fa(),console.log("[WebRTC] Connection stats:",io)):Sr()},5e3);window.__webrtcStatsTimer=t}function Sr(){const t=window.__webrtcStatsTimer;t&&(clearInterval(t),window.__webrtcStatsTimer=null)}function Ta(){const{socket:t,userId:n,isInSetupContext:e}=Ie(),r=Pn(Z),o=Pn(oe),a=Pn(le),c=$e,u=Ve,f=Ke;W({echoCancellation:!0,noiseSuppression:!0});const s=async()=>{if(oe&&oe.getAudioTracks().length>0)return console.log("[WebRTC] Reusing existing local stream"),oe;try{re&&console.log("[WebRTC] Requesting microphone access");const k=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1}),S=k.getAudioTracks();if(S.length===0)throw new Error("No audio tracks available in media stream");re&&(console.log(`[WebRTC] Got local stream with ${S.length} audio tracks`),console.log("[WebRTC] Audio track settings:",S[0].getSettings())),oe=k,o.value=k;const{getSavedMicrophoneState:_}=Gt();return _()===!0?(re&&console.log("[WebRTC] Applying saved mute state to new stream (muted)"),S.forEach($=>{$.enabled=!1}),Ve.value=!0,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!0}}))):(S.forEach($=>{$.enabled=!0}),Ve.value=!1),k}catch(k){throw console.error("[WebRTC] Error accessing microphone:",k),Ze=`Failed to access microphone: ${k}`,k}},i=()=>{if(Z)try{Z.close(),Z=null,le&&(le.getTracks().forEach(k=>{k.stop()}),le=null)}catch(k){console.error("[WebRTC] Error cleaning up old peer connection:",k)}try{const k=new RTCPeerConnection(Da.value);return k.onnegotiationneeded=async S=>{if(re&&console.log("[WebRTC] Negotiation needed event",S),!Q0(k)||Me){re&&console.log("[WebRTC] Skipping negotiation - already in progress or not in stable state");return}Me=!0;try{re&&console.log("[WebRTC] Starting negotiation"),B()}catch(_){console.error("[WebRTC] Negotiation error:",_),Ze=`Negotiation error: ${_}`,Me=!1}},k.oniceconnectionstatechange=()=>{re&&console.log("[WebRTC] ICE Connection state changed to:",k.iceConnectionState),k.iceConnectionState==="connected"||k.iceConnectionState==="completed"?(Ze="",Oe=0,D(),X0()):(k.iceConnectionState==="disconnected"||k.iceConnectionState==="failed"||k.iceConnectionState==="closed")&&(St(k.iceConnectionState),re&&console.log("[WebRTC] ICE Connection terminated:",k.iceConnectionState),Ke.value&&t.value&&t.value.emit("webrtc-connection-state",{to:Ke.value,state:k.iceConnectionState,reason:"ice-connection-state-change"}),(k.iceConnectionState==="failed"||k.iceConnectionState==="closed")&&setTimeout(()=>{(k.iceConnectionState==="failed"||k.iceConnectionState==="closed")&&St("failed")},2e3))},k.onicecandidate=S=>{var _;S.candidate?(re&&console.log("[WebRTC] New ICE candidate:",S.candidate),window.__localIceCandidates||(window.__localIceCandidates=[]),window.__localIceCandidates.push(S.candidate),f.value?(_=t.value)==null||_.emit("webrtc-signal",{type:"ice-candidate",candidate:S.candidate,to:f.value}):(Ye.push(S.candidate),re&&console.log("[WebRTC] Storing ICE candidate for later. Total pending:",Ye.length))):(re&&console.log("[WebRTC] ICE gathering complete"),Ye.length>0&&f.value&&(Ye.forEach(X=>{var $;($=t.value)==null||$.emit("webrtc-signal",{type:"ice-candidate",candidate:X,to:f.value})}),re&&console.log(`[WebRTC] Sent ${Ye.length} pending ICE candidates`),Ye=[]))},k.onicegatheringstatechange=()=>{re&&console.log("[WebRTC] ICE gathering state changed to:",k.iceGatheringState)},k.onconnectionstatechange=()=>{re&&console.log("[WebRTC] Connection state changed to:",k.connectionState),St(k.connectionState),k.connectionState==="connected"?(Ze="",Oe=0):(k.connectionState==="failed"||k.connectionState==="disconnected"||k.connectionState==="closed")&&k.connectionState==="failed"&&!Ze&&(Ze="PeerConnection failed")},k.onsignalingstatechange=()=>{re&&console.log("[WebRTC] Signaling state changed to:",k.signalingState),k.signalingState==="stable"&&(Me=!1)},k.ontrack=S=>{re&&console.log("[WebRTC] Track received:",S.track),le||(le=new MediaStream,a.value=le,console.log("[WebRTC] Created new remote stream")),le.addTrack(S.track),console.log(`[WebRTC] Added ${S.track.kind} track to remote stream, now has ${le.getTracks().length} tracks`),setTimeout(()=>{if(le){const _=le.getTracks();console.log(`[WebRTC] Remote stream has ${_.length} tracks after adding`),_.forEach(X=>{console.log(`[WebRTC] Track: ${X.kind}, enabled: ${X.enabled}, muted: ${X.muted}, readyState: ${X.readyState}`),X.kind==="audio"&&(!X.enabled||X.muted)&&(console.log("[WebRTC] 🔴 Found disabled or muted audio track, enabling it"),X.enabled=!0)})}},500),re&&(S.track.onunmute=()=>{console.log("[WebRTC] Track unmuted:",S.track.kind)},S.track.onmute=()=>{console.log("[WebRTC] Track muted:",S.track.kind),S.track.enabled=!0},S.track.onended=()=>{console.log("[WebRTC] Track ended:",S.track.kind)})},T(k),Z=k,k}catch(k){throw console.error("[WebRTC] Error creating peer connection:",k),Le=`Creation error: ${k}`,Ze="Failed to create connection",St("failed"),k}},g=async k=>{if(!k||!t.value){const S="لا يمكن إنشاء الاتصال: معرّف الشريك أو الاتصال غير متوفر";return console.error(`[WebRTC] ${S}`),Le=S,{error:S}}Ke.value=k,f.value=k;try{oe||await s();const S=i();if(oe)oe.getTracks().forEach(_=>{S.addTrack(_,oe)});else throw new Error("لا يمكن الوصول للميكروفون");return St("connecting"),S}catch(S){return console.error("[WebRTC] Error establishing connection:",S),Le=`خطأ في إنشاء الاتصال: ${S}`,{error:Le}}},d=async k=>{if(window.__webrtcConnectionTimeout&&clearTimeout(window.__webrtcConnectionTimeout),Me)return console.warn("[WebRTC] مفاوضة جارية بالفعل، تأجيل العرض الجديد"),new Promise(S=>{setTimeout(async()=>{S(Me?{waiting:"Negotiation in progress"}:await d(k))},1e3)});Me=!0;try{const S=await g(k);if(S.error)return S;re&&console.log("[WebRTC] Creating offer");const _=await S.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1});return re&&console.log("[WebRTC] Setting local description"),await S.setLocalDescription(_),t.value&&k&&(t.value.emit("voice-offer",{offer:S.localDescription,to:k}),t.value.emit("webrtc-signal",{type:"offer",offer:S.localDescription,to:k})),T(S),D(),re&&console.log("[WebRTC] Offer creation complete"),{success:!0}}catch(S){return console.error("[WebRTC] Error creating offer:",S),Le=`Error creating offer: ${S}`,Me=!1,{error:`Failed to create offer: ${S}`}}finally{setTimeout(()=>{Me=!1},2e3)}},b=k=>k.iceGatheringState==="complete"?(console.log("[WebRTC] ICE gathering already complete"),Promise.resolve()):new Promise(S=>{const _=()=>{k.iceGatheringState==="complete"&&(k.removeEventListener("icegatheringstatechange",_),S())};k.addEventListener("icegatheringstatechange",_),setTimeout(()=>{k.removeEventListener("icegatheringstatechange",_),console.log("[WebRTC] ICE gathering timed out, but continuing anyway"),S()},500)}),v=async(k,S)=>{if(!t.value){console.error("[WebRTC] Cannot handle offer: socket not available");return}console.log("[WebRTC] Received offer from:",S),console.log("[WebRTC] Offer SDP:",k.sdp),Ke.value=S,f.value=S;try{oe||(re&&console.log("[WebRTC] Initializing local stream before handling offer"),await s());const _=i();if(oe&&(_.getSenders().length===0?(re&&console.log("[WebRTC] Adding local tracks to connection"),oe.getTracks().forEach(U=>{_.addTrack(U,oe)})):re&&console.log("[WebRTC] Senders already exist, not adding tracks again")),$e.value="connecting",c.value="connecting",re&&console.log("[WebRTC] Setting remote description (offer)"),await _.setRemoteDescription(new RTCSessionDescription(k)),Ye.length>0){re&&console.log(`[WebRTC] Adding ${Ye.length} pending ICE candidates`);for(const $ of Ye)try{await _.addIceCandidate($)}catch(U){console.error("[WebRTC] Error adding pending ICE candidate:",U)}Ye=[]}re&&console.log("[WebRTC] Creating answer");const X=await _.createAnswer({offerToReceiveAudio:!0});re&&console.log("[WebRTC] Answer SDP:",X.sdp),re&&console.log("[WebRTC] Setting local description (answer)"),await _.setLocalDescription(X),_.getTransceivers().forEach($=>{if($.receiver.track.kind==="audio"&&(console.log("[WebRTC] Ensuring audio transceiver is set to receive"),$.direction!=="sendrecv"&&$.direction!=="recvonly"))try{$.direction="sendrecv"}catch(U){console.error("[WebRTC] Could not update transceiver direction:",U)}}),await b(_),re&&console.log("[WebRTC] Sending answer to:",S),t.value.emit("voice-answer",{answer:_.localDescription,to:S}),t.value.emit("webrtc-signal",{type:"answer",answer:_.localDescription,to:S}),T(_),D(),re&&console.log("[WebRTC] Offer handling and answer creation complete")}catch(_){console.error("[WebRTC] Error handling offer:",_),Le=`Error handling offer: ${_}`,setTimeout(()=>{t.value&&f.value&&(console.log("[WebRTC] Re-negotiating after offer error"),d(f.value))},2e3)}},C=async k=>{try{if(!Z){re&&console.log("[WebRTC] Cannot handle answer: no peer connection available");return}const S=Z.signalingState;if(re&&console.log(`[WebRTC] Current signaling state before handling answer: ${S}`),S==="have-local-offer"){re&&console.log("[WebRTC] Setting remote description from answer");try{await Z.setRemoteDescription(new RTCSessionDescription(k)),re&&console.log("[WebRTC] Remote description set successfully, signaling state now: "+Z.signalingState)}catch(_){if(console.error("[WebRTC] Error setting remote description:",_),_.toString().includes("InvalidStateError"))if(console.warn("[WebRTC] Invalid state error, attempting to recover"),await new Promise(X=>setTimeout(X,1e3)),Z.signalingState==="have-local-offer")try{re&&console.log("[WebRTC] Retrying set remote description after delay"),await Z.setRemoteDescription(new RTCSessionDescription(k)),re&&console.log("[WebRTC] Remote description set successfully on retry")}catch(X){console.error("[WebRTC] Final error setting remote description:",X)}else console.warn(`[WebRTC] Cannot set remote answer, wrong state: ${Z.signalingState}`)}}else console.warn(`[WebRTC] Cannot set remote description: wrong signaling state: ${S}`),S==="stable"?re&&console.log("[WebRTC] Already in stable state, ignoring answer"):S==="have-remote-offer"&&(console.warn("[WebRTC] We have a remote offer but received an answer - signaling confusion"),Oe<yt&&(Oe++,re&&console.log(`[WebRTC] Resetting connection due to signaling confusion (${Oe}/${yt})`),p(),setTimeout(()=>{f.value&&d(f.value)},2e3)))}catch(S){console.error("[WebRTC] Error handling answer:",S),Le=`Error handling answer: ${S}`,console.log("[WebRTC] Attempting to recover from answer error"),Oe<yt&&await y()}},x=async()=>{const k=!Ve.value,{saveMicrophoneState:S}=Gt();if(S(k),k)return console.log("[WebRTC] Muting microphone - stopping all tracks"),oe&&oe.getAudioTracks().forEach(_=>{_.enabled=!1}),Ve.value=!0,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!0}})),!0;console.log("[WebRTC] Unmuting microphone");try{if(oe&&oe.getAudioTracks().length>0)return oe.getAudioTracks().forEach(X=>{X.enabled=!0}),Ve.value=!1,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!1}})),!0;const _=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1});if(_.getAudioTracks().length===0)throw new Error("No audio tracks available");if(oe=_,o.value=_,Z&&_)try{const $=Z.getSenders().find(U=>U.track&&U.track.kind==="audio");if($){const U=_.getAudioTracks()[0];U&&$.replaceTrack(U)}else _.getAudioTracks().length>0&&_.getAudioTracks().forEach(U=>{Z&&Z.addTrack(U,_)})}catch(X){console.error("[WebRTC] Error adding audio tracks:",X)}return Ve.value=!1,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!1}})),!0}catch(_){console.error("[WebRTC] Error unmuting microphone:",_);try{const X=await navigator.mediaDevices.getUserMedia({audio:!0});return oe=X,o.value=X,Ve.value=!1,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!1}})),!0}catch(X){return console.error("[WebRTC] Fallback microphone access also failed:",X),!1}}},p=()=>{if(console.log("[WebRTC] Closing connection"),F(),Z){try{Z.ontrack=null,Z.onicecandidate=null,Z.oniceconnectionstatechange=null,Z.onicegatheringstatechange=null,Z.onsignalingstatechange=null,Z.onconnectionstatechange=null;try{Z.getTransceivers&&Z.getTransceivers().forEach(k=>{k.stop&&k.stop()})}catch{}Z.close(),re&&console.log("[WebRTC] Peer connection closed")}catch(k){console.error("[WebRTC] Error closing peer connection:",k)}Z=null}le&&(le.getTracks().forEach(k=>{k.stop()}),le=new MediaStream,a.value=le),$e.value="closed",c.value="closed",window.dispatchEvent(new CustomEvent("connection-closed",{detail:{timestamp:Date.now()}}))},m=()=>{p(),H(),oe&&(oe.getTracks().forEach(k=>{k.stop()}),oe=null,o.value=null),le&&(le.getTracks().forEach(k=>{k.stop()}),le=new MediaStream,a.value=le),Z=null,r.value=null,$e.value="closed",c.value="closed",lt=0};function h(){var k,S;if(!t.value){console.log("[WebRTC] No socket available, cannot set up listeners");return}console.log("[WebRTC] Setting up socket listeners"),t.value.off("webrtc-signal"),t.value.off("ice-candidate"),t.value.off("partner-disconnected"),t.value.off("webrtc-connection-failed"),t.value.off("connection-timeout"),t.value.off("webrtc-connection-state"),t.value.off("voice-offer"),t.value.off("voice-answer"),t.value.on("webrtc-signal",async _=>{if(console.log(`[WebRTC] Received ${_.type} signal from ${_.from}`),Ke.value=_.from,f.value=_.from,_.type==="offer"&&_.offer)try{await v(_.offer,_.from)}catch(X){console.error("[WebRTC] Error handling offer:",X),Le=`Error handling offer: ${X}`,t.value&&t.value.emit("webrtc-connection-failed",{to:_.from,reason:`Failed to handle offer: ${X}`})}else if(_.type==="answer"&&_.answer)try{await C(_.answer)}catch(X){console.error("[WebRTC] Error handling answer:",X),Le=`Error handling answer: ${X}`,t.value&&t.value.emit("webrtc-connection-failed",{to:_.from,reason:`Failed to handle answer: ${X}`})}}),t.value.on("ice-candidate",async _=>{if(console.log(`[WebRTC] Received ICE candidate from ${_.from}`),_.from!==f.value){console.log("[WebRTC] Ignoring ICE candidate from different partner");return}try{await j(_.candidate)}catch(X){console.error("[WebRTC] Error handling ICE candidate:",X),Le=`Error handling ICE candidate: ${X}`}}),t.value.on("webrtc-connection-failed",_=>{console.log(`[WebRTC] Connection failed notification from ${_.from}: ${_.reason}`),Oe<yt?(Oe++,console.log(`[WebRTC] Partner reported connection failure. Retry ${Oe}/${yt}`),_.from===f.value&&setTimeout(()=>{f.value&&t.value&&d(_.from)},K0)):($e.value="failed",Le=`Partner reported failure: ${_.reason}`)}),t.value.on("partner-disconnected",(_={})=>{console.log("[WebRTC] Partner disconnected event:",_),p(),F(),Sr(),Ke.value=null,f.value=null,$e.value="closed",c.value="closed",_&&_.reason&&console.log(`[WebRTC] Disconnection reason: ${_.reason}`),console.log("[WebRTC] WebRTC connection fully closed due to partner disconnection"),window.dispatchEvent(new CustomEvent("connection-state-changed",{detail:{state:"disconnected",reason:_.reason||"partner-left"}}))}),t.value.on("webrtc-connection-state",_=>{console.log(`[WebRTC] Received connection state update from partner: ${_.state} (reason: ${_.reason})`),(_.state==="failed"||_.state==="closed"||_.state==="disconnected")&&(_.state==="failed"||_.state==="closed"?(St("failed"),window.dispatchEvent(new CustomEvent("connection-state-changed",{detail:{state:"failed",reason:_.reason||"connection-failed"}})),Z&&Z.connectionState!=="closed"&&(console.log("[WebRTC] Closing local connection due to remote state:",_.state),p())):(console.log("[WebRTC] Partner connection state is disconnected, waiting to see if it recovers"),window.dispatchEvent(new CustomEvent("connection-state-changed",{detail:{state:"disconnected",reason:"network-disconnect",temporary:!0}}))))}),t.value.on("disconnect-partner",()=>{console.log("[WebRTC] Disconnect partner event received - preserving mic mute state");const _=Ve.value;console.log(`[WebRTC] Current mute state before disconnect: ${_?"muted":"unmuted"}`)}),t.value.on("matched",async _=>{if(console.log("[WebRTC] Matched event received - ensuring mic state is correct"),_&&_.partnerId&&(f.value=_.partnerId,Ke.value=_.partnerId),oe&&oe.getAudioTracks().length>0){const{getSavedMicrophoneState:X}=Gt(),$=X();$!==null&&(console.log(`[WebRTC] Applying saved mic state to active stream: ${$?"muted":"unmuted"}`),oe.getAudioTracks().forEach(U=>{U.enabled=!$}),Ve.value=$,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:$}})))}else try{await s()}catch(X){console.error("[WebRTC] Error initializing stream after match:",X)}}),(k=t.value)==null||k.on("disconnect",()=>{console.log("[WebRTC] Socket disconnected, cleaning up WebRTC connection"),H()}),(S=t.value)==null||S.on("reconnect",()=>{console.log("[WebRTC] Socket reconnected, attempting to recover WebRTC connection"),Ke.value&&qt===null&&P(Ke.value)})}h(),ft(()=>{H()});async function y(){if(!(!Z||!f.value)){console.log("[WebRTC] Attempting connection recovery");try{if(sn=!0,Ct===Lr?(Ct=so,console.log("[WebRTC] Switching to fast configuration for quicker connection")):Oe>5&&(Ct=ao,console.log("[WebRTC] Switching to TURN-only configuration")),Z.restartIce){Z.restartIce();const k=await Z.createOffer({iceRestart:!0,offerToReceiveAudio:!0});await Z.setLocalDescription(k),t.value&&(t.value.emit("offer",{offer:Z.localDescription,to:f.value}),t.value.emit("webrtc-signal",{type:"offer",offer:Z.localDescription,to:f.value}))}setTimeout(()=>{sn=!1},500)}catch(k){console.error("[WebRTC] Recovery attempt failed:",k),sn=!1,Oe<yt&&setTimeout(()=>{p(),f.value&&d(f.value)},200)}}}function w(){typeof window<"u"&&(window.__webrtc_debug={connectionState:$e.value,connectionRetryCount:Oe,lastConnectionError:Le,failureReason:Ze,isNegotiating:Me,isRestartingIce:sn,pendingCandidates:Ye.length,hasLocalTracks:oe?oe.getAudioTracks().length>0:!1,hasRemoteTracks:le?le.getAudioTracks().length>0:!1})}De(()=>$e.value,()=>{w()});function D(){Tt&&clearInterval(Tt),typeof window<"u"&&(window.__localIceCandidates=[],window.__remoteIceCandidates=[],window.__iceCandidatePairs=[]),Z&&(Z.onicecandidate=k=>{k.candidate&&(console.log("[WebRTC] ICE candidate generated:",k.candidate.candidate),typeof window<"u"&&(window.__localIceCandidates=window.__localIceCandidates||[],window.__localIceCandidates.push({candidate:k.candidate.candidate,timestamp:Date.now()})),t.value&&Ke.value&&t.value.emit("ice-candidate",{candidate:k.candidate,to:Ke.value}))}),Tt=window.setInterval(()=>{if(!Z||$e.value!=="connecting"&&$e.value!=="connected"){F();return}try{Q(),Fa().then(k=>{k&&k.iceCandidatePairs&&typeof window<"u"&&(window.__iceCandidatePairs=k.iceCandidatePairs)})}catch(k){console.error("[WebRTC] Error monitoring connection:",k)}},V0)}function F(){Tt&&(clearInterval(Tt),Tt=null)}function T(k){if(!f.value)return;window.__webrtcConnectionTimeout&&clearTimeout(window.__webrtcConnectionTimeout);const S=5e3;window.__webrtcConnectionTimeout=setTimeout(()=>{(k.connectionState==="connecting"||k.connectionState==="new")&&(console.log(`[WebRTC] Connection not established after ${S/1e3} seconds, trying fast config`),Ct=so,f.value&&!Me&&d(f.value),window.__webrtcConnectionTimeout=setTimeout(()=>{var _,X,$;if(k.connectionState==="connecting"||k.connectionState==="new"){console.log("[WebRTC] Connection still not established, trying TURN-only config");const U={localCandidates:((_=window.__localIceCandidates)==null?void 0:_.length)||0,remoteCandidates:((X=window.__remoteIceCandidates)==null?void 0:X.length)||0,iceCandidatePairsCount:(($=window.__iceCandidatePairs)==null?void 0:$.length)||0};console.log("[WebRTC] Connection diagnostic info:",JSON.stringify(U)),Ct=ao,p(),f.value&&setTimeout(()=>{d(f.value)},200)}},5e3))},S)}const j=async k=>{if(!Z){console.log("[WebRTC] Received ICE candidate but no peer connection exists");return}try{if(re&&console.log("[WebRTC] Adding received ICE candidate:",k.candidate),window.__remoteIceCandidates||(window.__remoteIceCandidates=[]),window.__remoteIceCandidates.push(k),!Z.remoteDescription||!Z.localDescription){re&&console.log("[WebRTC] Delaying ICE candidate addition until descriptions are set"),setTimeout(async()=>{if(Z&&Z.remoteDescription){re&&console.log("[WebRTC] Adding delayed ICE candidate after timeout");try{await Z.addIceCandidate(k)}catch(S){console.error("[WebRTC] Error adding delayed ICE candidate:",S)}}},1e3);return}await Z.addIceCandidate(k),re&&console.log("[WebRTC] Successfully added ICE candidate")}catch(S){console.error("[WebRTC] Error adding ICE candidate:",S),Le=`Error adding ICE candidate: ${S}`,setTimeout(async()=>{if(Z&&Z.remoteDescription){console.log("[WebRTC] Retrying to add ICE candidate after error");try{await Z.addIceCandidate(k),re&&console.log("[WebRTC] Successfully added ICE candidate on retry")}catch(_){console.error("[WebRTC] Error adding ICE candidate on retry:",_)}}},2e3)}};function B(){if(!Z||!f.value||Me){console.log("[WebRTC] Cannot start negotiation: missing connection, partner ID, or already negotiating");return}console.log("[WebRTC] Starting new negotiation"),Me=!0;try{Z.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1}).then(k=>{if(Z)return Z.setLocalDescription(k)}).then(()=>{!Z||!t.value||!f.value||(t.value.emit("voice-offer",{offer:Z.localDescription,to:f.value}),re&&console.log("[WebRTC] Sent renegotiation offer"))}).catch(k=>{console.error("[WebRTC] Error during negotiation:",k)}).finally(()=>{setTimeout(()=>{Me=!1},2e3)})}catch(k){console.error("[WebRTC] Failed to start negotiation:",k),Me=!1}}const A={connectionState:$e.value,iceCandidatesGenerated:Ye.length,localStreamActive:!!oe&&oe.active,remoteStreamActive:!!le&&le.active,localTracks:oe?oe.getAudioTracks().length:0,remoteTracks:le?le.getAudioTracks().length:0,connectionRetries:Oe,lastError:Le||Ze||"",isAudioMuted:Ve.value,forceReconnect:()=>Z&&$e.value!=="new"?(y(),!0):!1},O=async()=>{if(!oe){console.log("[WebRTC] No local stream to restore microphone state on");return}const{getSavedMicrophoneState:k}=Gt(),S=k();if(S===null){console.log("[WebRTC] No saved microphone state found");return}console.log(`[WebRTC] Restoring saved microphone state: ${S?"muted":"unmuted"}`),oe&&oe.getAudioTracks().length>0&&(oe.getAudioTracks().forEach(_=>{console.log(`[WebRTC] Setting track '${_.label}' enabled = ${!S}`),_.enabled=!S}),Ve.value=S,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:S}})))},E=async(k=null)=>{await s(),await O(),i(),k&&await d(k)};function P(k){if(!k||lt>=Nn){console.log(`[WebRTC] Aborting reconnection after ${lt} attempts or missing partnerId`),H();return}lt++;const S=Y0*Math.pow(1.5,lt-1);console.log(`[WebRTC] Reconnection attempt ${lt}/${Nn} scheduled in ${S}ms`),H(),qt=window.setTimeout(async()=>{console.log(`[WebRTC] Executing reconnection attempt ${lt} to partner ${k}`);try{p(),await s(),await O(),i(),k&&await d(k),lt=0}catch(_){console.error("[WebRTC] Reconnection attempt failed:",_),lt<Nn?P(k):(console.log("[WebRTC] Maximum reconnection attempts reached. Giving up."),window.dispatchEvent(new CustomEvent("webrtc-reconnection-failed",{detail:{partnerId:k,attempts:lt}})))}},S)}function H(){qt!==null&&(clearTimeout(qt),qt=null)}function Q(){if(console.log("[WebRTC] 🔍 Diagnosing connection issues"),!Z)return console.log("[WebRTC] 🔴 No connection exists"),!1;if(console.log(`[WebRTC] Connection state: ${Z.connectionState}`),console.log(`[WebRTC] ICE connection state: ${Z.iceConnectionState}`),console.log(`[WebRTC] Signaling state: ${Z.signalingState}`),!oe||oe.getAudioTracks().length===0){console.log("[WebRTC] 🔴 No local audio stream");try{s().catch(S=>console.error("[WebRTC] Failed to reinitialize local stream:",S))}catch(S){console.error("[WebRTC] Error initializing stream:",S)}return!1}if(!le||le.getAudioTracks().length===0){console.log("[WebRTC] 🔴 No remote audio stream");const _=Z.getReceivers().filter(X=>X.track&&X.track.kind==="audio");if(_.length>0&&(le||(le=new MediaStream),_.forEach(X=>{X.track&&(console.log("[WebRTC] Adding track from receiver to remote stream:",X.track.id),le.addTrack(X.track))}),a.value=le),!le||le.getAudioTracks().length===0)return!Me&&Ke.value&&B(),!1}return setTimeout(()=>{const S=document.querySelectorAll("audio");S.length>0&&le&&(console.log(`[WebRTC] Found ${S.length} audio elements, ensuring they use remote stream`),Array.from(S).forEach((_,X)=>{_.srcObject!==le&&(console.log(`[WebRTC] Audio element ${X} not using correct stream, updating`),_.srcObject=le,_.muted=!1,_.volume=1,_.play().catch($=>console.log("[WebRTC] Error playing audio:",$)))}))},100),[...(oe==null?void 0:oe.getTracks())||[],...(le==null?void 0:le.getTracks())||[]].every(S=>S.kind!=="audio"||S.kind==="audio"&&S.enabled)||(console.log("[WebRTC] 🟠 Found disabled tracks, enabling them"),le==null||le.getAudioTracks().forEach(S=>{S.enabled=!0}),Ve.value||oe==null||oe.getAudioTracks().forEach(S=>{S.enabled=!0})),!0}return{socket:t,peerConnection:r,remoteStream:a,localStream:o,connectionState:c,isAudioMuted:u,partnerId:f,createOffer:d,handleOffer:v,handleAnswer:C,handleIceCandidate:j,toggleMicrophone:x,closeConnection:p,initializeLocalStream:s,cleanup:m,diagnosticReport:A,restoreMicrophoneState:O,initializeConnection:E,diagnoseAndFixConnection:Q,startNegotiation:B,attemptReconnection:P}}function Q0(t){return t.signalingState==="stable"||t.signalingState==="have-remote-offer"}function St(t){$e.value!==t&&(console.log(`[WebRTC] Connection state changing from ${$e.value} to ${t}`),$e.value=t,t==="connected"||t==="completed"?(Ze="",Le="",Oe=0,console.log("[WebRTC] Connection established successfully")):(t==="failed"||t==="disconnected")&&(console.warn(`[WebRTC] Connection ${t}: ${Ze||"Unknown reason"}`),t==="failed"&&(Oe++,console.log(`[WebRTC] Connection failure count: ${Oe}/${yt}`))))}const Re=[];for(let t=0;t<256;++t)Re.push((t+256).toString(16).slice(1));function Z0(t,n=0){return(Re[t[n+0]]+Re[t[n+1]]+Re[t[n+2]]+Re[t[n+3]]+"-"+Re[t[n+4]]+Re[t[n+5]]+"-"+Re[t[n+6]]+Re[t[n+7]]+"-"+Re[t[n+8]]+Re[t[n+9]]+"-"+Re[t[n+10]]+Re[t[n+11]]+Re[t[n+12]]+Re[t[n+13]]+Re[t[n+14]]+Re[t[n+15]]).toLowerCase()}let Ln;const J0=new Uint8Array(16);function ei(){if(!Ln){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ln=crypto.getRandomValues.bind(crypto)}return Ln(J0)}const ti=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),lo={randomUUID:ti};function Sa(t,n,e){var o;if(lo.randomUUID&&!n&&!t)return lo.randomUUID();t=t||{};const r=t.random??((o=t.rng)==null?void 0:o.call(t))??ei();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){if(e=e||0,e<0||e+16>n.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let a=0;a<16;++a)n[e+a]=r[a];return n}return Z0(r)}var de=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ni(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ri(t){if(t.__esModule)return t;var n=t.default;if(typeof n=="function"){var e=function r(){return this instanceof r?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};e.prototype=n.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var o=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return t[r]}})}),e}var Ra={exports:{}};function oi(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Hn={exports:{}};const ai={},si=Object.freeze(Object.defineProperty({__proto__:null,default:ai},Symbol.toStringTag,{value:"Module"})),ii=ri(si);var co;function xe(){return co||(co=1,function(t,n){(function(e,r){t.exports=r()})(de,function(){var e=e||function(r,o){var a;if(typeof window<"u"&&window.crypto&&(a=window.crypto),typeof self<"u"&&self.crypto&&(a=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(a=globalThis.crypto),!a&&typeof window<"u"&&window.msCrypto&&(a=window.msCrypto),!a&&typeof de<"u"&&de.crypto&&(a=de.crypto),!a&&typeof oi=="function")try{a=ii}catch{}var c=function(){if(a){if(typeof a.getRandomValues=="function")try{return a.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof a.randomBytes=="function")try{return a.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},u=Object.create||function(){function m(){}return function(h){var y;return m.prototype=h,y=new m,m.prototype=null,y}}(),f={},s=f.lib={},i=s.Base=function(){return{extend:function(m){var h=u(this);return m&&h.mixIn(m),(!h.hasOwnProperty("init")||this.init===h.init)&&(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var m=this.extend();return m.init.apply(m,arguments),m},init:function(){},mixIn:function(m){for(var h in m)m.hasOwnProperty(h)&&(this[h]=m[h]);m.hasOwnProperty("toString")&&(this.toString=m.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),g=s.WordArray=i.extend({init:function(m,h){m=this.words=m||[],h!=o?this.sigBytes=h:this.sigBytes=m.length*4},toString:function(m){return(m||b).stringify(this)},concat:function(m){var h=this.words,y=m.words,w=this.sigBytes,D=m.sigBytes;if(this.clamp(),w%4)for(var F=0;F<D;F++){var T=y[F>>>2]>>>24-F%4*8&255;h[w+F>>>2]|=T<<24-(w+F)%4*8}else for(var j=0;j<D;j+=4)h[w+j>>>2]=y[j>>>2];return this.sigBytes+=D,this},clamp:function(){var m=this.words,h=this.sigBytes;m[h>>>2]&=4294967295<<32-h%4*8,m.length=r.ceil(h/4)},clone:function(){var m=i.clone.call(this);return m.words=this.words.slice(0),m},random:function(m){for(var h=[],y=0;y<m;y+=4)h.push(c());return new g.init(h,m)}}),d=f.enc={},b=d.Hex={stringify:function(m){for(var h=m.words,y=m.sigBytes,w=[],D=0;D<y;D++){var F=h[D>>>2]>>>24-D%4*8&255;w.push((F>>>4).toString(16)),w.push((F&15).toString(16))}return w.join("")},parse:function(m){for(var h=m.length,y=[],w=0;w<h;w+=2)y[w>>>3]|=parseInt(m.substr(w,2),16)<<24-w%8*4;return new g.init(y,h/2)}},v=d.Latin1={stringify:function(m){for(var h=m.words,y=m.sigBytes,w=[],D=0;D<y;D++){var F=h[D>>>2]>>>24-D%4*8&255;w.push(String.fromCharCode(F))}return w.join("")},parse:function(m){for(var h=m.length,y=[],w=0;w<h;w++)y[w>>>2]|=(m.charCodeAt(w)&255)<<24-w%4*8;return new g.init(y,h)}},C=d.Utf8={stringify:function(m){try{return decodeURIComponent(escape(v.stringify(m)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(m){return v.parse(unescape(encodeURIComponent(m)))}},x=s.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(m){typeof m=="string"&&(m=C.parse(m)),this._data.concat(m),this._nDataBytes+=m.sigBytes},_process:function(m){var h,y=this._data,w=y.words,D=y.sigBytes,F=this.blockSize,T=F*4,j=D/T;m?j=r.ceil(j):j=r.max((j|0)-this._minBufferSize,0);var B=j*F,A=r.min(B*4,D);if(B){for(var O=0;O<B;O+=F)this._doProcessBlock(w,O);h=w.splice(0,B),y.sigBytes-=A}return new g.init(h,A)},clone:function(){var m=i.clone.call(this);return m._data=this._data.clone(),m},_minBufferSize:0});s.Hasher=x.extend({cfg:i.extend(),init:function(m){this.cfg=this.cfg.extend(m),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(m){return this._append(m),this._process(),this},finalize:function(m){m&&this._append(m);var h=this._doFinalize();return h},blockSize:16,_createHelper:function(m){return function(h,y){return new m.init(y).finalize(h)}},_createHmacHelper:function(m){return function(h,y){return new p.HMAC.init(m,y).finalize(h)}}});var p=f.algo={};return f}(Math);return e})}(Hn)),Hn.exports}var Un={exports:{}},uo;function An(){return uo||(uo=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){return function(r){var o=e,a=o.lib,c=a.Base,u=a.WordArray,f=o.x64={};f.Word=c.extend({init:function(s,i){this.high=s,this.low=i}}),f.WordArray=c.extend({init:function(s,i){s=this.words=s||[],i!=r?this.sigBytes=i:this.sigBytes=s.length*8},toX32:function(){for(var s=this.words,i=s.length,g=[],d=0;d<i;d++){var b=s[d];g.push(b.high),g.push(b.low)}return u.create(g,this.sigBytes)},clone:function(){for(var s=c.clone.call(this),i=s.words=this.words.slice(0),g=i.length,d=0;d<g;d++)i[d]=i[d].clone();return s}})}(),e})}(Un)),Un.exports}var jn={exports:{}},fo;function li(){return fo||(fo=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){return function(){if(typeof ArrayBuffer=="function"){var r=e,o=r.lib,a=o.WordArray,c=a.init,u=a.init=function(f){if(f instanceof ArrayBuffer&&(f=new Uint8Array(f)),(f instanceof Int8Array||typeof Uint8ClampedArray<"u"&&f instanceof Uint8ClampedArray||f instanceof Int16Array||f instanceof Uint16Array||f instanceof Int32Array||f instanceof Uint32Array||f instanceof Float32Array||f instanceof Float64Array)&&(f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength)),f instanceof Uint8Array){for(var s=f.byteLength,i=[],g=0;g<s;g++)i[g>>>2]|=f[g]<<24-g%4*8;c.call(this,i,s)}else c.apply(this,arguments)};u.prototype=a}}(),e.lib.WordArray})}(jn)),jn.exports}var qn={exports:{}},xo;function ci(){return xo||(xo=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=r.enc;c.Utf16=c.Utf16BE={stringify:function(f){for(var s=f.words,i=f.sigBytes,g=[],d=0;d<i;d+=2){var b=s[d>>>2]>>>16-d%4*8&65535;g.push(String.fromCharCode(b))}return g.join("")},parse:function(f){for(var s=f.length,i=[],g=0;g<s;g++)i[g>>>1]|=f.charCodeAt(g)<<16-g%2*16;return a.create(i,s*2)}},c.Utf16LE={stringify:function(f){for(var s=f.words,i=f.sigBytes,g=[],d=0;d<i;d+=2){var b=u(s[d>>>2]>>>16-d%4*8&65535);g.push(String.fromCharCode(b))}return g.join("")},parse:function(f){for(var s=f.length,i=[],g=0;g<s;g++)i[g>>>1]|=u(f.charCodeAt(g)<<16-g%2*16);return a.create(i,s*2)}};function u(f){return f<<8&4278255360|f>>>8&16711935}}(),e.enc.Utf16})}(qn)),qn.exports}var zn={exports:{}},vo;function _t(){return vo||(vo=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=r.enc;c.Base64={stringify:function(f){var s=f.words,i=f.sigBytes,g=this._map;f.clamp();for(var d=[],b=0;b<i;b+=3)for(var v=s[b>>>2]>>>24-b%4*8&255,C=s[b+1>>>2]>>>24-(b+1)%4*8&255,x=s[b+2>>>2]>>>24-(b+2)%4*8&255,p=v<<16|C<<8|x,m=0;m<4&&b+m*.75<i;m++)d.push(g.charAt(p>>>6*(3-m)&63));var h=g.charAt(64);if(h)for(;d.length%4;)d.push(h);return d.join("")},parse:function(f){var s=f.length,i=this._map,g=this._reverseMap;if(!g){g=this._reverseMap=[];for(var d=0;d<i.length;d++)g[i.charCodeAt(d)]=d}var b=i.charAt(64);if(b){var v=f.indexOf(b);v!==-1&&(s=v)}return u(f,s,g)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function u(f,s,i){for(var g=[],d=0,b=0;b<s;b++)if(b%4){var v=i[f.charCodeAt(b-1)]<<b%4*2,C=i[f.charCodeAt(b)]>>>6-b%4*2,x=v|C;g[d>>>2]|=x<<24-d%4*8,d++}return a.create(g,d)}}(),e.enc.Base64})}(zn)),zn.exports}var Gn={exports:{}},go;function ui(){return go||(go=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=r.enc;c.Base64url={stringify:function(f,s){s===void 0&&(s=!0);var i=f.words,g=f.sigBytes,d=s?this._safe_map:this._map;f.clamp();for(var b=[],v=0;v<g;v+=3)for(var C=i[v>>>2]>>>24-v%4*8&255,x=i[v+1>>>2]>>>24-(v+1)%4*8&255,p=i[v+2>>>2]>>>24-(v+2)%4*8&255,m=C<<16|x<<8|p,h=0;h<4&&v+h*.75<g;h++)b.push(d.charAt(m>>>6*(3-h)&63));var y=d.charAt(64);if(y)for(;b.length%4;)b.push(y);return b.join("")},parse:function(f,s){s===void 0&&(s=!0);var i=f.length,g=s?this._safe_map:this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var b=0;b<g.length;b++)d[g.charCodeAt(b)]=b}var v=g.charAt(64);if(v){var C=f.indexOf(v);C!==-1&&(i=C)}return u(f,i,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function u(f,s,i){for(var g=[],d=0,b=0;b<s;b++)if(b%4){var v=i[f.charCodeAt(b-1)]<<b%4*2,C=i[f.charCodeAt(b)]>>>6-b%4*2,x=v|C;g[d>>>2]|=x<<24-d%4*8,d++}return a.create(g,d)}}(),e.enc.Base64url})}(Gn)),Gn.exports}var Vn={exports:{}},mo;function At(){return mo||(mo=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){return function(r){var o=e,a=o.lib,c=a.WordArray,u=a.Hasher,f=o.algo,s=[];(function(){for(var C=0;C<64;C++)s[C]=r.abs(r.sin(C+1))*4294967296|0})();var i=f.MD5=u.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(C,x){for(var p=0;p<16;p++){var m=x+p,h=C[m];C[m]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360}var y=this._hash.words,w=C[x+0],D=C[x+1],F=C[x+2],T=C[x+3],j=C[x+4],B=C[x+5],A=C[x+6],O=C[x+7],E=C[x+8],P=C[x+9],H=C[x+10],Q=C[x+11],k=C[x+12],S=C[x+13],_=C[x+14],X=C[x+15],$=y[0],U=y[1],V=y[2],G=y[3];$=g($,U,V,G,w,7,s[0]),G=g(G,$,U,V,D,12,s[1]),V=g(V,G,$,U,F,17,s[2]),U=g(U,V,G,$,T,22,s[3]),$=g($,U,V,G,j,7,s[4]),G=g(G,$,U,V,B,12,s[5]),V=g(V,G,$,U,A,17,s[6]),U=g(U,V,G,$,O,22,s[7]),$=g($,U,V,G,E,7,s[8]),G=g(G,$,U,V,P,12,s[9]),V=g(V,G,$,U,H,17,s[10]),U=g(U,V,G,$,Q,22,s[11]),$=g($,U,V,G,k,7,s[12]),G=g(G,$,U,V,S,12,s[13]),V=g(V,G,$,U,_,17,s[14]),U=g(U,V,G,$,X,22,s[15]),$=d($,U,V,G,D,5,s[16]),G=d(G,$,U,V,A,9,s[17]),V=d(V,G,$,U,Q,14,s[18]),U=d(U,V,G,$,w,20,s[19]),$=d($,U,V,G,B,5,s[20]),G=d(G,$,U,V,H,9,s[21]),V=d(V,G,$,U,X,14,s[22]),U=d(U,V,G,$,j,20,s[23]),$=d($,U,V,G,P,5,s[24]),G=d(G,$,U,V,_,9,s[25]),V=d(V,G,$,U,T,14,s[26]),U=d(U,V,G,$,E,20,s[27]),$=d($,U,V,G,S,5,s[28]),G=d(G,$,U,V,F,9,s[29]),V=d(V,G,$,U,O,14,s[30]),U=d(U,V,G,$,k,20,s[31]),$=b($,U,V,G,B,4,s[32]),G=b(G,$,U,V,E,11,s[33]),V=b(V,G,$,U,Q,16,s[34]),U=b(U,V,G,$,_,23,s[35]),$=b($,U,V,G,D,4,s[36]),G=b(G,$,U,V,j,11,s[37]),V=b(V,G,$,U,O,16,s[38]),U=b(U,V,G,$,H,23,s[39]),$=b($,U,V,G,S,4,s[40]),G=b(G,$,U,V,w,11,s[41]),V=b(V,G,$,U,T,16,s[42]),U=b(U,V,G,$,A,23,s[43]),$=b($,U,V,G,P,4,s[44]),G=b(G,$,U,V,k,11,s[45]),V=b(V,G,$,U,X,16,s[46]),U=b(U,V,G,$,F,23,s[47]),$=v($,U,V,G,w,6,s[48]),G=v(G,$,U,V,O,10,s[49]),V=v(V,G,$,U,_,15,s[50]),U=v(U,V,G,$,B,21,s[51]),$=v($,U,V,G,k,6,s[52]),G=v(G,$,U,V,T,10,s[53]),V=v(V,G,$,U,H,15,s[54]),U=v(U,V,G,$,D,21,s[55]),$=v($,U,V,G,E,6,s[56]),G=v(G,$,U,V,X,10,s[57]),V=v(V,G,$,U,A,15,s[58]),U=v(U,V,G,$,S,21,s[59]),$=v($,U,V,G,j,6,s[60]),G=v(G,$,U,V,Q,10,s[61]),V=v(V,G,$,U,F,15,s[62]),U=v(U,V,G,$,P,21,s[63]),y[0]=y[0]+$|0,y[1]=y[1]+U|0,y[2]=y[2]+V|0,y[3]=y[3]+G|0},_doFinalize:function(){var C=this._data,x=C.words,p=this._nDataBytes*8,m=C.sigBytes*8;x[m>>>5]|=128<<24-m%32;var h=r.floor(p/4294967296),y=p;x[(m+64>>>9<<4)+15]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,x[(m+64>>>9<<4)+14]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,C.sigBytes=(x.length+1)*4,this._process();for(var w=this._hash,D=w.words,F=0;F<4;F++){var T=D[F];D[F]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360}return w},clone:function(){var C=u.clone.call(this);return C._hash=this._hash.clone(),C}});function g(C,x,p,m,h,y,w){var D=C+(x&p|~x&m)+h+w;return(D<<y|D>>>32-y)+x}function d(C,x,p,m,h,y,w){var D=C+(x&m|p&~m)+h+w;return(D<<y|D>>>32-y)+x}function b(C,x,p,m,h,y,w){var D=C+(x^p^m)+h+w;return(D<<y|D>>>32-y)+x}function v(C,x,p,m,h,y,w){var D=C+(p^(x|~m))+h+w;return(D<<y|D>>>32-y)+x}o.MD5=u._createHelper(i),o.HmacMD5=u._createHmacHelper(i)}(Math),e.MD5})}(Vn)),Vn.exports}var Kn={exports:{}},po;function $a(){return po||(po=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=o.Hasher,u=r.algo,f=[],s=u.SHA1=c.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(i,g){for(var d=this._hash.words,b=d[0],v=d[1],C=d[2],x=d[3],p=d[4],m=0;m<80;m++){if(m<16)f[m]=i[g+m]|0;else{var h=f[m-3]^f[m-8]^f[m-14]^f[m-16];f[m]=h<<1|h>>>31}var y=(b<<5|b>>>27)+p+f[m];m<20?y+=(v&C|~v&x)+1518500249:m<40?y+=(v^C^x)+1859775393:m<60?y+=(v&C|v&x|C&x)-1894007588:y+=(v^C^x)-899497514,p=x,x=C,C=v<<30|v>>>2,v=b,b=y}d[0]=d[0]+b|0,d[1]=d[1]+v|0,d[2]=d[2]+C|0,d[3]=d[3]+x|0,d[4]=d[4]+p|0},_doFinalize:function(){var i=this._data,g=i.words,d=this._nDataBytes*8,b=i.sigBytes*8;return g[b>>>5]|=128<<24-b%32,g[(b+64>>>9<<4)+14]=Math.floor(d/4294967296),g[(b+64>>>9<<4)+15]=d,i.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var i=c.clone.call(this);return i._hash=this._hash.clone(),i}});r.SHA1=c._createHelper(s),r.HmacSHA1=c._createHmacHelper(s)}(),e.SHA1})}(Kn)),Kn.exports}var Yn={exports:{}},ho;function Hr(){return ho||(ho=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){return function(r){var o=e,a=o.lib,c=a.WordArray,u=a.Hasher,f=o.algo,s=[],i=[];(function(){function b(p){for(var m=r.sqrt(p),h=2;h<=m;h++)if(!(p%h))return!1;return!0}function v(p){return(p-(p|0))*4294967296|0}for(var C=2,x=0;x<64;)b(C)&&(x<8&&(s[x]=v(r.pow(C,1/2))),i[x]=v(r.pow(C,1/3)),x++),C++})();var g=[],d=f.SHA256=u.extend({_doReset:function(){this._hash=new c.init(s.slice(0))},_doProcessBlock:function(b,v){for(var C=this._hash.words,x=C[0],p=C[1],m=C[2],h=C[3],y=C[4],w=C[5],D=C[6],F=C[7],T=0;T<64;T++){if(T<16)g[T]=b[v+T]|0;else{var j=g[T-15],B=(j<<25|j>>>7)^(j<<14|j>>>18)^j>>>3,A=g[T-2],O=(A<<15|A>>>17)^(A<<13|A>>>19)^A>>>10;g[T]=B+g[T-7]+O+g[T-16]}var E=y&w^~y&D,P=x&p^x&m^p&m,H=(x<<30|x>>>2)^(x<<19|x>>>13)^(x<<10|x>>>22),Q=(y<<26|y>>>6)^(y<<21|y>>>11)^(y<<7|y>>>25),k=F+Q+E+i[T]+g[T],S=H+P;F=D,D=w,w=y,y=h+k|0,h=m,m=p,p=x,x=k+S|0}C[0]=C[0]+x|0,C[1]=C[1]+p|0,C[2]=C[2]+m|0,C[3]=C[3]+h|0,C[4]=C[4]+y|0,C[5]=C[5]+w|0,C[6]=C[6]+D|0,C[7]=C[7]+F|0},_doFinalize:function(){var b=this._data,v=b.words,C=this._nDataBytes*8,x=b.sigBytes*8;return v[x>>>5]|=128<<24-x%32,v[(x+64>>>9<<4)+14]=r.floor(C/4294967296),v[(x+64>>>9<<4)+15]=C,b.sigBytes=v.length*4,this._process(),this._hash},clone:function(){var b=u.clone.call(this);return b._hash=this._hash.clone(),b}});o.SHA256=u._createHelper(d),o.HmacSHA256=u._createHmacHelper(d)}(Math),e.SHA256})}(Yn)),Yn.exports}var Xn={exports:{}},bo;function di(){return bo||(bo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Hr())})(de,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=r.algo,u=c.SHA256,f=c.SHA224=u.extend({_doReset:function(){this._hash=new a.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var s=u._doFinalize.call(this);return s.sigBytes-=4,s}});r.SHA224=u._createHelper(f),r.HmacSHA224=u._createHmacHelper(f)}(),e.SHA224})}(Xn)),Xn.exports}var Qn={exports:{}},yo;function Ia(){return yo||(yo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),An())})(de,function(e){return function(){var r=e,o=r.lib,a=o.Hasher,c=r.x64,u=c.Word,f=c.WordArray,s=r.algo;function i(){return u.create.apply(u,arguments)}var g=[i(1116352408,3609767458),i(1899447441,602891725),i(3049323471,3964484399),i(3921009573,2173295548),i(961987163,4081628472),i(1508970993,3053834265),i(2453635748,2937671579),i(2870763221,3664609560),i(3624381080,2734883394),i(310598401,1164996542),i(607225278,1323610764),i(1426881987,3590304994),i(1925078388,4068182383),i(2162078206,991336113),i(2614888103,633803317),i(3248222580,3479774868),i(3835390401,2666613458),i(4022224774,944711139),i(264347078,2341262773),i(604807628,2007800933),i(770255983,1495990901),i(1249150122,1856431235),i(1555081692,3175218132),i(1996064986,2198950837),i(2554220882,3999719339),i(2821834349,766784016),i(2952996808,2566594879),i(3210313671,3203337956),i(3336571891,1034457026),i(3584528711,2466948901),i(113926993,3758326383),i(338241895,168717936),i(666307205,1188179964),i(773529912,1546045734),i(1294757372,1522805485),i(1396182291,2643833823),i(1695183700,2343527390),i(1986661051,1014477480),i(2177026350,1206759142),i(2456956037,344077627),i(2730485921,1290863460),i(2820302411,3158454273),i(3259730800,3505952657),i(3345764771,106217008),i(3516065817,3606008344),i(3600352804,1432725776),i(4094571909,1467031594),i(275423344,851169720),i(430227734,3100823752),i(506948616,1363258195),i(659060556,3750685593),i(883997877,3785050280),i(958139571,3318307427),i(1322822218,3812723403),i(1537002063,2003034995),i(1747873779,3602036899),i(1955562222,1575990012),i(2024104815,1125592928),i(2227730452,2716904306),i(2361852424,442776044),i(2428436474,593698344),i(2756734187,3733110249),i(3204031479,2999351573),i(3329325298,3815920427),i(3391569614,3928383900),i(3515267271,566280711),i(3940187606,3454069534),i(4118630271,4000239992),i(116418474,1914138554),i(174292421,2731055270),i(289380356,3203993006),i(460393269,320620315),i(685471733,587496836),i(852142971,1086792851),i(1017036298,365543100),i(1126000580,2618297676),i(1288033470,3409855158),i(1501505948,4234509866),i(1607167915,987167468),i(1816402316,1246189591)],d=[];(function(){for(var v=0;v<80;v++)d[v]=i()})();var b=s.SHA512=a.extend({_doReset:function(){this._hash=new f.init([new u.init(1779033703,4089235720),new u.init(3144134277,2227873595),new u.init(1013904242,4271175723),new u.init(2773480762,1595750129),new u.init(1359893119,2917565137),new u.init(2600822924,725511199),new u.init(528734635,4215389547),new u.init(1541459225,327033209)])},_doProcessBlock:function(v,C){for(var x=this._hash.words,p=x[0],m=x[1],h=x[2],y=x[3],w=x[4],D=x[5],F=x[6],T=x[7],j=p.high,B=p.low,A=m.high,O=m.low,E=h.high,P=h.low,H=y.high,Q=y.low,k=w.high,S=w.low,_=D.high,X=D.low,$=F.high,U=F.low,V=T.high,G=T.low,ve=j,me=B,Ce=A,ae=O,ct=E,nt=P,rt=H,ot=Q,Te=k,Se=S,mt=_,ee=X,Y=$,te=U,ue=V,pe=G,ye=0;ye<80;ye++){var he,fe,J=d[ye];if(ye<16)fe=J.high=v[C+ye*2]|0,he=J.low=v[C+ye*2+1]|0;else{var we=d[ye-15],Xe=we.high,at=we.low,Bn=(Xe>>>1|at<<31)^(Xe>>>8|at<<24)^Xe>>>7,Xt=(at>>>1|Xe<<31)^(at>>>8|Xe<<24)^(at>>>7|Xe<<25),Qt=d[ye-2],xt=Qt.high,pt=Qt.low,kn=(xt>>>19|pt<<13)^(xt<<3|pt>>>29)^xt>>>6,Zt=(pt>>>19|xt<<13)^(pt<<3|xt>>>29)^(pt>>>6|xt<<26),Jt=d[ye-7],Dn=Jt.high,Fn=Jt.low,Pt=d[ye-16],Bt=Pt.high,en=Pt.low;he=Xt+Fn,fe=Bn+Dn+(he>>>0<Xt>>>0?1:0),he=he+Zt,fe=fe+kn+(he>>>0<Zt>>>0?1:0),he=he+en,fe=fe+Bt+(he>>>0<en>>>0?1:0),J.high=fe,J.low=he}var tn=Te&mt^~Te&Y,vt=Se&ee^~Se&te,Tn=ve&Ce^ve&ct^Ce&ct,Sn=me&ae^me&nt^ae&nt,Rn=(ve>>>28|me<<4)^(ve<<30|me>>>2)^(ve<<25|me>>>7),kt=(me>>>28|ve<<4)^(me<<30|ve>>>2)^(me<<25|ve>>>7),Mt=(Te>>>14|Se<<18)^(Te>>>18|Se<<14)^(Te<<23|Se>>>9),ht=(Se>>>14|Te<<18)^(Se>>>18|Te<<14)^(Se<<23|Te>>>9),Ot=g[ye],$n=Ot.high,nn=Ot.low,Ne=pe+ht,st=ue+Mt+(Ne>>>0<pe>>>0?1:0),Ne=Ne+vt,st=st+tn+(Ne>>>0<vt>>>0?1:0),Ne=Ne+nn,st=st+$n+(Ne>>>0<nn>>>0?1:0),Ne=Ne+he,st=st+fe+(Ne>>>0<he>>>0?1:0),rn=kt+Sn,Wt=Rn+Tn+(rn>>>0<kt>>>0?1:0);ue=Y,pe=te,Y=mt,te=ee,mt=Te,ee=Se,Se=ot+Ne|0,Te=rt+st+(Se>>>0<ot>>>0?1:0)|0,rt=ct,ot=nt,ct=Ce,nt=ae,Ce=ve,ae=me,me=Ne+rn|0,ve=st+Wt+(me>>>0<Ne>>>0?1:0)|0}B=p.low=B+me,p.high=j+ve+(B>>>0<me>>>0?1:0),O=m.low=O+ae,m.high=A+Ce+(O>>>0<ae>>>0?1:0),P=h.low=P+nt,h.high=E+ct+(P>>>0<nt>>>0?1:0),Q=y.low=Q+ot,y.high=H+rt+(Q>>>0<ot>>>0?1:0),S=w.low=S+Se,w.high=k+Te+(S>>>0<Se>>>0?1:0),X=D.low=X+ee,D.high=_+mt+(X>>>0<ee>>>0?1:0),U=F.low=U+te,F.high=$+Y+(U>>>0<te>>>0?1:0),G=T.low=G+pe,T.high=V+ue+(G>>>0<pe>>>0?1:0)},_doFinalize:function(){var v=this._data,C=v.words,x=this._nDataBytes*8,p=v.sigBytes*8;C[p>>>5]|=128<<24-p%32,C[(p+128>>>10<<5)+30]=Math.floor(x/4294967296),C[(p+128>>>10<<5)+31]=x,v.sigBytes=C.length*4,this._process();var m=this._hash.toX32();return m},clone:function(){var v=a.clone.call(this);return v._hash=this._hash.clone(),v},blockSize:1024/32});r.SHA512=a._createHelper(b),r.HmacSHA512=a._createHmacHelper(b)}(),e.SHA512})}(Qn)),Qn.exports}var Zn={exports:{}},Co;function fi(){return Co||(Co=1,function(t,n){(function(e,r,o){t.exports=r(xe(),An(),Ia())})(de,function(e){return function(){var r=e,o=r.x64,a=o.Word,c=o.WordArray,u=r.algo,f=u.SHA512,s=u.SHA384=f.extend({_doReset:function(){this._hash=new c.init([new a.init(3418070365,3238371032),new a.init(1654270250,914150663),new a.init(2438529370,812702999),new a.init(355462360,4144912697),new a.init(1731405415,4290775857),new a.init(2394180231,1750603025),new a.init(3675008525,1694076839),new a.init(1203062813,3204075428)])},_doFinalize:function(){var i=f._doFinalize.call(this);return i.sigBytes-=16,i}});r.SHA384=f._createHelper(s),r.HmacSHA384=f._createHmacHelper(s)}(),e.SHA384})}(Zn)),Zn.exports}var Jn={exports:{}},wo;function xi(){return wo||(wo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),An())})(de,function(e){return function(r){var o=e,a=o.lib,c=a.WordArray,u=a.Hasher,f=o.x64,s=f.Word,i=o.algo,g=[],d=[],b=[];(function(){for(var x=1,p=0,m=0;m<24;m++){g[x+5*p]=(m+1)*(m+2)/2%64;var h=p%5,y=(2*x+3*p)%5;x=h,p=y}for(var x=0;x<5;x++)for(var p=0;p<5;p++)d[x+5*p]=p+(2*x+3*p)%5*5;for(var w=1,D=0;D<24;D++){for(var F=0,T=0,j=0;j<7;j++){if(w&1){var B=(1<<j)-1;B<32?T^=1<<B:F^=1<<B-32}w&128?w=w<<1^113:w<<=1}b[D]=s.create(F,T)}})();var v=[];(function(){for(var x=0;x<25;x++)v[x]=s.create()})();var C=i.SHA3=u.extend({cfg:u.cfg.extend({outputLength:512}),_doReset:function(){for(var x=this._state=[],p=0;p<25;p++)x[p]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(x,p){for(var m=this._state,h=this.blockSize/2,y=0;y<h;y++){var w=x[p+2*y],D=x[p+2*y+1];w=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,D=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360;var F=m[y];F.high^=D,F.low^=w}for(var T=0;T<24;T++){for(var j=0;j<5;j++){for(var B=0,A=0,O=0;O<5;O++){var F=m[j+5*O];B^=F.high,A^=F.low}var E=v[j];E.high=B,E.low=A}for(var j=0;j<5;j++)for(var P=v[(j+4)%5],H=v[(j+1)%5],Q=H.high,k=H.low,B=P.high^(Q<<1|k>>>31),A=P.low^(k<<1|Q>>>31),O=0;O<5;O++){var F=m[j+5*O];F.high^=B,F.low^=A}for(var S=1;S<25;S++){var B,A,F=m[S],_=F.high,X=F.low,$=g[S];$<32?(B=_<<$|X>>>32-$,A=X<<$|_>>>32-$):(B=X<<$-32|_>>>64-$,A=_<<$-32|X>>>64-$);var U=v[d[S]];U.high=B,U.low=A}var V=v[0],G=m[0];V.high=G.high,V.low=G.low;for(var j=0;j<5;j++)for(var O=0;O<5;O++){var S=j+5*O,F=m[S],ve=v[S],me=v[(j+1)%5+5*O],Ce=v[(j+2)%5+5*O];F.high=ve.high^~me.high&Ce.high,F.low=ve.low^~me.low&Ce.low}var F=m[0],ae=b[T];F.high^=ae.high,F.low^=ae.low}},_doFinalize:function(){var x=this._data,p=x.words;this._nDataBytes*8;var m=x.sigBytes*8,h=this.blockSize*32;p[m>>>5]|=1<<24-m%32,p[(r.ceil((m+1)/h)*h>>>5)-1]|=128,x.sigBytes=p.length*4,this._process();for(var y=this._state,w=this.cfg.outputLength/8,D=w/8,F=[],T=0;T<D;T++){var j=y[T],B=j.high,A=j.low;B=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360,A=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,F.push(A),F.push(B)}return new c.init(F,w)},clone:function(){for(var x=u.clone.call(this),p=x._state=this._state.slice(0),m=0;m<25;m++)p[m]=p[m].clone();return x}});o.SHA3=u._createHelper(C),o.HmacSHA3=u._createHmacHelper(C)}(Math),e.SHA3})}(Jn)),Jn.exports}var er={exports:{}},Eo;function vi(){return Eo||(Eo=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(r){var o=e,a=o.lib,c=a.WordArray,u=a.Hasher,f=o.algo,s=c.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),i=c.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),g=c.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),d=c.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),b=c.create([0,1518500249,1859775393,2400959708,2840853838]),v=c.create([1352829926,1548603684,1836072691,2053994217,0]),C=f.RIPEMD160=u.extend({_doReset:function(){this._hash=c.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(D,F){for(var T=0;T<16;T++){var j=F+T,B=D[j];D[j]=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360}var A=this._hash.words,O=b.words,E=v.words,P=s.words,H=i.words,Q=g.words,k=d.words,S,_,X,$,U,V,G,ve,me,Ce;V=S=A[0],G=_=A[1],ve=X=A[2],me=$=A[3],Ce=U=A[4];for(var ae,T=0;T<80;T+=1)ae=S+D[F+P[T]]|0,T<16?ae+=x(_,X,$)+O[0]:T<32?ae+=p(_,X,$)+O[1]:T<48?ae+=m(_,X,$)+O[2]:T<64?ae+=h(_,X,$)+O[3]:ae+=y(_,X,$)+O[4],ae=ae|0,ae=w(ae,Q[T]),ae=ae+U|0,S=U,U=$,$=w(X,10),X=_,_=ae,ae=V+D[F+H[T]]|0,T<16?ae+=y(G,ve,me)+E[0]:T<32?ae+=h(G,ve,me)+E[1]:T<48?ae+=m(G,ve,me)+E[2]:T<64?ae+=p(G,ve,me)+E[3]:ae+=x(G,ve,me)+E[4],ae=ae|0,ae=w(ae,k[T]),ae=ae+Ce|0,V=Ce,Ce=me,me=w(ve,10),ve=G,G=ae;ae=A[1]+X+me|0,A[1]=A[2]+$+Ce|0,A[2]=A[3]+U+V|0,A[3]=A[4]+S+G|0,A[4]=A[0]+_+ve|0,A[0]=ae},_doFinalize:function(){var D=this._data,F=D.words,T=this._nDataBytes*8,j=D.sigBytes*8;F[j>>>5]|=128<<24-j%32,F[(j+64>>>9<<4)+14]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360,D.sigBytes=(F.length+1)*4,this._process();for(var B=this._hash,A=B.words,O=0;O<5;O++){var E=A[O];A[O]=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360}return B},clone:function(){var D=u.clone.call(this);return D._hash=this._hash.clone(),D}});function x(D,F,T){return D^F^T}function p(D,F,T){return D&F|~D&T}function m(D,F,T){return(D|~F)^T}function h(D,F,T){return D&T|F&~T}function y(D,F,T){return D^(F|~T)}function w(D,F){return D<<F|D>>>32-F}o.RIPEMD160=u._createHelper(C),o.HmacRIPEMD160=u._createHmacHelper(C)}(),e.RIPEMD160})}(er)),er.exports}var tr={exports:{}},_o;function Ur(){return _o||(_o=1,function(t,n){(function(e,r){t.exports=r(xe())})(de,function(e){(function(){var r=e,o=r.lib,a=o.Base,c=r.enc,u=c.Utf8,f=r.algo;f.HMAC=a.extend({init:function(s,i){s=this._hasher=new s.init,typeof i=="string"&&(i=u.parse(i));var g=s.blockSize,d=g*4;i.sigBytes>d&&(i=s.finalize(i)),i.clamp();for(var b=this._oKey=i.clone(),v=this._iKey=i.clone(),C=b.words,x=v.words,p=0;p<g;p++)C[p]^=1549556828,x[p]^=909522486;b.sigBytes=v.sigBytes=d,this.reset()},reset:function(){var s=this._hasher;s.reset(),s.update(this._iKey)},update:function(s){return this._hasher.update(s),this},finalize:function(s){var i=this._hasher,g=i.finalize(s);i.reset();var d=i.finalize(this._oKey.clone().concat(g));return d}})})()})}(tr)),tr.exports}var nr={exports:{}},Ao;function gi(){return Ao||(Ao=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Hr(),Ur())})(de,function(e){return function(){var r=e,o=r.lib,a=o.Base,c=o.WordArray,u=r.algo,f=u.SHA256,s=u.HMAC,i=u.PBKDF2=a.extend({cfg:a.extend({keySize:128/32,hasher:f,iterations:25e4}),init:function(g){this.cfg=this.cfg.extend(g)},compute:function(g,d){for(var b=this.cfg,v=s.create(b.hasher,g),C=c.create(),x=c.create([1]),p=C.words,m=x.words,h=b.keySize,y=b.iterations;p.length<h;){var w=v.update(d).finalize(x);v.reset();for(var D=w.words,F=D.length,T=w,j=1;j<y;j++){T=v.finalize(T),v.reset();for(var B=T.words,A=0;A<F;A++)D[A]^=B[A]}C.concat(w),m[0]++}return C.sigBytes=h*4,C}});r.PBKDF2=function(g,d,b){return i.create(b).compute(g,d)}}(),e.PBKDF2})}(nr)),nr.exports}var rr={exports:{}},Bo;function gt(){return Bo||(Bo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),$a(),Ur())})(de,function(e){return function(){var r=e,o=r.lib,a=o.Base,c=o.WordArray,u=r.algo,f=u.MD5,s=u.EvpKDF=a.extend({cfg:a.extend({keySize:128/32,hasher:f,iterations:1}),init:function(i){this.cfg=this.cfg.extend(i)},compute:function(i,g){for(var d,b=this.cfg,v=b.hasher.create(),C=c.create(),x=C.words,p=b.keySize,m=b.iterations;x.length<p;){d&&v.update(d),d=v.update(i).finalize(g),v.reset();for(var h=1;h<m;h++)d=v.finalize(d),v.reset();C.concat(d)}return C.sigBytes=p*4,C}});r.EvpKDF=function(i,g,d){return s.create(d).compute(i,g)}}(),e.EvpKDF})}(rr)),rr.exports}var or={exports:{}},ko;function Fe(){return ko||(ko=1,function(t,n){(function(e,r,o){t.exports=r(xe(),gt())})(de,function(e){e.lib.Cipher||function(r){var o=e,a=o.lib,c=a.Base,u=a.WordArray,f=a.BufferedBlockAlgorithm,s=o.enc;s.Utf8;var i=s.Base64,g=o.algo,d=g.EvpKDF,b=a.Cipher=f.extend({cfg:c.extend(),createEncryptor:function(B,A){return this.create(this._ENC_XFORM_MODE,B,A)},createDecryptor:function(B,A){return this.create(this._DEC_XFORM_MODE,B,A)},init:function(B,A,O){this.cfg=this.cfg.extend(O),this._xformMode=B,this._key=A,this.reset()},reset:function(){f.reset.call(this),this._doReset()},process:function(B){return this._append(B),this._process()},finalize:function(B){B&&this._append(B);var A=this._doFinalize();return A},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function B(A){return typeof A=="string"?j:D}return function(A){return{encrypt:function(O,E,P){return B(E).encrypt(A,O,E,P)},decrypt:function(O,E,P){return B(E).decrypt(A,O,E,P)}}}}()});a.StreamCipher=b.extend({_doFinalize:function(){var B=this._process(!0);return B},blockSize:1});var v=o.mode={},C=a.BlockCipherMode=c.extend({createEncryptor:function(B,A){return this.Encryptor.create(B,A)},createDecryptor:function(B,A){return this.Decryptor.create(B,A)},init:function(B,A){this._cipher=B,this._iv=A}}),x=v.CBC=function(){var B=C.extend();B.Encryptor=B.extend({processBlock:function(O,E){var P=this._cipher,H=P.blockSize;A.call(this,O,E,H),P.encryptBlock(O,E),this._prevBlock=O.slice(E,E+H)}}),B.Decryptor=B.extend({processBlock:function(O,E){var P=this._cipher,H=P.blockSize,Q=O.slice(E,E+H);P.decryptBlock(O,E),A.call(this,O,E,H),this._prevBlock=Q}});function A(O,E,P){var H,Q=this._iv;Q?(H=Q,this._iv=r):H=this._prevBlock;for(var k=0;k<P;k++)O[E+k]^=H[k]}return B}(),p=o.pad={},m=p.Pkcs7={pad:function(B,A){for(var O=A*4,E=O-B.sigBytes%O,P=E<<24|E<<16|E<<8|E,H=[],Q=0;Q<E;Q+=4)H.push(P);var k=u.create(H,E);B.concat(k)},unpad:function(B){var A=B.words[B.sigBytes-1>>>2]&255;B.sigBytes-=A}};a.BlockCipher=b.extend({cfg:b.cfg.extend({mode:x,padding:m}),reset:function(){var B;b.reset.call(this);var A=this.cfg,O=A.iv,E=A.mode;this._xformMode==this._ENC_XFORM_MODE?B=E.createEncryptor:(B=E.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==B?this._mode.init(this,O&&O.words):(this._mode=B.call(E,this,O&&O.words),this._mode.__creator=B)},_doProcessBlock:function(B,A){this._mode.processBlock(B,A)},_doFinalize:function(){var B,A=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(A.pad(this._data,this.blockSize),B=this._process(!0)):(B=this._process(!0),A.unpad(B)),B},blockSize:128/32});var h=a.CipherParams=c.extend({init:function(B){this.mixIn(B)},toString:function(B){return(B||this.formatter).stringify(this)}}),y=o.format={},w=y.OpenSSL={stringify:function(B){var A,O=B.ciphertext,E=B.salt;return E?A=u.create([1398893684,1701076831]).concat(E).concat(O):A=O,A.toString(i)},parse:function(B){var A,O=i.parse(B),E=O.words;return E[0]==1398893684&&E[1]==1701076831&&(A=u.create(E.slice(2,4)),E.splice(0,4),O.sigBytes-=16),h.create({ciphertext:O,salt:A})}},D=a.SerializableCipher=c.extend({cfg:c.extend({format:w}),encrypt:function(B,A,O,E){E=this.cfg.extend(E);var P=B.createEncryptor(O,E),H=P.finalize(A),Q=P.cfg;return h.create({ciphertext:H,key:O,iv:Q.iv,algorithm:B,mode:Q.mode,padding:Q.padding,blockSize:B.blockSize,formatter:E.format})},decrypt:function(B,A,O,E){E=this.cfg.extend(E),A=this._parse(A,E.format);var P=B.createDecryptor(O,E).finalize(A.ciphertext);return P},_parse:function(B,A){return typeof B=="string"?A.parse(B,this):B}}),F=o.kdf={},T=F.OpenSSL={execute:function(B,A,O,E,P){if(E||(E=u.random(64/8)),P)var H=d.create({keySize:A+O,hasher:P}).compute(B,E);else var H=d.create({keySize:A+O}).compute(B,E);var Q=u.create(H.words.slice(A),O*4);return H.sigBytes=A*4,h.create({key:H,iv:Q,salt:E})}},j=a.PasswordBasedCipher=D.extend({cfg:D.cfg.extend({kdf:T}),encrypt:function(B,A,O,E){E=this.cfg.extend(E);var P=E.kdf.execute(O,B.keySize,B.ivSize,E.salt,E.hasher);E.iv=P.iv;var H=D.encrypt.call(this,B,A,P.key,E);return H.mixIn(P),H},decrypt:function(B,A,O,E){E=this.cfg.extend(E),A=this._parse(A,E.format);var P=E.kdf.execute(O,B.keySize,B.ivSize,A.salt,E.hasher);E.iv=P.iv;var H=D.decrypt.call(this,B,A,P.key,E);return H}})}()})}(or)),or.exports}var ar={exports:{}},Do;function mi(){return Do||(Do=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return e.mode.CFB=function(){var r=e.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(a,c){var u=this._cipher,f=u.blockSize;o.call(this,a,c,f,u),this._prevBlock=a.slice(c,c+f)}}),r.Decryptor=r.extend({processBlock:function(a,c){var u=this._cipher,f=u.blockSize,s=a.slice(c,c+f);o.call(this,a,c,f,u),this._prevBlock=s}});function o(a,c,u,f){var s,i=this._iv;i?(s=i.slice(0),this._iv=void 0):s=this._prevBlock,f.encryptBlock(s,0);for(var g=0;g<u;g++)a[c+g]^=s[g]}return r}(),e.mode.CFB})}(ar)),ar.exports}var sr={exports:{}},Fo;function pi(){return Fo||(Fo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return e.mode.CTR=function(){var r=e.lib.BlockCipherMode.extend(),o=r.Encryptor=r.extend({processBlock:function(a,c){var u=this._cipher,f=u.blockSize,s=this._iv,i=this._counter;s&&(i=this._counter=s.slice(0),this._iv=void 0);var g=i.slice(0);u.encryptBlock(g,0),i[f-1]=i[f-1]+1|0;for(var d=0;d<f;d++)a[c+d]^=g[d]}});return r.Decryptor=o,r}(),e.mode.CTR})}(sr)),sr.exports}var ir={exports:{}},To;function hi(){return To||(To=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return e.mode.CTRGladman=function(){var r=e.lib.BlockCipherMode.extend();function o(u){if((u>>24&255)===255){var f=u>>16&255,s=u>>8&255,i=u&255;f===255?(f=0,s===255?(s=0,i===255?i=0:++i):++s):++f,u=0,u+=f<<16,u+=s<<8,u+=i}else u+=1<<24;return u}function a(u){return(u[0]=o(u[0]))===0&&(u[1]=o(u[1])),u}var c=r.Encryptor=r.extend({processBlock:function(u,f){var s=this._cipher,i=s.blockSize,g=this._iv,d=this._counter;g&&(d=this._counter=g.slice(0),this._iv=void 0),a(d);var b=d.slice(0);s.encryptBlock(b,0);for(var v=0;v<i;v++)u[f+v]^=b[v]}});return r.Decryptor=c,r}(),e.mode.CTRGladman})}(ir)),ir.exports}var lr={exports:{}},So;function bi(){return So||(So=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return e.mode.OFB=function(){var r=e.lib.BlockCipherMode.extend(),o=r.Encryptor=r.extend({processBlock:function(a,c){var u=this._cipher,f=u.blockSize,s=this._iv,i=this._keystream;s&&(i=this._keystream=s.slice(0),this._iv=void 0),u.encryptBlock(i,0);for(var g=0;g<f;g++)a[c+g]^=i[g]}});return r.Decryptor=o,r}(),e.mode.OFB})}(lr)),lr.exports}var cr={exports:{}},Ro;function yi(){return Ro||(Ro=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return e.mode.ECB=function(){var r=e.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(o,a){this._cipher.encryptBlock(o,a)}}),r.Decryptor=r.extend({processBlock:function(o,a){this._cipher.decryptBlock(o,a)}}),r}(),e.mode.ECB})}(cr)),cr.exports}var ur={exports:{}},$o;function Ci(){return $o||($o=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return e.pad.AnsiX923={pad:function(r,o){var a=r.sigBytes,c=o*4,u=c-a%c,f=a+u-1;r.clamp(),r.words[f>>>2]|=u<<24-f%4*8,r.sigBytes+=u},unpad:function(r){var o=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=o}},e.pad.Ansix923})}(ur)),ur.exports}var dr={exports:{}},Io;function wi(){return Io||(Io=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return e.pad.Iso10126={pad:function(r,o){var a=o*4,c=a-r.sigBytes%a;r.concat(e.lib.WordArray.random(c-1)).concat(e.lib.WordArray.create([c<<24],1))},unpad:function(r){var o=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=o}},e.pad.Iso10126})}(dr)),dr.exports}var fr={exports:{}},Po;function Ei(){return Po||(Po=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return e.pad.Iso97971={pad:function(r,o){r.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(r,o)},unpad:function(r){e.pad.ZeroPadding.unpad(r),r.sigBytes--}},e.pad.Iso97971})}(fr)),fr.exports}var xr={exports:{}},Mo;function _i(){return Mo||(Mo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return e.pad.ZeroPadding={pad:function(r,o){var a=o*4;r.clamp(),r.sigBytes+=a-(r.sigBytes%a||a)},unpad:function(r){for(var o=r.words,a=r.sigBytes-1,a=r.sigBytes-1;a>=0;a--)if(o[a>>>2]>>>24-a%4*8&255){r.sigBytes=a+1;break}}},e.pad.ZeroPadding})}(xr)),xr.exports}var vr={exports:{}},Oo;function Ai(){return Oo||(Oo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding})}(vr)),vr.exports}var gr={exports:{}},Wo;function Bi(){return Wo||(Wo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),Fe())})(de,function(e){return function(r){var o=e,a=o.lib,c=a.CipherParams,u=o.enc,f=u.Hex,s=o.format;s.Hex={stringify:function(i){return i.ciphertext.toString(f)},parse:function(i){var g=f.parse(i);return c.create({ciphertext:g})}}}(),e.format.Hex})}(gr)),gr.exports}var mr={exports:{}},No;function ki(){return No||(No=1,function(t,n){(function(e,r,o){t.exports=r(xe(),_t(),At(),gt(),Fe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.BlockCipher,c=r.algo,u=[],f=[],s=[],i=[],g=[],d=[],b=[],v=[],C=[],x=[];(function(){for(var h=[],y=0;y<256;y++)y<128?h[y]=y<<1:h[y]=y<<1^283;for(var w=0,D=0,y=0;y<256;y++){var F=D^D<<1^D<<2^D<<3^D<<4;F=F>>>8^F&255^99,u[w]=F,f[F]=w;var T=h[w],j=h[T],B=h[j],A=h[F]*257^F*16843008;s[w]=A<<24|A>>>8,i[w]=A<<16|A>>>16,g[w]=A<<8|A>>>24,d[w]=A;var A=B*16843009^j*65537^T*257^w*16843008;b[F]=A<<24|A>>>8,v[F]=A<<16|A>>>16,C[F]=A<<8|A>>>24,x[F]=A,w?(w=T^h[h[h[B^T]]],D^=h[h[D]]):w=D=1}})();var p=[0,1,2,4,8,16,32,64,128,27,54],m=c.AES=a.extend({_doReset:function(){var h;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var y=this._keyPriorReset=this._key,w=y.words,D=y.sigBytes/4,F=this._nRounds=D+6,T=(F+1)*4,j=this._keySchedule=[],B=0;B<T;B++)B<D?j[B]=w[B]:(h=j[B-1],B%D?D>6&&B%D==4&&(h=u[h>>>24]<<24|u[h>>>16&255]<<16|u[h>>>8&255]<<8|u[h&255]):(h=h<<8|h>>>24,h=u[h>>>24]<<24|u[h>>>16&255]<<16|u[h>>>8&255]<<8|u[h&255],h^=p[B/D|0]<<24),j[B]=j[B-D]^h);for(var A=this._invKeySchedule=[],O=0;O<T;O++){var B=T-O;if(O%4)var h=j[B];else var h=j[B-4];O<4||B<=4?A[O]=h:A[O]=b[u[h>>>24]]^v[u[h>>>16&255]]^C[u[h>>>8&255]]^x[u[h&255]]}}},encryptBlock:function(h,y){this._doCryptBlock(h,y,this._keySchedule,s,i,g,d,u)},decryptBlock:function(h,y){var w=h[y+1];h[y+1]=h[y+3],h[y+3]=w,this._doCryptBlock(h,y,this._invKeySchedule,b,v,C,x,f);var w=h[y+1];h[y+1]=h[y+3],h[y+3]=w},_doCryptBlock:function(h,y,w,D,F,T,j,B){for(var A=this._nRounds,O=h[y]^w[0],E=h[y+1]^w[1],P=h[y+2]^w[2],H=h[y+3]^w[3],Q=4,k=1;k<A;k++){var S=D[O>>>24]^F[E>>>16&255]^T[P>>>8&255]^j[H&255]^w[Q++],_=D[E>>>24]^F[P>>>16&255]^T[H>>>8&255]^j[O&255]^w[Q++],X=D[P>>>24]^F[H>>>16&255]^T[O>>>8&255]^j[E&255]^w[Q++],$=D[H>>>24]^F[O>>>16&255]^T[E>>>8&255]^j[P&255]^w[Q++];O=S,E=_,P=X,H=$}var S=(B[O>>>24]<<24|B[E>>>16&255]<<16|B[P>>>8&255]<<8|B[H&255])^w[Q++],_=(B[E>>>24]<<24|B[P>>>16&255]<<16|B[H>>>8&255]<<8|B[O&255])^w[Q++],X=(B[P>>>24]<<24|B[H>>>16&255]<<16|B[O>>>8&255]<<8|B[E&255])^w[Q++],$=(B[H>>>24]<<24|B[O>>>16&255]<<16|B[E>>>8&255]<<8|B[P&255])^w[Q++];h[y]=S,h[y+1]=_,h[y+2]=X,h[y+3]=$},keySize:256/32});r.AES=a._createHelper(m)}(),e.AES})}(mr)),mr.exports}var pr={exports:{}},Lo;function Di(){return Lo||(Lo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),_t(),At(),gt(),Fe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=o.BlockCipher,u=r.algo,f=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],i=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],g=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],b=u.DES=c.extend({_doReset:function(){for(var p=this._key,m=p.words,h=[],y=0;y<56;y++){var w=f[y]-1;h[y]=m[w>>>5]>>>31-w%32&1}for(var D=this._subKeys=[],F=0;F<16;F++){for(var T=D[F]=[],j=i[F],y=0;y<24;y++)T[y/6|0]|=h[(s[y]-1+j)%28]<<31-y%6,T[4+(y/6|0)]|=h[28+(s[y+24]-1+j)%28]<<31-y%6;T[0]=T[0]<<1|T[0]>>>31;for(var y=1;y<7;y++)T[y]=T[y]>>>(y-1)*4+3;T[7]=T[7]<<5|T[7]>>>27}for(var B=this._invSubKeys=[],y=0;y<16;y++)B[y]=D[15-y]},encryptBlock:function(p,m){this._doCryptBlock(p,m,this._subKeys)},decryptBlock:function(p,m){this._doCryptBlock(p,m,this._invSubKeys)},_doCryptBlock:function(p,m,h){this._lBlock=p[m],this._rBlock=p[m+1],v.call(this,4,252645135),v.call(this,16,65535),C.call(this,2,858993459),C.call(this,8,16711935),v.call(this,1,1431655765);for(var y=0;y<16;y++){for(var w=h[y],D=this._lBlock,F=this._rBlock,T=0,j=0;j<8;j++)T|=g[j][((F^w[j])&d[j])>>>0];this._lBlock=F,this._rBlock=D^T}var B=this._lBlock;this._lBlock=this._rBlock,this._rBlock=B,v.call(this,1,1431655765),C.call(this,8,16711935),C.call(this,2,858993459),v.call(this,16,65535),v.call(this,4,252645135),p[m]=this._lBlock,p[m+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function v(p,m){var h=(this._lBlock>>>p^this._rBlock)&m;this._rBlock^=h,this._lBlock^=h<<p}function C(p,m){var h=(this._rBlock>>>p^this._lBlock)&m;this._lBlock^=h,this._rBlock^=h<<p}r.DES=c._createHelper(b);var x=u.TripleDES=c.extend({_doReset:function(){var p=this._key,m=p.words;if(m.length!==2&&m.length!==4&&m.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var h=m.slice(0,2),y=m.length<4?m.slice(0,2):m.slice(2,4),w=m.length<6?m.slice(0,2):m.slice(4,6);this._des1=b.createEncryptor(a.create(h)),this._des2=b.createEncryptor(a.create(y)),this._des3=b.createEncryptor(a.create(w))},encryptBlock:function(p,m){this._des1.encryptBlock(p,m),this._des2.decryptBlock(p,m),this._des3.encryptBlock(p,m)},decryptBlock:function(p,m){this._des3.decryptBlock(p,m),this._des2.encryptBlock(p,m),this._des1.decryptBlock(p,m)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=c._createHelper(x)}(),e.TripleDES})}(pr)),pr.exports}var hr={exports:{}},Ho;function Fi(){return Ho||(Ho=1,function(t,n){(function(e,r,o){t.exports=r(xe(),_t(),At(),gt(),Fe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.StreamCipher,c=r.algo,u=c.RC4=a.extend({_doReset:function(){for(var i=this._key,g=i.words,d=i.sigBytes,b=this._S=[],v=0;v<256;v++)b[v]=v;for(var v=0,C=0;v<256;v++){var x=v%d,p=g[x>>>2]>>>24-x%4*8&255;C=(C+b[v]+p)%256;var m=b[v];b[v]=b[C],b[C]=m}this._i=this._j=0},_doProcessBlock:function(i,g){i[g]^=f.call(this)},keySize:256/32,ivSize:0});function f(){for(var i=this._S,g=this._i,d=this._j,b=0,v=0;v<4;v++){g=(g+1)%256,d=(d+i[g])%256;var C=i[g];i[g]=i[d],i[d]=C,b|=i[(i[g]+i[d])%256]<<24-v*8}return this._i=g,this._j=d,b}r.RC4=a._createHelper(u);var s=c.RC4Drop=u.extend({cfg:u.cfg.extend({drop:192}),_doReset:function(){u._doReset.call(this);for(var i=this.cfg.drop;i>0;i--)f.call(this)}});r.RC4Drop=a._createHelper(s)}(),e.RC4})}(hr)),hr.exports}var br={exports:{}},Uo;function Ti(){return Uo||(Uo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),_t(),At(),gt(),Fe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.StreamCipher,c=r.algo,u=[],f=[],s=[],i=c.Rabbit=a.extend({_doReset:function(){for(var d=this._key.words,b=this.cfg.iv,v=0;v<4;v++)d[v]=(d[v]<<8|d[v]>>>24)&16711935|(d[v]<<24|d[v]>>>8)&4278255360;var C=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],x=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var v=0;v<4;v++)g.call(this);for(var v=0;v<8;v++)x[v]^=C[v+4&7];if(b){var p=b.words,m=p[0],h=p[1],y=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,w=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,D=y>>>16|w&4294901760,F=w<<16|y&65535;x[0]^=y,x[1]^=D,x[2]^=w,x[3]^=F,x[4]^=y,x[5]^=D,x[6]^=w,x[7]^=F;for(var v=0;v<4;v++)g.call(this)}},_doProcessBlock:function(d,b){var v=this._X;g.call(this),u[0]=v[0]^v[5]>>>16^v[3]<<16,u[1]=v[2]^v[7]>>>16^v[5]<<16,u[2]=v[4]^v[1]>>>16^v[7]<<16,u[3]=v[6]^v[3]>>>16^v[1]<<16;for(var C=0;C<4;C++)u[C]=(u[C]<<8|u[C]>>>24)&16711935|(u[C]<<24|u[C]>>>8)&4278255360,d[b+C]^=u[C]},blockSize:128/32,ivSize:64/32});function g(){for(var d=this._X,b=this._C,v=0;v<8;v++)f[v]=b[v];b[0]=b[0]+1295307597+this._b|0,b[1]=b[1]+3545052371+(b[0]>>>0<f[0]>>>0?1:0)|0,b[2]=b[2]+886263092+(b[1]>>>0<f[1]>>>0?1:0)|0,b[3]=b[3]+1295307597+(b[2]>>>0<f[2]>>>0?1:0)|0,b[4]=b[4]+3545052371+(b[3]>>>0<f[3]>>>0?1:0)|0,b[5]=b[5]+886263092+(b[4]>>>0<f[4]>>>0?1:0)|0,b[6]=b[6]+1295307597+(b[5]>>>0<f[5]>>>0?1:0)|0,b[7]=b[7]+3545052371+(b[6]>>>0<f[6]>>>0?1:0)|0,this._b=b[7]>>>0<f[7]>>>0?1:0;for(var v=0;v<8;v++){var C=d[v]+b[v],x=C&65535,p=C>>>16,m=((x*x>>>17)+x*p>>>15)+p*p,h=((C&4294901760)*C|0)+((C&65535)*C|0);s[v]=m^h}d[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,d[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,d[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,d[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,d[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,d[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,d[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,d[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}r.Rabbit=a._createHelper(i)}(),e.Rabbit})}(br)),br.exports}var yr={exports:{}},jo;function Si(){return jo||(jo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),_t(),At(),gt(),Fe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.StreamCipher,c=r.algo,u=[],f=[],s=[],i=c.RabbitLegacy=a.extend({_doReset:function(){var d=this._key.words,b=this.cfg.iv,v=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],C=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var x=0;x<4;x++)g.call(this);for(var x=0;x<8;x++)C[x]^=v[x+4&7];if(b){var p=b.words,m=p[0],h=p[1],y=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,w=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,D=y>>>16|w&4294901760,F=w<<16|y&65535;C[0]^=y,C[1]^=D,C[2]^=w,C[3]^=F,C[4]^=y,C[5]^=D,C[6]^=w,C[7]^=F;for(var x=0;x<4;x++)g.call(this)}},_doProcessBlock:function(d,b){var v=this._X;g.call(this),u[0]=v[0]^v[5]>>>16^v[3]<<16,u[1]=v[2]^v[7]>>>16^v[5]<<16,u[2]=v[4]^v[1]>>>16^v[7]<<16,u[3]=v[6]^v[3]>>>16^v[1]<<16;for(var C=0;C<4;C++)u[C]=(u[C]<<8|u[C]>>>24)&16711935|(u[C]<<24|u[C]>>>8)&4278255360,d[b+C]^=u[C]},blockSize:128/32,ivSize:64/32});function g(){for(var d=this._X,b=this._C,v=0;v<8;v++)f[v]=b[v];b[0]=b[0]+1295307597+this._b|0,b[1]=b[1]+3545052371+(b[0]>>>0<f[0]>>>0?1:0)|0,b[2]=b[2]+886263092+(b[1]>>>0<f[1]>>>0?1:0)|0,b[3]=b[3]+1295307597+(b[2]>>>0<f[2]>>>0?1:0)|0,b[4]=b[4]+3545052371+(b[3]>>>0<f[3]>>>0?1:0)|0,b[5]=b[5]+886263092+(b[4]>>>0<f[4]>>>0?1:0)|0,b[6]=b[6]+1295307597+(b[5]>>>0<f[5]>>>0?1:0)|0,b[7]=b[7]+3545052371+(b[6]>>>0<f[6]>>>0?1:0)|0,this._b=b[7]>>>0<f[7]>>>0?1:0;for(var v=0;v<8;v++){var C=d[v]+b[v],x=C&65535,p=C>>>16,m=((x*x>>>17)+x*p>>>15)+p*p,h=((C&4294901760)*C|0)+((C&65535)*C|0);s[v]=m^h}d[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,d[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,d[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,d[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,d[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,d[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,d[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,d[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}r.RabbitLegacy=a._createHelper(i)}(),e.RabbitLegacy})}(yr)),yr.exports}var Cr={exports:{}},qo;function Ri(){return qo||(qo=1,function(t,n){(function(e,r,o){t.exports=r(xe(),_t(),At(),gt(),Fe())})(de,function(e){return function(){var r=e,o=r.lib,a=o.BlockCipher,c=r.algo;const u=16,f=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],s=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var i={pbox:[],sbox:[]};function g(x,p){let m=p>>24&255,h=p>>16&255,y=p>>8&255,w=p&255,D=x.sbox[0][m]+x.sbox[1][h];return D=D^x.sbox[2][y],D=D+x.sbox[3][w],D}function d(x,p,m){let h=p,y=m,w;for(let D=0;D<u;++D)h=h^x.pbox[D],y=g(x,h)^y,w=h,h=y,y=w;return w=h,h=y,y=w,y=y^x.pbox[u],h=h^x.pbox[u+1],{left:h,right:y}}function b(x,p,m){let h=p,y=m,w;for(let D=u+1;D>1;--D)h=h^x.pbox[D],y=g(x,h)^y,w=h,h=y,y=w;return w=h,h=y,y=w,y=y^x.pbox[1],h=h^x.pbox[0],{left:h,right:y}}function v(x,p,m){for(let F=0;F<4;F++){x.sbox[F]=[];for(let T=0;T<256;T++)x.sbox[F][T]=s[F][T]}let h=0;for(let F=0;F<u+2;F++)x.pbox[F]=f[F]^p[h],h++,h>=m&&(h=0);let y=0,w=0,D=0;for(let F=0;F<u+2;F+=2)D=d(x,y,w),y=D.left,w=D.right,x.pbox[F]=y,x.pbox[F+1]=w;for(let F=0;F<4;F++)for(let T=0;T<256;T+=2)D=d(x,y,w),y=D.left,w=D.right,x.sbox[F][T]=y,x.sbox[F][T+1]=w;return!0}var C=c.Blowfish=a.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var x=this._keyPriorReset=this._key,p=x.words,m=x.sigBytes/4;v(i,p,m)}},encryptBlock:function(x,p){var m=d(i,x[p],x[p+1]);x[p]=m.left,x[p+1]=m.right},decryptBlock:function(x,p){var m=b(i,x[p],x[p+1]);x[p]=m.left,x[p+1]=m.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=a._createHelper(C)}(),e.Blowfish})}(Cr)),Cr.exports}(function(t,n){(function(e,r,o){t.exports=r(xe(),An(),li(),ci(),_t(),ui(),At(),$a(),Hr(),di(),Ia(),fi(),xi(),vi(),Ur(),gi(),gt(),Fe(),mi(),pi(),hi(),bi(),yi(),Ci(),wi(),Ei(),_i(),Ai(),Bi(),ki(),Di(),Fi(),Ti(),Si(),Ri())})(de,function(e){return e})})(Ra);var $i=Ra.exports;const wr=ni($i);var ut=(t=>(t.SENDING="sending",t.SENT="sent",t.DELIVERED="delivered",t.READ="read",t.FAILED="failed",t))(ut||{});const zo="spacetalk-secure-key-2023";class Ii{constructor(n){Ue(this,"messages",W({}));Ue(this,"pendingMessages",W({}));Ue(this,"unreadMessages",W({}));Ue(this,"messageExpiryDays",30);this.storageProvider=n,this.loadAllChats(),this.setupAutoCleanup(),De(this.messages,()=>{this.saveAllChats()},{deep:!0}),De(this.pendingMessages,()=>{this.savePendingMessages()},{deep:!0})}createMessage(n,e,r){const o=this.encryptMessage(n);return{id:Sa(),sender:r?"me":"partner",text:o,originalText:r?n:void 0,timestamp:Date.now(),status:r?"sending":"delivered",retryCount:0,expiresAt:Date.now()+this.messageExpiryDays*24*60*60*1e3}}addMessage(n,e){const r=this.getConversationKey(e);this.messages.value[r]||(this.messages.value[r]=[]),this.messages.value[r].push(n),this.saveAllChats()}updateMessageStatus(n,e){let r=!1;return Object.keys(this.messages.value).forEach(o=>{const a=this.messages.value[o],c=a.findIndex(u=>u.id===n);c!==-1&&(a[c].status=e,r=!0)}),r&&this.saveAllChats(),r}addToPendingMessages(n,e){this.pendingMessages.value[e]||(this.pendingMessages.value[e]=[]),this.pendingMessages.value[e].push(n),this.savePendingMessages()}removeFromPendingMessages(n,e){if(!this.pendingMessages.value[e])return!1;const r=this.pendingMessages.value[e].length;return this.pendingMessages.value[e]=this.pendingMessages.value[e].filter(o=>o.id!==n),r!==this.pendingMessages.value[e].length?(this.savePendingMessages(),!0):!1}getPendingMessages(n){return this.pendingMessages.value[n]||[]}getAllPendingMessages(){return this.pendingMessages.value}getMessages(n){const e=this.getConversationKey(n);return(this.messages.value[e]||[]).map(o=>o.sender==="partner"?{...o,text:this.decryptMessage(o.text)}:{...o,text:o.originalText||this.decryptMessage(o.text)})}markAsRead(n){this.unreadMessages.value[n]=!1;const e=this.getConversationKey(n),r=this.messages.value[e]||[];let o=!1;r.forEach(a=>{a.sender==="partner"&&a.status==="delivered"&&(a.status="read",o=!0)}),o&&this.saveAllChats()}hasUnreadMessages(n){return!!this.unreadMessages.value[n]}setUnread(n,e){this.unreadMessages.value[n]=e}clearChat(n){const e=this.getConversationKey(n);this.messages.value[e]&&(this.messages.value[e]=[],this.saveAllChats()),this.pendingMessages.value[n]&&(this.pendingMessages.value[n]=[],this.savePendingMessages())}clearAllChats(){this.messages.value={},this.unreadMessages.value={},this.pendingMessages.value={},this.saveAllChats(),this.savePendingMessages()}encryptMessage(n){try{return wr.AES.encrypt(n,zo).toString()}catch(e){return console.error("Failed to encrypt message:",e),n}}decryptMessage(n){try{return wr.AES.decrypt(n,zo).toString(wr.enc.Utf8)}catch(e){return console.error("Failed to decrypt message:",e),n}}getConversationKey(n){return`chat_${n}`}saveAllChats(){if(this.storageProvider.isAvailable)try{this.storageProvider.setItem("chat_messages",JSON.stringify(this.messages.value)),this.storageProvider.setItem("chat_unread",JSON.stringify(this.unreadMessages.value))}catch(n){console.error("Failed to save chats:",n)}}loadAllChats(){if(this.storageProvider.isAvailable)try{const n=this.storageProvider.getItem("chat_messages");n&&(this.messages.value=JSON.parse(n));const e=this.storageProvider.getItem("chat_unread");e&&(this.unreadMessages.value=JSON.parse(e))}catch(n){console.error("Failed to load chats:",n)}}savePendingMessages(){if(this.storageProvider.isAvailable)try{this.storageProvider.setItem("chat_pending_messages",JSON.stringify(this.pendingMessages.value))}catch(n){console.error("Failed to save pending messages:",n)}}loadPendingMessages(){if(this.storageProvider.isAvailable)try{const n=this.storageProvider.getItem("chat_pending_messages");n&&(this.pendingMessages.value=JSON.parse(n))}catch(n){console.error("Failed to load pending messages:",n)}}setupAutoCleanup(){setInterval(()=>this.cleanupExpiredMessages(),24*60*60*1e3),this.cleanupExpiredMessages()}cleanupExpiredMessages(){const n=Date.now();let e=!1;Object.keys(this.messages.value).forEach(r=>{const o=this.messages.value[r].length;this.messages.value[r]=this.messages.value[r].filter(a=>!a.expiresAt||a.expiresAt>n),o!==this.messages.value[r].length&&(e=!0)}),e&&this.saveAllChats()}}class Pi{constructor(n){Ue(this,"currentPartnerId",null);Ue(this,"isListening",!1);Ue(this,"retryTimeout",null);Ue(this,"typingTimeout",null);Ue(this,"DEBUG",!0);this.model=n,this.setupSocketListeners(),this.scheduleRetryCheck()}setupSocketListeners(){const{socket:n}=Ie();if(!n.value){this.DEBUG&&console.log("[ChatController] No socket available, cannot set up listeners");return}this.isListening&&(n.value.off("chat-message"),n.value.off("message-received"),n.value.off("message-read"),n.value.off("typing"),n.value.off("check-pending-messages"),this.isListening=!1),n.value.on("check-pending-messages",()=>{var e;this.DEBUG&&console.log("[ChatController] Server requested to check pending messages"),(e=n.value)==null||e.emit("get-pending-messages")}),n.value.on("chat-message",e=>{this.DEBUG&&(console.log("[ChatController] Received chat message:",e),console.log("[ChatController] Current partner ID:",this.currentPartnerId));const r=this.model.createMessage(e.text,e.from,!1);r.id=e.id,r.timestamp=e.timestamp,this.model.addMessage(r,e.from),e.from!==this.currentPartnerId?(this.DEBUG&&console.log(`[ChatController] Message from ${e.from} marked as unread (not current partner)`),this.model.setUnread(e.from,!0)):(this.DEBUG&&console.log(`[ChatController] Message from current partner ${e.from}, marking as read`),this.sendReadReceipt(e.id,e.from)),this.sendDeliveryReceipt(e.id,e.from)}),n.value.on("message-received",e=>{this.DEBUG&&console.log("[ChatController] Message delivery receipt:",e),this.model.updateMessageStatus(e.id,ut.DELIVERED)}),n.value.on("message-read",e=>{this.DEBUG&&console.log("[ChatController] Message read receipt:",e),this.model.updateMessageStatus(e.id,ut.READ)}),n.value.on("typing",e=>{this.DEBUG&&console.log("[ChatController] Typing indicator:",e),window.dispatchEvent(new CustomEvent("chat:typing",{detail:{partnerId:e.from,isTyping:e.isTyping}}))}),this.isListening=!0,this.DEBUG&&console.log("[ChatController] Chat listeners setup complete")}setCurrentPartner(n){this.currentPartnerId=n,n&&this.model.markAsRead(n)}sendMessage(n,e){if(!n.trim()||!e)return!1;const r=this.model.createMessage(n,e,!0);this.model.addMessage(r,e);const{socket:o,isConnected:a}=Ie();return o.value&&a.value?this.sendMessageToServer(r,e):(r.status=ut.FAILED,this.model.addToPendingMessages(r,e)),!0}sendMessageToServer(n,e){const{socket:r}=Ie();if(!r.value){n.status=ut.FAILED,this.model.addToPendingMessages(n,e);return}this.model.updateMessageStatus(n.id,ut.SENDING),this.DEBUG&&console.log(`[ChatController] Sending message to server: ID=${n.id}, to=${e}, text=${n.originalText||n.text}`),r.value.emit("chat-message",{id:n.id,text:n.originalText||n.text,to:e,timestamp:n.timestamp},o=>{o&&o.success?(this.DEBUG&&console.log(`[ChatController] Server acknowledged message ${n.id}`),this.model.updateMessageStatus(n.id,ut.SENT)):(this.DEBUG&&console.log(`[ChatController] Server rejected message ${n.id}: ${(o==null?void 0:o.error)||"Unknown error"}`),this.model.updateMessageStatus(n.id,ut.FAILED),this.model.addToPendingMessages(n,e))})}resendMessage(n,e){const o=this.model.getPendingMessages(e).find(a=>a.id===n);if(!o){this.DEBUG&&console.log(`[ChatController] Message ${n} not found in pending messages`);const c=this.model.getMessages(e).find(u=>u.id===n&&u.status===ut.FAILED);return c?c.retryCount>=3?(this.DEBUG&&console.log(`[ChatController] Message ${n} has reached maximum retry attempts`),!1):(c.retryCount++,this.sendMessageToServer(c,e),!0):(this.DEBUG&&console.log(`[ChatController] Message ${n} not found in regular messages either`),!1)}return o.retryCount>=3?(this.DEBUG&&console.log(`[ChatController] Message ${n} has reached maximum retry attempts`),!1):(o.retryCount++,this.model.removeFromPendingMessages(n,e),this.sendMessageToServer(o,e),!0)}retryPendingMessages(){const{isConnected:n}=Ie();if(!n.value){this.DEBUG&&console.log("[ChatController] Not connected, skipping retry of pending messages");return}const e=this.model.getAllPendingMessages();Object.keys(e).forEach(r=>{const o=[...e[r]];this.DEBUG&&console.log(`[ChatController] Retrying ${o.length} pending messages for partner ${r}`),o.forEach(a=>{a.retryCount<3&&(this.model.removeFromPendingMessages(a.id,r),this.sendMessageToServer(a,r))})})}scheduleRetryCheck(){this.retryTimeout=setInterval(()=>{this.DEBUG&&console.log("[ChatController] Running scheduled retry check for pending messages"),this.retryPendingMessages()},3e4)}sendDeliveryReceipt(n,e){const{socket:r,isConnected:o}=Ie();if(!r.value||!o.value){this.DEBUG&&console.log("[ChatController] Cannot send delivery receipt: not connected");return}this.DEBUG&&console.log(`[ChatController] Sending delivery receipt for message ${n} to ${e}`),r.value.emit("message-received",{id:n,to:e})}sendReadReceipt(n,e){const{socket:r,isConnected:o}=Ie();if(!r.value||!o.value){this.DEBUG&&console.log("[ChatController] Cannot send read receipt: not connected");return}this.DEBUG&&console.log(`[ChatController] Sending read receipt for message ${n} to ${e}`),r.value.emit("message-read",{id:n,to:e})}sendTypingIndicator(n){const{socket:e,isConnected:r}=Ie();!e.value||!r.value||!n||(this.typingTimeout&&clearTimeout(this.typingTimeout),e.value.emit("typing",{to:n,isTyping:!0}),this.typingTimeout=setTimeout(()=>{e.value&&r.value&&e.value.emit("typing",{to:n,isTyping:!1})},3e3))}getMessages(n){return this.model.getMessages(n)}hasUnreadMessages(n){return this.model.hasUnreadMessages(n)}markAsRead(n){this.model.markAsRead(n)}clearChat(n){this.model.clearChat(n)}clearAllChats(){this.model.clearAllChats()}cleanup(){const{socket:n}=Ie();n.value&&(n.value.off("chat-message"),n.value.off("message-received"),n.value.off("message-read"),n.value.off("typing")),this.retryTimeout&&clearInterval(this.retryTimeout),this.typingTimeout&&clearTimeout(this.typingTimeout),this.isListening=!1}}W({});const Er=W(null);W({});W(!1);W({});let Go=null,ke=null,Vo=!1;function Mi(){const t=ka();Ie(),Vo||(console.log("[ChatService] Initializing chat service with MVC architecture"),Go=new Ii(t),ke=new Pi(Go),Vo=!0);function n(i){Er.value=i,ke&&ke.setCurrentPartner(i)}function e(i,g=null){const d=g||Er.value;return!d||!i.trim()||!ke?!1:ke.sendMessage(i,d)}function r(i,g){return ke?ke.resendMessage(i,g):!1}function o(i){return!i||!ke?[]:ke.getMessages(i)}function a(i){return!i||!ke?!1:ke.hasUnreadMessages(i)}function c(i){!i||!ke||ke.markAsRead(i)}function u(i){!i||!ke||ke.sendTypingIndicator(i)}function f(i){ke&&ke.clearChat(i)}function s(){ke&&ke.clearAllChats()}return{currentPartnerId:Er,setCurrentPartner:n,sendMessage:e,resendMessage:r,getMessages:o,hasUnreadMessages:a,markAsRead:c,handleTyping:u,clearChat:f,clearAllChats:s}}const zt="/assets/Circle-e098ae42.png",Oi={class:"bg-white/5 backdrop-blur-sm rounded-2xl p-4 sm:p-6 text-center border border-white/10"},Wi={key:"disconnected"},Ni={key:"disconnecting"},Li={class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},Hi={class:"text-xs sm:text-sm text-red-300"},Ui={key:"searching"},ji={key:"matched"},qi={class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},zi={key:0,class:"flex items-center justify-center gap-2 text-gray-300"},Gi={class:"text-lg sm:text-xl"},Vi={class:"text-xs sm:text-sm font-medium"},Ki={key:"connected"},Yi={class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},Xi={key:0,class:"flex items-center justify-center gap-2 text-gray-300"},Qi={class:"text-lg sm:text-xl"},Zi={class:"text-xs sm:text-sm font-medium"},Ji={key:0,class:"mt-3 sm:mt-4 text-xs"},el={class:"flex items-center justify-center gap-1 sm:gap-2"},tl={class:"text-gray-300"},nl={key:0,class:"text-red-400 mt-1 text-xs"},rl=He({__name:"connection-card",props:{status:{type:String,default:"disconnected"},partnerInfo:{type:Object,default:null},errorMessage:{type:String,default:""},showStatus:{type:Boolean,default:!0},disconnectReason:{type:String,default:""}},setup(t){const n=t,e=W(n.status),r=_e(()=>{switch(n.disconnectReason){case"skip":return"Skipped";case"network-disconnect":return"Connection Lost";case"inactivity":return"Inactive Connection";case"matching":return"Finding New Partner";default:return"Disconnected"}}),o=_e(()=>{switch(n.disconnectReason){case"skip":return"The conversation has been skipped";case"network-disconnect":return"The connection with your partner was lost";case"inactivity":return"The call ended due to inactivity";case"matching":return"Looking for a new partner...";default:return"The call has been ended"}});De(()=>n.partnerInfo,(g,d)=>{console.log("PartnerInfo changed in connection-card:",{new:g?"Present":"Null",old:d?"Present":"Null",status:n.status})},{deep:!0}),De(()=>n.status,(g,d)=>{console.log("Status changed in connection-card:",{new:g,old:d}),e.value=d,g==="disconnected"&&n.partnerInfo!==null&&console.warn("Warning: Partner info still present when status is disconnected")});const a=_e(()=>e.value==="disconnected"&&n.status==="searching"?"idle-to-search":e.value==="searching"&&n.status==="matched"?"search-to-match":e.value==="matched"&&n.status==="connected"?"match-to-connect":n.status==="disconnected"?"to-idle":n.status==="disconnecting"?"to-disconnecting":"fade"),c=g=>{},u=(g,d)=>{},f=g=>{},s=_e(()=>{switch(n.status){case"searching":return"Searching...";case"matched":return"Partner found, connecting...";case"connected":return"Connected";case"disconnecting":return"Call ended";default:return"Disconnected"}}),i=g=>{switch(g.toLowerCase()){case"any":return"Go With the Flow";case"chill":return"Chill";case"fun":return"Fun";case"curious":return"Curious";case"creative":return"Creative";default:return g}};return ze(()=>{window.addEventListener("connection-closed",()=>{console.log("Connection-closed event received in connection-card")})}),(g,d)=>(N(),L("div",Oi,[Qe(Ka,{name:a.value,mode:"out-in",onBeforeLeave:c,onEnter:u,onAfterEnter:f},{default:Va(()=>{var b,v;return[t.status==="disconnected"?(N(),L("div",Wi,d[0]||(d[0]=[l("div",{class:"status-container"},[l("div",{class:"status-circle"},[l("img",{src:zt,alt:"Connection Circle",class:"circle-image"}),l("div",{class:"thin-ring idle-ring"})])],-1),l("h2",{class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},"Ready to Connect",-1),l("p",{class:"text-xs sm:text-sm text-gray-300"},'Press "Next" to find someone to talk with',-1)]))):t.status==="disconnecting"?(N(),L("div",Ni,[d[1]||(d[1]=l("div",{class:"status-container"},[l("div",{class:"status-circle"},[l("img",{src:zt,alt:"Connection Circle",class:"circle-image pulse-effect"}),l("div",{class:"thin-ring disconnecting-ring"})])],-1)),l("h2",Li,K(r.value),1),l("p",Hi,K(o.value),1)])):t.status==="searching"?(N(),L("div",Ui,d[2]||(d[2]=[l("div",{class:"status-container"},[l("div",{class:"status-circle"},[l("img",{src:zt,alt:"Connection Circle",class:"circle-image pulse-effect"}),l("div",{class:"thin-ring search-ring"})])],-1),l("h2",{class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},"Searching...",-1),l("p",{class:"text-xs sm:text-sm text-gray-300"},"Looking for someone to talk to",-1)]))):t.status==="matched"?(N(),L("div",ji,[d[3]||(d[3]=l("div",{class:"status-container"},[l("div",{class:"status-circle"},[l("img",{src:zt,alt:"Connection Circle",class:"circle-image fast-rotate"}),l("div",{class:"thin-ring match-ring"})])],-1)),l("h2",qi,K((b=t.partnerInfo)!=null&&b.vibe?i(t.partnerInfo.vibe):"Match Found!"),1),t.partnerInfo?(N(),L("div",zi,[l("span",Gi,K(t.partnerInfo.flag||"🌍"),1),l("span",Vi,K(t.partnerInfo.country),1)])):ne("",!0),d[4]||(d[4]=l("p",{class:"text-xs sm:text-sm text-yellow-400 mt-1 sm:mt-2"},"Setting up voice connection...",-1))])):t.status==="connected"?(N(),L("div",Ki,[d[5]||(d[5]=l("div",{class:"status-container"},[l("div",{class:"status-circle"},[l("img",{src:zt,alt:"Connection Circle",class:"circle-image"}),l("div",{class:"thin-ring connect-ring"})])],-1)),l("h2",Yi,K((v=t.partnerInfo)!=null&&v.vibe?i(t.partnerInfo.vibe):"Connected!"),1),t.partnerInfo?(N(),L("div",Xi,[l("span",Qi,K(t.partnerInfo.flag||"🌍"),1),l("span",Zi,K(t.partnerInfo.country),1)])):ne("",!0),d[6]||(d[6]=l("p",{class:"text-xs sm:text-sm text-green-400 mt-1 sm:mt-2"},"You can talk now",-1))])):ne("",!0)]}),_:1},8,["name"]),t.showStatus&&t.status!=="disconnected"?(N(),L("div",Ji,[l("div",el,[l("span",{class:ie({"text-green-400":t.status==="connected","text-yellow-400":t.status==="matched","text-blue-400":t.status==="searching","text-red-400":t.status==="disconnecting"})},"●",2),l("span",tl,K(s.value),1)]),t.errorMessage?(N(),L("p",nl,K(t.errorMessage),1)):ne("",!0)])):ne("",!0)]))}});const tt=(t,n)=>{const e=t.__vccOpts||t;for(const[r,o]of n)e[r]=o;return e},ol=tt(rl,[["__scopeId","data-v-f2f75ee4"]]),al={class:"space-y-2 sm:space-y-3 md:space-y-4 px-1 sm:px-2"},sl={class:"flex justify-center items-center gap-2 sm:gap-3 md:gap-4"},il=["disabled"],ll={class:"relative"},cl={key:0,class:"text-white text-base sm:text-lg md:text-xl"},ul={key:1,class:"text-white text-base sm:text-lg md:text-xl"},dl={key:2,class:"absolute -top-1 -right-1 w-2 h-2 sm:w-3 sm:h-3 bg-yellow-300 rounded-full animate-pulse"},fl=["disabled"],xl={class:"flex flex-wrap justify-center gap-1 sm:gap-2 md:gap-3"},vl=He({__name:"control-buttons",props:{isMuted:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!0}},emits:["toggle-mute","find-next","toggle-chat","toggle-games","toggle-history","toggle-donation"],setup(t,{emit:n}){const e=t,r=n,o=W(!1),a=W(e.isMuted);De(()=>e.isMuted,f=>{a.value=f});function c(f){const{isMuted:s}=f.detail;a.value=s}function u(){o.value||(o.value=!0,r("toggle-mute"),setTimeout(()=>{o.value=!1},200),setTimeout(()=>{try{const f=document.querySelector("audio");f&&f.paused&&f.play().catch(s=>{console.warn("Could not auto-play audio after mute toggle:",s)})}catch(f){console.error("Error trying to auto-play:",f)}},300))}return ze(()=>{const{getSavedMicrophoneState:f}=Gt(),s=f();s!==null&&(a.value=s),window.addEventListener("microphone-state-changed",c)}),ft(()=>{window.removeEventListener("microphone-state-changed",c)}),(f,s)=>(N(),L("div",al,[l("div",sl,[l("button",{onClick:u,class:ie(["w-11 h-11 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center transition-all shadow-xl transform hover:scale-110",a.value?"bg-gradient-to-r from-red-400 to-pink-400 shadow-red-400/70":"bg-gradient-to-r from-emerald-400 to-green-400 hover:from-green-400 hover:to-emerald-400 shadow-emerald-400/70"]),disabled:o.value},[l("div",ll,[a.value?(N(),L("span",ul,"🔇")):(N(),L("span",cl,"🎤")),o.value?(N(),L("span",dl)):ne("",!0)])],10,il),l("button",{onClick:s[0]||(s[0]=i=>f.$emit("find-next")),class:"w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-gradient-to-r from-orange-400 to-yellow-400 hover:from-yellow-400 hover:to-orange-400 rounded-full flex items-center justify-center shadow-2xl shadow-orange-400/80 transition-all transform hover:scale-110"},s[5]||(s[5]=[l("span",{class:"text-white text-xl sm:text-2xl md:text-3xl"},"📞",-1)])),l("button",{onClick:s[1]||(s[1]=i=>f.$emit("toggle-chat")),disabled:t.isDisabled,class:ie(["w-11 h-11 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center shadow-xl transition-all transform hover:scale-110",t.isDisabled?"bg-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-blue-400 to-cyan-400 hover:from-cyan-400 hover:to-blue-400 shadow-blue-400/70"])},s[6]||(s[6]=[l("span",{class:"text-white text-base sm:text-lg md:text-xl"},"💬",-1)]),10,fl)]),l("div",xl,[l("button",{onClick:s[2]||(s[2]=i=>f.$emit("toggle-games")),class:"bg-gradient-to-r from-purple-400 to-pink-400 hover:from-pink-400 hover:to-purple-400 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-purple-400/70 transition-all transform hover:scale-110 whitespace-nowrap"}," 🎮 Games "),l("button",{onClick:s[3]||(s[3]=i=>f.$emit("toggle-history")),class:"bg-gradient-to-r from-indigo-400 to-blue-400 hover:from-blue-400 hover:to-indigo-400 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-indigo-400/70 transition-all transform hover:scale-110 whitespace-nowrap"}," 📞 History "),l("button",{onClick:s[4]||(s[4]=i=>f.$emit("toggle-donation")),class:"bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-orange-400 hover:to-yellow-400 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-yellow-400/70 transition-all animate-pulse transform hover:scale-110 whitespace-nowrap"}," ❤️ Support ")])]))}}),gl={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},ml={class:"bg-gray-900 rounded-lg w-full max-w-md mx-auto h-[80vh] flex flex-col"},pl={class:"flex items-center justify-between p-4 border-b border-gray-700"},hl={key:0,class:"h-full flex items-center justify-center text-gray-500"},bl={key:1,class:"space-y-2"},yl={class:"flex justify-between gap-2"},Cl={class:"text-xs text-gray-400"},wl={class:"mt-1 text-white break-words"},El={class:"p-3 border-t border-gray-700"},_l=["disabled"],Al=["disabled"],Bl=He({__name:"chat-modal",props:{isOpen:{type:Boolean,default:!1},isConnected:{type:Boolean,default:!1},messages:{type:Array,default:()=>[]}},emits:["close","send-message"],setup(t,{emit:n}){const e=t,r=n,o=W(""),a=W(null),c=()=>{o.value.trim()&&e.isConnected&&(r("send-message",o.value),o.value="")},u=async()=>{await Jo(),a.value&&(a.value.scrollTop=a.value.scrollHeight)},f=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return De(()=>e.messages,()=>{u()},{deep:!0}),De(()=>e.isOpen,s=>{s&&u()}),ze(()=>{e.isOpen&&u()}),(s,i)=>t.isOpen?(N(),L("div",gl,[l("div",ml,[l("div",pl,[i[2]||(i[2]=l("div",{class:"flex items-center"},[l("span",{class:"text-white text-lg font-medium"},"💬 Chat")],-1)),l("button",{onClick:i[0]||(i[0]=g=>s.$emit("close")),class:"text-gray-400 hover:text-white"}," ✕ ")]),l("div",{class:"flex-1 p-4 overflow-y-auto",ref_key:"messagesContainerRef",ref:a},[t.messages.length===0?(N(),L("div",hl,i[3]||(i[3]=[l("div",{class:"text-center"},[l("p",null,"No messages yet"),l("p",{class:"text-sm mt-1"},"Send a message to start the conversation")],-1)]))):(N(),L("div",bl,[(N(!0),L(Ae,null,Pe(t.messages,g=>(N(),L("div",{key:g.id,class:ie(["rounded-lg p-3 max-w-[80%]",g.isOwn?"bg-blue-700 ml-auto":"bg-gray-700 mr-auto"])},[l("div",yl,[l("span",{class:ie(["text-sm",g.isOwn?"text-blue-200":"text-gray-200"])},K(g.isOwn?"You":"Partner"),3),l("span",Cl,K(f(g.timestamp)),1)]),l("p",wl,K(g.text||g.message),1)],2))),128))]))],512),l("div",El,[l("form",{onSubmit:Zo(c,["prevent"]),class:"flex gap-2"},[Rt(l("input",{"onUpdate:modelValue":i[1]||(i[1]=g=>o.value=g),type:"text",placeholder:"Type a message...",class:"flex-1 bg-gray-800 border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!t.isConnected},null,8,_l),[[Vt,o.value]]),l("button",{type:"submit",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",disabled:!t.isConnected||!o.value.trim()}," Send ",8,Al)],32)])])])):ne("",!0)}});class kl{constructor(n=[]){Ue(this,"sounds",new Map);Ue(this,"isMuted",!1);Ue(this,"defaultVolume",.5);Ue(this,"soundPaths",{click:"/sounds/click.mp3",win:"/sounds/win.mp3",lose:"/sounds/lose.mp3",draw:"/sounds/draw.mp3",move:"/sounds/move.mp3",notification:"/sounds/notification.mp3",countdown:"/sounds/countdown.mp3",gameStart:"/sounds/game-start.mp3",gameOver:"/sounds/game-over.mp3",correct:"/sounds/correct.mp3",incorrect:"/sounds/incorrect.mp3",button:"/sounds/button.mp3"});n.length>0&&n.forEach(o=>{o in this.soundPaths&&this.preloadSound(o)});const e=localStorage.getItem("gameSoundMuted");e&&(this.isMuted=e==="true");const r=localStorage.getItem("gameSoundVolume");r&&(this.defaultVolume=parseFloat(r))}preloadSound(n){if(this.soundPaths[n]){const e=new Audio(this.soundPaths[n]);e.preload="auto",this.sounds.set(n,e)}}playSound(n,e={}){if(this.isMuted)return;this.sounds.has(n)||this.preloadSound(n);const r=this.sounds.get(n);r&&(r.pause(),r.currentTime=0,r.volume=e.volume!==void 0?e.volume:this.defaultVolume,r.loop=e.loop||!1,r.play().catch(o=>{console.warn(`Failed to play sound ${n}:`,o)}))}toggleMute(){return this.isMuted=!this.isMuted,localStorage.setItem("gameSoundMuted",this.isMuted.toString()),this.isMuted&&this.stopAllSounds(),this.isMuted}isSoundMuted(){return this.isMuted}setVolume(n){this.defaultVolume=Math.max(0,Math.min(1,n)),localStorage.setItem("gameSoundVolume",this.defaultVolume.toString())}stopAllSounds(){this.sounds.forEach(n=>{n.pause(),n.currentTime=0})}stopSound(n){const e=this.sounds.get(n);e&&(e.pause(),e.currentTime=0)}}class ln{static addWinEffect(n,e=2e3){n.classList.add("win-effect"),setTimeout(()=>{n.classList.remove("win-effect")},e)}static addLoseEffect(n,e=1e3){n.classList.add("lose-effect"),setTimeout(()=>{n.classList.remove("lose-effect")},e)}static addDrawEffect(n,e=1500){n.classList.add("draw-effect"),setTimeout(()=>{n.classList.remove("draw-effect")},e)}static addPulseEffect(n,e="rgba(139, 92, 246, 0.5)",r=1e3){const o=n.style.border,a=n.style.boxShadow;n.style.border=`2px solid ${e}`,n.style.boxShadow=`0 0 10px ${e}`,n.style.transition="all 0.3s ease",setTimeout(()=>{n.style.border=o,n.style.boxShadow=a},r)}static addMoveEffect(n,e,r=10,o=300){const a=n.style.position,c=n.style.transform;a!=="relative"&&a!=="absolute"&&(n.style.position="relative");let u="";switch(e){case"up":u=`translateY(-${r}px)`;break;case"down":u=`translateY(${r}px)`;break;case"left":u=`translateX(-${r}px)`;break;case"right":u=`translateX(${r}px)`;break}n.style.transform=u,n.style.transition=`transform ${o}ms ease`,setTimeout(()=>{n.style.transform=c},o)}}const ge=new kl(["click","win","lose","move","notification"]),Dl={class:"w-full p-2"},Fl={class:"flex justify-between items-center mb-4 game-header"},Tl={key:0,class:"text-yellow-300 animate-pulse"},Sl={key:1},Rl={key:2},$l={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 mb-4 game-board"},Il={class:"mb-4 w-full"},Pl={class:"flex items-center justify-between gap-4 mb-2"},Ml={class:"flex items-center"},Ol={class:"text-center ml-2"},Wl={key:0,class:"flex items-center"},Nl={class:"flex items-center justify-center p-1 bg-gray-700/50 rounded-lg"},Ll={class:"ml-2 text-sm text-gray-300"},Hl={class:"flex items-center"},Ul={class:"text-center mr-2"},jl={key:0,class:"bg-gray-700/40 rounded-lg p-2 text-sm text-gray-300 mb-3"},ql={class:"flex justify-between mb-1"},zl={class:"flex justify-between mb-1"},Gl={class:"flex justify-between"},Vl={class:"grid grid-cols-3 gap-3 mb-4"},Kl=["onClick","disabled"],Yl={key:0,class:"text-blue-400"},Xl={key:1,class:"text-green-400"},Ql={key:0,class:"text-center mt-4 animate__animated animate__fadeIn"},Zl={key:1,class:"text-center mt-4 animate__animated animate__fadeIn"},Jl={key:2,class:"text-center mt-4"},ec={key:0,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},tc={class:"bg-gray-800 p-4 rounded-lg max-w-xs w-full text-center"},nc={class:"flex justify-center gap-3"},rc=6e4,oc=He({__name:"TicTacToe",props:{partnerId:{type:String,required:!0},isFirstPlayer:{type:Boolean,default:!0},partnerReady:{type:Boolean,default:!1}},emits:["back","error"],setup(t,{emit:n}){const e=t,r=n,{socket:o}=Ie(),a=W("waiting"),c=W(["","","","","","","","",""]),u=W(e.isFirstPlayer?"X":"O"),f=W(e.isFirstPlayer?"O":"X"),s=W("X"),i=W(null),g=W(null),d=W(Date.now()),b=W([]),v=W([]);W(ge.isSoundMuted());const C=W(!1),x=W({moves:0,movesByPlayer:{},gameTime:0,gameStartTime:Date.now()}),p=_e(()=>s.value===u.value),m=E=>{const P=Math.floor(E/60),H=E%60;return`${P}:${H<10?"0":""}${H}`},h=E=>{var P;if(!(a.value!=="playing"||c.value[E]!==""||!p.value||i.value!==null))try{ge.playSound("move"),c.value[E]=u.value,s.value=f.value,d.value=Date.now(),v.value[E]&&ln.addPulseEffect(v.value[E],u.value==="X"?"rgba(59, 130, 246, 0.5)":"rgba(16, 185, 129, 0.5)");const H={index:E};(P=o.value)==null||P.emit("game-move",{gameType:"tic-tac-toe",move:H,to:e.partnerId}),y(),w()}catch{T("Failed to make a move. Please try again.")}},y=()=>{const E=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const P of E){const[H,Q,k]=P;if(c.value[H]!==""&&c.value[H]===c.value[Q]&&c.value[H]===c.value[k])return a.value="finished",i.value=c.value[H],b.value=P,setTimeout(()=>{P.forEach(S=>{v.value[S]&&ln.addWinEffect(v.value[S])})},100),i.value===u.value?ge.playSound("win"):ge.playSound("lose"),!0}return c.value.every(P=>P!=="")?(a.value="finished",i.value="tie",ge.playSound("draw"),!0):!1},w=()=>{g.value&&clearTimeout(g.value),g.value=window.setTimeout(()=>{var E;a.value==="playing"&&i.value===null&&((E=o.value)==null||E.emit("game-ping",{to:e.partnerId,gameType:"tic-tac-toe"}),setTimeout(()=>{a.value==="playing"&&i.value===null&&D()},5e3))},rc)},D=()=>{a.value==="playing"&&(a.value="finished",T("Lost connection with your partner. The game has ended."),ge.playSound("notification"))},F=()=>{var E;try{ge.playSound("click"),c.value=["","","","","","","","",""],i.value=null,a.value="playing",b.value=[];const P=u.value;u.value=f.value,f.value=P,s.value="X",(E=o.value)==null||E.emit("game-reset",{gameType:"tic-tac-toe",to:e.partnerId,swapRoles:!0}),w()}catch{T("Failed to reset the game. Please try again.")}},T=E=>{r("error",E),console.error(E)},j=E=>{var P,H,Q;if(console.log("Received server state update:",E),E.board&&(c.value=E.board.map(k=>k===null?"":k)),E.currentSymbol?s.value=E.currentSymbol:E.currentTurn&&E.marks&&(s.value=E.marks[E.currentTurn]||"X"),E.playerSymbols){const k=(P=o.value)==null?void 0:P.id,S=e.partnerId;k&&E.playerSymbols[k]&&(u.value=E.playerSymbols[k],f.value=E.playerSymbols[S])}else if(E.marks){const k=((H=o.value)==null?void 0:H.id)||"";u.value=E.marks[k]||"X";const S=Object.keys(E.marks).filter(_=>_!==k);S.length>0&&(f.value=E.marks[S[0]]||"O")}if(E.gameOver)if(a.value="finished",E.winner){const k=((Q=o.value)==null?void 0:Q.id)||"";E.winner===k?(i.value=u.value,ge.playSound("win")):(i.value=f.value,ge.playSound("lose"))}else E.isDraw&&(i.value="tie",ge.playSound("draw"));else a.value="playing";E.winningLine&&(b.value=E.winningLine,b.value.length>0&&setTimeout(()=>{b.value.forEach(k=>{v.value[k]&&ln.addWinEffect(v.value[k])})},100)),E.stats&&(x.value=E.stats),E.gameOver||y()};ze(()=>{if(!o.value){T("Socket connection not available");return}o.value.on("game-move",E=>{if(E.gameType==="tic-tac-toe"&&E.from===e.partnerId)try{if(E.gameState){j(E.gameState),ge.playSound("move"),w();return}let P=-1;if(typeof E.move=="object"&&E.move!==null?typeof E.move.index=="number"?P=E.move.index:typeof E.move.row=="number"&&typeof E.move.col=="number"&&(P=E.move.row*3+E.move.col):typeof E.move=="number"&&(P=E.move),P<0||P>=9){T("Received invalid move from partner");return}c.value[P]=f.value,s.value=u.value,d.value=Date.now(),ge.playSound("move"),v.value[P]&&ln.addPulseEffect(v.value[P],f.value==="X"?"rgba(59, 130, 246, 0.5)":"rgba(16, 185, 129, 0.5)"),y(),w()}catch{T("Error processing partner's move")}}),o.value.on("game-reset",E=>{if(E.gameType==="tic-tac-toe"&&E.from===e.partnerId)try{if(E.gameState){j(E.gameState),ge.playSound("gameStart"),w();return}if(c.value=["","","","","","","","",""],i.value=null,a.value="playing",b.value=[],E.swapRoles){const P=u.value;u.value=f.value,f.value=P}s.value="X",ge.playSound("gameStart"),w(),console.log(`Game reset received. My symbol is now ${u.value}, partner's symbol is ${f.value}`)}catch{T("Error resetting the game")}}),o.value.on("game-state",E=>{if(E.gameType==="tic-tac-toe")try{j(E)}catch{T("Error updating game state")}}),o.value.on("game-ping",E=>{var P;E.from===e.partnerId&&((P=o.value)==null||P.emit("game-pong",{to:e.partnerId,gameType:"tic-tac-toe"}),d.value=Date.now())}),o.value.on("game-pong",E=>{E.from===e.partnerId&&(d.value=Date.now(),console.log("Received pong from partner, connection is active"))}),o.value.on("game-notification",E=>{E.from===e.partnerId&&(E.type==="leave"?console.log("Partner is leaving the game"):console.log(`Game notification from partner: ${E.message}`))}),o.value.on("game-partner-joined",E=>{E.from===e.partnerId&&(a.value="playing",ge.playSound("gameStart"),w())}),o.value.on("game-partner-left",E=>{if(E.from===e.partnerId){a.value="finished";const P=document.createElement("div");P.className="fixed top-4 right-4 bg-yellow-600/80 text-white px-4 py-2 rounded-lg shadow-lg z-50",P.innerHTML=`
        <div class="flex items-center gap-2">
          <span>⚠️</span>
          <span>Your partner has left the game</span>
        </div>
      `,document.body.appendChild(P),setTimeout(()=>{document.body.removeChild(P),r("back")},3e3),ge.playSound("click"),g.value&&(clearTimeout(g.value),g.value=null)}}),e.isFirstPlayer||(a.value="playing",ge.playSound("gameStart"),w())}),ft(()=>{o.value&&(o.value.off("game-move"),o.value.off("game-reset"),o.value.off("game-partner-joined"),o.value.off("game-partner-left"),o.value.off("game-state"),o.value.off("game-notification"),o.value.off("game-ping"),o.value.off("game-pong"),e.partnerId&&(o.value.emit("game-notification",{to:e.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{var E;(E=o.value)==null||E.emit("game-leave-room",{roomId:`tictactoe-${e.partnerId}`,to:e.partnerId})},200))),g.value&&(clearTimeout(g.value),g.value=null)});const B=W(!1),A=()=>{B.value=!1,o.value&&e.partnerId?(o.value.emit("game-notification",{to:e.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{var E;(E=o.value)==null||E.emit("game-leave-room",{roomId:`tictactoe-${e.partnerId}`,to:e.partnerId}),r("back")},200)):r("back")},O=()=>{ge.playSound("click"),B.value=!0};return(E,P)=>(N(),L(Ae,null,[l("div",Dl,[l("div",Fl,[P[2]||(P[2]=l("h2",{class:"text-xl font-bold text-purple-400"},"Tic Tac Toe",-1)),l("div",{class:ie(["text-white text-sm px-3 py-1 rounded-full game-status",{"bg-yellow-600/30":a.value==="waiting","bg-green-600/30":p.value&&a.value==="playing","bg-red-600/30":!p.value&&a.value==="playing","bg-purple-600/30":i.value}])},[a.value==="waiting"?(N(),L("span",Tl," Waiting for partner... ")):i.value?(N(),L("span",Sl,K(i.value===u.value?"You Won! 🎉":i.value==="tie"?"It's a Tie! 🤝":"You Lost! 😢"),1)):(N(),L("span",Rl,K(p.value?"Your Turn":"Partner's Turn"),1))],2)]),l("div",$l,[l("div",{class:ie(["flex flex-col items-center",[{"opacity-70":a.value==="waiting"||!p.value&&!i.value}]])},[l("div",Il,[l("div",Pl,[l("div",Ml,[l("div",{class:ie([{"ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800":u.value==="X"},"w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-lg font-bold"])}," X ",2),l("div",Ol,[P[3]||(P[3]=l("p",{class:"text-gray-300 text-sm"},"You",-1)),l("p",{class:ie(["font-bold text-lg",{"text-blue-400":u.value==="X","text-green-400":u.value==="O"}])},K(u.value),3)])]),a.value==="playing"?(N(),L("div",Wl,[l("div",Nl,[l("div",{class:ie(["w-2 h-2 rounded-full",{"bg-green-400 animate-pulse":p.value,"bg-red-400":!p.value}])},null,2),l("span",Ll,K(p.value?"Your Turn":"Partner's Turn"),1)])])):ne("",!0),l("div",Hl,[l("div",Ul,[P[4]||(P[4]=l("p",{class:"text-gray-300 text-sm"},"Partner",-1)),l("p",{class:ie(["font-bold text-lg",{"text-blue-400":f.value==="X","text-green-400":f.value==="O"}])},K(f.value),3)]),l("div",{class:ie([{"ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800":u.value==="O"},"w-10 h-10 rounded-full bg-green-600 flex items-center justify-center text-lg font-bold"])}," O ",2)])]),C.value?(N(),L("div",jl,[l("div",ql,[P[5]||(P[5]=l("span",null,"Moves:",-1)),l("span",null,K(x.value.moves),1)]),l("div",zl,[P[6]||(P[6]=l("span",null,"Your Moves:",-1)),l("span",null,K(x.value.movesByPlayer[e.partnerId]||0),1)]),l("div",Gl,[P[7]||(P[7]=l("span",null,"Game Time:",-1)),l("span",null,K(m(x.value.gameTime)),1)])])):ne("",!0),l("button",{onClick:P[0]||(P[0]=H=>C.value=!C.value),class:"w-full text-xs bg-gray-700/30 hover:bg-gray-700/50 py-1 rounded-lg transition-colors text-gray-400"},K(C.value?"Hide Stats":"Show Stats"),1)]),l("div",Vl,[(N(!0),L(Ae,null,Pe(c.value,(H,Q)=>(N(),L("button",{key:Q,onClick:k=>h(Q),disabled:H!==""||!p.value||i.value!==null||a.value==="waiting",ref_for:!0,ref:k=>{k&&(v.value[Q]=k)},class:ie(["w-20 h-20 rounded-lg flex items-center justify-center text-3xl font-bold transition-all duration-300 game-cell game-transition",{"game-interactive bg-gray-700 hover:bg-gray-600":H===""&&p.value&&!i.value&&a.value!=="waiting","bg-gray-700/50":H===""&&(!p.value||i.value!==null||a.value==="waiting"),"bg-blue-600/20":H==="X","bg-green-600/20":H==="O","cursor-not-allowed":H!==""||!p.value||i.value!==null||a.value==="waiting","hover:bg-purple-700/50":p.value&&H===""&&!i.value&&a.value==="playing","win-effect":b.value.includes(Q)}])},[H==="X"?(N(),L("span",Yl,"X")):H==="O"?(N(),L("span",Xl,"O")):ne("",!0)],10,Kl))),128))]),i.value?(N(),L("div",Ql,[l("button",{onClick:F,class:"game-button bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm transition-colors mb-2 game-interactive"}," Play Again "),P[8]||(P[8]=l("p",{class:"text-sm text-gray-400 mt-1"}," In the next round, symbols (X/O) will be swapped ",-1))])):a.value==="finished"?(N(),L("div",Zl,[l("button",{onClick:F,class:"game-button bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm transition-colors mb-2 game-interactive"}," Play Again "),P[9]||(P[9]=l("p",{class:"text-sm text-gray-400 mt-1"}," In the next round, symbols (X/O) will be swapped ",-1))])):ne("",!0),a.value==="waiting"?(N(),L("div",Jl,P[10]||(P[10]=[l("div",{class:"bg-yellow-600/20 rounded-lg p-4 animate-pulse"},[l("p",{class:"text-yellow-300 mb-1"},"Waiting for your partner to join..."),l("p",{class:"text-sm text-gray-300"},[je(" You'll play as "),l("span",{class:"font-bold text-blue-400"},"X")])],-1)]))):ne("",!0)],2)]),l("div",{class:"flex justify-end mb-4"},[l("button",{onClick:O,class:"game-button bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors game-interactive"}," Back to Games ")])]),B.value?(N(),L("div",ec,[l("div",tc,[P[11]||(P[11]=l("h3",{class:"text-lg font-semibold mb-3 text-white"},"Are you sure?",-1)),P[12]||(P[12]=l("p",{class:"text-sm text-gray-300 mb-4"}," Leaving the game will end it for your partner too. ",-1)),l("div",nc,[l("button",{onClick:P[1]||(P[1]=H=>B.value=!1),class:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"}," Cancel "),l("button",{onClick:A,class:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm"}," Leave ")])])])):ne("",!0)],64))}});const ac=tt(oc,[["__scopeId","data-v-9065bc8e"]]),sc={class:"w-full p-2"},ic={class:"flex justify-between items-center mb-4"},lc={key:0,class:"text-yellow-300 animate-pulse flex items-center"},cc={key:1,class:"flex items-center"},uc={key:2,class:"flex items-center"},dc={key:3,class:"flex items-center"},fc={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 md:p-6 mb-4 border border-gray-700/50 shadow-xl"},xc={class:"flex justify-center items-center gap-4 md:gap-8 mb-6 w-full"},vc={class:"text-center p-2 bg-blue-900/20 rounded-lg backdrop-blur-sm border border-blue-800/30 min-w-[70px]"},gc={class:"text-2xl font-bold text-blue-400"},mc={class:"text-center px-4 py-2 bg-gray-700/50 rounded-lg border border-gray-600/30"},pc={class:"text-xl font-bold text-white"},hc={class:"text-center p-2 bg-green-900/20 rounded-lg backdrop-blur-sm border border-green-800/30 min-w-[70px]"},bc={class:"text-2xl font-bold text-green-400"},yc={class:"w-full mb-4"},Cc={key:0,class:"flex flex-col items-center mb-6 animate__animated animate__fadeIn"},wc={class:"flex justify-center items-center gap-6 md:gap-10 mb-6"},Ec={class:"text-center"},_c={class:"text-center"},Ac={key:1,class:"animate__animated animate__fadeIn"},Bc={class:"text-center mb-6"},kc={class:"inline-block px-3 py-1 rounded-full bg-gray-700/70 text-sm text-gray-300 mb-2"},Dc={class:"flex justify-center items-center gap-3 md:gap-6"},Fc=["onClick"],Tc={class:"text-4xl mb-2"},Sc={class:"text-xs text-gray-300"},Rc={key:2,class:"text-center"},$c={key:3,class:"text-center"},Ic={key:0,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},Pc={class:"bg-gray-800 p-4 rounded-lg max-w-xs w-full text-center"},Mc={class:"flex justify-center gap-3"},Ko=10,Oc=He({__name:"RockPaperScissors",props:{partnerId:{type:String,required:!0},partnerReady:{type:Boolean,default:!1}},emits:["back","error"],setup(t,{emit:n}){const e=t,r=n,{socket:o}=Ie(),a=[{value:"rock",name:"Rock",emoji:"👊"},{value:"paper",name:"Paper",emoji:"✋"},{value:"scissors",name:"Scissors",emoji:"✌️"}],c=W("waiting"),u=W(null),f=W(null),s=W(0),i=W(0),g=W(1),d=W(null),b=W(Ko),v=W(null),C=W(!1),x=_e(()=>d.value==="win"?"You Win!":d.value==="lose"?"You Lose!":d.value==="tie"?"It's a Tie!":""),p=B=>{if(!B)return"❓";const A=a.find(O=>O.value===B);return A?A.emoji:"❓"},m=()=>{var B;c.value="choosing",u.value=null,f.value=null,d.value=null,D(),(B=o.value)==null||B.emit("game-start-round",{gameType:"rock-paper-scissors",to:e.partnerId,round:g.value})},h=B=>{var A;u.value=B,(A=o.value)==null||A.emit("game-move",{gameType:"rock-paper-scissors",move:{choice:B,round:g.value},to:e.partnerId}),console.log(`Sent move to server: ${B}, round: ${g.value}`),f.value&&y()},y=()=>{!u.value||!f.value||(F(),c.value="result",u.value===f.value?d.value="tie":u.value==="rock"&&f.value==="scissors"||u.value==="paper"&&f.value==="rock"||u.value==="scissors"&&f.value==="paper"?(d.value="win",s.value++):(d.value="lose",i.value++),g.value++)},w=()=>{m()},D=()=>{b.value=Ko,v.value&&clearInterval(v.value),v.value=window.setInterval(()=>{if(b.value--,b.value<=0&&(F(),!u.value)){const B=Math.floor(Math.random()*a.length);h(a[B].value)}},1e3)},F=()=>{v.value&&(clearInterval(v.value),v.value=null)},T=()=>{C.value=!0},j=()=>{C.value=!1,o.value&&e.partnerId?(o.value.emit("game-notification",{to:e.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{var B;(B=o.value)==null||B.emit("game-leave-room",{roomId:`rps-${e.partnerId}`,to:e.partnerId}),r("back")},200)):r("back")};return ze(()=>{var B,A,O,E,P;e.partnerReady&&(c.value="ready"),(B=o.value)==null||B.on("game-move",H=>{if(H.from===e.partnerId&&H.gameType==="rock-paper-scissors"){let Q=null;if(typeof H.move=="string"?Q=H.move:typeof H.move=="object"&&H.move!==null&&(Q=H.move.choice),!Q||!["rock","paper","scissors"].includes(Q)){console.error("Received invalid move from partner:",H.move);return}console.log(`Received move from partner: ${Q}`),f.value=Q,u.value&&y()}}),(A=o.value)==null||A.on("game-start-round",H=>{H.from===e.partnerId&&H.gameType==="rock-paper-scissors"&&(c.value="choosing",u.value=null,f.value=null,d.value=null,g.value=H.round,D())}),(O=o.value)==null||O.on("game-partner-joined",H=>{H.from===e.partnerId&&(c.value="ready")}),(E=o.value)==null||E.on("game-partner-left",H=>{if(H.from===e.partnerId){F(),c.value="waiting";const Q=document.createElement("div");Q.className="fixed top-4 right-4 bg-yellow-600/80 text-white px-4 py-2 rounded-lg shadow-lg z-50",Q.innerHTML=`
        <div class="flex items-center gap-2">
          <span>⚠️</span>
          <span>Your partner has left the game</span>
        </div>
      `,document.body.appendChild(Q),setTimeout(()=>{document.body.removeChild(Q),handleBackToGames()},3e3)}}),(P=o.value)==null||P.on("game-reset",H=>{H.from===e.partnerId&&H.gameType==="rock-paper-scissors"&&(s.value=0,i.value=0,g.value=1,c.value="ready")})}),ft(()=>{var B,A,O,E,P;F(),o.value&&e.partnerId&&(o.value.emit("game-notification",{to:e.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{var H;(H=o.value)==null||H.emit("game-leave-room",{roomId:`rps-${e.partnerId}`,to:e.partnerId})},200)),(B=o.value)==null||B.off("game-move"),(A=o.value)==null||A.off("game-start-round"),(O=o.value)==null||O.off("game-partner-joined"),(E=o.value)==null||E.off("game-partner-left"),(P=o.value)==null||P.off("game-reset")}),(B,A)=>(N(),L(Ae,null,[l("div",sc,[l("div",ic,[A[5]||(A[5]=l("h2",{class:"text-xl font-bold text-purple-400"},[l("span",{class:"hidden sm:inline"},"Rock Paper Scissors"),l("span",{class:"sm:hidden"},"RPS Game")],-1)),l("div",{class:ie(["text-white text-sm px-3 py-1 rounded-full backdrop-blur-sm shadow-lg",{"bg-yellow-600/40 border border-yellow-500/30":c.value==="waiting","bg-green-600/40 border border-green-500/30":c.value==="ready","bg-blue-600/40 border border-blue-500/30":c.value==="choosing","bg-purple-600/40 border border-purple-500/30":c.value==="result"}])},[c.value==="waiting"?(N(),L("span",lc,A[1]||(A[1]=[l("span",{class:"inline-block w-2 h-2 bg-yellow-400 rounded-full mr-2 animate-ping"},null,-1),je(" Waiting... ")]))):c.value==="ready"?(N(),L("span",cc,A[2]||(A[2]=[l("span",{class:"inline-block w-2 h-2 bg-green-400 rounded-full mr-2"},null,-1),je(" Ready! ")]))):c.value==="choosing"?(N(),L("span",uc,A[3]||(A[3]=[l("span",{class:"inline-block w-2 h-2 bg-blue-400 rounded-full mr-2"},null,-1),je(" Choose ")]))):c.value==="result"?(N(),L("span",dc,[A[4]||(A[4]=l("span",{class:"inline-block w-2 h-2 bg-purple-400 rounded-full mr-2"},null,-1)),je(" "+K(x.value),1)])):ne("",!0)],2)]),l("div",fc,[l("div",{class:ie(["flex flex-col items-center",{"opacity-70":c.value==="waiting"}])},[l("div",xc,[l("div",vc,[A[6]||(A[6]=l("div",{class:"text-sm text-gray-300 mb-1"},"You",-1)),l("div",gc,K(s.value),1)]),l("div",mc,[A[7]||(A[7]=l("div",{class:"text-sm text-gray-300"},"Round",-1)),l("div",pc,K(g.value),1)]),l("div",hc,[A[8]||(A[8]=l("div",{class:"text-sm text-gray-300 mb-1"},"Partner",-1)),l("div",bc,K(i.value),1)])]),l("div",yc,[c.value==="result"?(N(),L("div",Cc,[l("div",wc,[l("div",Ec,[l("div",{class:ie(["w-20 h-20 md:w-24 md:h-24 bg-blue-500/20 rounded-full flex items-center justify-center text-4xl md:text-5xl mb-2 shadow-lg border border-blue-400/30 transform transition-all",{"scale-110 ring-2 ring-blue-400 ring-opacity-50":d.value==="win"}])},K(p(u.value)),3),A[9]||(A[9]=l("div",{class:"text-sm text-blue-400"},"You",-1))]),A[11]||(A[11]=l("div",{class:"text-2xl font-bold text-white bg-gray-700/50 rounded-full h-10 w-10 flex items-center justify-center"},"VS",-1)),l("div",_c,[l("div",{class:ie(["w-20 h-20 md:w-24 md:h-24 bg-green-500/20 rounded-full flex items-center justify-center text-4xl md:text-5xl mb-2 shadow-lg border border-green-400/30 transform transition-all",{"scale-110 ring-2 ring-green-400 ring-opacity-50":d.value==="lose"}])},K(p(f.value)),3),A[10]||(A[10]=l("div",{class:"text-sm text-green-400"},"Partner",-1))])]),l("div",{class:ie(["text-xl font-bold mb-4 py-2 px-4 rounded-lg",{"bg-yellow-500/10 text-yellow-400 border border-yellow-500/30":d.value==="tie","bg-green-500/10 text-green-400 border border-green-500/30":d.value==="win","bg-red-500/10 text-red-400 border border-red-500/30":d.value==="lose"}])},K(x.value),3),l("button",{onClick:w,class:"mt-2 px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"}," Play Again ")])):c.value==="choosing"?(N(),L("div",Ac,[l("div",Bc,[A[13]||(A[13]=l("p",{class:"text-lg text-white mb-1"},"Choose your move:",-1)),l("div",kc,[A[12]||(A[12]=je(" Time: ")),l("span",{class:ie(["font-mono text-white",{"text-red-400":b.value<=3}])},K(b.value)+"s",3)])]),l("div",Dc,[(N(),L(Ae,null,Pe(a,O=>l("button",{key:O.value,onClick:E=>h(O.value),class:ie(["w-[90px] h-[90px] md:w-24 md:h-24 rounded-lg flex flex-col items-center justify-center transition-all shadow-lg hover:shadow-xl",{"bg-blue-600/30 border border-blue-500/30 scale-105":u.value===O.value,"bg-gray-800/80 border border-gray-700/50 hover:bg-gray-700/70 hover:scale-105 active:scale-95":u.value!==O.value}])},[l("span",Tc,K(O.emoji),1),l("span",Sc,K(O.name),1)],10,Fc)),64))])])):c.value==="waiting"?(N(),L("div",Rc,A[14]||(A[14]=[dt('<div class="bg-yellow-600/20 rounded-lg p-4 border border-yellow-500/30 shadow-lg animate-pulse" data-v-27a86712><div class="w-16 h-16 mx-auto mb-3 relative" data-v-27a86712><div class="absolute inset-0 bg-yellow-500/20 rounded-full animate-ping" data-v-27a86712></div><div class="absolute inset-2 bg-yellow-500/30 rounded-full animate-ping animation-delay-300" data-v-27a86712></div><div class="absolute inset-4 bg-yellow-500/40 rounded-full animate-ping animation-delay-600" data-v-27a86712></div><div class="absolute inset-0 flex items-center justify-center" data-v-27a86712><span class="text-2xl" data-v-27a86712>👥</span></div></div><p class="text-yellow-300 mb-1 font-medium" data-v-27a86712>Waiting for your partner to join...</p><p class="text-sm text-gray-300" data-v-27a86712>Game will start automatically</p></div>',1)]))):c.value==="ready"?(N(),L("div",$c,[A[15]||(A[15]=dt('<div class="bg-green-600/20 rounded-lg p-4 border border-green-500/30 shadow-lg mb-4" data-v-27a86712><div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center bg-green-500/30 rounded-full" data-v-27a86712><span class="text-2xl" data-v-27a86712>🎮</span></div><p class="text-lg text-white mb-1" data-v-27a86712>Both players are ready!</p><p class="text-sm text-gray-300 mb-4" data-v-27a86712>Prepare for an epic battle</p></div>',1)),l("button",{onClick:m,class:"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"}," Start Game ")])):ne("",!0)])],2)]),l("div",{class:"flex justify-between"},[l("button",{onClick:T,class:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95"}," Back to Games ")])]),C.value?(N(),L("div",Ic,[l("div",Pc,[A[16]||(A[16]=l("h3",{class:"text-lg font-semibold mb-3 text-white"},"Are you sure?",-1)),A[17]||(A[17]=l("p",{class:"text-sm text-gray-300 mb-4"}," Leaving the game will end it for your partner too. ",-1)),l("div",Mc,[l("button",{onClick:A[0]||(A[0]=O=>C.value=!1),class:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"}," Cancel "),l("button",{onClick:j,class:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm"}," Leave ")])])])):ne("",!0)],64))}});const Wc=tt(Oc,[["__scopeId","data-v-27a86712"]]),Nc={class:"w-full p-2",dir:"auto"},Lc={class:"flex justify-between items-center mb-4"},Hc={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 md:p-6 mb-4 border border-gray-700/50 shadow-xl"},Uc={class:"flex justify-center items-center gap-4 md:gap-8 mb-6 w-full"},jc={class:"text-center p-2 bg-blue-900/20 rounded-lg backdrop-blur-sm border border-blue-800/30 min-w-[80px]"},qc={class:"text-2xl font-bold text-blue-400"},zc={key:0,class:"text-center px-4 py-2 bg-gray-700/50 rounded-lg border border-gray-600/30"},Gc={class:"text-center p-2 bg-green-900/20 rounded-lg backdrop-blur-sm border border-green-800/30 min-w-[80px]"},Vc={class:"text-2xl font-bold text-green-400"},Kc={class:"text-center p-2 bg-purple-900/20 rounded-lg backdrop-blur-sm border border-purple-800/30 min-w-[80px]"},Yc={class:"text-2xl font-bold text-purple-400"},Xc={class:"w-full mb-4"},Qc={key:0,class:"animate__animated animate__fadeIn"},Zc={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},Jc={class:"mb-4"},eu=["dir","disabled"],tu={key:0,class:"text-xs text-red-400 mt-1"},nu={key:1,class:"text-xs text-gray-400 mt-1"},ru={class:"mb-4"},ou={class:"flex gap-2"},au={class:"text-center"},su=["disabled"],iu={key:1,class:"animate__animated animate__fadeIn"},lu={key:2,class:"animate__animated animate__fadeIn"},cu={class:"mb-6"},uu={class:"bg-gray-700/50 rounded-lg p-4 shadow-inner mb-4"},du={class:"flex justify-between items-center mb-2"},fu={class:"text-xs text-gray-400"},xu=["dir"],vu={class:"mb-4"},gu={class:"flex gap-2"},mu=["dir","maxlength"],pu=["disabled"],hu={key:0,class:"text-xs text-red-400 mt-1"},bu={key:1,class:"text-xs text-gray-400 mt-1"},yu={class:"bg-gray-700/30 rounded-lg p-3 max-h-28 overflow-y-auto"},Cu={key:0,class:"text-gray-400 italic text-sm"},wu={class:"text-gray-400 w-5"},Eu=["dir"],_u={key:3,class:"animate__animated animate__fadeIn"},Au={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},Bu={class:"flex justify-between items-center mb-2"},ku=["dir"],Du=["dir"],Fu={class:"mt-4 text-sm text-gray-300"},Tu={key:0},Su={class:"mt-2"},Ru={class:"bg-gray-700/30 rounded-lg p-3 max-h-36 overflow-y-auto"},$u={key:0,class:"text-gray-400 italic text-sm"},Iu={class:"text-gray-400 w-5"},Pu=["dir"],Mu={key:4,class:"animate__animated animate__fadeIn"},Ou={class:"text-center mb-6"},Wu={class:"w-20 h-20 mx-auto mb-4 flex items-center justify-center bg-purple-500/30 rounded-full"},Nu={class:"text-3xl"},Lu={class:"text-2xl font-bold text-white mb-2"},Hu={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},Uu={class:"text-2xl font-bold text-purple-400 mb-2",dir:"rtl"},ju={key:0,class:"text-green-400 mt-4"},qu={key:1,class:"text-yellow-400 mt-4"},zu={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},Gu={class:"flex justify-between items-center"},Vu={class:"text-xl font-bold text-green-400"},Ku={class:"text-xl font-bold text-blue-400"},Yu={key:5,class:"text-center"},Xu={key:0,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},Qu={class:"bg-gray-800 p-4 rounded-lg max-w-xs w-full text-center"},Zu={class:"text-lg font-semibold mb-3 text-white"},Ju={class:"text-sm text-gray-300 mb-4"},ed={class:"flex justify-center gap-3"},td=He({__name:"WordGalaxy",props:{partnerId:{type:String,required:!0},partnerReady:{type:Boolean,default:!1}},emits:["back","error"],setup(t,{emit:n}){const e=t,r=n,{socket:o,userId:a}=Ie(),c=W(""),u=W(""),f=W(!1),s=W("waiting"),i=W(!1),g=W(""),d=W(0),b=W([]),v=W([]),C=W(0),x=W("medium"),p=W(""),m=W([]),h=W(0),y=W(!1),w=W(0),D=W("Watching you set up the game..."),F=W(0),T=W(0),j=W(1),B=W([]),A=W(0),O=W(null),E=W(!1),P={easy:{attempts:10,time:60,multiplier:1},medium:{attempts:8,time:45,multiplier:1.5},hard:{attempts:6,time:30,multiplier:2}};W(ge.isSoundMuted());const H=ee=>/[\u0600-\u06FF]/.test(ee),Q=ee=>/^[a-zA-Z\u0600-\u06FF]+$/.test(ee),k=_e(()=>g.value&&H(g.value)?"rtl":"ltr"),S=()=>{if(c.value="",g.value.length>0&&g.value.length<3){c.value="The word must be at least 3 letters";return}g.value.length>0&&!Q(g.value)&&(g.value=g.value.replace(/[^a-zA-Z\u0600-\u06FF]/g,""),c.value="Only Arabic or English letters are allowed")},_=()=>{if(u.value="",p.value.length>0&&p.value.length!==d.value){u.value=`The word must be ${d.value} letters long`;return}p.value.length>0&&!Q(p.value)&&(p.value=p.value.replace(/[^a-zA-Z\u0600-\u06FF]/g,""),u.value="Only Arabic or English letters are allowed")},X=_e(()=>P[x.value].attempts),$=_e(()=>P[x.value].time),U=_e(()=>X.value-h.value),V=_e(()=>g.value.length>=3&&g.value.length<=15&&Q(g.value)&&!c.value),G=()=>{var ee;V.value&&(g.value=g.value.trim(),ge.playSound("gameStart"),(ee=o.value)==null||ee.emit("game-word-setup",{gameType:"word-galaxy",to:e.partnerId,wordLength:g.value.length,difficulty:x.value}),s.value="guessing",d.value=g.value.length,ve())},ve=()=>{b.value=Array(d.value).fill("_"),v.value=[],C.value=0},me=()=>{O.value&&clearInterval(O.value),A.value=$.value,E.value=!0,O.value=window.setInterval(()=>{var ee;A.value--,A.value<=0&&(Ce(),i.value||(s.value="complete",y.value=!1,(ee=o.value)==null||ee.emit("game-move",{gameType:"word-galaxy",move:"timeout",to:e.partnerId})))},1e3)},Ce=()=>{O.value&&(clearInterval(O.value),O.value=null)},ae=()=>{var Y,te;if(!p.value||p.value.length!==d.value)return;if(!Q(p.value)){p.value=p.value.replace(/[^a-zA-Z\u0600-\u06FF]/g,""),u.value="Only Arabic or English letters are allowed";return}const ee=p.value.trim();u.value="",ge.playSound("move"),(Y=o.value)==null||Y.emit("game-move",{gameType:"word-galaxy",move:ee,to:e.partnerId}),p.value="",h.value++,h.value>=X.value&&(s.value="complete",y.value=!1,Ce(),ge.playSound("lose"),(te=o.value)==null||te.emit("game-move",{gameType:"word-galaxy",move:"out-of-attempts",to:e.partnerId}))},ct=ee=>{var he;const Y=g.value,te=ee;let ue=0;const pe=[...v.value];if(H(Y))for(let fe=0;fe<Y.length;fe++)te[fe]===Y[fe]&&(ue++,pe.includes(fe)||pe.push(fe));else for(let fe=0;fe<Y.length;fe++)te[fe]===Y[fe]&&(ue++,pe.includes(fe)||pe.push(fe));if(v.value=pe,C.value=pe.length,m.value.push({word:te,matches:ue}),D.value=`Made guess: "${te}" (${ue} matches)`,ue<Y.length){const fe=10*P[x.value].multiplier;T.value+=Math.round(fe),ue>0?ge.playSound("correct"):ge.playSound("incorrect")}else ge.playSound("win");(he=o.value)==null||he.emit("game-guess-result",{gameType:"word-galaxy",to:e.partnerId,result:{word:Y,originalGuess:te,matches:ue,revealedPositions:pe,isCorrect:ue===Y.length,creatorEarnedPoints:ue<Y.length?Math.round(10*P[x.value].multiplier):0}}),ue===Y.length&&(b.value=Y.split(""),C.value=d.value,s.value="complete",y.value=!1,g.value=Y,Ce(),rt())},nt=ee=>{m.value.push({word:ee.originalGuess||p.value,matches:ee.matches}),ee.creatorEarnedPoints&&(T.value+=ee.creatorEarnedPoints);for(let Y=0;Y<d.value;Y++)ee.revealedPositions.includes(Y)&&(b.value[Y]=ee.word[Y]);C.value=ee.revealedPositions.length,ee.isCorrect?(b.value=ee.word.split(""),C.value=d.value,s.value="complete",y.value=!0,g.value=ee.word,Ce(),ge.playSound("win"),rt()):ee.matches>0?ge.playSound("correct"):ge.playSound("incorrect")},rt=()=>{var ee,Y;if(y.value){if(!i.value){const ue=P[x.value].multiplier,pe=(X.value-h.value)*5,ye=Math.round(A.value/3),he=Math.round((50+pe+ye)*ue);F.value+=he,(ee=o.value)==null||ee.emit("game-score-update",{gameType:"word-galaxy",to:e.partnerId,guesserScore:F.value,creatorScore:T.value})}}else if(i.value){const ue=P[x.value].multiplier,pe=Math.round(30*ue);T.value+=pe,(Y=o.value)==null||Y.emit("game-score-update",{gameType:"word-galaxy",to:e.partnerId,guesserScore:F.value,creatorScore:T.value})}B.value.push({creator:i.value&&!y.value?Math.round(30*P[x.value].multiplier):0,guesser:!i.value&&y.value?Math.round((50+(X.value-h.value)*5+Math.round(A.value/3))*P[x.value].multiplier):0})},ot=ee=>ee===0?"bg-red-500/30 text-red-300":ee===d.value?"bg-green-500/30 text-green-300":ee>=d.value/2?"bg-yellow-500/30 text-yellow-300":"bg-blue-500/30 text-blue-300",Te=()=>{var Y;s.value="setup",g.value="",b.value=[],v.value=[],C.value=0,p.value="",m.value=[],h.value=0,y.value=!1,w.value=0,E.value=!1,j.value++;const ee=i.value;i.value=!ee,console.log(`Play Again clicked: Round ${j.value}, Swapping roles - I was ${ee?"creator":"guesser"}, now I am ${i.value?"creator":"guesser"}`),(Y=o.value)==null||Y.emit("game-reset",{gameType:"word-galaxy",to:e.partnerId,swapRoles:!1,shouldBeCreator:!i.value,roundCount:j.value,guesserScore:F.value,creatorScore:T.value})},Se=()=>{f.value=!0,ge.playSound("button")},mt=()=>{var ee;f.value=!1,(ee=o.value)==null||ee.emit("game-leave",{gameType:"word-galaxy",to:e.partnerId}),r("back")};return ze(()=>{var ee,Y,te,ue,pe,ye,he,fe;if(e.partnerReady){if(s.value="setup",j.value===1){const J=a.value||"",we=e.partnerId||"";i.value=J<we,console.log(`Role assignment: My ID ${J}, Partner ID ${we}, I am ${i.value?"word creator":"guesser"}`)}ge.playSound("gameStart")}(ee=o.value)==null||ee.on("game-word-setup",J=>{J.from===e.partnerId&&J.gameType==="word-galaxy"&&(d.value=J.wordLength,x.value=J.difficulty,s.value="guessing",i.value=!1,ve(),me())}),(Y=o.value)==null||Y.on("game-score-update",J=>{J.from===e.partnerId&&J.gameType==="word-galaxy"&&(J.guesserScore!==void 0&&(F.value=J.guesserScore),J.creatorScore!==void 0&&(T.value=J.creatorScore))}),(te=o.value)==null||te.on("game-move",J=>{if(J.from===e.partnerId&&J.gameType==="word-galaxy"){const we=J.move;typeof we=="string"&&(we==="timeout"?(s.value="complete",y.value=!0,D.value="Ran out of time!",rt()):we==="out-of-attempts"?(s.value="complete",y.value=!0,D.value="Ran out of attempts!",rt()):ct(we))}}),(ue=o.value)==null||ue.on("game-guess-result",J=>{J.from===e.partnerId&&J.gameType==="word-galaxy"&&nt(J.result)}),(pe=o.value)==null||pe.on("game-partner-joined",J=>{if(J.from===e.partnerId&&(s.value="setup",j.value===1)){const we=a.value||"",Xe=e.partnerId||"";i.value=we<Xe,console.log(`Partner joined: My ID ${we}, Partner ID ${Xe}, I am ${i.value?"word creator":"guesser"}`)}}),(ye=o.value)==null||ye.on("game-partner-left",()=>{s.value="waiting",Ce(),ge.playSound("notification");const J=document.createElement("div");J.className="fixed top-4 right-4 bg-yellow-600/80 text-white px-4 py-2 rounded-lg shadow-lg z-50",J.innerHTML=`
      <div class="flex items-center gap-2">
        <span>⚠️</span>
        <span>Your partner has left the game</span>
      </div>
    `,document.body.appendChild(J),setTimeout(()=>{document.body.removeChild(J),r("back")},3e3)}),(he=o.value)==null||he.on("game-reset",J=>{if(J.from===e.partnerId&&J.gameType==="word-galaxy"&&(console.log("Received game-reset from partner with data:",JSON.stringify({roundCount:J.roundCount,shouldBeCreator:J.shouldBeCreator})),s.value="setup",g.value="",b.value=[],v.value=[],C.value=0,p.value="",m.value=[],h.value=0,y.value=!1,w.value=0,Ce(),E.value=!1,J.roundCount&&(j.value=J.roundCount),J.guesserScore!==void 0&&(F.value=J.guesserScore),J.creatorScore!==void 0&&(T.value=J.creatorScore),J.shouldBeCreator!==void 0)){const we=i.value;i.value=J.shouldBeCreator,console.log(`Reset from partner: Round ${j.value}, Changing role from ${we?"creator":"guesser"} to ${i.value?"creator":"guesser"}`)}}),(fe=o.value)==null||fe.on("game-notification",J=>{J.from===e.partnerId&&J.gameType==="word-galaxy"&&console.log(`Game notification from partner: ${J.message}`)})}),ft(()=>{var ee,Y,te,ue,pe,ye,he,fe;Ce(),ge.stopAllSounds(),(ee=o.value)==null||ee.off("game-word-setup"),(Y=o.value)==null||Y.off("game-move"),(te=o.value)==null||te.off("game-guess-result"),(ue=o.value)==null||ue.off("game-score-update"),(pe=o.value)==null||pe.off("game-partner-joined"),(ye=o.value)==null||ye.off("game-partner-left"),(he=o.value)==null||he.off("game-reset"),(fe=o.value)==null||fe.off("game-notification")}),_e(()=>s.value!=="complete"?null:i.value?y.value?"failed":"guessed":y.value?"guessed":"failed"),(ee,Y)=>(N(),L(Ae,null,[l("div",Nc,[l("div",Lc,[Y[6]||(Y[6]=l("h2",{class:"text-xl font-bold text-purple-400"},[l("span",{class:"hidden sm:inline"},"Word Galaxy"),l("span",{class:"sm:hidden"},"Word Game")],-1)),l("div",{class:ie(["text-white text-sm px-3 py-1 rounded-full backdrop-blur-sm shadow-lg",{"bg-yellow-600/40 border border-yellow-500/30":s.value==="waiting","bg-green-600/40 border border-green-500/30":s.value==="setup","bg-blue-600/40 border border-blue-500/30":s.value==="guessing","bg-purple-600/40 border border-purple-500/30":s.value==="complete"}])},K(ee.gameStateLabel),3)]),l("div",Hc,[l("div",{class:ie(["flex flex-col items-center",{"opacity-70":s.value==="waiting"}])},[l("div",Uc,[l("div",jc,[Y[7]||(Y[7]=l("div",{class:"text-sm text-gray-300 mb-1"},"Attempts",-1)),l("div",qc,K(h.value)+"/"+K(X.value),1)]),s.value==="guessing"&&!i.value?(N(),L("div",zc,[Y[8]||(Y[8]=l("div",{class:"text-sm text-gray-300"},"Time",-1)),l("div",{class:ie(["text-xl font-bold",{"text-red-400":A.value<10,"text-yellow-400":A.value<20,"text-white":A.value>=20}])},K(A.value)+"s",3)])):ne("",!0),l("div",Gc,[Y[9]||(Y[9]=l("div",{class:"text-sm text-gray-300 mb-1"},"Score",-1)),l("div",Vc,K(i.value?T.value:F.value),1)]),l("div",Kc,[Y[10]||(Y[10]=l("div",{class:"text-sm text-gray-300 mb-1"},"Round",-1)),l("div",Yc,K(j.value),1)])]),l("div",Xc,[s.value==="setup"&&i.value?(N(),L("div",Qc,[Y[13]||(Y[13]=dt('<div class="text-center mb-6" data-v-f9483a22><div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center bg-green-500/30 rounded-full" data-v-f9483a22><span class="text-2xl" data-v-f9483a22>💬</span></div><h3 class="text-xl font-bold text-white mb-2" data-v-f9483a22>Create a Word</h3><p class="text-gray-300 mb-4" data-v-f9483a22>Enter a word for your partner to guess</p></div>',1)),l("div",Zc,[l("div",Jc,[Y[11]||(Y[11]=l("label",{class:"block text-gray-300 text-sm mb-2"},"Your Word:",-1)),Rt(l("input",{"onUpdate:modelValue":Y[0]||(Y[0]=te=>g.value=te),dir:H(g.value)?"rtl":"ltr",class:"w-full bg-gray-900 text-white px-4 py-2 rounded border border-gray-600 focus:border-purple-500 focus:outline-none",placeholder:"Enter a word...",maxlength:"15",disabled:s.value!=="setup",onInput:S},null,40,eu),[[Vt,g.value]]),c.value?(N(),L("p",tu,K(c.value),1)):(N(),L("p",nu,"The word should be 3-15 letters long"))]),l("div",ru,[Y[12]||(Y[12]=l("label",{class:"block text-gray-300 text-sm mb-2"},"Difficulty:",-1)),l("div",ou,[l("button",{onClick:Y[1]||(Y[1]=te=>x.value="easy"),class:ie(["flex-1 px-4 py-2 rounded-lg text-sm transition-all",x.value==="easy"?"bg-green-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"])}," Easy ",2),l("button",{onClick:Y[2]||(Y[2]=te=>x.value="medium"),class:ie(["flex-1 px-4 py-2 rounded-lg text-sm transition-all",x.value==="medium"?"bg-yellow-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"])}," Medium ",2),l("button",{onClick:Y[3]||(Y[3]=te=>x.value="hard"),class:ie(["flex-1 px-4 py-2 rounded-lg text-sm transition-all",x.value==="hard"?"bg-red-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"])}," Hard ",2)])])]),l("div",au,[l("button",{onClick:G,class:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:pointer-events-none",disabled:!V.value}," Start Game ",8,su)])])):s.value==="setup"&&!i.value?(N(),L("div",iu,Y[14]||(Y[14]=[dt('<div class="text-center mb-6" data-v-f9483a22><div class="w-16 h-16 mx-auto mb-3 relative" data-v-f9483a22><div class="absolute inset-0 bg-blue-500/20 rounded-full animate-ping" data-v-f9483a22></div><div class="absolute inset-2 bg-blue-500/30 rounded-full animate-ping animation-delay-300" data-v-f9483a22></div><div class="absolute inset-0 flex items-center justify-center" data-v-f9483a22><span class="text-2xl" data-v-f9483a22>🔤</span></div></div><h3 class="text-xl font-bold text-white mb-2" data-v-f9483a22>Get Ready!</h3><p class="text-gray-300" data-v-f9483a22>Your partner is creating a word for you to guess...</p></div><div class="bg-gray-700/50 rounded-lg p-4 mb-4" data-v-f9483a22><h4 class="font-bold text-white mb-2" data-v-f9483a22>How to Play:</h4><ul class="text-gray-300 text-sm space-y-2 list-disc pl-4" data-v-f9483a22><li data-v-f9483a22>Your partner will create a secret word</li><li data-v-f9483a22>You&#39;ll see a blurred version of the word</li><li data-v-f9483a22>Type guesses to reveal more letters</li><li data-v-f9483a22>You need to guess the word before the timer runs out</li><li data-v-f9483a22>You win if you guess correctly, your partner wins if you don&#39;t</li></ul></div>',2)]))):s.value==="guessing"&&!i.value?(N(),L("div",lu,[l("div",cu,[l("div",uu,[l("div",du,[Y[15]||(Y[15]=l("span",{class:"text-sm text-gray-400"},"The Secret Word:",-1)),l("span",fu,K(C.value)+"/"+K(d.value)+" letters revealed",1)]),l("div",{class:"flex justify-center gap-1 md:gap-2 flex-wrap",dir:k.value},[(N(!0),L(Ae,null,Pe(b.value,(te,ue)=>(N(),L("div",{key:ue,class:ie(["w-8 h-10 md:w-10 md:h-12 flex items-center justify-center rounded bg-gray-800/80 border text-lg md:text-xl font-bold",te==="_"?"border-gray-700 text-gray-500":"border-purple-500 text-white"])},K(te),3))),128))],8,xu)]),l("div",vu,[Y[16]||(Y[16]=l("label",{class:"block text-gray-300 text-sm mb-2"},"Your Guess:",-1)),l("div",gu,[Rt(l("input",{"onUpdate:modelValue":Y[4]||(Y[4]=te=>p.value=te),dir:H(p.value)||H(g.value.value)?"rtl":"ltr",class:"flex-1 bg-gray-900 text-white px-4 py-2 rounded-l border border-gray-600 focus:border-purple-500 focus:outline-none",placeholder:"Type your guess...",maxlength:d.value,onKeyup:Ya(ae,["enter"]),onInput:_},null,40,mu),[[Vt,p.value]]),l("button",{onClick:ae,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-r transition-all",disabled:!p.value||p.value.length!==d.value}," Submit ",8,pu)]),u.value?(N(),L("p",hu,K(u.value),1)):(N(),L("p",bu,K(U.value)+" attempts remaining ",1))]),l("div",yu,[m.value.length===0?(N(),L("p",Cu,"Your previous guesses will appear here...")):ne("",!0),(N(!0),L(Ae,null,Pe(m.value,(te,ue)=>(N(),L("div",{key:ue,class:"text-sm flex items-center mb-1"},[l("span",wu,K(ue+1)+".",1),l("span",{dir:H(te.word)||H(g.value.value)?"rtl":"ltr",class:"text-gray-300 mr-2"},K(te.word),9,Eu),l("span",{class:ie(["text-xs px-1.5 py-0.5 rounded",ot(te.matches)])},K(te.matches)+" matching ",3)]))),128))])])])):s.value==="guessing"&&i.value?(N(),L("div",_u,[l("div",Au,[l("div",Bu,[Y[17]||(Y[17]=l("span",{class:"text-gray-300"},"Your Secret Word:",-1)),l("span",{class:"text-white font-bold",dir:H(g.value)?"rtl":"ltr"},K(g.value),9,ku)]),l("div",{class:"flex justify-center gap-1 md:gap-2 flex-wrap",dir:k.value},[(N(!0),L(Ae,null,Pe(g.value,(te,ue)=>(N(),L("div",{key:ue,class:ie(["w-8 h-10 md:w-10 md:h-12 flex items-center justify-center rounded border border-purple-500 text-lg md:text-xl font-bold",v.value.includes(ue)?"bg-purple-600/30 text-white":"bg-gray-800 text-gray-500"])},K(te),3))),128))],8,Du),l("div",Fu,[E.value?(N(),L("p",Tu,[Y[18]||(Y[18]=l("span",{class:"text-yellow-400 font-bold"},"Time remaining:",-1)),je(" "+K(A.value)+"s ",1)])):ne("",!0),l("p",Su,[Y[19]||(Y[19]=l("span",{class:"text-purple-400 font-bold"},"Status:",-1)),je(" "+K(D.value),1)])])]),l("div",Ru,[m.value.length===0?(N(),L("p",$u,"Partner's guesses will appear here...")):ne("",!0),(N(!0),L(Ae,null,Pe(m.value,(te,ue)=>(N(),L("div",{key:ue,class:"text-sm flex items-center mb-1"},[l("span",Iu,K(ue+1)+".",1),l("span",{dir:H(te.word)||H(g.value)?"rtl":"ltr",class:"text-gray-300 mr-2"},K(te.word),9,Pu),l("span",{class:ie(["text-xs px-1.5 py-0.5 rounded",ot(te.matches)])},K(te.matches)+" matching ",3)]))),128))])])):s.value==="complete"?(N(),L("div",Mu,[l("div",Ou,[l("div",Wu,[l("span",Nu,K(y.value?"🎉":"🔍"),1)]),l("h3",Lu,K(y.value?"You Won!":"You Lost!"),1),l("div",Hu,[Y[20]||(Y[20]=l("p",{class:"text-gray-300 mb-2"},"The secret word was:",-1)),l("div",Uu,K(g.value),1),y.value?(N(),L("p",ju,K(i.value?"Your partner couldn't solve it!":"Solved in "+h.value+" attempts!"),1)):(N(),L("p",qu,K(i.value?"Your partner solved it!":"Better luck next time!"),1))]),l("div",zu,[Y[23]||(Y[23]=l("h4",{class:"text-lg font-bold text-white mb-2"},"Scores",-1)),l("div",Gu,[l("div",null,[Y[21]||(Y[21]=l("p",{class:"text-gray-300"},"You:",-1)),l("p",Vu,K(i.value?T.value:F.value),1)]),l("div",null,[Y[22]||(Y[22]=l("p",{class:"text-gray-300"},"Partner:",-1)),l("p",Ku,K(i.value?F.value:T.value),1)])]),Y[24]||(Y[24]=l("p",{class:"text-xs text-gray-400 mt-2"},"Points are saved until you exit the game",-1))]),l("button",{onClick:Te,class:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"}," Play Again ")])])):s.value==="waiting"?(N(),L("div",Yu,Y[25]||(Y[25]=[dt('<div class="bg-yellow-600/20 rounded-lg p-4 border border-yellow-500/30 shadow-lg animate-pulse" data-v-f9483a22><div class="w-16 h-16 mx-auto mb-3 relative" data-v-f9483a22><div class="absolute inset-0 bg-yellow-500/20 rounded-full animate-ping" data-v-f9483a22></div><div class="absolute inset-2 bg-yellow-500/30 rounded-full animate-ping animation-delay-300" data-v-f9483a22></div><div class="absolute inset-4 bg-yellow-500/40 rounded-full animate-ping animation-delay-600" data-v-f9483a22></div><div class="absolute inset-0 flex items-center justify-center" data-v-f9483a22><span class="text-2xl" data-v-f9483a22>👥</span></div></div><p class="text-yellow-300 mb-1 font-medium" data-v-f9483a22>Waiting for your partner to join...</p><p class="text-sm text-gray-300" data-v-f9483a22>Game will start automatically</p></div>',1)]))):ne("",!0)])],2)]),l("div",{class:"flex justify-between"},[l("button",{onClick:Se,class:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95"}," Back to Games ")])]),f.value?(N(),L("div",Xu,[l("div",Qu,[l("h3",Zu,K(H(g.value)?"هل أنت متأكد؟":"Are you sure?"),1),l("p",Ju,K(H(g.value)?"مغادرة اللعبة ستنهيها لشريكك أيضًا.":"Leaving the game will end it for your partner too."),1),l("div",ed,[l("button",{onClick:Y[5]||(Y[5]=te=>f.value=!1),class:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},K(H(g.value)?"إلغاء":"Cancel"),1),l("button",{onClick:mt,class:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm"},K(H(g.value)?"مغادرة":"Leave"),1)])])])):ne("",!0)],64))}});const nd=tt(td,[["__scopeId","data-v-f9483a22"]]),rd={key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-2 sm:p-4"},od={class:"bg-[#1e1e2e] rounded-lg w-full max-w-md mx-auto shadow-2xl relative overflow-hidden"},ad={class:"flex items-center justify-between p-2 sm:p-3 border-b border-gray-800"},sd={key:1,class:"p-3 sm:p-4"},id={class:"grid grid-cols-2 gap-2 sm:gap-4 mb-3 sm:mb-4"},ld=["disabled"],cd=["disabled"],ud=["disabled"],dd={key:2,class:"text-center p-4 sm:p-6"},fd={class:"mb-4"},xd={class:"text-sm sm:text-base text-gray-300"},vd={key:3},gd=He({__name:"games-modal",props:{isOpen:{type:Boolean,default:!1},partnerId:{type:String,required:!0},isConnected:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:n}){const{socket:e,userId:r}=Ie(),o=t,a=W(null),c=W(null),u=W(!0),f=W(null),s=W(!1),i=W(""),g=x=>{console.log(`[Game Debug] ${x}`),i.value=x},d=x=>{var m;if(!o.isConnected)return;g(`Starting game: ${x} with partner: ${o.partnerId}`),c.value=null,a.value=x,u.value=!0,s.value=!1;const p=[r.value,o.partnerId].sort();if(f.value=`${x}-${p[0]}-${p[1]}`,g(`Created game room: ${f.value}`),(m=e.value)==null||m.emit("game-join-room",{gameType:x,roomId:f.value,to:o.partnerId,isFirstPlayer:!0}),e.value&&o.partnerId){const h=`invite-${Date.now()}-${Math.floor(Math.random()*1e4)}`;e.value.emit("game-invite",{gameType:x,to:o.partnerId,inviteId:h}),console.log(`Sent game invitation for ${x} to ${o.partnerId}`),C("Invitation sent! Waiting for response...","info")}},b=()=>{var x;o.partnerId?((x=e.value)==null||x.emit("game-leave-notification",{gameType:a.value||"unknown",to:o.partnerId,message:"Your partner returned to the game menu"}),e.value&&e.value.emit("game-notification",{gameType:a.value||"unknown",to:o.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{f.value&&e.value&&e.value.emit("game-leave-room",{roomId:f.value,to:o.partnerId}),a.value=null,c.value=null,u.value=!0,f.value=null,s.value=!1},100)):(a.value=null,c.value=null,u.value=!0,f.value=null,s.value=!1)},v=x=>{c.value=x,g(`Error: ${x}`)};ze(()=>{var x,p,m,h,y;g("Setting up game events"),document.addEventListener("select-game",w=>{const{gameType:D,partnerId:F}=w.detail;if(D&&F&&F===o.partnerId){g(`Received direct game selection: ${D}`),a.value=D,c.value=null,u.value=!1,s.value=!0;const T=[r.value,o.partnerId].sort();f.value=`${D}-${T[0]}-${T[1]}`,g(`Created game room: ${f.value}`)}}),(x=e.value)==null||x.on("game-room-invite",w=>{var D;w.from===o.partnerId&&(g(`Received invitation to join game room: ${w.roomId}`),f.value=w.roomId,a.value=w.gameType,u.value=!1,(D=e.value)==null||D.emit("game-join-room",{gameType:w.gameType,roomId:w.roomId,to:o.partnerId,isFirstPlayer:!1}))}),(p=e.value)==null||p.on("game-partner-joined",w=>{w.from===o.partnerId&&(g(`Partner joined the game: ${w.gameType}`),s.value=!0)}),(m=e.value)==null||m.on("game-error",w=>{(w.from==="system"||w.from===o.partnerId)&&(c.value=w.message||"An error occurred in the game.",g(`Game error: ${w.message}`))}),(h=e.value)==null||h.on("game-partner-left",w=>{a.value&&(g("Partner left the game - closing silently"),a.value=null,f.value=null,s.value=!1,c.value=null)}),(y=e.value)==null||y.on("game-notification",w=>{w.from===o.partnerId&&g(`Notification from partner: ${w.message}`)})}),ft(()=>{var x,p,m,h,y,w;(x=e.value)==null||x.off("game-room-invite"),(p=e.value)==null||p.off("game-partner-joined"),(m=e.value)==null||m.off("game-error"),(h=e.value)==null||h.off("game-partner-left"),(y=e.value)==null||y.off("game-notification"),f.value&&((w=e.value)==null||w.emit("game-leave-room",{roomId:f.value,to:o.partnerId})),document.removeEventListener("select-game",()=>{})}),De(()=>o.isOpen,x=>{x||b()});const C=(x,p="info")=>{const m=document.createElement("div");let h="bg-blue-600";p==="success"&&(h="bg-emerald-600"),p==="error"&&(h="bg-red-600"),m.className=`fixed bottom-4 right-4 ${h} text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in`,m.style.animationDuration="0.3s",m.innerHTML=x,document.body.appendChild(m),setTimeout(()=>{m.style.opacity="0",m.style.transition="opacity 0.3s ease",setTimeout(()=>{document.body.removeChild(m)},300)},3e3)};return(x,p)=>t.isOpen?(N(),L("div",rd,[l("div",od,[l("div",ad,[p[4]||(p[4]=l("div",{class:"flex items-center gap-2"},[l("span",{class:"text-purple-400 text-lg sm:text-xl"},"🎮"),l("h2",{class:"text-lg sm:text-xl font-semibold text-[#a881fc]"},"Space Games")],-1)),l("button",{onClick:p[0]||(p[0]=m=>x.$emit("close")),class:"text-gray-400 hover:text-white text-lg"}," ✕ ")]),ne("",!0),a.value?c.value?(N(),L("div",dd,[l("div",fd,[p[10]||(p[10]=l("div",{class:"w-12 h-12 sm:w-16 sm:h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-2"},[l("span",{class:"text-xl sm:text-2xl"},"⚠️")],-1)),p[11]||(p[11]=l("h3",{class:"text-lg sm:text-xl font-bold mb-2 text-red-400"},"Game Error",-1)),l("p",xd,K(c.value),1)]),l("button",{onClick:b,class:"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors mt-2"}," Back to Games ")])):(N(),L("div",vd,[a.value==="tic-tac-toe"?(N(),cn(ac,{key:0,partnerId:t.partnerId,isFirstPlayer:u.value,partnerReady:s.value,onBack:b,onError:v},null,8,["partnerId","isFirstPlayer","partnerReady"])):ne("",!0),a.value==="rock-paper-scissors"?(N(),cn(Wc,{key:1,partnerId:t.partnerId,partnerReady:s.value,onBack:b,onError:v},null,8,["partnerId","partnerReady"])):ne("",!0),a.value==="word-galaxy"?(N(),cn(nd,{key:2,partnerId:t.partnerId,partnerReady:s.value,onBack:b,onError:v},null,8,["partnerId","partnerReady"])):ne("",!0)])):(N(),L("div",sd,[l("div",id,[l("button",{class:ie(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!t.isConnected}]),disabled:!t.isConnected,onClick:p[1]||(p[1]=m=>d("rock-paper-scissors"))},p[5]||(p[5]=[l("div",{class:"bg-yellow-500 text-white w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl"},"👊",-1),l("div",{class:"text-white text-xs sm:text-sm font-medium"},"Rock Paper Scissors",-1),l("div",{class:"text-xs text-gray-400 hidden sm:block"},"vs Partner",-1)]),10,ld),l("button",{class:ie(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!t.isConnected}]),disabled:!t.isConnected,onClick:p[2]||(p[2]=m=>d("word-galaxy"))},p[6]||(p[6]=[l("div",{class:"bg-white text-gray-800 w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl"},"💬",-1),l("div",{class:"text-white text-xs sm:text-sm font-medium"},"Word Galaxy",-1),l("div",{class:"text-xs text-gray-400 hidden sm:block"},"Word Guessing Game",-1)]),10,cd),l("button",{class:ie(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!t.isConnected}]),disabled:!t.isConnected,onClick:p[3]||(p[3]=m=>d("tic-tac-toe"))},p[7]||(p[7]=[l("div",{class:"bg-red-600 text-white w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl"},"⭕",-1),l("div",{class:"text-white text-xs sm:text-sm font-medium"},"Tic-Tac-Toe",-1),l("div",{class:"text-xs text-gray-400 hidden sm:block"},"vs Partner",-1)]),10,ud),l("button",{class:ie(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center relative",{"opacity-50 cursor-not-allowed":!0}]),disabled:""},p[8]||(p[8]=[dt('<div class="absolute inset-0 flex items-center justify-center bg-[#2e2e42]/80 rounded-lg" data-v-d5876d55><span class="bg-purple-500 text-white text-xs px-2 py-1 rounded-md font-medium" data-v-d5876d55>Coming Soon</span></div><div class="bg-purple-600 text-white w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl" data-v-d5876d55>🎲</div><div class="text-white text-xs sm:text-sm font-medium" data-v-d5876d55>Mystery Game</div><div class="text-xs text-gray-400 hidden sm:block" data-v-d5876d55>More Fun Ahead</div>',4)]))]),p[9]||(p[9]=l("p",{class:"text-center text-xs sm:text-sm text-gray-400 mt-2"}," Connect to play with others ",-1))]))])])):ne("",!0)}});const md=tt(gd,[["__scopeId","data-v-d5876d55"]]),pd={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},hd={class:"bg-gray-900 rounded-lg w-full max-w-md mx-auto p-6"},bd={class:"flex items-center justify-between mb-6"},yd={class:"grid grid-cols-3 gap-4 mb-6"},Cd=He({__name:"donation-modal",props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:n}){const e=n,r=W(15),o=c=>{r.value=c},a=()=>{window.open(`https://www.paypal.com/paypalme/spacetalk/${r.value}`,"_blank"),e("close")};return(c,u)=>t.isOpen?(N(),L("div",pd,[l("div",hd,[l("div",bd,[u[4]||(u[4]=l("div",{class:"flex items-center gap-2"},[l("span",{class:"text-red-400 text-xl"},"❤️"),l("h2",{class:"text-lg font-semibold text-violet-400"},"Support SpaceTalk")],-1)),l("button",{onClick:u[0]||(u[0]=f=>c.$emit("close")),class:"text-gray-400 hover:text-white text-lg"}," ✕ ")]),u[8]||(u[8]=l("div",{class:"mb-6 text-center"},[l("p",{class:"text-gray-300"},"Keep SpaceTalk free for everyone")],-1)),l("div",yd,[l("button",{class:ie(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",r.value===5?"ring-2 ring-emerald-500 scale-105":""]),onClick:u[1]||(u[1]=f=>o(5))},u[5]||(u[5]=[l("div",{class:"text-lg font-bold text-white"},"$5",-1),l("div",{class:"text-sm text-gray-400"},"Coffee",-1)]),2),l("button",{class:ie(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",r.value===15?"ring-2 ring-emerald-500 scale-105":""]),onClick:u[2]||(u[2]=f=>o(15))},u[6]||(u[6]=[l("div",{class:"text-lg font-bold text-white"},"$15",-1),l("div",{class:"text-sm text-gray-400"},"Fuel",-1)]),2),l("button",{class:ie(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",r.value===50?"ring-2 ring-emerald-500 scale-105":""]),onClick:u[3]||(u[3]=f=>o(50))},u[7]||(u[7]=[l("div",{class:"text-lg font-bold text-white"},"$50",-1),l("div",{class:"text-sm text-gray-400"},"Rocket",-1)]),2)]),u[9]||(u[9]=l("div",{class:"flex justify-center items-center gap-1 mb-6"},[l("span",{class:"text-yellow-400"},"⭐"),l("span",{class:"text-sm text-gray-300"},"Boost development")],-1)),l("button",{class:"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-3 rounded-lg transition-colors mb-2 active:scale-95 transform duration-150",onClick:a}," Donate via PayPal "),u[10]||(u[10]=l("div",{class:"text-xs text-gray-500 text-center"}," Secure payments via PayPal ",-1))])])):ne("",!0)}}),wd={class:"fixed inset-0 overflow-hidden pointer-events-none"},Ed=He({__name:"starfield",setup(t){const n=W([]);ze(()=>{e()});const e=()=>{const o=[];for(let a=0;a<50;a++)o.push({id:a,x:Math.random()*100,y:Math.random()*100,size:Math.random()*2+1,opacity:Math.random()*.7+.3,duration:Math.random()*8+2});n.value=o};return(r,o)=>(N(),L("div",wd,[(N(!0),L(Ae,null,Pe(n.value,a=>(N(),L("div",{key:a.id,class:"absolute rounded-full bg-white",style:Rr({width:`${a.size}px`,height:`${a.size}px`,top:`${a.y}%`,left:`${a.x}%`,opacity:a.opacity,boxShadow:`0 0 ${a.size*2}px rgba(255, 255, 255, ${a.opacity})`,animation:`twinkle ${a.duration}s infinite ease-in-out`})},null,4))),128))]))}});const _d=tt(Ed,[["__scopeId","data-v-f4bff5a3"]]),_r=!1,Ad=10,Bd=He({__name:"AudioOutput",props:{showControls:{type:Boolean,default:!0}},setup(t){const{remoteStream:n,connectionState:e,partnerId:r,isAudioMuted:o}=Ta(),a=W(null),c=W(.8),u=W(!1),f=W(0),s=_e(()=>(n.value!==null&&n.value?n.value.getAudioTracks().length>0:!1)&&n.value?n.value.getAudioTracks().some(y=>y.enabled):!1);_e(()=>n.value?n.value.getAudioTracks().filter(p=>p.enabled&&p.readyState==="live").length:0),_e(()=>u.value&&s.value?"connected":(e.value==="connected"&&!s.value&&!u.value&&setTimeout(v,500),e.value)),De(()=>n.value,p=>{v(),f.value=0,setTimeout(C,500)}),De(()=>o.value,p=>{!p&&n.value&&a.value&&setTimeout(()=>{a.value&&a.value.paused&&a.value.play().catch(m=>{})},300)}),De(()=>e.value,p=>{p==="connected"?setTimeout(()=>{v(),C()},1e3):p==="new"||p==="connecting"?f.value=0:(p==="disconnected"||p==="failed")&&x()}),De(()=>r.value,p=>{u.value=!1,f.value=0,p||a.value&&(a.value.srcObject=null)}),ze(()=>{v(),a.value&&(a.value.onplaying=()=>{u.value=!0},a.value.onpause=()=>{u.value=!1},a.value.onended=()=>{u.value=!1},a.value.onerror=p=>{console.error("[AudioOutput] Audio error:",p),u.value=!1},a.value.volume=c.value),document.addEventListener("visibilitychange",b),g()}),$r(()=>{a.value&&(a.value.srcObject=null),document.removeEventListener("visibilitychange",b),d()});let i=null;function g(){d(),i=window.setInterval(()=>{!u.value&&s.value&&e.value==="connected"&&(v(),C())},5e3)}function d(){i&&(clearInterval(i),i=null)}function b(){document.visibilityState==="visible"&&(v(),setTimeout(()=>{!u.value&&s.value&&C()},500))}function v(){a.value&&(n.value?(a.value.srcObject=n.value,n.value.getAudioTracks().forEach(p=>{p.enabled=!0}),C()):(a.value.srcObject=null,u.value=!1))}async function C(){if(!(!a.value||!a.value.srcObject))try{const p=n.value&&n.value.getAudioTracks().length>0;await a.value.play(),u.value=!0,f.value=0}catch(p){if(console.error("[AudioOutput] Error playing audio:",p),u.value=!1,p instanceof DOMException&&p.name==="NotAllowedError"&&console.warn("[AudioOutput] Audio play was blocked by browser policy, user interaction needed"),f.value<Ad){f.value++;const m=f.value*1e3;setTimeout(C,m)}else console.warn("[AudioOutput] Max retry attempts reached, manual play required")}}function x(){f.value=0,a.value&&(a.value.srcObject=null),setTimeout(()=>{v(),C()},500)}return(p,m)=>(N(),L("div",null,[l("audio",{ref_key:"audioElement",ref:a,autoplay:"",playsinline:"",class:"hidden"},null,512),ne("",!0)]))}});const kd=tt(Bd,[["__scopeId","data-v-f63dc209"]]),Dd={class:"flex items-center"},Fd={key:0,class:"spinner mr-3"},Td={key:1,class:"timeout-icon mr-3"},Sd={class:"content flex-grow"},Rd={class:"message"},$d={key:0,class:"wait-time"},Id={key:2,class:"flex-shrink-0"},Pd=He({__name:"queue-status",emits:["retry"],setup(t,{emit:n}){const e=Ie(),r=W(e.queueStatus.value),o=W(e.queueMessage.value),a=W(e.queueWaitTime.value),c=_e(()=>r.value!=="idle"&&r.value!=="matched"),u=_e(()=>r.value==="waiting"),f=_e(()=>r.value==="timeout"),s=_e(()=>({waiting:u.value,timeout:f.value}));function i(v){if(v<60)return`${v} seconds`;if(v<3600){const C=Math.floor(v/60),x=v%60;return`${C} ${C===1?"minute":"minutes"}${x>0?` and ${x} ${x===1?"second":"seconds"}`:""}`}else{const C=Math.floor(v/3600),x=Math.floor(v%3600/60);return`${C} ${C===1?"hour":"hours"}${x>0?` and ${x} ${x===1?"minute":"minutes"}`:""}`}}function g(){e.socket.value&&(r.value="idle",b("retry"))}function d(v){const C=v.detail;r.value=C.status,o.value=C.message,a.value=C.waitTime}const b=n;return ze(()=>{r.value=e.queueStatus.value,o.value=e.queueMessage.value,a.value=e.queueWaitTime.value,window.addEventListener("queue-status-changed",d)}),ft(()=>{window.removeEventListener("queue-status-changed",d)}),(v,C)=>c.value?(N(),L("div",{key:0,class:ie(["queue-status",s.value])},[l("div",Dd,[u.value?(N(),L("div",Fd)):f.value?(N(),L("div",Td,"⏱️")):ne("",!0),l("div",Sd,[l("div",Rd,K(o.value),1),a.value>0?(N(),L("div",$d," Wait time: "+K(i(a.value)),1)):ne("",!0)]),f.value?(N(),L("div",Id,[l("button",{onClick:g,class:"retry-button"}," Try Again ")])):ne("",!0)])],2)):ne("",!0)}});const Md=tt(Pd,[["__scopeId","data-v-7301a6d5"]]),Od={class:"filter-feedback"},Wd={key:0,class:"mt-2 p-2 bg-emerald-900/30 rounded-lg"},Nd={class:"text-xs text-emerald-300"},Ld={class:"font-medium"},Hd={class:"w-full bg-gray-700 rounded-full h-2 mt-1"},Ud={key:1,class:"mt-2"},jd={class:"text-xs text-gray-400"},qd={key:2,class:"mt-2"},zd={class:"text-xs text-gray-400"},Gd=He({__name:"CountryFilterFeedback",props:{preferredCountries:{type:Array,required:!0},blockedCountries:{type:Array,required:!0},onlineUsers:{type:Number,default:0},countries:{type:Array,required:!0}},setup(t){const n=t,e=_e(()=>{if(n.preferredCountries.length===0)return 100;const o=195,a=n.preferredCountries.length/o*100;return Math.min(Math.round(a),100)}),r=o=>{const a=n.countries.find(c=>c.value===o);return a?a.name:o};return(o,a)=>(N(),L("div",Od,[t.preferredCountries.length>0?(N(),L("div",Wd,[l("p",Nd,[l("span",Ld,K(e.value)+"%",1),a[0]||(a[0]=je(" of users match your preferences "))]),l("div",Hd,[l("div",{class:"bg-emerald-500 h-2 rounded-full",style:Rr({width:`${e.value}%`})},null,4)])])):ne("",!0),t.preferredCountries.length>0?(N(),L("div",Ud,[l("p",jd,[a[1]||(a[1]=je(" Your current preferences will match you only with users from: ")),(N(!0),L(Ae,null,Pe(t.preferredCountries,(c,u)=>(N(),L("span",{key:c},K(r(c))+K(u<t.preferredCountries.length-1?", ":""),1))),128))])])):ne("",!0),t.blockedCountries.length>0?(N(),L("div",qd,[l("p",zd,[a[2]||(a[2]=je(" You will not be matched with users from: ")),(N(!0),L(Ae,null,Pe(t.blockedCountries,(c,u)=>(N(),L("span",{key:c},K(r(c))+K(u<t.blockedCountries.length-1?", ":""),1))),128))])])):ne("",!0)]))}});const Vd=tt(Gd,[["__scopeId","data-v-bceab852"]]),Kd={class:"bg-gradient-to-br from-indigo-900 to-purple-900 rounded-2xl p-6 w-full max-w-sm border border-indigo-500/50 shadow-2xl animate-bounce-in"},Yd={class:"text-center"},Xd={class:"w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-br from-indigo-600 to-purple-700 flex items-center justify-center shadow-lg shadow-indigo-500/30 animate-pulse"},Qd={class:"text-4xl"},Zd={class:"text-white/90 text-sm mb-2"},Jd={class:"font-medium text-indigo-300"},ef={class:"mt-4 mb-3 relative"},tf={class:"h-3 bg-gray-700/70 rounded-full overflow-hidden backdrop-blur-sm shadow-inner"},nf={class:"text-sm text-indigo-200 mt-2 font-medium"},Yo=30,rf=He({__name:"GameInviteNotification",props:{gameType:{},from:{},inviteId:{}},emits:["accept","decline","timeout"],setup(t,{emit:n}){const e=t,r=n,o=W(Yo);let a=null;const c=_e(()=>o.value/Yo*100);ze(()=>{const d=new Audio("/sounds/notification.mp3");d.volume=.3,d.play().catch(b=>console.log("Error playing sound",b)),a=window.setInterval(()=>{o.value-=.1,o.value<=0&&u()},100)}),$r(()=>{a!==null&&clearInterval(a)});const u=()=>{a!==null&&clearInterval(a),r("timeout",{inviteId:e.inviteId})},f=()=>{a!==null&&clearInterval(a),r("accept",{inviteId:e.inviteId,gameType:e.gameType,from:e.from})},s=()=>{a!==null&&clearInterval(a),r("decline",{inviteId:e.inviteId,from:e.from})},i=d=>({"rock-paper-scissors":"Rock Paper Scissors","tic-tac-toe":"Tic-Tac-Toe","word-galaxy":"Word Galaxy",trivia:"Trivia Quiz"})[d]||d,g=d=>({"rock-paper-scissors":"✂️","tic-tac-toe":"⭕","word-galaxy":"🌌",trivia:"❓"})[d]||"🎮";return(d,b)=>(N(),L("div",{class:"fixed inset-0 flex items-center justify-center z-50 bg-black/70",onClick:Zo(s,["self"])},[l("div",Kd,[b[2]||(b[2]=l("div",{class:"absolute inset-0 -z-10 bg-gradient-to-r from-purple-600/20 to-indigo-600/20 rounded-2xl blur-xl animate-pulse"},null,-1)),l("div",Yd,[l("div",Xd,[l("span",Qd,K(g(d.gameType)),1)]),b[1]||(b[1]=l("p",{class:"text-white text-xl font-semibold mb-2 text-shadow"},"Game Invitation",-1)),l("p",Zd,[b[0]||(b[0]=je(" You've been invited to play ")),l("span",Jd,K(i(d.gameType)),1)]),l("div",ef,[l("div",tf,[l("div",{class:"h-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-pulse-slow",style:Rr({width:`${c.value}%`})},null,4)]),l("p",nf,K(Math.ceil(o.value))+"s remaining ",1)])]),l("div",{class:"mt-6 grid grid-cols-2 gap-4"},[l("button",{onClick:s,class:"bg-gray-700/80 hover:bg-gray-600 text-white px-6 py-3 rounded-xl text-sm transition-all duration-300 hover:scale-105 backdrop-blur-sm shadow-lg"}," Decline "),l("button",{onClick:f,class:"bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white px-6 py-3 rounded-xl text-sm transition-all duration-300 hover:scale-105 shadow-lg shadow-indigo-500/30 font-medium"}," Accept ")])])]))}});const of=tt(rf,[["__scopeId","data-v-7a75153e"]]),af={class:"min-h-screen font-sans"},sf={class:"relative min-h-screen z-10 text-white"},lf={class:"p-2 sm:p-4 border-b border-white/10"},cf={class:"max-w-4xl mx-auto"},uf={class:"flex justify-center gap-2 mb-2 sm:mb-3"},df={class:"bg-green-500/20 rounded-full px-2 py-1 text-xs flex items-center gap-1"},ff={key:0,class:"bg-purple-500/20 rounded-full px-2 py-1 text-xs"},xf={class:"grid grid-cols-2 gap-2 text-xs relative"},vf={class:"flex items-center truncate"},gf={key:0,class:"absolute top-full left-0 mt-1 w-full bg-gray-800/95 backdrop-blur-md border border-gray-700 rounded-xl shadow-xl z-20 overflow-hidden transition-all duration-200 animate-dropdown"},mf={class:"py-1"},pf=["onClick"],hf={class:"text-sm"},bf={class:"flex-1 p-2 sm:p-4"},yf={class:"max-w-md mx-auto space-y-4 sm:space-y-6"},Cf={class:"flex items-center justify-center gap-2 mb-2 sm:mb-4"},wf={class:"relative inline-block w-10 h-5 mr-2"},Ef={class:"text-center"},_f={class:"text-xs text-gray-400 italic"},Af={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},Bf={class:"bg-gray-800 rounded-2xl p-6 w-full max-w-sm"},kf={class:"flex justify-between items-center mb-4"},Df={class:"space-y-3"},Ff={key:0,class:"text-center py-8"},Tf={class:"flex items-center gap-3"},Sf={class:"text-2xl"},Rf={class:"text-white text-sm font-medium"},$f={class:"text-gray-400 text-xs"},If={class:"text-xs text-gray-500"},Pf={key:0,class:"text-xs text-gray-500 text-center mt-4"},Mf={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-20 p-4"},Of={class:"bg-gray-800 rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto relative"},Wf={class:"flex justify-between items-center mb-6"},Nf={class:"space-y-6"},Lf={class:"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide"},Hf={key:0,class:"text-xs text-gray-400 p-2"},Uf={key:1,class:"flex flex-wrap gap-2"},jf={class:"flag-icon"},qf=["onClick"],zf={class:"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide"},Gf={key:0,class:"text-xs text-gray-400 p-2"},Vf={key:1,class:"flex flex-wrap gap-2"},Kf={class:"flag-icon"},Yf=["onClick"],Xf={key:2,class:"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer preferred-outer"},Qf={class:"py-1 w-full"},Zf={class:"px-3 py-2 border-b border-gray-600"},Jf={key:0,class:"text-xs text-gray-400 px-3 py-2"},ex=["onClick"],tx={class:"flag-icon w-6 text-center"},nx={class:"text-sm"},rx={key:3,class:"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer blocked-outer"},ox={class:"py-1 w-full"},ax={class:"px-3 py-2 border-b border-gray-600"},sx={key:0,class:"text-xs text-gray-400 px-3 py-2"},ix=["onClick"],lx={class:"flag-icon w-6 text-center"},cx={class:"text-sm"},ux={key:4,class:"hidden"},dx={key:5,class:"fixed inset-0 flex items-center justify-center z-50 p-4 bg-black/50"},fx={class:"bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl p-6 w-full max-w-sm border border-purple-500/30 shadow-xl"},xx={class:"text-center"},vx={class:"text-white/80 text-sm"},gx={class:"mt-4 text-center"},mx=He({__name:"HomeView",setup(t){const n=W("disconnected"),e=W(null),r=W(null),o=W(""),a=W(!1);let c=null;const u=W(!1),f=W(!1),s=W(!1),i=W(!1),g=W(!1),d=W(0),b=W(0),v=W(!1),C=W([]),x=W([]),p=W([]),m=W("any"),h=W(!1),y=W([]),w=W([]),D=W(!1),F=W(!1),T=W(""),j=W([]),B=W(""),A=W([]),O=[{value:"any",text:"Go With the Flow",emoji:"🌟"},{value:"chill",text:"Chill",emoji:"😌"},{value:"fun",text:"Fun",emoji:"🎉"},{value:"curious",text:"Curious",emoji:"🤔"},{value:"creative",text:"Creative",emoji:"🎨"}],E=W([{value:"any",label:"🌍 Any Country",name:"Any Country",flag:"🌍"},{value:"ae",label:"🇦🇪 UAE",name:"United Arab Emirates",flag:"🇦🇪"},{value:"af",label:"🇦🇫 Afghanistan",name:"Afghanistan",flag:"🇦🇫"},{value:"al",label:"🇦🇱 Albania",name:"Albania",flag:"🇦🇱"},{value:"dz",label:"🇩🇿 Algeria",name:"Algeria",flag:"🇩🇿"},{value:"ar",label:"🇦🇷 Argentina",name:"Argentina",flag:"🇦🇷"},{value:"au",label:"🇦🇺 Australia",name:"Australia",flag:"🇦🇺"},{value:"at",label:"🇦🇹 Austria",name:"Austria",flag:"🇦🇹"},{value:"bh",label:"🇧🇭 Bahrain",name:"Bahrain",flag:"🇧🇭"},{value:"bd",label:"🇧🇩 Bangladesh",name:"Bangladesh",flag:"🇧🇩"},{value:"be",label:"🇧🇪 Belgium",name:"Belgium",flag:"🇧🇪"},{value:"br",label:"🇧🇷 Brazil",name:"Brazil",flag:"🇧🇷"},{value:"ca",label:"🇨🇦 Canada",name:"Canada",flag:"🇨🇦"},{value:"cn",label:"🇨🇳 China",name:"China",flag:"🇨🇳"},{value:"dk",label:"🇩🇰 Denmark",name:"Denmark",flag:"🇩🇰"},{value:"eg",label:"🇪🇬 Egypt",name:"Egypt",flag:"🇪🇬"},{value:"fi",label:"🇫🇮 Finland",name:"Finland",flag:"🇫🇮"},{value:"fr",label:"🇫🇷 France",name:"France",flag:"🇫🇷"},{value:"de",label:"🇩🇪 Germany",name:"Germany",flag:"🇩🇪"},{value:"gr",label:"🇬🇷 Greece",name:"Greece",flag:"🇬🇷"},{value:"hk",label:"🇭🇰 Hong Kong",name:"Hong Kong",flag:"🇭🇰"},{value:"hu",label:"🇭🇺 Hungary",name:"Hungary",flag:"🇭🇺"},{value:"in",label:"🇮🇳 India",name:"India",flag:"🇮🇳"},{value:"id",label:"🇮🇩 Indonesia",name:"Indonesia",flag:"🇮🇩"},{value:"ir",label:"🇮🇷 Iran",name:"Iran",flag:"🇮🇷"},{value:"iq",label:"🇮🇶 Iraq",name:"Iraq",flag:"🇮🇶"},{value:"ie",label:"🇮🇪 Ireland",name:"Ireland",flag:"🇮🇪"},{value:"it",label:"🇮🇹 Italy",name:"Italy",flag:"🇮🇹"},{value:"jp",label:"🇯🇵 Japan",name:"Japan",flag:"🇯🇵"},{value:"jo",label:"🇯🇴 Jordan",name:"Jordan",flag:"🇯🇴"},{value:"kz",label:"🇰🇿 Kazakhstan",name:"Kazakhstan",flag:"🇰🇿"},{value:"kr",label:"🇰🇷 Korea",name:"South Korea",flag:"🇰🇷"},{value:"kw",label:"🇰🇼 Kuwait",name:"Kuwait",flag:"🇰🇼"},{value:"lb",label:"🇱🇧 Lebanon",name:"Lebanon",flag:"🇱🇧"},{value:"ly",label:"🇱🇾 Libya",name:"Libya",flag:"🇱🇾"},{value:"my",label:"🇲🇾 Malaysia",name:"Malaysia",flag:"🇲🇾"},{value:"mx",label:"🇲🇽 Mexico",name:"Mexico",flag:"🇲🇽"},{value:"ma",label:"🇲🇦 Morocco",name:"Morocco",flag:"🇲🇦"},{value:"nl",label:"🇳🇱 Netherlands",name:"Netherlands",flag:"🇳🇱"},{value:"nz",label:"🇳🇿 New Zealand",name:"New Zealand",flag:"🇳🇿"},{value:"ng",label:"🇳🇬 Nigeria",name:"Nigeria",flag:"🇳🇬"},{value:"no",label:"🇳🇴 Norway",name:"Norway",flag:"🇳🇴"},{value:"om",label:"🇴🇲 Oman",name:"Oman",flag:"🇴🇲"},{value:"pk",label:"🇵🇰 Pakistan",name:"Pakistan",flag:"🇵🇰"},{value:"ps",label:"🇵🇸 Palestine",name:"Palestine",flag:"🇵🇸"},{value:"ph",label:"🇵🇭 Philippines",name:"Philippines",flag:"🇵🇭"},{value:"pl",label:"🇵🇱 Poland",name:"Poland",flag:"🇵🇱"},{value:"pt",label:"🇵🇹 Portugal",name:"Portugal",flag:"🇵🇹"},{value:"qa",label:"🇶🇦 Qatar",name:"Qatar",flag:"🇶🇦"},{value:"ro",label:"🇷🇴 Romania",name:"Romania",flag:"🇷🇴"},{value:"ru",label:"🇷🇺 Russia",name:"Russia",flag:"🇷🇺"},{value:"sa",label:"🇸🇦 Saudi Arabia",name:"Saudi Arabia",flag:"🇸🇦"},{value:"sg",label:"🇸🇬 Singapore",name:"Singapore",flag:"🇸🇬"},{value:"za",label:"🇿🇦 South Africa",name:"South Africa",flag:"🇿🇦"},{value:"es",label:"🇪🇸 Spain",name:"Spain",flag:"🇪🇸"},{value:"sd",label:"🇸🇩 Sudan",name:"Sudan",flag:"🇸🇩"},{value:"se",label:"🇸🇪 Sweden",name:"Sweden",flag:"🇸🇪"},{value:"ch",label:"🇨🇭 Switzerland",name:"Switzerland",flag:"🇨🇭"},{value:"sy",label:"🇸🇾 Syria",name:"Syria",flag:"🇸🇾"},{value:"tw",label:"🇹🇼 Taiwan",name:"Taiwan",flag:"🇹🇼"},{value:"th",label:"🇹🇭 Thailand",name:"Thailand",flag:"🇹🇭"},{value:"tn",label:"🇹🇳 Tunisia",name:"Tunisia",flag:"🇹🇳"},{value:"tr",label:"🇹🇷 Turkey",name:"Turkey",flag:"🇹🇷"},{value:"ua",label:"🇺🇦 Ukraine",name:"Ukraine",flag:"🇺🇦"},{value:"gb",label:"🇬🇧 UK",name:"United Kingdom",flag:"🇬🇧"},{value:"us",label:"🇺🇸 USA",name:"United States",flag:"🇺🇸"},{value:"ye",label:"🇾🇪 Yemen",name:"Yemen",flag:"🇾🇪"}]),P=async()=>{try{const I=await fetch("/api/countries");if(!I.ok)throw new Error("Failed to load countries");let R=await I.json();if(!R||R.length===0){console.log("Using static countries list");return}R=R.filter(Ge=>Ge.value!=="il"),R.some(Ge=>Ge.value==="ps")||R.push({value:"ps",label:"🇵🇸 Palestine",name:"Palestine",flag:"🇵🇸"}),R.some(Ge=>Ge.value==="eg")||R.push({value:"eg",label:"🇪🇬 Egypt",name:"Egypt",flag:"🇪🇬"}),R.sort((Ge,z)=>Ge.name.localeCompare(z.name)),E.value=[{value:"any",label:"🌍 Any Country",name:"Any Country",flag:"🌍"},...R],console.log("Countries loaded:",E.value.length),console.log("Filtered out Israel and ensured Palestine and Egypt are included"),j.value=[...ue.value],A.value=[...pe.value]}catch(I){console.error("Failed to load countries list:",I)}},H=W(null),Q=["You're not alone in the universe.","Every voice carries a story from across the stars.","Connection transcends distance in the cosmic web.","Discover new worlds through conversation.","In space, every voice matters."],k=W(Q[Math.floor(Math.random()*Q.length)]),S=Ie(),_=S.socket,{isConnected:X}=S,$=Ta(),{peerConnection:U,remoteStream:V,localStream:G,connectionState:ve,isAudioMuted:me,partnerId:Ce,createOffer:ae,handleOffer:ct,handleAnswer:nt,handleIceCandidate:rt,toggleMicrophone:ot,closeConnection:Te,restoreMicrophoneState:Se,diagnoseAndFixConnection:mt}=$,ee=Mi(),Y=Qa(),te=W(Y.params.roomId||null);De(()=>te.value,I=>{I&&(f.value=!0)},{immediate:!0});const ue=_e(()=>E.value.filter(I=>I.value!=="any"&&!y.value.includes(I.value)&&!w.value.includes(I.value))),pe=_e(()=>E.value.filter(I=>I.value!=="any"&&!w.value.includes(I.value)&&!y.value.includes(I.value))),ye=W(""),he=W(!1),fe=W(!1),J=W(""),we=W(null),Xe=async()=>{await ot(),a.value=me.value,n.value==="connected"&&setTimeout(()=>{const I=document.querySelector("audio");I&&I.paused&&I.play().catch(()=>{})},300)},at=async()=>{if(console.log("Finding next partner"),!G.value)try{await $.initializeLocalStream(),console.log("Microphone initialized")}catch(I){console.error("Failed to access microphone",I),alert("Please allow microphone access to use voice chat");return}if(_.value&&(_.value.emit("ping"),console.log("Sending ping to update activity status")),fe.value){In("Please wait before trying again");return}_.value&&(e.value?(console.log("Disconnecting from current partner"),he.value=!0,_.value.emit("disconnect-partner",{reason:"skip"}),Te(),await(()=>new Promise(R=>{const q=()=>{$.connectionState.value==="closed"?(console.log("Connection successfully closed, proceeding to search"),R()):(console.log(`Waiting for connection to close, current state: ${$.connectionState.value}`),setTimeout(q,300))};setTimeout(q,500)}))(),n.value="searching",o.value="",console.log("Clearing partner data from UI"),e.value=null,r.value=null,C.value=[],console.log("Finding new partner with preferences"),_.value.emit("join-queue",{vibe:m.value,preferences:{preferredCountries:y.value.length?y.value:void 0,blockedCountries:w.value.length?w.value:void 0}}),b.value++,setTimeout(()=>{he.value=!1},500)):(e.value=null,r.value=null,n.value="searching",o.value="",console.log("Finding new partner with preferences"),_.value.emit("join-queue",{vibe:m.value,preferences:{preferredCountries:y.value.length?y.value:void 0,blockedCountries:w.value.length?w.value:void 0}}),b.value++))},Bn=()=>{u.value=!u.value,u.value&&e.value&&ee.markAsRead(e.value)},Xt=I=>{if(_.value&&e.value){const R=Sa();_.value.emit("chat-message",{id:R,text:I,to:e.value,timestamp:Date.now()}),C.value.push({id:R,message:I,isOwn:!0,timestamp:Date.now()})}},Qt=I=>{if(console.log(`Selected game: ${I}`),_.value&&e.value){const R=`invite-${Date.now()}-${Math.floor(Math.random()*1e4)}`;_.value.emit("game-invite",{gameType:I,to:e.value,inviteId:R}),Lt("Game invitation sent!","info")}else Lt("Cannot send invitation - no partner connected","error")},xt=I=>{I&&!y.value.includes(I)&&y.value.push(I)},pt=I=>{y.value=y.value.filter(R=>R!==I)},kn=I=>{if(I&&!w.value.includes(I)){w.value.push(I);const R=Bt(I);console.log(`Added ${R} (${I}) to blocked countries list`),localStorage.setItem("blockedCountries",JSON.stringify(w.value))}},Zt=I=>{w.value=w.value.filter(q=>q!==I);const R=Bt(I);console.log(`Removed ${R} (${I}) from blocked countries list`),localStorage.setItem("blockedCountries",JSON.stringify(w.value))},Jt=()=>{y.value=[],w.value=[],localStorage.removeItem("preferredCountries"),localStorage.removeItem("blockedCountries")},Dn=()=>{console.log("Applying filters with the following settings:"),console.log("- Blocked countries:",w.value.length?w.value:"None"),console.log("- Preferred countries:",y.value.length?y.value:"None"),g.value=!1,Ot(),Fn(),nn()},Fn=()=>{const I=document.createElement("div");I.className="fixed bottom-4 right-4 bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-lg z-50",I.innerHTML=`
    <div class="flex items-center gap-2">
      <span>✓</span>
      <span>Filter settings applied successfully</span>
    </div>
  `,document.body.appendChild(I),setTimeout(()=>{I.classList.add("opacity-0","transition-opacity","duration-300"),setTimeout(()=>{document.body.removeChild(I)},300)},3e3)},Pt=I=>{const R=E.value.find(q=>q.value===I);return R?R.flag:"🏳️"},Bt=I=>{const R=E.value.find(q=>q.value===I);return R?R.name:"Earth"},en=I=>new Date(I).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),tn=(I,R,q)=>{I.value=!I.value,I.value&&(R.forEach(be=>be.value=!1),q!=null&&q.updatePositions&&ht(),q!=null&&q.resetSearch&&(q.resetSearch.query.value="",q.resetSearch.list.value=[...q.resetSearch.source]))},vt=I=>{I==="vibe"?(h.value=!h.value,D.value=!1,F.value=!1):I==="preferred"?Wa():I==="blocked"&&Na()},Tn=I=>{m.value=I,h.value=!1},Sn=I=>{const R=O.find(q=>q.value===I);return R?R.emoji:"🌟"},Rn=I=>{const R=O.find(q=>q.value===I);return R?R.text:"Go With the Flow"},kt=W(null),Mt=W(null),ht=()=>{Jo(()=>{var Ge,z;const I=(Ge=kt.value)==null?void 0:Ge.getBoundingClientRect(),R=(z=Mt.value)==null?void 0:z.getBoundingClientRect(),q=document.querySelector(".preferred-outer"),be=document.querySelector(".blocked-outer");I&&q&&(q.style.left=`${I.left}px`,q.style.top=`${I.bottom+5}px`,q.style.width=`${I.width}px`),R&&be&&(be.style.left=`${R.left}px`,be.style.top=`${R.bottom+5}px`,be.style.width=`${R.width}px`)})},Ot=()=>{localStorage.setItem("preferredCountries",JSON.stringify(y.value)),localStorage.setItem("blockedCountries",JSON.stringify(w.value))},$n=()=>{try{const I=localStorage.getItem("preferredCountries"),R=localStorage.getItem("blockedCountries");I&&(y.value=JSON.parse(I)),R&&(w.value=JSON.parse(R))}catch(I){console.error("Error loading filter settings:",I)}},nn=()=>{_.value&&X.value?(console.log("Restarting matching with updated filters:",{preferredCountries:y.value,blockedCountries:w.value}),_.value.emit("startMatching",{preferredCountries:y.value.length>0?y.value:null,blockedCountries:w.value}),n.value="searching",o.value=""):console.warn("Cannot restart matching - socket not connected")};De(n,I=>{console.log(`Connection status changed to: ${I}`),I==="connected"?(c&&clearInterval(c),c=setInterval(()=>{e.value&&ve.value!=="connected"&&(console.log("Connection health check: WebRTC not connected but partnerId exists"),["failed","closed","disconnected"].includes(ve.value)&&(console.log("Connection appears to be broken - resetting UI state"),n.value="disconnected",e.value=null,r.value=null))},2e3)):I==="disconnected"&&c&&(clearInterval(c),c=null)}),ze(async()=>{var I,R,q,be,Ge;console.log("Home view mounted"),P();try{const z=localStorage.getItem("preferredCountries"),Ee=localStorage.getItem("blockedCountries");z&&(y.value=JSON.parse(z)),Ee&&(w.value=JSON.parse(Ee));const on=localStorage.getItem("autoReconnect");on&&(v.value=on==="true")}catch(z){console.error("Error loading saved preferences:",z)}_.value&&(_.value.on("filters-updated",z=>{z.success&&console.log("Filters updated successfully on server")}),_.value.on("user-location",z=>{console.log("Received user location:",z),z&&z.countryCode&&z.country?(H.value=z,y.value.length===0&&z.countryCode!=="unknown"&&z.countryCode!=="earth"&&(console.log(`Adding user's country ${z.country} (${z.countryCode}) to preferred countries`),y.value.push(z.countryCode),Ot()),console.log(`Your location: ${z.flag} ${z.country}`)):console.warn("Received incomplete location data:",z)}),_.value.on("online-count",z=>{let Ee;if(typeof z=="number")Ee=z;else if(typeof z=="object"&&z!==null&&"count"in z)Ee=z.count;else{console.error("Received invalid online count data:",z);return}console.log(`Received online count update: ${Ee}`),d.value=Ee}),_.value.on("online-count-update",z=>{console.log(`Received online count update via update event: ${z.count}`),d.value=z.count}),_.value.on("matched",z=>{console.log("Partner matched with event:",z),n.value="matched",o.value="",e.value=z.partnerId,r.value={id:z.partnerId,country:z.country||"Earth",countryCode:z.countryCode||"unknown",flag:z.flag||"🌍",vibe:z.vibe||"any"},x.value.unshift({id:Date.now().toString(),country:r.value.country,flag:r.value.flag,timestamp:Date.now()}),x.value.length>3&&(x.value=x.value.slice(0,3)),z.partnerId&&(console.log("Initiating WebRTC connection with partner immediately"),ae(z.partnerId),setTimeout(()=>{n.value==="matched"&&ve.value==="connected"&&(console.log("WebRTC connection established, updating UI state"),n.value="connected")},2e3))}),_.value.on("direct-connection-established",z=>{console.log("Direct connection established:",z),n.value="connected",e.value=z.partnerId,r.value={id:z.partnerId,country:z.country||"Earth",countryCode:z.countryCode||"unknown",flag:z.flag||"🌍"}}),_.value.on("user-skipped",z=>{console.log("User skipped event received",z),Nt("disconnecting",{reason:"disconnected",message:"The other user disconnected"})}),_.value.on("user-disconnected",z=>{console.log("User disconnected event received",z);let Ee;z.reason==="connection-lost"?Ee="The other user's connection was lost":Ee="The other user disconnected",Nt("disconnecting",{reason:"disconnected",message:Ee})}),_.value.on("skip-confirmed",z=>{console.log("Skip confirmed by server:",z)}),_.value.on("disconnect-confirmed",z=>{console.log("Disconnect confirmed by server:",z)}),_.value.on("chat-message",z=>{C.value.push({id:z.id||Date.now().toString(),message:z.text||z.message||"",isOwn:!1,timestamp:z.timestamp||Date.now()}),z.id&&z.from&&_.value&&(console.log(`Sending receipt confirmation for message ${z.id}`),_.value.emit("message-received",{id:z.id,to:z.from}))}),_.value.on("error",z=>{if(console.error("Socket error:",z),z.type==="rate-limit"){const Ee=z.waitTime||60;In(`Please wait ${Ee} seconds before trying again`,3e3),n.value==="searching"&&(n.value="disconnected")}}),_.value.on("voice-offer",Ne),_.value.on("voice-answer",st),_.value.on("ice-candidate",rn),_.value.emit("get-online-count"),setTimeout(()=>{v.value&&n.value==="disconnected"&&(console.log("Auto-call is enabled - automatically finding a partner"),at())},1e3),_.value.on("queue-join-error",z=>{if(console.error("Queue join error:",z),z.reason==="rate-limited"){const Ee=z.waitTime||60;In(`Please wait ${Ee} seconds before trying to connect again`,3e3),n.value==="searching"&&(n.value="disconnected")}}),(I=_.value)==null||I.on("game-invite",z=>{console.log(`[Game] Received game invitation for ${z.gameType} from ${z.from}`),p.value.push({id:z.inviteId||`invite-${Date.now()}`,gameType:z.gameType,from:z.from,timestamp:Date.now()});const Ee=new Audio("/sounds/game-invite.mp3");Ee.volume=.7,Ee.play().catch(on=>console.log("Error playing sound",on)),"vibrate"in navigator&&navigator.vibrate([200,100,400])}),(R=_.value)==null||R.on("game-invite-accepted",z=>{var Ee;console.log(`[Game] ${z.from} accepted your game invitation for ${z.gameType}`),Lt("Invitation accepted!","success"),e.value=z.from,f.value=!0,(Ee=_.value)==null||Ee.emit("game-join",{gameType:z.gameType,partnerId:z.from})}),(q=_.value)==null||q.on("game-invite-declined",z=>{console.log(`[Game] ${z.from} declined your game invitation`),Lt("Invitation declined","error")}),(be=_.value)==null||be.on("game-invite-timeout",z=>{console.log(`[Game] Game invitation ${z.inviteId} timed out`),Lt("Invitation expired","info")}),(Ge=_.value)==null||Ge.on("game-join-confirmed",z=>{console.log(`[Game] Join confirmed for game ${z.gameType} in room ${z.roomId}`)})),document.addEventListener("click",jr),window.addEventListener("resize",ht),document.addEventListener("scroll",ht,!0),$n(),await Se(),a.value=me.value,window.addEventListener("connection-closed",()=>{console.log("Connection-closed event detected in HomeView")}),window.addEventListener("connection-state-changed",z=>{if(console.log("Connection state changed event received:",z.detail),(z.detail.state==="disconnected"||z.detail.state==="failed")&&n.value!=="disconnected"&&n.value!=="disconnecting"){const Ee=z.detail.temporary?"Connection temporarily lost. Trying to reconnect...":"Connection lost. The call has ended.";Nt("disconnecting",{reason:z.detail.reason||"network-disconnect",message:Ee,temporary:z.detail.temporary})}}),window.addEventListener("queue-status-changed",qr)}),$r(()=>{console.log("Home view unmounting, cleaning up connection"),Te(),c&&(clearInterval(c),c=null),_.value&&(_.value.off("online-count"),_.value.off("matched"),_.value.off("direct-connection-established"),_.value.off("user-skipped"),_.value.off("user-disconnected"),_.value.off("skip-confirmed"),_.value.off("disconnect-confirmed"),_.value.off("queue-join-error"),_.value.off("chat-message"),_.value.off("error"),_.value.off("voice-offer"),_.value.off("voice-answer"),_.value.off("ice-candidate"),_.value.off("online-count-update"),_.value.off("game-invite"),_.value.off("game-invite-accepted"),_.value.off("game-invite-declined"),_.value.off("game-invite-timeout"),_.value.off("game-join-confirmed")),document.removeEventListener("click",jr),window.removeEventListener("resize",ht),document.removeEventListener("scroll",ht,!0),window.removeEventListener("connection-closed",()=>{}),we.value&&(clearTimeout(we.value),we.value=null),window.removeEventListener("queue-status-changed",qr)});const Ne=async I=>{console.log("Received voice offer - forwarding to WebRTC service"),ct(I.offer,I.from)},st=async I=>{console.log("Received voice answer - forwarding to WebRTC service"),nt(I.answer)},rn=async I=>{console.log("Received ICE candidate - forwarding to WebRTC service"),rt(I.candidate)};De(ve,I=>{console.log(`WebRTC connection state changed to: ${I}`),I==="connected"?n.value==="matched"&&Nt("connected"):["failed","closed","disconnected"].includes(I)&&(console.log(`WebRTC connection is now ${I}, updating UI if needed`),e.value&&n.value!=="disconnected"&&n.value!=="disconnecting"&&Nt("disconnecting",{reason:I==="disconnected"?"network-disconnect":"disconnected",message:I==="disconnected"?"Connection lost. Trying to reconnect...":"Connection closed."}))});const Wt=W(null),jr=I=>{const R=I.target;if(Wt.value&&!Wt.value.contains(R)&&(h.value=!1),D.value){const q=kt.value,be=document.querySelector(".preferred-outer");q&&be&&!q.contains(R)&&!be.contains(R)&&(D.value=!1)}if(F.value){const q=Mt.value,be=document.querySelector(".blocked-outer");q&&be&&!q.contains(R)&&!be.contains(R)&&(F.value=!1)}};function Ma(){_.value&&(_.value.emit("join-queue",{vibe:m.value,preferences:{preferredCountries:y.value.length?y.value:void 0,blockedCountries:w.value.length?w.value:void 0}}),n.value="searching",console.log("Manual retry initiated, keeping auto-reconnect off"))}De(v,I=>{localStorage.setItem("autoReconnect",I.toString()),I&&n.value==="disconnected"&&(console.log("Auto-call enabled - automatically finding a partner"),at())}),De(()=>n.value,I=>{I==="searching"&&(o.value="")});function In(I,R=3e3){J.value=I,fe.value=!0,we.value&&clearTimeout(we.value),we.value=window.setTimeout(()=>{fe.value=!1,J.value="",we.value=null},R)}const qr=I=>{const R=I;R.detail&&R.detail.status==="timeout"&&(console.log("Queue timeout detected, disabling auto-reconnect"),v.value=!1,n.value="disconnected")},Oa=()=>{if(pe.value)if(B.value.trim()==="")A.value=[...pe.value];else{const I=B.value.toLowerCase().trim();A.value=pe.value.filter(R=>R.name.toLowerCase().includes(I)||R.value.toLowerCase().includes(I))}},Wa=()=>{tn(D,[F,h],{updatePositions:!0,resetSearch:{query:T,list:j,source:ue.value}})},Na=()=>{tn(F,[D,h],{updatePositions:!0,resetSearch:{query:B,list:A,source:pe.value}})},Nt=(I,R={})=>{if(console.log(`Handling connection state change to: ${I} with reason: ${R.reason||"none"}`),I==="disconnecting"){if(ye.value=R.reason||"disconnected",R.message&&(o.value=R.message,setTimeout(()=>{o.value=""},5e3)),n.value="disconnecting",!R.temporary){const q=R.skipDelay?0:2e3;setTimeout(()=>{n.value==="disconnecting"&&(e.value=null,r.value=null,n.value="disconnected",ye.value="",o.value="",Te(),v.value&&(console.log("Auto-call is enabled - finding new partner after disconnection"),setTimeout(()=>{n.value==="disconnected"&&v.value&&(console.log("Auto-call: Starting new call automatically"),at())},1e3)))},q)}}else n.value=I,I==="searching"&&(o.value="")},La=I=>{console.log(`Accepting game invitation: ${I.gameType} from ${I.from}`),p.value=p.value.filter(R=>R.id!==I.inviteId),_.value&&(_.value.emit("game-invite-accept",{inviteId:I.inviteId,gameType:I.gameType,to:I.from}),e.value=I.from,f.value=!0,_.value.emit("game-join",{gameType:I.gameType,partnerId:I.from}))},Ha=I=>{console.log(`Declining game invitation from ${I.from}`),p.value=p.value.filter(R=>R.id!==I.inviteId),_.value&&_.value.emit("game-invite-decline",{inviteId:I.inviteId,to:I.from})},Ua=I=>{if(console.log(`Game invitation timed out: ${I.inviteId}`),p.value=p.value.filter(R=>R.id!==I.inviteId),_.value){const R=p.value.find(q=>q.id===I.inviteId);R&&_.value.emit("game-invite-timeout",{inviteId:I.inviteId,to:R.from})}},Lt=(I,R="info")=>{const q=document.createElement("div");let be="bg-blue-600";R==="success"&&(be="bg-emerald-600"),R==="error"&&(be="bg-red-600"),q.className=`fixed bottom-4 right-4 ${be} text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in`,q.style.animationDuration="0.3s",q.innerHTML=I,document.body.appendChild(q),setTimeout(()=>{q.style.opacity="0",q.style.transition="opacity 0.3s ease",setTimeout(()=>{document.body.removeChild(q)},300)},3e3)};return(I,R)=>(N(),L("div",af,[R[31]||(R[31]=dt('<div class="fixed inset-0 pointer-events-none" data-v-cce2d9ef><div class="absolute top-1/4 left-1/4 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl animate-pulse" data-v-cce2d9ef></div><div class="absolute top-1/3 right-1/3 w-24 h-24 bg-violet-500/20 rounded-full blur-2xl animate-pulse delay-1000" data-v-cce2d9ef></div><div class="absolute bottom-1/4 left-1/3 w-28 h-28 bg-indigo-500/20 rounded-full blur-3xl animate-pulse delay-2000" data-v-cce2d9ef></div><div class="absolute top-1/2 right-1/4 w-20 h-20 bg-fuchsia-500/20 rounded-full blur-2xl animate-pulse delay-500" data-v-cce2d9ef></div></div>',1)),Qe(_d),l("div",sf,[l("header",lf,[l("div",cf,[R[18]||(R[18]=dt('<div class="text-center mb-2 sm:mb-4" data-v-cce2d9ef><div class="inline-flex items-center gap-2" data-v-cce2d9ef><div class="w-6 h-6 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center shadow-lg shadow-cyan-500/50" data-v-cce2d9ef><span class="text-white text-xs" data-v-cce2d9ef>✨</span></div><h1 class="text-lg font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent drop-shadow-lg" data-v-cce2d9ef> SpaceTalk.live </h1></div></div>',1)),l("div",uf,[l("div",df,[R[17]||(R[17]=l("div",{class:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"},null,-1)),l("span",null,K(d.value)+" online",1)]),b.value>0?(N(),L("div",ff," Today: "+K(b.value)+" voices ",1)):ne("",!0)]),l("div",xf,[l("div",{class:"relative",ref_key:"vibeDropdownRef",ref:Wt},[l("div",{onClick:R[0]||(R[0]=q=>vt("vibe")),class:"cursor-pointer bg-purple-500/20 border border-purple-500/30 rounded-full h-8 flex items-center justify-between px-3 text-xs shadow-lg shadow-purple-500/20 text-white hover:bg-purple-500/30 active:scale-95 transition-all duration-150"},[l("span",vf,K(Sn(m.value))+" "+K(Rn(m.value)),1),l("span",{class:ie(["ml-2 text-xs transition-transform duration-300",{"rotate-180":h.value}])},"▼",2)]),h.value?(N(),L("div",gf,[l("div",mf,[(N(),L(Ae,null,Pe(O,q=>l("div",{key:q.value,onClick:be=>Tn(q.value),class:ie(["px-3 py-2 hover:bg-gray-700/80 cursor-pointer transition-colors flex items-center gap-2",{"bg-gray-700/70":m.value===q.value}])},[l("span",hf,K(q.emoji),1),l("span",null,K(q.text),1)],10,pf)),64))])])):ne("",!0)],512),l("button",{onClick:R[1]||(R[1]=q=>g.value=!0),class:"bg-violet-500/20 border border-violet-500/30 rounded-full h-8 px-3 text-xs hover:bg-violet-500/30 active:scale-95 transition-all duration-150 shadow-lg shadow-violet-500/20"}," 🔍 Filters ")])])]),l("main",bf,[l("div",yf,[Qe(ol,{status:n.value,"partner-info":r.value,"error-message":o.value,"disconnect-reason":ye.value,"show-status":!0},null,8,["status","partner-info","error-message","disconnect-reason"]),Qe(Md,{onRetry:Ma}),l("div",Cf,[l("div",wf,[Rt(l("input",{type:"checkbox",id:"auto-reconnect","onUpdate:modelValue":R[2]||(R[2]=q=>v.value=q),class:"opacity-0 w-0 h-0 absolute"},null,512),[[Xa,v.value]]),l("label",{for:"auto-reconnect",class:ie(["toggle-label block overflow-hidden h-5 rounded-full bg-gray-700 border border-gray-600 cursor-pointer transition-all duration-300",{"bg-gradient-to-r from-indigo-500 to-purple-500 border-indigo-400":v.value}])},[l("span",{class:ie(["dot absolute top-0.5 left-0.5 bg-white w-4 h-4 rounded-full transition-all duration-300 shadow-md",{"transform translate-x-5 bg-white":v.value}])},null,2)],2)]),l("label",{for:"auto-reconnect",class:ie(["text-xs font-medium cursor-pointer transition-colors duration-300",v.value?"text-indigo-300":"text-gray-400"])}," Auto-call ",2)]),Qe(vl,{"is-muted":a.value,"is-disabled":n.value!=="connected",onToggleMute:Xe,onFindNext:at,onToggleChat:Bn,onToggleGames:R[3]||(R[3]=q=>f.value=!0),onToggleHistory:R[4]||(R[4]=q=>i.value=!0),onToggleDonation:R[5]||(R[5]=q=>s.value=!0)},null,8,["is-muted","is-disabled"]),l("div",Ef,[l("p",_f,'"'+K(k.value)+'"',1)])])]),R[19]||(R[19]=dt('<footer class="p-2 sm:p-4 border-t border-white/10" data-v-cce2d9ef><div class="max-w-md mx-auto text-center space-y-1 sm:space-y-2" data-v-cce2d9ef><h3 class="text-sm font-semibold text-emerald-400" data-v-cce2d9ef>Community Guidelines</h3><div class="text-xs text-gray-300 space-y-0.5 sm:space-y-1" data-v-cce2d9ef><p data-v-cce2d9ef>• Must be 18+ years old to use this service</p><p data-v-cce2d9ef>• Be respectful and kind to other users</p><p data-v-cce2d9ef>• No harassment, hate speech, or inappropriate content</p><p data-v-cce2d9ef>• Report any misconduct using the report feature</p><p data-v-cce2d9ef>• Your privacy and safety are our priority</p></div><p class="text-xs text-gray-400 mt-2 sm:mt-3" data-v-cce2d9ef> By using SpaceTalk.live, you agree to follow these guidelines </p><div class="grid grid-cols-2 md:flex md:flex-wrap justify-center gap-2 mt-2 sm:mt-4 text-xs" data-v-cce2d9ef><a href="#" class="bg-cyan-500/20 border border-cyan-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-cyan-300 hover:text-cyan-200 hover:bg-cyan-500/30 transition-all shadow-lg shadow-cyan-500/20 text-center" data-v-cce2d9ef> ℹ️ About </a><a href="https://instagram.com" target="_blank" class="bg-pink-500/20 border border-pink-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-pink-300 hover:text-pink-200 hover:bg-pink-500/30 transition-all shadow-lg shadow-pink-500/20 text-center" data-v-cce2d9ef> 📷 Instagram </a><a href="https://facebook.com" target="_blank" class="bg-blue-500/20 border border-blue-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-blue-300 hover:text-blue-200 hover:bg-blue-500/30 transition-all shadow-lg shadow-blue-500/20 text-center" data-v-cce2d9ef> 📘 Facebook </a><a href="mailto:contact@spacetalk.live" class="bg-emerald-500/20 border border-emerald-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-emerald-300 hover:text-emerald-200 hover:bg-emerald-500/30 transition-all shadow-lg shadow-emerald-500/20 text-center" data-v-cce2d9ef> 📧 Contact </a></div></div></footer>',1))]),i.value?(N(),L("div",Af,[l("div",Bf,[l("div",kf,[R[20]||(R[20]=l("h2",{class:"text-lg font-semibold text-indigo-400"},"📞 Call History",-1)),l("button",{onClick:R[6]||(R[6]=q=>i.value=!1),class:"text-gray-400 hover:text-white text-xl"}," ✕ ")]),l("div",Df,[x.value.length===0?(N(),L("div",Ff,R[21]||(R[21]=[l("p",{class:"text-gray-400 text-sm"},"No recent calls",-1),l("p",{class:"text-xs text-gray-500 mt-1"},"Your last 3 conversations will appear here",-1)]))):(N(!0),L(Ae,{key:1},Pe(x.value,(q,be)=>(N(),L("div",{key:q.id,class:"bg-gray-700 rounded-lg p-3 flex items-center justify-between hover:bg-gray-600 transition-colors"},[l("div",Tf,[l("span",Sf,K(q.flag),1),l("div",null,[l("p",Rf,K(q.country),1),l("p",$f,K(en(q.timestamp)),1)])]),l("div",If," #"+K(be+1),1)]))),128))]),x.value.length>0?(N(),L("p",Pf," History clears when you leave the page ")):ne("",!0)])])):ne("",!0),g.value?(N(),L("div",Mf,[l("div",Of,[l("div",Wf,[R[22]||(R[22]=l("h2",{class:"text-lg font-semibold text-emerald-400"},"Filters & Preferences",-1)),l("button",{onClick:R[7]||(R[7]=q=>g.value=!1),class:"text-gray-400 hover:text-white text-xl"}," ✕ ")]),l("div",Nf,[l("div",null,[R[24]||(R[24]=l("label",{class:"block text-sm font-medium mb-3 text-emerald-400"},"Preferred Countries",-1)),l("div",Lf,[y.value.length===0?(N(),L("p",Hf,"No countries selected")):(N(),L("div",Uf,[(N(!0),L(Ae,null,Pe(y.value,q=>(N(),L("span",{key:q,class:"bg-emerald-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1"},[l("span",jf,K(Pt(q)),1),je(" "+K(Bt(q))+" ",1),l("button",{onClick:be=>pt(q),class:"text-emerald-200 hover:text-white ml-1"}," ✕ ",8,qf)]))),128))]))]),l("div",{class:"mt-2 relative preferred-dropdown",ref_key:"preferredDropdownRef",ref:kt},[l("div",{onClick:R[8]||(R[8]=q=>vt("preferred")),class:"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white"},R[23]||(R[23]=[l("span",{class:"text-gray-300"},"Add preferred country...",-1),l("span",{class:"ml-1"},"▼",-1)]))],512),Qe(Vd,{"preferred-countries":y.value,"blocked-countries":w.value,"online-users":d.value,countries:E.value},null,8,["preferred-countries","blocked-countries","online-users","countries"]),R[25]||(R[25]=l("p",{class:"text-xs text-gray-400 mt-2"},"You'll be matched only with users from these countries",-1))]),l("div",null,[R[27]||(R[27]=l("label",{class:"block text-sm font-medium mb-3 text-red-400"},"Blocked Countries",-1)),l("div",zf,[w.value.length===0?(N(),L("p",Gf,"No countries blocked")):(N(),L("div",Vf,[(N(!0),L(Ae,null,Pe(w.value,q=>(N(),L("span",{key:q,class:"bg-red-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1"},[l("span",Kf,K(Pt(q)),1),je(" "+K(Bt(q))+" ",1),l("button",{onClick:be=>Zt(q),class:"text-red-200 hover:text-white ml-1"}," ✕ ",8,Yf)]))),128))]))]),l("div",{class:"mt-2 relative blocked-dropdown",ref_key:"blockedDropdownRef",ref:Mt},[l("div",{onClick:R[9]||(R[9]=q=>vt("blocked")),class:"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white"},R[26]||(R[26]=[l("span",{class:"text-gray-300"},"Add blocked country...",-1),l("span",{class:"ml-1"},"▼",-1)]))],512),R[28]||(R[28]=l("p",{class:"text-xs text-gray-400 mt-2"},"You won't be matched with users from these countries",-1))])]),l("div",{class:"flex gap-2 mt-8"},[l("button",{onClick:Jt,class:"flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg text-sm transition-colors"}," Clear All "),l("button",{onClick:Dn,class:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-lg text-sm transition-colors"}," Apply Filters ")])])])):ne("",!0),D.value?(N(),L("div",Xf,[l("div",Qf,[l("div",Zf,[Rt(l("input",{"onUpdate:modelValue":R[10]||(R[10]=q=>T.value=q),type:"text",placeholder:"Search countries...",class:"w-full px-3 py-2 bg-gray-800 rounded text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:R[11]||(R[11]=(...q)=>I.updateCountrySearch&&I.updateCountrySearch(...q))},null,544),[[Vt,T.value]])]),ue.value.length===0?(N(),L("div",Jf,"No more countries available")):ne("",!0),(N(!0),L(Ae,null,Pe(j.value,q=>(N(),L("div",{key:q.value,onClick:()=>{xt(q.value),vt("preferred")},class:"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2"},[l("span",tx,K(q.flag),1),l("span",nx,K(q.name),1)],8,ex))),128))])])):ne("",!0),F.value?(N(),L("div",rx,[l("div",ox,[l("div",ax,[Rt(l("input",{"onUpdate:modelValue":R[12]||(R[12]=q=>B.value=q),type:"text",placeholder:"Search countries...",class:"w-full px-3 py-2 bg-gray-800 rounded text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500",onInput:Oa},null,544),[[Vt,B.value]])]),pe.value.length===0?(N(),L("div",sx,"No more countries available")):ne("",!0),(N(!0),L(Ae,null,Pe(A.value,q=>(N(),L("div",{key:q.value,onClick:()=>{kn(q.value),vt("blocked")},class:"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2"},[l("span",lx,K(q.flag),1),l("span",cx,K(q.name),1)],8,ix))),128))])])):ne("",!0),Qe(Bl,{"is-open":u.value,onClose:R[13]||(R[13]=q=>u.value=!1),messages:C.value,onSendMessage:Xt,"is-connected":n.value==="connected"},null,8,["is-open","messages","is-connected"]),Qe(md,{"is-open":f.value,onClose:R[14]||(R[14]=q=>f.value=!1),"is-connected":n.value==="connected",onSelectGame:Qt,"partner-id":e.value||"","initial-game-room-id":te.value},null,8,["is-open","is-connected","partner-id","initial-game-room-id"]),Qe(Cd,{"is-open":s.value,onClose:R[15]||(R[15]=q=>s.value=!1)},null,8,["is-open"]),n.value==="connected"?(N(),L("div",ux,[Qe(kd,{showControls:!1})])):ne("",!0),(N(!0),L(Ae,null,Pe(p.value,q=>(N(),cn(of,{key:q.id,"invite-id":q.id,"game-type":q.gameType,from:q.from,onAccept:La,onDecline:Ha,onTimeout:Ua},null,8,["invite-id","game-type","from"]))),128)),fe.value?(N(),L("div",dx,[l("div",fx,[l("div",xx,[R[29]||(R[29]=l("div",{class:"w-20 h-20 mx-auto mb-4 rounded-full bg-purple-800 flex items-center justify-center"},[l("span",{class:"text-3xl"},"⏱️")],-1)),R[30]||(R[30]=l("p",{class:"text-white text-lg font-semibold mb-1"},"Rate Limit Reached",-1)),l("p",vx,K(J.value),1)]),l("div",gx,[l("button",{onClick:R[16]||(R[16]=q=>fe.value=!1),class:"bg-purple-700 hover:bg-purple-600 text-white px-6 py-2 rounded-full text-sm transition-colors duration-300"}," OK ")])])])):ne("",!0)]))}});const Xo=tt(mx,[["__scopeId","data-v-cce2d9ef"]]),px=Za({history:Ja("/"),routes:[{path:"/",name:"home",component:Xo},{path:"/game/:roomId",name:"game",component:Xo,props:!0}]}),Pa=es(us);Pa.use(px);Pa.mount("#app");
//# sourceMappingURL=index-848213e1.js.map
