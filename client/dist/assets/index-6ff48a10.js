import{d as oe,c as b,a as re,u as Nt,o as p,R as Ft,r as x,b as ue,e as We,s as De,w as K,f as ce,g as t,t as j,h as B,n as z,F as ne,i as ae,j as Lt,k as lt,v as Bt,l as rt,m as Pe,p as be,q as Ut,x as Gt,y as st,z as zt,A as qt,B as Vt,C as Yt,D as Ht}from"./vue-vendor-063cf05a.js";import{l as Xt}from"./socket-vendor-d9998155.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))k(f);new MutationObserver(f=>{for(const n of f)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&k(g)}).observe(document,{childList:!0,subtree:!0});function s(f){const n={};return f.integrity&&(n.integrity=f.integrity),f.referrerPolicy&&(n.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?n.credentials="include":f.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function k(f){if(f.ep)return;f.ep=!0;const n=s(f);fetch(f.href,n)}})();const Jt={class:"app-container"},Kt=oe({__name:"App",setup(o){return(m,s)=>(p(),b("div",Jt,[re(Nt(Ft))]))}});const Qt=()=>window.location.origin,P=x(null),_e=x(null),ge=x(!1);let ve=null;function ke(){ue(()=>{P.value||o()}),We(()=>{P.value&&k(),ve&&(clearInterval(ve),ve=null)});function o(){const n=Qt();console.log(`Connecting to socket server at: ${n}`);const g=localStorage.getItem("spacechat_user_id");console.log("Retrieved stored user ID:",g),P.value=Xt(n,{autoConnect:!0,reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:3e4,transports:["websocket","polling"],extraHeaders:{"X-Client-Version":"1.0.0"},query:g?{userId:g}:void 0,forceNew:!1,rememberUpgrade:!0,withCredentials:!0}),s(),m()}function m(){ve&&clearInterval(ve),ve=setInterval(()=>{P.value&&ge.value&&P.value.emit("ping")},3e4)}function s(){P.value&&(P.value.on("connect",()=>{var g,r;console.log("Socket connected"),ge.value=!0;const n=localStorage.getItem("spacechat_user_id");(g=P.value)==null||g.emit("user:identify",{prevUserId:n||void 0},R=>{console.log("Identified with server, user ID:",R),_e.value=R,localStorage.setItem("spacechat_user_id",R)}),(r=P.value)==null||r.emit("get-online-count")}),P.value.on("disconnect",()=>{console.log("Socket disconnected"),ge.value=!1}),P.value.on("reconnect",n=>{var r;console.log(`Socket reconnected after ${n} attempts`),ge.value=!0;const g=localStorage.getItem("spacechat_user_id");g&&((r=P.value)==null||r.emit("user:identify",{prevUserId:g},R=>{var D;console.log("Re-identified with server after reconnection, user ID:",R),_e.value=R,R!==g&&localStorage.setItem("spacechat_user_id",R),(D=P.value)==null||D.emit("get-online-count")}))}),P.value.on("reconnect_attempt",n=>{console.log(`Socket reconnection attempt ${n}`)}),P.value.on("reconnect_error",n=>{console.error("Socket reconnection error:",n)}),P.value.on("reconnect_failed",()=>{console.error("Socket reconnection failed"),setTimeout(()=>{ge.value||(console.log("Attempting to reinitialize socket connection..."),k(),o())},5e3)}),P.value.on("error",n=>{console.error("Socket error:",n)}),P.value.on("pong",()=>{}),P.value.on("user-id",n=>{console.log("Received user ID from server:",n),_e.value=n,localStorage.setItem("spacechat_user_id",n)}))}function k(){P.value&&(P.value.off("connect"),P.value.off("disconnect"),P.value.off("reconnect"),P.value.off("reconnect_attempt"),P.value.off("reconnect_error"),P.value.off("reconnect_failed"),P.value.off("error"),P.value.off("user-id"),P.value.off("pong"))}function f(){P.value?(console.log("Forcing socket reconnection..."),P.value.disconnect(),P.value.connect()):o()}return{socket:P,isConnected:ge,userId:_e,reconnect:f}}const Zt=86400,it=`${Date.now()+Zt}:spacechat`,ct="openrelayproject",ut={iceServers:[{urls:["turns:global.relay.metered.ca:443","turn:global.relay.metered.ca:443?transport=tcp","turn:global.relay.metered.ca:80?transport=tcp","turn:global.relay.metered.ca:80"],username:it,credential:ct},{urls:["turn:relay.metered.ca:80","turn:relay.metered.ca:443","turns:relay.metered.ca:443"],username:"dbc12a",credential:"c84ded89b281ae42"},{urls:["turn:global.turn.twilio.com:3478?transport=tcp","turn:global.turn.twilio.com:3478?transport=udp","turns:global.turn.twilio.com:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"},{urls:"stun:openrelay.metered.ca:80"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},Qe={iceServers:[{urls:["turns:global.relay.metered.ca:443","turn:global.relay.metered.ca:443?transport=tcp","turn:global.relay.metered.ca:80?transport=tcp","turns:relay.metered.ca:443"],username:it,credential:ct},{urls:["turn:relay.metered.ca:443?transport=tcp","turns:relay.metered.ca:443"],username:"dbc12a",credential:"c84ded89b281ae42"},{urls:["turns:global.turn.twilio.com:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"}],iceCandidatePoolSize:10,iceTransportPolicy:"relay",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},Ze={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun.cloudflare.com:3478"]},{urls:["turn:relay.metered.ca:443?transport=tcp"],username:"dbc12a",credential:"c84ded89b281ae42"}],iceCandidatePoolSize:5,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};let pe=ut;const eo=pe;let d=null,E=null,A=null;const V=x("new"),se=x(!1),Ce=x(null),_=!0;let J="",te="",et=null,q=!1,ie=!1,L=0;const ee=15;let Z=[],me=null;const to=8e3,oo=1e3;async function dt(){if(!d)return{error:"No peer connection available"};try{const o={};return(await d.getStats()).forEach(s=>{s.type==="transport"?o.transport={bytesReceived:s.bytesReceived,bytesSent:s.bytesSent,dtlsState:s.dtlsState,selectedCandidatePairId:s.selectedCandidatePairId}:s.type==="candidate-pair"&&s.selected?o.selectedCandidatePair={localCandidateId:s.localCandidateId,remoteCandidateId:s.remoteCandidateId,state:s.state,availableOutgoingBitrate:s.availableOutgoingBitrate}:s.type==="local-candidate"||s.type==="remote-candidate"?(o.candidates||(o.candidates=[]),o.candidates.push({type:s.type,id:s.id,ip:s.ip,port:s.port,protocol:s.protocol,candidateType:s.candidateType})):(s.type==="media-source"||s.type==="track"||s.type==="media-playout")&&(o.media||(o.media=[]),o.media.push({type:s.type,id:s.id,kind:s.kind,audioLevel:s.audioLevel,trackIdentifier:s.trackIdentifier}))}),o}catch(o){return console.error("[WebRTC] Error getting stats:",o),{error:"Failed to get stats: "+o}}}function no(){tt();const o=setInterval(async()=>{d&&(V.value==="connected"||V.value==="connecting")?(et=await dt(),console.log("[WebRTC] Connection stats:",et)):tt()},5e3);window.__webrtcStatsTimer=o}function tt(){const o=window.__webrtcStatsTimer;o&&(clearInterval(o),window.__webrtcStatsTimer=null)}function Ne(){const{socket:o,userId:m}=ke(),s=De(d),k=De(E),f=De(A),n=V,g=se,r=Ce;x({echoCancellation:!0,noiseSuppression:!0});const R=async()=>{try{if(E){_&&console.log("[WebRTC] Using existing local stream");const a=E.getAudioTracks();if(a.length===0||!a[0].enabled)_&&console.log("[WebRTC] Existing stream has no active audio tracks, requesting new stream"),E.getTracks().forEach(h=>h.stop()),E=null;else return E}_&&console.log("[WebRTC] Requesting access to microphone with specific constraints");const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:2},video:!1});if(e.getAudioTracks().length===0)throw console.error("[WebRTC] No audio tracks found in stream"),new Error("No audio tracks available");return _&&(console.log("[WebRTC] Local stream acquired successfully"),console.log("[WebRTC] Audio tracks:",e.getAudioTracks().length),e.getAudioTracks().forEach(h=>{console.log(`[WebRTC] Track: ${h.label}, enabled: ${h.enabled}, muted: ${h.muted}, readyState: ${h.readyState}`),console.log("[WebRTC] Track settings:",JSON.stringify(h.getSettings()))})),e.getTracks().forEach(a=>{a.enabled=!0}),E=e,k.value=e,e}catch(e){console.error("[WebRTC] Error accessing microphone:",e);try{_&&console.log("[WebRTC] Trying fallback with simpler constraints");const a=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});if(a.getAudioTracks().length===0)throw new Error("No audio tracks available");return E=a,k.value=a,a}catch(a){throw console.error("[WebRTC] Fallback also failed:",a),new Error("Could not access microphone. Please check permissions.")}}},D=()=>{if(d)try{d.close(),d=null,A&&(A.getTracks().forEach(e=>{e.stop()}),A=null)}catch(e){console.error("[WebRTC] Error cleaning up old peer connection:",e)}try{const e=new RTCPeerConnection(eo);return e.onnegotiationneeded=async a=>{if(_&&console.log("[WebRTC] Negotiation needed event",a),!ao(e)||q){_&&console.log("[WebRTC] Skipping negotiation - already in progress or not in stable state");return}q=!0;try{_&&console.log("[WebRTC] Starting negotiation"),de()}catch(h){console.error("[WebRTC] Negotiation error:",h),te=`Negotiation error: ${h}`,q=!1}},e.oniceconnectionstatechange=()=>{_&&console.log("[WebRTC] ICE Connection state changed to:",e.iceConnectionState),e.iceConnectionState==="connected"||e.iceConnectionState==="completed"?(te="",L=0,F(),no(),we("connected")):(e.iceConnectionState==="failed"||e.iceConnectionState==="disconnected"||e.iceConnectionState==="closed")&&(e.iceConnectionState==="failed"&&(te="ICE connection failed",console.error("[WebRTC] ICE Connection failed")),e.iceConnectionState!=="closed"?!ie&&L<ee?(console.log(`[WebRTC] Attempting ICE restart, attempt ${L+1} of ${ee}`),O()):L>=ee&&(console.error("[WebRTC] Max connection retry attempts reached, giving up"),we("failed"),L=0,te="Max retries reached, connection failed",i()):we("closed")),V.value=e.iceConnectionState},e.onicecandidate=a=>{var h;a.candidate?(_&&console.log("[WebRTC] New ICE candidate:",a.candidate),window.__localIceCandidates||(window.__localIceCandidates=[]),window.__localIceCandidates.push(a.candidate),r.value?(h=o.value)==null||h.emit("webrtc-signal",{type:"ice-candidate",candidate:a.candidate,to:r.value}):(Z.push(a.candidate),_&&console.log("[WebRTC] Storing ICE candidate for later. Total pending:",Z.length))):(_&&console.log("[WebRTC] ICE gathering complete"),Z.length>0&&r.value&&(Z.forEach(v=>{var u;(u=o.value)==null||u.emit("webrtc-signal",{type:"ice-candidate",candidate:v,to:r.value})}),_&&console.log(`[WebRTC] Sent ${Z.length} pending ICE candidates`),Z=[]))},e.onicegatheringstatechange=()=>{_&&console.log("[WebRTC] ICE gathering state changed to:",e.iceGatheringState)},e.onconnectionstatechange=()=>{_&&console.log("[WebRTC] Connection state changed to:",e.connectionState),we(e.connectionState),e.connectionState==="connected"?(te="",L=0):(e.connectionState==="failed"||e.connectionState==="disconnected"||e.connectionState==="closed")&&e.connectionState==="failed"&&!te&&(te="PeerConnection failed")},e.onsignalingstatechange=()=>{_&&console.log("[WebRTC] Signaling state changed to:",e.signalingState),e.signalingState==="stable"&&(q=!1)},e.ontrack=a=>{_&&console.log("[WebRTC] Track received:",a.track),A||(A=new MediaStream,f.value=A,console.log("[WebRTC] Created new remote stream")),A.addTrack(a.track),console.log(`[WebRTC] Added ${a.track.kind} track to remote stream, now has ${A.getTracks().length} tracks`),setTimeout(()=>{if(A){const h=A.getTracks();console.log(`[WebRTC] Remote stream has ${h.length} tracks after adding`),h.forEach(v=>{console.log(`[WebRTC] Track: ${v.kind}, enabled: ${v.enabled}, muted: ${v.muted}, readyState: ${v.readyState}`),v.kind==="audio"&&(!v.enabled||v.muted)&&(console.log("[WebRTC] ðŸ”´ Found disabled or muted audio track, enabling it"),v.enabled=!0)})}},500),_&&(a.track.onunmute=()=>{console.log("[WebRTC] Track unmuted:",a.track.kind)},a.track.onmute=()=>{console.log("[WebRTC] Track muted:",a.track.kind),a.track.enabled=!0},a.track.onended=()=>{console.log("[WebRTC] Track ended:",a.track.kind)})},ye(e),d=e,e}catch(e){throw console.error("[WebRTC] Error creating peer connection:",e),J=`Creation error: ${e}`,te="Failed to create connection",we("failed"),e}},S=async e=>{if(window.__webrtcConnectionTimeout&&clearTimeout(window.__webrtcConnectionTimeout),!e){const a="Cannot create offer: No target partner ID provided";return console.error(`[WebRTC] ${a}`),J=a,{error:a}}if(!o.value){const a="Cannot create offer: socket not available";return console.error(`[WebRTC] ${a}`),J=a,{error:a}}if(!E)try{_&&console.log("[WebRTC] Initializing local stream before creating offer"),await R()}catch(a){return console.error("[WebRTC] Failed to initialize local stream:",a),J=`Failed to access microphone: ${a}`,{error:`Failed to access microphone: ${a}`}}if(console.log(`[WebRTC] Creating offer for partner: ${e}`),q)return console.warn("[WebRTC] Negotiation already in progress, deferring new offer"),new Promise(a=>{setTimeout(async()=>{a(q?{waiting:"Negotiation in progress"}:await S(e))},1e3)});q=!0,Ce.value=e,r.value=e;try{_&&console.log(`[WebRTC] Setting partner ID: ${e}`);const a=D();if(E){_&&(console.log("[WebRTC] Adding local tracks to connection"),console.log(`[WebRTC] Local stream has ${E.getTracks().length} tracks`));const v=E;if(a.getSenders().length>0){_&&console.log("[WebRTC] Replacing existing senders");let u=0;v.getTracks().forEach($=>{a.getSenders()[u]?(a.getSenders()[u].replaceTrack($),u++):a.addTrack($,v)})}else v.getTracks().forEach(u=>{a.addTrack(u,v)})}else if(console.error("[WebRTC] No local stream to add tracks from"),await R(),E){const v=E;v.getTracks().forEach(u=>{a.addTrack(u,v)})}V.value="connecting",n.value="connecting",_&&console.log("[WebRTC] Creating offer");const h=await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1});return _&&console.log("[WebRTC] Setting local description"),await a.setLocalDescription(h),o.value&&e&&(_&&console.log("[WebRTC] Sending immediate offer using Trickle ICE"),o.value.emit("voice-offer",{offer:a.localDescription,to:e}),o.value.emit("webrtc-signal",{type:"offer",offer:a.localDescription,to:e})),ye(a),F(),_&&console.log("[WebRTC] Offer creation complete"),{success:!0}}catch(a){return console.error("[WebRTC] Error creating offer:",a),J=`Error creating offer: ${a}`,q=!1,{error:`Failed to create offer: ${a}`}}finally{setTimeout(()=>{q=!1},2e3)}},W=e=>e.iceGatheringState==="complete"?(console.log("[WebRTC] ICE gathering already complete"),Promise.resolve()):new Promise(a=>{const h=()=>{e.iceGatheringState==="complete"&&(e.removeEventListener("icegatheringstatechange",h),a())};e.addEventListener("icegatheringstatechange",h),setTimeout(()=>{e.removeEventListener("icegatheringstatechange",h),console.log("[WebRTC] ICE gathering timed out, but continuing anyway"),a()},1e3)}),U=async(e,a)=>{if(!o.value){console.error("[WebRTC] Cannot handle offer: socket not available");return}console.log("[WebRTC] Received offer from:",a),console.log("[WebRTC] Offer SDP:",e.sdp),Ce.value=a,r.value=a;try{E||(_&&console.log("[WebRTC] Initializing local stream before handling offer"),await R());const h=D();if(E&&(h.getSenders().length===0?(_&&console.log("[WebRTC] Adding local tracks to connection"),E.getTracks().forEach($=>{h.addTrack($,E)})):_&&console.log("[WebRTC] Senders already exist, not adding tracks again")),V.value="connecting",n.value="connecting",_&&console.log("[WebRTC] Setting remote description (offer)"),await h.setRemoteDescription(new RTCSessionDescription(e)),Z.length>0){_&&console.log(`[WebRTC] Adding ${Z.length} pending ICE candidates`);for(const u of Z)try{await h.addIceCandidate(u)}catch($){console.error("[WebRTC] Error adding pending ICE candidate:",$)}Z=[]}_&&console.log("[WebRTC] Creating answer");const v=await h.createAnswer({offerToReceiveAudio:!0});_&&console.log("[WebRTC] Answer SDP:",v.sdp),_&&console.log("[WebRTC] Setting local description (answer)"),await h.setLocalDescription(v),h.getTransceivers().forEach(u=>{if(u.receiver.track.kind==="audio"&&(console.log("[WebRTC] Ensuring audio transceiver is set to receive"),u.direction!=="sendrecv"&&u.direction!=="recvonly"))try{u.direction="sendrecv"}catch($){console.error("[WebRTC] Could not update transceiver direction:",$)}}),await W(h),_&&console.log("[WebRTC] Sending answer to:",a),o.value.emit("voice-answer",{answer:h.localDescription,to:a}),o.value.emit("webrtc-signal",{type:"answer",answer:h.localDescription,to:a}),ye(h),F(),_&&console.log("[WebRTC] Offer handling and answer creation complete")}catch(h){console.error("[WebRTC] Error handling offer:",h),J=`Error handling offer: ${h}`,setTimeout(()=>{o.value&&r.value&&(console.log("[WebRTC] Re-negotiating after offer error"),S(r.value))},2e3)}},N=async e=>{try{if(!d){_&&console.log("[WebRTC] Cannot handle answer: no peer connection available");return}const a=d.signalingState;if(_&&console.log(`[WebRTC] Current signaling state before handling answer: ${a}`),a==="have-local-offer"){_&&console.log("[WebRTC] Setting remote description from answer");try{await d.setRemoteDescription(new RTCSessionDescription(e)),_&&console.log("[WebRTC] Remote description set successfully, signaling state now: "+d.signalingState)}catch(h){if(console.error("[WebRTC] Error setting remote description:",h),h.toString().includes("InvalidStateError"))if(console.warn("[WebRTC] Invalid state error, attempting to recover"),await new Promise(v=>setTimeout(v,1e3)),d.signalingState==="have-local-offer")try{_&&console.log("[WebRTC] Retrying set remote description after delay"),await d.setRemoteDescription(new RTCSessionDescription(e)),_&&console.log("[WebRTC] Remote description set successfully on retry")}catch(v){console.error("[WebRTC] Final error setting remote description:",v)}else console.warn(`[WebRTC] Cannot set remote answer, wrong state: ${d.signalingState}`)}}else console.warn(`[WebRTC] Cannot set remote description: wrong signaling state: ${a}`),a==="stable"?_&&console.log("[WebRTC] Already in stable state, ignoring answer"):a==="have-remote-offer"&&(console.warn("[WebRTC] We have a remote offer but received an answer - signaling confusion"),L<ee&&(L++,_&&console.log(`[WebRTC] Resetting connection due to signaling confusion (${L}/${ee})`),i(),setTimeout(()=>{r.value&&S(r.value)},2e3)))}catch(a){console.error("[WebRTC] Error handling answer:",a),J=`Error handling answer: ${a}`,console.log("[WebRTC] Attempting to recover from answer error"),L<ee&&await O()}},G=async()=>{if(!se.value)return console.log("[WebRTC] Muting microphone - stopping all tracks"),E&&(E.getAudioTracks().forEach(a=>{a.stop()}),E=null,k.value=null),se.value=!0,!1;console.log("[WebRTC] Unmuting microphone - requesting new permission");try{E&&(E.getTracks().forEach(h=>h.stop()),E=null,k.value=null);const a=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1});if(a.getAudioTracks().length===0)throw new Error("No audio tracks available");if(E=a,k.value=a,d&&a)try{const v=d.getSenders().find(u=>u.track&&u.track.kind==="audio");if(v){const u=a.getAudioTracks()[0];u&&v.replaceTrack(u)}else a.getAudioTracks().length>0&&a.getAudioTracks().forEach(u=>{d&&d.addTrack(u,a)})}catch(h){console.error("[WebRTC] Error adding audio tracks:",h)}return se.value=!1,!0}catch(a){console.error("[WebRTC] Error unmuting microphone:",a);try{const h=await navigator.mediaDevices.getUserMedia({audio:!0});return E=h,k.value=h,se.value=!1,!0}catch(h){return console.error("[WebRTC] Fallback microphone access also failed:",h),!1}}},i=()=>{if(console.log("[WebRTC] Closing connection"),Y(),d){try{d.ontrack=null,d.onicecandidate=null,d.oniceconnectionstatechange=null,d.onicegatheringstatechange=null,d.onsignalingstatechange=null,d.onconnectionstatechange=null;try{d.getTransceivers&&d.getTransceivers().forEach(e=>{e.stop&&e.stop()})}catch{}d.close(),_&&console.log("[WebRTC] Peer connection closed")}catch(e){console.error("[WebRTC] Error closing peer connection:",e)}d=null}A&&(A.getTracks().forEach(e=>{e.stop()}),A=new MediaStream,f.value=A),V.value="closed",n.value="closed"},w=()=>{console.log("[WebRTC] Full cleanup initiated"),i(),E&&(console.log("[WebRTC] Stopping local stream tracks"),E.getTracks().forEach(e=>{e.stop()}),E=null,k.value=null),console.log("[WebRTC] Cleanup complete")};function y(){if(!o.value){console.log("[WebRTC] No socket available, cannot set up listeners");return}console.log("[WebRTC] Setting up socket listeners"),o.value.off("webrtc-signal"),o.value.off("ice-candidate"),o.value.off("partner-disconnected"),o.value.off("webrtc-connection-failed"),o.value.off("connection-timeout"),o.value.off("voice-offer"),o.value.off("voice-answer"),o.value.on("voice-offer",async e=>{console.log("[WebRTC] Received legacy voice-offer:",e),await U(e.offer,e.from)}),o.value.on("voice-answer",async e=>{console.log("[WebRTC] Received legacy voice-answer:",e),await N(e.answer)}),o.value.on("webrtc-signal",async e=>{if(console.log(`[WebRTC] Received ${e.type} signal from ${e.from}`),Ce.value=e.from,r.value=e.from,e.type==="offer"&&e.offer)try{await U(e.offer,e.from)}catch(a){console.error("[WebRTC] Error handling offer:",a),J=`Error handling offer: ${a}`,o.value&&o.value.emit("webrtc-connection-failed",{to:e.from,reason:`Failed to handle offer: ${a}`})}else if(e.type==="answer"&&e.answer)try{await N(e.answer)}catch(a){console.error("[WebRTC] Error handling answer:",a),J=`Error handling answer: ${a}`,o.value&&o.value.emit("webrtc-connection-failed",{to:e.from,reason:`Failed to handle answer: ${a}`})}}),o.value.on("ice-candidate",async e=>{if(console.log(`[WebRTC] Received ICE candidate from ${e.from}`),e.from!==r.value){console.log("[WebRTC] Ignoring ICE candidate from different partner");return}try{await xe(e.candidate)}catch(a){console.error("[WebRTC] Error handling ICE candidate:",a),J=`Error handling ICE candidate: ${a}`}}),o.value.on("webrtc-connection-failed",e=>{console.log(`[WebRTC] Connection failed notification from ${e.from}: ${e.reason}`),L<ee?(L++,console.log(`[WebRTC] Partner reported connection failure. Retry ${L}/${ee}`),e.from===r.value&&setTimeout(()=>{r.value&&o.value&&S(e.from)},oo)):(V.value="failed",J=`Partner reported failure: ${e.reason}`)}),o.value.on("partner-disconnected",()=>{console.log("[WebRTC] Partner disconnected"),i(),Ce.value=null,r.value=null,V.value="closed",q=!1,ie=!1,L=0})}y(),We(()=>{s.value=null,k.value=null,f.value=null});function I(){if(!d||!A)return console.log("[WebRTC] Cannot fix tracks: missing connection or stream"),!1;console.log("[WebRTC] Checking and fixing tracks");const e=d.getSenders();if(e.length===0&&E)console.log("[WebRTC] No senders found, re-adding local tracks"),E.getTracks().forEach(h=>{d==null||d.addTrack(h,E)});else if(e.length>0&&E){console.log(`[WebRTC] Found ${e.length} senders, checking state`);const h=E.getTracks();e.forEach(v=>{if(v.track&&v.track.readyState!=="live"){const u=h.find($=>{var Q;return $.kind===((Q=v.track)==null?void 0:Q.kind)});u&&(console.log("[WebRTC] Replacing inactive track with active one"),v.replaceTrack(u))}})}const a=d.getReceivers();if(a.length>0){console.log(`[WebRTC] Found ${a.length} receivers`);let h=!1;a.forEach(v=>{v.track&&v.track.kind==="audio"&&(h=!0,!(A!=null&&A.getTracks().some($=>{var Q;return $.id===((Q=v.track)==null?void 0:Q.id)}))&&A&&(console.log("[WebRTC] Adding missing track to remote stream"),A.addTrack(v.track)))}),h||console.log("[WebRTC] No audio receivers found!")}M(),C()}function C(){var h;if(console.log("[WebRTC] ðŸ” Diagnosing audio connection issues"),!d)return console.log("[WebRTC] ðŸ”´ No peer connection exists"),!1;console.log(`[WebRTC] Connection state: ${d.connectionState}`),console.log(`[WebRTC] ICE connection state: ${d.iceConnectionState}`),console.log(`[WebRTC] Signaling state: ${d.signalingState}`);const e=d.getReceivers();console.log(`[WebRTC] Connection has ${e.length} receivers`);let a=!1;if(d.getStats().then(v=>{v.forEach(u=>{u.type==="inbound-rtp"&&u.kind==="audio"&&(console.log("[WebRTC] Audio receiver stats:",u),u.packetsReceived===0||u.bytesReceived===0?console.log("[WebRTC] ðŸ”´ Warning: No audio packets received!"):console.log(`[WebRTC] âœ… Receiving audio: ${u.packetsReceived} packets, ${u.bytesReceived} bytes`))})}).catch(v=>console.error("[WebRTC] Error getting stats:",v)),e.forEach((v,u)=>{const $=v.track;$&&$.kind==="audio"&&(a=!0,console.log(`[WebRTC] Audio receiver ${u} - Track: ${$.label}, enabled: ${$.enabled}, muted: ${$.muted}, readyState: ${$.readyState}`),(!$.enabled||$.muted)&&(console.log("[WebRTC] ðŸŸ  Found disabled/muted audio track, enabling it"),$.enabled=!0),$.onmute=()=>{console.log("[WebRTC] Track muted event - automatically unmuting"),$.enabled=!0},$.onended=()=>{console.log("[WebRTC] Track ended event - attempting to recreate connection"),!ie&&d&&d.connectionState==="connected"&&O()})}),!a){console.log("[WebRTC] ðŸ”´ No audio receivers found. Remote party may not be sending audio.");const v=d.getTransceivers();let u=!1;v.forEach($=>{if(console.log(`[WebRTC] Transceiver direction: ${$.direction}, currentDirection: ${$.currentDirection}`),$.direction==="sendonly"||$.direction==="inactive")try{console.log("[WebRTC] ðŸŸ  Fixing transceiver direction to sendrecv"),$.direction="sendrecv",u=!0}catch(Q){console.error("[WebRTC] Error updating transceiver direction:",Q)}}),u&&!q&&(console.log("[WebRTC] Triggering renegotiation after fixing transceivers"),de()),d.connectionState==="connected"&&(console.log("[WebRTC] ðŸŸ  Connection is established but no audio receivers. Checking SDP parameters..."),!q&&r.value&&(console.log("[WebRTC] Trying to recover audio by sending refresh signal"),(h=o.value)==null||h.emit("webrtc-signal",{type:"refresh-tracks",to:r.value})))}if(E){const v=E.getAudioTracks();console.log(`[WebRTC] Local stream has ${v.length} audio tracks`),v.length===0?(console.log("[WebRTC] ðŸ”´ No local audio tracks! Trying to reinitialize microphone..."),R().then(()=>{d&&d.connectionState==="connected"&&(console.log("[WebRTC] Added new local audio tracks, restarting connection"),de())}).catch(u=>console.error("[WebRTC] Failed to reinitialize local stream:",u))):v.forEach((u,$)=>{console.log(`[WebRTC] Local audio track ${$}: ${u.label}, enabled: ${u.enabled}, muted: ${u.muted}, readyState: ${u.readyState}`),!u.enabled&&!se.value&&(console.log("[WebRTC] ðŸŸ  Local track disabled but not muted by user, enabling it"),u.enabled=!0)})}else console.log("[WebRTC] ðŸ”´ No local stream available");if(A){const v=A.getAudioTracks();if(console.log(`[WebRTC] Remote stream has ${v.length} audio tracks`),v.forEach((u,$)=>{console.log(`[WebRTC] Remote audio track ${$}: ${u.label}, enabled: ${u.enabled}, muted: ${u.muted}, readyState: ${u.readyState}`),(!u.enabled||u.muted)&&(console.log("[WebRTC] ðŸŸ  Found disabled remote audio track, enabling it"),u.enabled=!0),u.readyState!=="live"&&(console.log("[WebRTC] ðŸ”´ Remote track not live! ReadyState:",u.readyState),d&&Array.from(d.getReceivers()).find(Se=>Se.track&&Se.track.id===u.id)||(console.log("[WebRTC] Remote track not found in receivers, attempting to recreate connection"),d&&d.connectionState==="connected"&&!q&&de()))}),v.length===0){console.log("[WebRTC] ðŸ”´ No audio tracks in remote stream. Checking for receivers...");const u=d?Array.from(d.getReceivers()).filter($=>$.track&&$.track.kind==="audio"):[];u.length>0&&(console.log("[WebRTC] Found audio receivers but they are not in remote stream. Adding them now."),u.forEach($=>{$.track&&A&&(console.log("[WebRTC] Adding track from receiver to remote stream:",$.track.id),A.addTrack($.track))}),f.value=A)}}else if(d&&d.getReceivers().length>0){console.log("[WebRTC] ðŸ”´ No remote stream but receivers exist! Creating new remote stream"),A=new MediaStream;const v=Array.from(d.getReceivers()).filter(u=>u.track&&u.track.kind==="audio");v.length>0&&v.forEach(u=>{u.track&&A&&(console.log("[WebRTC] Adding track to new remote stream:",u.track.id),A.addTrack(u.track))}),f.value=A}else console.log("[WebRTC] ðŸ”´ No remote stream or receivers available");return setTimeout(()=>{const v=document.querySelectorAll("audio");v.length>0&&A&&(console.log(`[WebRTC] Found ${v.length} audio elements, ensuring they use remote stream`),Array.from(v).forEach((u,$)=>{u.srcObject!==A&&(console.log(`[WebRTC] Audio element ${$} not using correct stream, updating`),u.srcObject=A,u.muted=!1,u.volume=1,u.play().catch(Q=>console.log("[WebRTC] Error playing audio:",Q)))}))},100),setTimeout(I,3e3),!0}async function O(){if(!(!d||!r.value)){console.log("[WebRTC] Attempting connection recovery");try{if(ie=!0,pe===ut?(pe=Ze,console.log("[WebRTC] Switching to fast configuration for quicker connection")):L>5&&(pe=Qe,console.log("[WebRTC] Switching to TURN-only configuration")),d.restartIce){d.restartIce();const e=await d.createOffer({iceRestart:!0,offerToReceiveAudio:!0});await d.setLocalDescription(e),o.value&&(o.value.emit("offer",{offer:d.localDescription,to:r.value}),o.value.emit("webrtc-signal",{type:"offer",offer:d.localDescription,to:r.value}))}setTimeout(()=>{ie=!1},500)}catch(e){console.error("[WebRTC] Recovery attempt failed:",e),ie=!1,L<ee&&setTimeout(()=>{i(),r.value&&S(r.value)},200)}}}function M(){typeof window<"u"&&(window.__webrtc_debug={connectionState:V.value,connectionRetryCount:L,lastConnectionError:J,failureReason:te,isNegotiating:q,isRestartingIce:ie,pendingCandidates:Z.length,hasLocalTracks:E?E.getAudioTracks().length>0:!1,hasRemoteTracks:A?A.getAudioTracks().length>0:!1})}K(()=>V.value,()=>{M()});function F(){me&&clearInterval(me),typeof window<"u"&&(window.__localIceCandidates=[],window.__remoteIceCandidates=[],window.__iceCandidatePairs=[]),d&&(d.onicecandidate=e=>{e.candidate&&(console.log("[WebRTC] ICE candidate generated:",e.candidate.candidate),typeof window<"u"&&(window.__localIceCandidates=window.__localIceCandidates||[],window.__localIceCandidates.push({candidate:e.candidate.candidate,timestamp:Date.now()})),o.value&&r.value&&(console.log("[WebRTC] Sending ICE candidate to partner"),o.value.emit("ice-candidate",{candidate:e.candidate,to:r.value})))}),me=window.setInterval(async()=>{if(!d||V.value!=="connecting"&&V.value!=="connected"){Y();return}try{const e=await dt();e&&e.iceCandidatePairs&&typeof window<"u"&&(window.__iceCandidatePairs=e.iceCandidatePairs),Ie(e)}catch(e){console.error("[WebRTC] Error monitoring connection:",e)}},to)}function Y(){me&&(clearInterval(me),me=null)}function Ie(e){if(!e||e.error)return;const a=!e.media||e.media.length===0||!e.media.some(v=>v.kind==="audio"&&v.audioLevel>0),h=!e.selectedCandidatePair||e.selectedCandidatePair.state!=="succeeded";(a||h)&&(console.log("[WebRTC] Connection health issues detected, trying to fix..."),I(),V.value==="connected"&&L<ee&&(L++,console.log(`[WebRTC] Attempting connection improvement (${L}/${ee})`),d&&d.getTransceivers&&d.getTransceivers().forEach(v=>{v.sender&&v.sender.track&&v.sender.track.kind==="audio"&&v.sender.setParameters({...v.sender.getParameters(),degradationPreference:"maintain-framerate"})})))}function ye(e){if(!r.value)return;window.__webrtcConnectionTimeout&&clearTimeout(window.__webrtcConnectionTimeout);const a=5e3;window.__webrtcConnectionTimeout=setTimeout(()=>{(e.connectionState==="connecting"||e.connectionState==="new")&&(console.log(`[WebRTC] Connection not established after ${a/1e3} seconds, trying fast config`),pe=Ze,r.value&&!q&&S(r.value),window.__webrtcConnectionTimeout=setTimeout(()=>{var h,v,u;if(e.connectionState==="connecting"||e.connectionState==="new"){console.log("[WebRTC] Connection still not established, trying TURN-only config");const $={localCandidates:((h=window.__localIceCandidates)==null?void 0:h.length)||0,remoteCandidates:((v=window.__remoteIceCandidates)==null?void 0:v.length)||0,iceCandidatePairsCount:((u=window.__iceCandidatePairs)==null?void 0:u.length)||0};console.log("[WebRTC] Connection diagnostic info:",JSON.stringify($)),pe=Qe,i(),r.value&&setTimeout(()=>{S(r.value)},200)}},5e3))},a)}const xe=async e=>{if(!d){console.log("[WebRTC] Received ICE candidate but no peer connection exists");return}try{if(_&&console.log("[WebRTC] Adding received ICE candidate:",e.candidate),window.__remoteIceCandidates||(window.__remoteIceCandidates=[]),window.__remoteIceCandidates.push(e),!d.remoteDescription||!d.localDescription){_&&console.log("[WebRTC] Delaying ICE candidate addition until descriptions are set"),setTimeout(async()=>{if(d&&d.remoteDescription){_&&console.log("[WebRTC] Adding delayed ICE candidate after timeout");try{await d.addIceCandidate(e)}catch(a){console.error("[WebRTC] Error adding delayed ICE candidate:",a)}}},1e3);return}await d.addIceCandidate(e),_&&console.log("[WebRTC] Successfully added ICE candidate")}catch(a){console.error("[WebRTC] Error adding ICE candidate:",a),J=`Error adding ICE candidate: ${a}`,setTimeout(async()=>{if(d&&d.remoteDescription){console.log("[WebRTC] Retrying to add ICE candidate after error");try{await d.addIceCandidate(e),_&&console.log("[WebRTC] Successfully added ICE candidate on retry")}catch(h){console.error("[WebRTC] Error adding ICE candidate on retry:",h)}}},2e3)}};function de(){if(!d||!r.value||q){console.log("[WebRTC] Cannot start negotiation: missing connection, partner ID, or already negotiating");return}console.log("[WebRTC] Starting new negotiation"),q=!0;try{d.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1}).then(e=>{if(d)return d.setLocalDescription(e)}).then(()=>{!d||!o.value||!r.value||(o.value.emit("voice-offer",{offer:d.localDescription,to:r.value}),_&&console.log("[WebRTC] Sent renegotiation offer"))}).catch(e=>{console.error("[WebRTC] Error during negotiation:",e)}).finally(()=>{setTimeout(()=>{q=!1},2e3)})}catch(e){console.error("[WebRTC] Failed to start negotiation:",e),q=!1}}const Re={connectionState:V.value,iceCandidatesGenerated:Z.length,localStreamActive:!!E&&E.active,remoteStreamActive:!!A&&A.active,localTracks:E?E.getAudioTracks().length:0,remoteTracks:A?A.getAudioTracks().length:0,connectionRetries:L,lastError:J||te||"",isAudioMuted:se.value,forceReconnect:()=>d&&V.value!=="new"?(O(),!0):!1};return{socket:o,peerConnection:s,remoteStream:f,localStream:k,connectionState:n,isAudioMuted:g,partnerId:r,createOffer:S,handleOffer:U,handleAnswer:N,handleIceCandidate:xe,toggleMicrophone:G,closeConnection:i,initializeLocalStream:R,cleanup:w,diagnosticReport:Re}}function ao(o){return o.signalingState==="stable"||o.signalingState==="have-remote-offer"}function we(o){V.value!==o&&(console.log(`[WebRTC] Connection state changing from ${V.value} to ${o}`),V.value=o,o==="connected"||o==="completed"?(te="",J="",L=0,console.log("[WebRTC] Connection established successfully")):(o==="failed"||o==="disconnected")&&(console.warn(`[WebRTC] Connection ${o}: ${te||"Unknown reason"}`),o==="failed"&&(L++,console.log(`[WebRTC] Connection failure count: ${L}/${ee}`))))}function lo(){const o="test";try{return localStorage.setItem(o,o),localStorage.removeItem(o),!0}catch(m){return console.error("localStorage is not available:",m),!1}}function ro(){const o=x(lo());function m(n,g){if(!o.value){console.warn("localStorage is not available, cannot set item");return}try{localStorage.setItem(n,g)}catch(r){console.error("Failed to set localStorage item:",r)}}function s(n){if(!o.value)return console.warn("localStorage is not available, cannot get item"),null;try{return localStorage.getItem(n)}catch(g){return console.error("Failed to get localStorage item:",g),null}}function k(n){if(!o.value){console.warn("localStorage is not available, cannot remove item");return}try{localStorage.removeItem(n)}catch(g){console.error("Failed to remove localStorage item:",g)}}function f(){if(!o.value){console.warn("localStorage is not available, cannot clear storage");return}try{localStorage.clear()}catch(n){console.error("Failed to clear localStorage:",n)}}return{isAvailable:o,setItem:m,getItem:s,removeItem:k,clear:f}}const H=x({}),Te=x(null),le=x({}),$e=x(!1),je=!0;let ot=!1;function so(){const{socket:o,userId:m}=ke(),s=ro();ot?console.log("[ChatService] Using existing chat service instance"):(console.log("[ChatService] Initializing chat service"),k(),ot=!0);function k(){f(),U(),K(H,()=>{W()},{deep:!0}),K(()=>o.value,i=>{i&&!$e.value&&(console.log("[ChatService] Socket reconnected, setting up listeners again"),f())})}function f(){if(!o.value){console.log("[ChatService] No socket available, cannot set up listeners");return}$e.value&&(console.log("[ChatService] Removing existing chat-message listener"),o.value.off("chat-message"),$e.value=!1),console.log("[ChatService] Setting up chat-message listener"),o.value.on("chat-message",i=>{console.log("[ChatService] Received chat message:",i);const w=i.from,y=S(w);console.log(`[ChatService] Conversation key: ${y}, current partner: ${Te.value}`),H.value[y]||(H.value[y]=[]),H.value[y].push({sender:"partner",text:i.text,timestamp:i.timestamp||Date.now()}),w!==Te.value&&(le.value[w]=!0,console.log(`[ChatService] Marked message from ${w} as unread`)),W(),console.log("[ChatService] Updated messages:",H.value[y])}),$e.value=!0,console.log("[ChatService] Chat message listener setup complete")}function n(i){console.log(`[ChatService] Setting current partner: ${i}`),Te.value=i,i&&(le.value[i]=!1)}function g(i,w=null){const y=w||Te.value;if(!y||!i.trim()||!o.value)return console.log(`[ChatService] Cannot send message: partnerId=${y}, text=${i.trim()?"present":"empty"}, socket=${o.value?"present":"not present"}`),!1;console.log(`[ChatService] Sending message to ${y}: ${i}`);const I=S(y);H.value[I]||(H.value[I]=[]);const C=Date.now();return H.value[I].push({sender:"me",text:i.trim(),timestamp:C}),o.value.emit("chat-message",{text:i.trim(),to:y}),console.log("[ChatService] Message sent, current messages:",H.value[I]),!0}function r(i){if(!i)return[];const w=S(i),y=H.value[w]||[];return console.log(`[ChatService] Getting messages for ${i}, found ${y.length} messages`),y}function R(i){if(!i)return!1;const w=!!le.value[i];return console.log(`[ChatService] Checking unread for ${i}: ${w}`),w}function D(i){i&&(console.log(`[ChatService] Marking messages as read for ${i}`),le.value[i]=!1)}function S(i){if(!m.value)return i;const w=[m.value,i].sort();return`${w[0]}_${w[1]}`}function W(){if(!s.isAvailable.value){console.log("[ChatService] localStorage not available, cannot save chats");return}try{s.setItem("chat_messages",JSON.stringify(H.value)),s.setItem("chat_unread",JSON.stringify(le.value)),je&&console.log("[ChatService] Saved chats to localStorage")}catch(i){console.error("[ChatService] Failed to save chats:",i)}}function U(){if(!s.isAvailable.value){console.log("[ChatService] localStorage not available, cannot load chats");return}try{const i=s.getItem("chat_messages");i&&(H.value=JSON.parse(i),je&&console.log("[ChatService] Loaded messages from localStorage:",Object.keys(H.value).length,"conversations"));const w=s.getItem("chat_unread");w&&(le.value=JSON.parse(w),je&&console.log("[ChatService] Loaded unread status from localStorage"))}catch(i){console.error("[ChatService] Failed to load chats:",i)}}function N(i){if(!i)return;const w=S(i);H.value[w]&&(H.value[w]=[],W(),console.log(`[ChatService] Cleared chat for ${i}`))}function G(){H.value={},le.value={},W(),console.log("[ChatService] Cleared all chats")}return{messages:H,unreadMessages:le,currentPartnerId:Te,setCurrentPartner:n,sendMessage:g,getMessages:r,hasUnreadMessages:R,markAsRead:D,clearChat:N,clearAllChats:G}}const io={class:"bg-white/5 backdrop-blur-sm rounded-2xl p-6 text-center border border-white/10"},co={key:0},uo={key:1},fo={class:"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-yellow-500 to-green-500 rounded-full flex items-center justify-center animate-pulse"},go={key:0,class:"text-2xl"},vo={key:1,class:"text-2xl"},mo={class:"text-lg font-semibold mb-2 text-yellow-400"},po={key:0,class:"flex items-center justify-center gap-2 text-gray-300"},bo={class:"text-xl"},ho={class:"text-sm font-medium"},yo={key:2},xo={class:"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center"},Co={key:0,class:"text-2xl"},wo={key:1,class:"text-2xl"},To={class:"text-lg font-semibold mb-2"},ko={key:0,class:"flex items-center justify-center gap-2 text-gray-300"},Ro={class:"text-xl"},So={class:"text-sm font-medium"},_o={key:3},$o={key:4,class:"mt-4 text-xs"},Wo={class:"flex items-center justify-center gap-2"},Io={key:0,class:"text-red-400 mt-1 text-xs"},Eo=oe({__name:"connection-card",props:{status:{type:String,default:"disconnected"},partnerInfo:{type:Object,default:null},errorMessage:{type:String,default:""},showStatus:{type:Boolean,default:!0}},setup(o){const m=o,s=ce(()=>{switch(m.status){case"searching":return"Searching...";case"matched":return"Partner found, connecting...";case"connected":return"Connected";default:return"Disconnected"}}),k=f=>{switch(f.toLowerCase()){case"any":return"Go With the Flow";case"chill":return"Chill";case"fun":return"Fun";case"curious":return"Curious";case"creative":return"Creative";default:return f}};return(f,n)=>{var g,r,R,D;return p(),b("div",io,[o.status==="searching"?(p(),b("div",co,n[0]||(n[0]=[t("div",{class:"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center animate-pulse"},[t("div",{class:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"})],-1),t("h2",{class:"text-lg font-semibold mb-2"},"Searching...",-1),t("p",{class:"text-sm text-gray-300"},"Looking for someone to talk to",-1)]))):o.status==="matched"?(p(),b("div",uo,[t("div",fo,[(g=o.partnerInfo)!=null&&g.flag?(p(),b("span",go,j(o.partnerInfo.flag),1)):(p(),b("span",vo,"ðŸ”„"))]),t("h2",mo,j((r=o.partnerInfo)!=null&&r.vibe?k(o.partnerInfo.vibe):"Match Found!"),1),o.partnerInfo?(p(),b("div",po,[t("span",bo,j(o.partnerInfo.flag||"ðŸŒ"),1),t("span",ho,j(o.partnerInfo.country),1)])):B("",!0),n[1]||(n[1]=t("p",{class:"text-sm text-yellow-400 mt-2"},"Setting up voice connection...",-1)),n[2]||(n[2]=t("div",{class:"mt-3 relative h-1.5 w-3/4 mx-auto bg-gray-700 rounded-full overflow-hidden"},[t("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-yellow-500 to-green-500 rounded-full animate-progress"})],-1))])):o.status==="connected"?(p(),b("div",yo,[t("div",xo,[(R=o.partnerInfo)!=null&&R.flag?(p(),b("span",Co,j(o.partnerInfo.flag),1)):(p(),b("span",wo,"ðŸ‘¥"))]),t("h2",To,j((D=o.partnerInfo)!=null&&D.vibe?k(o.partnerInfo.vibe):"Connected!"),1),o.partnerInfo?(p(),b("div",ko,[t("span",Ro,j(o.partnerInfo.flag||"ðŸŒ"),1),t("span",So,j(o.partnerInfo.country),1)])):B("",!0),n[3]||(n[3]=t("p",{class:"text-sm text-green-400 mt-2"},"You can talk now",-1))])):(p(),b("div",_o,n[4]||(n[4]=[t("div",{class:"w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-gray-600 to-gray-700 rounded-full flex items-center justify-center"},[t("span",{class:"text-2xl"},"ðŸŒŸ")],-1),t("h2",{class:"text-lg font-semibold mb-2"},"Ready to Connect",-1),t("p",{class:"text-sm text-gray-300"},'Press "Next" to find someone to talk with',-1)]))),o.showStatus&&o.status!=="disconnected"?(p(),b("div",$o,[t("div",Wo,[t("span",{class:z({"text-green-400":o.status==="connected","text-yellow-400":o.status==="matched","text-blue-400":o.status==="searching"})},"â—",2),t("span",null,j(s.value),1)]),o.errorMessage?(p(),b("p",Io,j(o.errorMessage),1)):B("",!0)])):B("",!0)])}}});const he=(o,m)=>{const s=o.__vccOpts||o;for(const[k,f]of m)s[k]=f;return s},Ao=he(Eo,[["__scopeId","data-v-51adf7ba"]]),Oo={class:"space-y-3 md:space-y-4 px-2"},Do={class:"flex justify-center items-center gap-3 md:gap-4"},jo=["disabled"],Mo={class:"relative"},Po={key:0,class:"text-white text-lg md:text-xl"},No={key:1,class:"text-white text-lg md:text-xl"},Fo={key:2,class:"absolute -top-1 -right-1 w-3 h-3 bg-yellow-300 rounded-full animate-pulse"},Lo=["disabled"],Bo={class:"flex flex-wrap justify-center gap-2 md:gap-3"},Uo=oe({__name:"control-buttons",props:{isMuted:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!0}},emits:["toggle-mute","find-next","toggle-chat","toggle-games","toggle-history","toggle-donation"],setup(o,{emit:m}){const s=m,k=x(!1);function f(){k.value||(k.value=!0,s("toggle-mute"),setTimeout(()=>{k.value=!1},200),setTimeout(()=>{try{const n=document.querySelector("audio");n&&n.paused&&n.play().catch(g=>{console.warn("Could not auto-play audio after mute toggle:",g)})}catch(n){console.error("Error trying to auto-play:",n)}},300))}return(n,g)=>(p(),b("div",Oo,[t("div",Do,[t("button",{onClick:f,class:z(["w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center transition-all shadow-xl transform hover:scale-110",o.isMuted?"bg-gradient-to-r from-red-400 to-pink-400 shadow-red-400/70":"bg-gradient-to-r from-emerald-400 to-green-400 hover:from-green-400 hover:to-emerald-400 shadow-emerald-400/70"]),disabled:k.value},[t("div",Mo,[o.isMuted?(p(),b("span",No,"ðŸ”‡")):(p(),b("span",Po,"ðŸŽ¤")),k.value?(p(),b("span",Fo)):B("",!0)])],10,jo),t("button",{onClick:g[0]||(g[0]=r=>n.$emit("find-next")),class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-r from-orange-400 to-yellow-400 hover:from-yellow-400 hover:to-orange-400 rounded-full flex items-center justify-center shadow-2xl shadow-orange-400/80 transition-all transform hover:scale-110"},g[5]||(g[5]=[t("span",{class:"text-white text-2xl md:text-3xl"},"ðŸ“ž",-1)])),t("button",{onClick:g[1]||(g[1]=r=>n.$emit("toggle-chat")),disabled:o.isDisabled,class:z(["w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center shadow-xl transition-all transform hover:scale-110",o.isDisabled?"bg-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-blue-400 to-cyan-400 hover:from-cyan-400 hover:to-blue-400 shadow-blue-400/70"])},g[6]||(g[6]=[t("span",{class:"text-white text-lg md:text-xl"},"ðŸ’¬",-1)]),10,Lo)]),t("div",Bo,[t("button",{onClick:g[2]||(g[2]=r=>n.$emit("toggle-games")),class:"bg-gradient-to-r from-purple-400 to-pink-400 hover:from-pink-400 hover:to-purple-400 rounded-full px-3 py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-purple-400/70 transition-all transform hover:scale-110"}," ðŸŽ® Games "),t("button",{onClick:g[3]||(g[3]=r=>n.$emit("toggle-history")),class:"bg-gradient-to-r from-indigo-400 to-blue-400 hover:from-blue-400 hover:to-indigo-400 rounded-full px-3 py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-indigo-400/70 transition-all transform hover:scale-110"}," ðŸ“ž History "),t("button",{onClick:g[4]||(g[4]=r=>n.$emit("toggle-donation")),class:"bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-orange-400 hover:to-yellow-400 rounded-full px-3 py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-yellow-400/70 transition-all animate-pulse transform hover:scale-110"}," â¤ï¸ Support ")])]))}}),Go={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},zo={class:"bg-gray-900 rounded-lg w-full max-w-md mx-auto h-[80vh] flex flex-col"},qo={class:"flex items-center justify-between p-4 border-b border-gray-700"},Vo={key:0,class:"h-full flex items-center justify-center text-gray-500"},Yo={key:1,class:"space-y-2"},Ho={class:"flex justify-between gap-2"},Xo={class:"text-xs text-gray-400"},Jo={class:"mt-1 text-white break-words"},Ko={class:"p-3 border-t border-gray-700"},Qo=["disabled"],Zo=["disabled"],en=oe({__name:"chat-modal",props:{isOpen:{type:Boolean,default:!1},isConnected:{type:Boolean,default:!1},messages:{type:Array,default:()=>[]}},emits:["close","send-message"],setup(o,{emit:m}){const s=o,k=m,f=x(""),n=x(null),g=()=>{f.value.trim()&&s.isConnected&&(k("send-message",f.value),f.value="")},r=async()=>{await rt(),n.value&&(n.value.scrollTop=n.value.scrollHeight)},R=D=>new Date(D).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return K(()=>s.messages,()=>{r()},{deep:!0}),K(()=>s.isOpen,D=>{D&&r()}),ue(()=>{s.isOpen&&r()}),(D,S)=>o.isOpen?(p(),b("div",Go,[t("div",zo,[t("div",qo,[S[2]||(S[2]=t("div",{class:"flex items-center"},[t("span",{class:"text-white text-lg font-medium"},"ðŸ’¬ Chat")],-1)),t("button",{onClick:S[0]||(S[0]=W=>D.$emit("close")),class:"text-gray-400 hover:text-white"}," âœ• ")]),t("div",{class:"flex-1 p-4 overflow-y-auto",ref_key:"messagesContainerRef",ref:n},[o.messages.length===0?(p(),b("div",Vo,S[3]||(S[3]=[t("div",{class:"text-center"},[t("p",null,"No messages yet"),t("p",{class:"text-sm mt-1"},"Send a message to start the conversation")],-1)]))):(p(),b("div",Yo,[(p(!0),b(ne,null,ae(o.messages,W=>(p(),b("div",{key:W.id,class:z(["rounded-lg p-3 max-w-[80%]",W.isOwn?"bg-blue-700 ml-auto":"bg-gray-700 mr-auto"])},[t("div",Ho,[t("span",{class:z(["text-sm",W.isOwn?"text-blue-200":"text-gray-200"])},j(W.isOwn?"You":"Partner"),3),t("span",Xo,j(R(W.timestamp)),1)]),t("p",Jo,j(W.message),1)],2))),128))]))],512),t("div",Ko,[t("form",{onSubmit:Lt(g,["prevent"]),class:"flex gap-2"},[lt(t("input",{"onUpdate:modelValue":S[1]||(S[1]=W=>f.value=W),type:"text",placeholder:"Type a message...",class:"flex-1 bg-gray-800 border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!o.isConnected},null,8,Qo),[[Bt,f.value]]),t("button",{type:"submit",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",disabled:!o.isConnected||!f.value.trim()}," Send ",8,Zo)],32)])])])):B("",!0)}}),tn={class:"w-full p-2"},on={class:"flex justify-between items-center mb-4"},nn={key:0,class:"text-yellow-300 animate-pulse"},an={key:1},ln={key:2},rn={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 mb-4"},sn={class:"mb-4 text-center"},cn={class:"flex items-center justify-center gap-4"},un={class:"text-center"},dn={class:"grid grid-cols-3 gap-3 mb-4"},fn=["onClick","disabled"],gn={key:0,class:"text-blue-400"},vn={key:1,class:"text-green-400"},mn={key:0,class:"text-center mt-4 animate__animated animate__fadeIn"},pn={key:1,class:"text-center mt-4"},bn={class:"flex justify-between"},nt=3e4,hn=oe({__name:"TicTacToe",props:{partnerId:{type:String,required:!0},isFirstPlayer:{type:Boolean,default:!0}},emits:["back","error"],setup(o,{emit:m}){const s=o,k=m,{socket:f}=ke(),n=x("waiting"),g=x(["","","","","","","","",""]),r=x(s.isFirstPlayer?"X":"O"),R=x(s.isFirstPlayer?"O":"X"),D=x("X"),S=x(null),W=x(null),U=x(Date.now()),N=ce(()=>D.value===r.value),G=C=>{var O;if(!(n.value!=="playing"||g.value[C]!==""||!N.value||S.value!==null))try{g.value[C]=r.value,D.value=R.value,U.value=Date.now(),(O=f.value)==null||O.emit("game-move",{gameType:"tic-tac-toe",move:C,to:s.partnerId}),i(),I()}catch{y("Failed to make a move. Please try again.")}},i=()=>{const C=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const O of C){const[M,F,Y]=O;if(g.value[M]&&g.value[M]===g.value[F]&&g.value[M]===g.value[Y]){S.value=g.value[M],n.value="finished",W.value&&(clearTimeout(W.value),W.value=null);return}}g.value.includes("")||(S.value="tie",n.value="finished",W.value&&(clearTimeout(W.value),W.value=null))},w=()=>{var C;try{g.value=["","","","","","","","",""],D.value="X",S.value=null,n.value="playing",U.value=Date.now(),(C=f.value)==null||C.emit("game-reset",{gameType:"tic-tac-toe",to:s.partnerId}),I()}catch{y("Failed to reset the game. Please try again.")}},y=C=>{console.error(`Tic-Tac-Toe Error: ${C}`),k("error",C)},I=()=>{W.value&&clearTimeout(W.value),n.value==="playing"&&!S.value&&(W.value=window.setTimeout(()=>{Date.now()-U.value>nt&&(y("Connection with your partner appears to be lost. The game will be closed."),k("back"))},nt))};return K(()=>s.isFirstPlayer,C=>{r.value=C?"X":"O",R.value=C?"O":"X",C||(n.value="playing")}),ue(()=>{var C,O,M;try{(C=f.value)==null||C.on("game-partner-joined",F=>{F.from===s.partnerId&&F.gameType==="tic-tac-toe"&&(console.log("Partner joined the game!",F),n.value="playing",U.value=Date.now(),I())}),(O=f.value)==null||O.on("game-move",F=>{if(F.from===s.partnerId&&F.gameType==="tic-tac-toe"){const Y=F.move;typeof Y=="number"&&Y>=0&&Y<9&&g.value[Y]===""?(g.value[Y]=R.value,D.value=r.value,U.value=Date.now(),i(),I()):y("Received invalid move from partner.")}}),(M=f.value)==null||M.on("game-reset",F=>{F.from===s.partnerId&&F.gameType==="tic-tac-toe"&&(g.value=["","","","","","","","",""],D.value="X",S.value=null,n.value="playing",U.value=Date.now(),I())}),s.isFirstPlayer||(n.value="playing")}catch{y("Failed to initialize game connection.")}}),We(()=>{var C,O,M;(C=f.value)==null||C.off("game-partner-joined"),(O=f.value)==null||O.off("game-move"),(M=f.value)==null||M.off("game-reset"),W.value&&(clearTimeout(W.value),W.value=null)}),(C,O)=>(p(),b("div",tn,[t("div",on,[O[1]||(O[1]=t("h2",{class:"text-xl font-bold text-purple-400"},"Tic Tac Toe",-1)),t("div",{class:z(["text-white text-sm px-3 py-1 rounded-full",{"bg-yellow-600/30":n.value==="waiting","bg-green-600/30":N.value&&n.value==="playing","bg-red-600/30":!N.value&&n.value==="playing","bg-purple-600/30":S.value}])},[n.value==="waiting"?(p(),b("span",nn," Waiting for partner... ")):S.value?(p(),b("span",an,j(S.value===r.value?"You Won! ðŸŽ‰":S.value==="tie"?"It's a Tie! ðŸ¤":"You Lost! ðŸ˜¢"),1)):(p(),b("span",ln,j(N.value?"Your Turn":"Partner's Turn"),1))],2)]),t("div",rn,[t("div",{class:z(["flex flex-col items-center",{"opacity-70":n.value==="waiting"||!N.value&&!S.value}])},[t("div",sn,[t("div",cn,[t("div",{class:z([{"ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800":r.value==="X"},"w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-lg font-bold"])}," X ",2),t("div",un,[O[2]||(O[2]=t("p",{class:"text-gray-300 text-sm"},"You are",-1)),t("p",{class:z(["font-bold text-lg",{"text-blue-400":r.value==="X","text-green-400":r.value==="O"}])},j(r.value),3)]),t("div",{class:z([{"ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800":r.value==="O"},"w-10 h-10 rounded-full bg-green-600 flex items-center justify-center text-lg font-bold"])}," O ",2)])]),t("div",dn,[(p(!0),b(ne,null,ae(g.value,(M,F)=>(p(),b("button",{key:F,onClick:Y=>G(F),disabled:M!==""||!N.value||S.value!==null||n.value==="waiting",class:z(["w-20 h-20 rounded-lg flex items-center justify-center text-3xl font-bold transition-all duration-300",{"bg-gray-700 hover:bg-gray-600":M===""&&N.value&&!S.value&&n.value!=="waiting","bg-gray-700/50":M===""&&(!N.value||S.value!==null||n.value==="waiting"),"bg-blue-600/20":M==="X","bg-green-600/20":M==="O","cursor-not-allowed":M!==""||!N.value||S.value!==null||n.value==="waiting","hover:bg-purple-700/50":N.value&&M===""&&!S.value&&n.value==="playing"}])},[M==="X"?(p(),b("span",gn,"X")):M==="O"?(p(),b("span",vn,"O")):B("",!0)],10,fn))),128))]),S.value?(p(),b("div",mn,[t("button",{onClick:w,class:"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm transition-colors mb-2"}," Play Again ")])):B("",!0),n.value==="waiting"?(p(),b("div",pn,O[3]||(O[3]=[t("div",{class:"bg-yellow-600/20 rounded-lg p-4 animate-pulse"},[t("p",{class:"text-yellow-300 mb-1"},"Waiting for your partner to join..."),t("p",{class:"text-sm text-gray-300"},[Pe("You'll play as "),t("span",{class:"font-bold text-blue-400"},"X")])],-1)]))):B("",!0)],2)]),t("div",bn,[t("button",{onClick:O[0]||(O[0]=M=>C.$emit("back")),class:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors"}," Back to Games ")])]))}});const yn=he(hn,[["__scopeId","data-v-98a0628f"]]),xn={key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4"},Cn={class:"bg-[#1e1e2e] rounded-lg w-full max-w-md mx-auto shadow-2xl relative overflow-hidden"},wn={class:"flex items-center justify-between p-3 border-b border-gray-800"},Tn={key:1,class:"p-4"},kn={class:"grid grid-cols-2 gap-4 mb-4"},Rn=["disabled"],Sn=["disabled"],_n={key:2,class:"text-center p-6"},$n={class:"mb-4"},Wn={class:"text-gray-300"},In={key:3},En=oe({__name:"games-modal",props:{isOpen:{type:Boolean,default:!1},partnerId:{type:String,required:!0},isConnected:{type:Boolean,default:!1}},emits:["close"],setup(o,{emit:m}){const{socket:s,userId:k}=ke(),f=o,n=x(null),g=x(null),r=x(!0),R=x(null),D=x(!1),S=x(""),W=i=>{console.log(`[Game Debug] ${i}`),S.value=i},U=i=>{var y;if(!f.isConnected)return;W(`Starting game: ${i} with partner: ${f.partnerId}`),g.value=null,n.value=i,r.value=!0,D.value=!1;const w=[k.value,f.partnerId].sort();R.value=`${i}-${w[0]}-${w[1]}`,W(`Created game room: ${R.value}`),(y=s.value)==null||y.emit("game-join-room",{gameType:i,roomId:R.value,to:f.partnerId,isFirstPlayer:!0})},N=()=>{var i;R.value&&((i=s.value)==null||i.emit("game-leave-room",{roomId:R.value,to:f.partnerId})),n.value=null,g.value=null,r.value=!0,R.value=null,D.value=!1},G=i=>{g.value=i,W(`Error: ${i}`)};return ue(()=>{var i,w,y,I;W("Setting up game events"),(i=s.value)==null||i.on("game-room-invite",C=>{var O;C.from===f.partnerId&&(W(`Received invitation to join game room: ${C.roomId}`),R.value=C.roomId,n.value=C.gameType,r.value=!1,(O=s.value)==null||O.emit("game-join-room",{gameType:C.gameType,roomId:C.roomId,to:f.partnerId,isFirstPlayer:!1}))}),(w=s.value)==null||w.on("game-partner-joined",C=>{C.from===f.partnerId&&(W(`Partner joined the game: ${C.gameType}`),D.value=!0)}),(y=s.value)==null||y.on("game-error",C=>{(C.from==="system"||C.from===f.partnerId)&&(g.value=C.message||"An error occurred in the game.",W(`Game error: ${C.message}`))}),(I=s.value)==null||I.on("game-partner-left",C=>{n.value&&(g.value="Your partner left the game.",W("Partner left the game"),n.value=null)})}),We(()=>{var i,w,y,I,C;(i=s.value)==null||i.off("game-room-invite"),(w=s.value)==null||w.off("game-partner-joined"),(y=s.value)==null||y.off("game-error"),(I=s.value)==null||I.off("game-partner-left"),R.value&&((C=s.value)==null||C.emit("game-leave-room",{roomId:R.value,to:f.partnerId}))}),K(()=>f.isOpen,i=>{i||N()}),(i,w)=>o.isOpen?(p(),b("div",xn,[t("div",Cn,[t("div",wn,[w[2]||(w[2]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"text-purple-400 text-xl"},"ðŸŽ®"),t("h2",{class:"text-xl font-semibold text-[#a881fc]"},"Space Games")],-1)),t("button",{onClick:w[0]||(w[0]=y=>i.$emit("close")),class:"text-gray-400 hover:text-white text-lg"}," âœ• ")]),B("",!0),n.value?g.value?(p(),b("div",_n,[t("div",$n,[w[8]||(w[8]=t("div",{class:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-2"},[t("span",{class:"text-2xl"},"âš ï¸")],-1)),w[9]||(w[9]=t("h3",{class:"text-xl font-bold mb-2 text-red-400"},"Game Error",-1)),t("p",Wn,j(g.value),1)]),t("button",{onClick:N,class:"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors mt-2"}," Back to Games ")])):(p(),b("div",In,[n.value==="tic-tac-toe"?(p(),Ut(yn,{key:0,partnerId:o.partnerId,isFirstPlayer:r.value,partnerReady:D.value,onBack:N,onError:G},null,8,["partnerId","isFirstPlayer","partnerReady"])):B("",!0)])):(p(),b("div",Tn,[t("div",kn,[t("button",{class:z(["bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!o.isConnected}]),disabled:!o.isConnected},w[3]||(w[3]=[be('<div class="absolute inset-0 flex items-center justify-center bg-[#2e2e42]/80 rounded-lg" data-v-823f908a><span class="bg-purple-500 text-white text-xs px-2 py-1 rounded-md font-medium" data-v-823f908a>Coming Soon</span></div><div class="bg-yellow-500 text-white w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl" data-v-823f908a>ðŸ‘Š</div><div class="text-white font-medium" data-v-823f908a>Rock Paper Scissors</div><div class="text-xs text-gray-400" data-v-823f908a>vs Partner</div>',4)]),10,Rn),t("button",{class:z(["bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center relative",{"opacity-50 cursor-not-allowed":!0}]),disabled:""},w[4]||(w[4]=[be('<div class="absolute inset-0 flex items-center justify-center bg-[#2e2e42]/80 rounded-lg" data-v-823f908a><span class="bg-purple-500 text-white text-xs px-2 py-1 rounded-md font-medium" data-v-823f908a>Coming Soon</span></div><div class="bg-indigo-600 text-white w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl" data-v-823f908a>ðŸŽµ</div><div class="text-white font-medium" data-v-823f908a>Sound Game</div><div class="text-xs text-gray-400" data-v-823f908a>Voice Challenge</div>',4)])),t("button",{class:z(["bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!o.isConnected}]),disabled:!o.isConnected,onClick:w[1]||(w[1]=y=>U("tic-tac-toe"))},w[5]||(w[5]=[t("div",{class:"bg-red-600 text-white w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl"},"â­•",-1),t("div",{class:"text-white font-medium"},"Tic-Tac-Toe",-1),t("div",{class:"text-xs text-gray-400"},"vs Partner",-1)]),10,Sn),t("button",{class:z(["bg-[#2e2e42] p-4 rounded-lg flex flex-col items-center text-center relative",{"opacity-50 cursor-not-allowed":!0}]),disabled:""},w[6]||(w[6]=[be('<div class="absolute inset-0 flex items-center justify-center bg-[#2e2e42]/80 rounded-lg" data-v-823f908a><span class="bg-purple-500 text-white text-xs px-2 py-1 rounded-md font-medium" data-v-823f908a>Coming Soon</span></div><div class="bg-white text-gray-800 w-12 h-12 rounded-full flex items-center justify-center mb-3 text-xl" data-v-823f908a>ðŸ’¬</div><div class="text-white font-medium" data-v-823f908a>Word Galaxy</div><div class="text-xs text-gray-400" data-v-823f908a>Brain Game</div>',4)]))]),w[7]||(w[7]=t("p",{class:"text-center text-sm text-gray-400 mt-2"}," Connect to play with others ",-1))]))])])):B("",!0)}});const An=he(En,[["__scopeId","data-v-823f908a"]]),On={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},Dn={class:"bg-gray-900 rounded-lg w-full max-w-md mx-auto p-6"},jn={class:"flex items-center justify-between mb-6"},Mn={class:"grid grid-cols-3 gap-4 mb-6"},Pn=oe({__name:"donation-modal",props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(o,{emit:m}){const s=m,k=x(15),f=g=>{k.value=g},n=()=>{window.open(`https://www.paypal.com/paypalme/spacetalk/${k.value}`,"_blank"),s("close")};return(g,r)=>o.isOpen?(p(),b("div",On,[t("div",Dn,[t("div",jn,[r[4]||(r[4]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"text-red-400 text-xl"},"â¤ï¸"),t("h2",{class:"text-lg font-semibold text-violet-400"},"Support SpaceTalk")],-1)),t("button",{onClick:r[0]||(r[0]=R=>g.$emit("close")),class:"text-gray-400 hover:text-white text-lg"}," âœ• ")]),r[8]||(r[8]=t("div",{class:"mb-6 text-center"},[t("p",{class:"text-gray-300"},"Keep SpaceTalk free for everyone")],-1)),t("div",Mn,[t("button",{class:z(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",k.value===5?"ring-2 ring-emerald-500 scale-105":""]),onClick:r[1]||(r[1]=R=>f(5))},r[5]||(r[5]=[t("div",{class:"text-lg font-bold text-white"},"$5",-1),t("div",{class:"text-sm text-gray-400"},"Coffee",-1)]),2),t("button",{class:z(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",k.value===15?"ring-2 ring-emerald-500 scale-105":""]),onClick:r[2]||(r[2]=R=>f(15))},r[6]||(r[6]=[t("div",{class:"text-lg font-bold text-white"},"$15",-1),t("div",{class:"text-sm text-gray-400"},"Fuel",-1)]),2),t("button",{class:z(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",k.value===50?"ring-2 ring-emerald-500 scale-105":""]),onClick:r[3]||(r[3]=R=>f(50))},r[7]||(r[7]=[t("div",{class:"text-lg font-bold text-white"},"$50",-1),t("div",{class:"text-sm text-gray-400"},"Rocket",-1)]),2)]),r[9]||(r[9]=t("div",{class:"flex justify-center items-center gap-1 mb-6"},[t("span",{class:"text-yellow-400"},"â­"),t("span",{class:"text-sm text-gray-300"},"Boost development")],-1)),t("button",{class:"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-3 rounded-lg transition-colors mb-2 active:scale-95 transform duration-150",onClick:n}," Donate via PayPal "),r[10]||(r[10]=t("div",{class:"text-xs text-gray-500 text-center"}," Secure payments via PayPal ",-1))])])):B("",!0)}});const Nn={class:"fixed inset-0 overflow-hidden pointer-events-none"},Fn=oe({__name:"starfield",setup(o){const m=x([]);ue(()=>{s()});const s=()=>{const f=[];for(let n=0;n<50;n++)f.push({id:n,x:Math.random()*100,y:Math.random()*100,size:Math.random()*2+1,opacity:Math.random()*.7+.3,duration:Math.random()*8+2});m.value=f};return(k,f)=>(p(),b("div",Nn,[(p(!0),b(ne,null,ae(m.value,n=>(p(),b("div",{key:n.id,class:"absolute rounded-full bg-white",style:Gt({width:`${n.size}px`,height:`${n.size}px`,top:`${n.y}%`,left:`${n.x}%`,opacity:n.opacity,boxShadow:`0 0 ${n.size*2}px rgba(255, 255, 255, ${n.opacity})`,animation:`twinkle ${n.duration}s infinite ease-in-out`})},null,4))),128))]))}});const Ln=he(Fn,[["__scopeId","data-v-f4bff5a3"]]),Me=!1,Bn=10,Un=oe({__name:"AudioOutput",props:{showControls:{type:Boolean,default:!0}},setup(o){const{remoteStream:m,connectionState:s,partnerId:k,isAudioMuted:f}=Ne(),n=x(null),g=x(.8),r=x(!1),R=x(0),D=ce(()=>(m.value!==null&&m.value?m.value.getAudioTracks().length>0:!1)&&m.value?m.value.getAudioTracks().some(O=>O.enabled):!1);ce(()=>m.value?m.value.getAudioTracks().filter(y=>y.enabled&&y.readyState==="live").length:0),ce(()=>r.value&&D.value?"connected":(s.value==="connected"&&!D.value&&!r.value&&setTimeout(G,500),s.value)),K(()=>m.value,y=>{G(),R.value=0,setTimeout(i,500)}),K(()=>f.value,y=>{!y&&m.value&&n.value&&setTimeout(()=>{n.value&&n.value.paused&&n.value.play().catch(I=>{})},300)}),K(()=>s.value,y=>{y==="connected"?setTimeout(()=>{G(),i()},1e3):y==="new"||y==="connecting"?R.value=0:(y==="disconnected"||y==="failed")&&w()}),K(()=>k.value,y=>{r.value=!1,R.value=0,y||n.value&&(n.value.srcObject=null)}),ue(()=>{G(),n.value&&(n.value.onplaying=()=>{r.value=!0},n.value.onpause=()=>{r.value=!1},n.value.onended=()=>{r.value=!1},n.value.onerror=y=>{console.error("[AudioOutput] Audio error:",y),r.value=!1},n.value.volume=g.value),document.addEventListener("visibilitychange",N),W()}),st(()=>{n.value&&(n.value.srcObject=null),document.removeEventListener("visibilitychange",N),U()});let S=null;function W(){U(),S=window.setInterval(()=>{!r.value&&D.value&&s.value==="connected"&&(G(),i())},5e3)}function U(){S&&(clearInterval(S),S=null)}function N(){document.visibilityState==="visible"&&(G(),setTimeout(()=>{!r.value&&D.value&&i()},500))}function G(){n.value&&(m.value?(n.value.srcObject=m.value,m.value.getAudioTracks().forEach(y=>{y.enabled=!0}),i()):(n.value.srcObject=null,r.value=!1))}async function i(){if(!(!n.value||!n.value.srcObject))try{const y=m.value&&m.value.getAudioTracks().length>0;await n.value.play(),r.value=!0,R.value=0}catch(y){if(console.error("[AudioOutput] Error playing audio:",y),r.value=!1,y instanceof DOMException&&y.name==="NotAllowedError"&&console.warn("[AudioOutput] Audio play was blocked by browser policy, user interaction needed"),R.value<Bn){R.value++;const I=R.value*1e3;setTimeout(i,I)}else console.warn("[AudioOutput] Max retry attempts reached, manual play required")}}function w(){R.value=0,n.value&&(n.value.srcObject=null),setTimeout(()=>{G(),i()},500)}return(y,I)=>(p(),b("div",null,[t("audio",{ref_key:"audioElement",ref:n,autoplay:"",playsinline:"",class:"hidden"},null,512),B("",!0)]))}});const Gn=he(Un,[["__scopeId","data-v-f63dc209"]]),zn={class:"min-h-screen font-sans"},qn={class:"relative min-h-screen z-10 text-white"},Vn={class:"p-4 border-b border-white/10"},Yn={class:"max-w-4xl mx-auto"},Hn={class:"flex justify-center gap-2 mb-3"},Xn={class:"bg-green-500/20 rounded-full px-2 py-1 text-xs flex items-center gap-1"},Jn={key:0,class:"bg-purple-500/20 rounded-full px-2 py-1 text-xs"},Kn={class:"grid grid-cols-2 gap-2 text-xs relative"},Qn={class:"flex items-center"},Zn={key:0,class:"absolute top-full left-0 mt-1 w-full bg-gray-800/95 backdrop-blur-md border border-gray-700 rounded-xl shadow-xl z-20 overflow-hidden transition-all duration-200 animate-dropdown"},ea={class:"py-1"},ta=["onClick"],oa={class:"text-sm"},na={class:"flex-1 p-4"},aa={class:"max-w-md mx-auto space-y-6"},la={class:"flex items-center justify-center gap-2 mb-4"},ra={class:"text-center"},sa={class:"text-xs text-gray-400 italic"},ia={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},ca={class:"bg-gray-800 rounded-2xl p-6 w-full max-w-sm"},ua={class:"flex justify-between items-center mb-4"},da={class:"space-y-3"},fa={key:0,class:"text-center py-8"},ga={class:"flex items-center gap-3"},va={class:"text-2xl"},ma={class:"text-white text-sm font-medium"},pa={class:"text-gray-400 text-xs"},ba={class:"text-xs text-gray-500"},ha={key:0,class:"text-xs text-gray-500 text-center mt-4"},ya={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-20 p-4"},xa={class:"bg-gray-800 rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto relative"},Ca={class:"flex justify-between items-center mb-6"},wa={class:"space-y-6"},Ta={class:"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide"},ka={key:0,class:"text-xs text-gray-400 p-2"},Ra={key:1,class:"flex flex-wrap gap-2"},Sa={class:"flag-icon"},_a=["onClick"],$a={class:"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide"},Wa={key:0,class:"text-xs text-gray-400 p-2"},Ia={key:1,class:"flex flex-wrap gap-2"},Ea={class:"flag-icon"},Aa=["onClick"],Oa={key:2,class:"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer preferred-outer"},Da={class:"py-1 w-full"},ja={key:0,class:"text-xs text-gray-400 px-3 py-2"},Ma=["onClick"],Pa={class:"flag-icon w-6 text-center"},Na={class:"text-sm"},Fa={key:3,class:"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer blocked-outer"},La={class:"py-1 w-full"},Ba={key:0,class:"text-xs text-gray-400 px-3 py-2"},Ua=["onClick"],Ga={class:"flag-icon w-6 text-center"},za={class:"text-sm"},qa={key:4,class:"hidden"},Va=oe({__name:"HomeView",setup(o){const m=x("disconnected"),s=x(null),k=x(null),f=x(""),n=x(!1),g=x(!1),r=x(!1),R=x(!1),D=x(!1),S=x(!1),W=x(0),U=x(0),N=x(!1),G=x([]),i=x([]),w=x("any"),y=x(!1),I=x([]),C=x([]);x(""),x("");const O=x(!1),M=x(!1),F=[{value:"any",text:"Go With the Flow",emoji:"ðŸŒŸ"},{value:"chill",text:"Chill",emoji:"ðŸ˜Œ"},{value:"fun",text:"Fun",emoji:"ðŸŽ‰"},{value:"curious",text:"Curious",emoji:"ðŸ¤”"},{value:"creative",text:"Creative",emoji:"ðŸŽ¨"}],Y=x([{value:"any",label:"ðŸŒ Any Country",name:"Any Country",flag:"ðŸŒ"},{value:"sa",label:"ðŸ‡¸ðŸ‡¦ Saudi Arabia",name:"Saudi Arabia",flag:"ðŸ‡¸ðŸ‡¦"},{value:"ae",label:"ðŸ‡¦ðŸ‡ª UAE",name:"United Arab Emirates",flag:"ðŸ‡¦ðŸ‡ª"},{value:"eg",label:"ðŸ‡ªðŸ‡¬ Egypt",name:"Egypt",flag:"ðŸ‡ªðŸ‡¬"},{value:"us",label:"ðŸ‡ºðŸ‡¸ USA",name:"United States",flag:"ðŸ‡ºðŸ‡¸"},{value:"gb",label:"ðŸ‡¬ðŸ‡§ UK",name:"United Kingdom",flag:"ðŸ‡¬ðŸ‡§"},{value:"de",label:"ðŸ‡©ðŸ‡ª Germany",name:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{value:"fr",label:"ðŸ‡«ðŸ‡· France",name:"France",flag:"ðŸ‡«ðŸ‡·"},{value:"ca",label:"ðŸ‡¨ðŸ‡¦ Canada",name:"Canada",flag:"ðŸ‡¨ðŸ‡¦"},{value:"au",label:"ðŸ‡¦ðŸ‡º Australia",name:"Australia",flag:"ðŸ‡¦ðŸ‡º"},{value:"jp",label:"ðŸ‡¯ðŸ‡µ Japan",name:"Japan",flag:"ðŸ‡¯ðŸ‡µ"},{value:"kr",label:"ðŸ‡°ðŸ‡· Korea",name:"South Korea",flag:"ðŸ‡°ðŸ‡·"},{value:"cn",label:"ðŸ‡¨ðŸ‡³ China",name:"China",flag:"ðŸ‡¨ðŸ‡³"},{value:"in",label:"ðŸ‡®ðŸ‡³ India",name:"India",flag:"ðŸ‡®ðŸ‡³"},{value:"br",label:"ðŸ‡§ðŸ‡· Brazil",name:"Brazil",flag:"ðŸ‡§ðŸ‡·"},{value:"ma",label:"ðŸ‡²ðŸ‡¦ Morocco",name:"Morocco",flag:"ðŸ‡²ðŸ‡¦"},{value:"dz",label:"ðŸ‡©ðŸ‡¿ Algeria",name:"Algeria",flag:"ðŸ‡©ðŸ‡¿"},{value:"tn",label:"ðŸ‡¹ðŸ‡³ Tunisia",name:"Tunisia",flag:"ðŸ‡¹ðŸ‡³"},{value:"ly",label:"ðŸ‡±ðŸ‡¾ Libya",name:"Libya",flag:"ðŸ‡±ðŸ‡¾"},{value:"jo",label:"ðŸ‡¯ðŸ‡´ Jordan",name:"Jordan",flag:"ðŸ‡¯ðŸ‡´"},{value:"lb",label:"ðŸ‡±ðŸ‡§ Lebanon",name:"Lebanon",flag:"ðŸ‡±ðŸ‡§"},{value:"kw",label:"ðŸ‡°ðŸ‡¼ Kuwait",name:"Kuwait",flag:"ðŸ‡°ðŸ‡¼"},{value:"bh",label:"ðŸ‡§ðŸ‡­ Bahrain",name:"Bahrain",flag:"ðŸ‡§ðŸ‡­"},{value:"qa",label:"ðŸ‡¶ðŸ‡¦ Qatar",name:"Qatar",flag:"ðŸ‡¶ðŸ‡¦"},{value:"om",label:"ðŸ‡´ðŸ‡² Oman",name:"Oman",flag:"ðŸ‡´ðŸ‡²"},{value:"ye",label:"ðŸ‡¾ðŸ‡ª Yemen",name:"Yemen",flag:"ðŸ‡¾ðŸ‡ª"},{value:"iq",label:"ðŸ‡®ðŸ‡¶ Iraq",name:"Iraq",flag:"ðŸ‡®ðŸ‡¶"},{value:"sy",label:"ðŸ‡¸ðŸ‡¾ Syria",name:"Syria",flag:"ðŸ‡¸ðŸ‡¾"},{value:"sd",label:"ðŸ‡¸ðŸ‡© Sudan",name:"Sudan",flag:"ðŸ‡¸ðŸ‡©"}]),Ie=async()=>{try{const l=await fetch("/api/countries");if(!l.ok)throw new Error("Failed to load countries");const c=await l.json();if(!c||c.length===0){console.log("Using static countries list");return}Y.value=[{value:"any",label:"ðŸŒ Any Country",name:"Any Country",flag:"ðŸŒ"},...c],console.log("Countries loaded:",Y.value.length)}catch(l){console.error("Failed to load countries list:",l)}},ye=x(null),xe=["You're not alone in the universe.","Every voice carries a story from across the stars.","Connection transcends distance in the cosmic web.","Discover new worlds through conversation.","In space, every voice matters."],de=x(xe[Math.floor(Math.random()*xe.length)]),Re=ke(),e=Re.socket,{isConnected:a}=Re,{remoteStream:h,localStream:v,connectionState:u,createOffer:$,handleOffer:Q,handleAnswer:Se,handleIceCandidate:gt,closeConnection:Fe,toggleMicrophone:vt,initializeLocalStream:mt}=Ne(),pt=so(),bt=qt(),Le=x(bt.params.roomId||null);K(()=>Le.value,l=>{l&&(r.value=!0)},{immediate:!0});const Be=ce(()=>Y.value.filter(l=>l.value!=="any"&&!I.value.includes(l.value)&&!C.value.includes(l.value))),Ue=ce(()=>Y.value.filter(l=>l.value!=="any"&&!C.value.includes(l.value)&&!I.value.includes(l.value))),ht=async()=>{const l=await vt();n.value!==!l&&(n.value=!l),m.value==="connected"&&setTimeout(()=>{const c=document.querySelector("audio");c&&c.paused&&c.play().catch(()=>{})},300)},Ge=async()=>{if(!v.value)try{await mt(),console.log("Microphone initialized")}catch(l){console.error("Failed to access microphone",l),alert("Please allow microphone access to use voice chat");return}e.value&&(m.value="searching",s.value&&(console.log("Disconnecting from current partner"),e.value.emit("disconnect-partner"),s.value=null,k.value=null,G.value=[],Fe()),console.log("Finding new partner with preferences"),e.value.emit("join-queue",{vibe:w.value,preferences:{preferredCountries:I.value.length?I.value:void 0,blockedCountries:C.value.length?C.value:void 0}}),U.value++)},yt=()=>{g.value=!g.value,g.value&&s.value&&pt.markAsRead(s.value)},xt=l=>{e.value&&s.value&&(e.value.emit("chat-message",{message:l,to:s.value}),G.value.push({id:Date.now().toString(),message:l,isOwn:!0,timestamp:Date.now()}))},Ct=l=>{console.log(`Selected game: ${l}`),e.value&&s.value&&e.value.emit("game-invite",{game:l,to:s.value})},wt=l=>{l&&!I.value.includes(l)&&I.value.push(l)},Tt=l=>{I.value=I.value.filter(c=>c!==l)},kt=l=>{l&&!C.value.includes(l)&&C.value.push(l)},Rt=l=>{C.value=C.value.filter(c=>c!==l)},St=()=>{I.value=[],C.value=[],localStorage.removeItem("preferredCountries"),localStorage.removeItem("blockedCountries")},_t=()=>{S.value=!1,He(),Dt()},ze=l=>{const c=Y.value.find(T=>T.value===l);return c?c.flag:"ðŸ³ï¸"},qe=l=>{const c=Y.value.find(T=>T.value===l);return c?c.name:"Earth"},$t=l=>new Date(l).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Wt=()=>{y.value=!y.value},It=l=>{w.value=l,y.value=!1},Et=l=>{const c=F.find(T=>T.value===l);return c?c.emoji:"ðŸŒŸ"},At=l=>{const c=F.find(T=>T.value===l);return c?c.text:"Go With the Flow"},Ee=x(null),Ae=x(null),fe=()=>{rt(()=>{var Je,Ke;const l=(Je=Ee.value)==null?void 0:Je.getBoundingClientRect(),c=(Ke=Ae.value)==null?void 0:Ke.getBoundingClientRect(),T=document.querySelector(".preferred-outer"),X=document.querySelector(".blocked-outer");l&&T&&(T.style.left=`${l.left}px`,T.style.top=`${l.bottom+5}px`,T.style.width=`${l.width}px`),c&&X&&(X.style.left=`${c.left}px`,X.style.top=`${c.bottom+5}px`,X.style.width=`${c.width}px`)})},Ve=()=>{O.value=!O.value,O.value&&(M.value=!1,fe())},Ye=()=>{M.value=!M.value,M.value&&(O.value=!1,fe())},He=()=>{localStorage.setItem("preferredCountries",JSON.stringify(I.value)),localStorage.setItem("blockedCountries",JSON.stringify(C.value))},Ot=()=>{try{const l=localStorage.getItem("preferredCountries"),c=localStorage.getItem("blockedCountries");l&&(I.value=JSON.parse(l)),c&&(C.value=JSON.parse(c))}catch(l){console.error("Error loading filter settings:",l)}},Dt=()=>{e.value&&a.value&&e.value.emit("startMatching",{preferredCountries:I.value.length>0?I.value:null,blockedCountries:C.value})};ue(()=>{console.log("Home view mounted"),Ie();try{const l=localStorage.getItem("preferredCountries"),c=localStorage.getItem("blockedCountries");l&&(I.value=JSON.parse(l)),c&&(C.value=JSON.parse(c))}catch(l){console.error("Error loading saved preferences:",l)}e.value&&(e.value.on("user-location",l=>{console.log("Received user location:",l),l&&l.countryCode&&l.country?(ye.value=l,I.value.length===0&&l.countryCode!=="unknown"&&l.countryCode!=="earth"&&(console.log(`Adding user's country ${l.country} (${l.countryCode}) to preferred countries`),I.value.push(l.countryCode),He()),console.log(`Your location: ${l.flag} ${l.country}`)):console.warn("Received incomplete location data:",l)}),e.value.on("online-count",l=>{W.value=l}),e.value.on("matched",l=>{if(console.log("Partner matched with event:",l),m.value="matched",f.value="",s.value=l.partnerId,k.value={id:l.partnerId,country:l.country||"Earth",countryCode:l.countryCode||"unknown",flag:l.flag||"ðŸŒ",vibe:l.vibe||"any"},i.value.unshift({id:Date.now().toString(),country:k.value.country,flag:k.value.flag,timestamp:Date.now()}),i.value.length>3&&(i.value=i.value.slice(0,3)),l.partnerId){console.log("Initiating WebRTC connection with partner immediately");const{createOffer:c}=Ne();c(l.partnerId),setTimeout(()=>{m.value==="matched"&&u.value==="connected"&&(console.log("WebRTC connection established, updating UI state"),m.value="connected")},2e3)}}),e.value.on("direct-connection-established",l=>{console.log("Direct connection established:",l),m.value="connected",s.value=l.partnerId,k.value={id:l.partnerId,country:l.country||"Earth",countryCode:l.countryCode||"unknown",flag:l.flag||"ðŸŒ"}}),e.value.on("partner-disconnected",()=>{m.value="disconnected",s.value=null,k.value=null,G.value=[],N.value&&setTimeout(()=>{m.value==="disconnected"&&N.value&&Ge()},2e3)}),e.value.on("chat-message",l=>{G.value.push({id:Date.now().toString(),message:l.message,isOwn:!1,timestamp:Date.now()})}),e.value.on("error",l=>{console.error("Socket error:",l.message),l.type==="matching"&&(m.value="disconnected")}),e.value.on("voice-offer",jt),e.value.on("voice-answer",Mt),e.value.on("ice-candidate",Pt),e.value.emit("get-online-count")),document.addEventListener("click",Xe),window.addEventListener("resize",fe),document.addEventListener("scroll",fe,!0),Ot()}),st(()=>{console.log("Home view unmounting, cleaning up connection"),Fe(),e.value&&(e.value.off("online-count"),e.value.off("matched"),e.value.off("direct-connection-established"),e.value.off("partner-disconnected"),e.value.off("chat-message"),e.value.off("error"),e.value.off("voice-offer"),e.value.off("voice-answer"),e.value.off("ice-candidate")),document.removeEventListener("click",Xe),window.removeEventListener("resize",fe),document.removeEventListener("scroll",fe,!0)});const jt=async l=>{console.log("Received voice offer - forwarding to WebRTC service"),Q(l.offer,l.from)},Mt=async l=>{console.log("Received voice answer - forwarding to WebRTC service"),Se(l.answer)},Pt=async l=>{console.log("Received ICE candidate - forwarding to WebRTC service"),gt(l.candidate)};K(u,(l,c)=>{console.log(`[HomeView] WebRTC connection state changed: ${c} -> ${l}`),l==="connected"&&m.value==="matched"?setTimeout(()=>{u.value==="connected"&&m.value==="matched"&&(m.value="connected",f.value="",console.log("[HomeView] Successfully transitioned from matched to connected"))},1e3):l==="failed"?(f.value="",setTimeout(()=>{u.value==="failed"&&(m.value==="matched"||m.value==="connected")&&(f.value='Connection failed. Press "Next" to find a new partner.')},6e4)):l==="disconnected"&&(m.value==="connected"||m.value==="matched")&&(f.value="",setTimeout(()=>{u.value==="disconnected"&&(m.value==="connected"||m.value==="matched")&&(f.value="Connection lost. Trying to reconnect...")},6e4))});const Oe=x(null),Xe=l=>{const c=l.target;if(Oe.value&&!Oe.value.contains(c)&&(y.value=!1),O.value){const T=Ee.value,X=document.querySelector(".preferred-outer");T&&X&&!T.contains(c)&&!X.contains(c)&&(O.value=!1)}if(M.value){const T=Ae.value,X=document.querySelector(".blocked-outer");T&&X&&!T.contains(c)&&!X.contains(c)&&(M.value=!1)}};return(l,c)=>(p(),b("div",zn,[c[23]||(c[23]=be('<div class="fixed inset-0 pointer-events-none" data-v-65547d95><div class="absolute top-1/4 left-1/4 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl animate-pulse" data-v-65547d95></div><div class="absolute top-1/3 right-1/3 w-24 h-24 bg-violet-500/20 rounded-full blur-2xl animate-pulse delay-1000" data-v-65547d95></div><div class="absolute bottom-1/4 left-1/3 w-28 h-28 bg-indigo-500/20 rounded-full blur-3xl animate-pulse delay-2000" data-v-65547d95></div><div class="absolute top-1/2 right-1/4 w-20 h-20 bg-fuchsia-500/20 rounded-full blur-2xl animate-pulse delay-500" data-v-65547d95></div></div>',1)),re(Ln),t("div",qn,[t("header",Vn,[t("div",Yn,[c[11]||(c[11]=be('<div class="text-center mb-4" data-v-65547d95><div class="inline-flex items-center gap-2" data-v-65547d95><div class="w-6 h-6 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center shadow-lg shadow-cyan-500/50" data-v-65547d95><span class="text-white text-xs" data-v-65547d95>âœ¨</span></div><h1 class="text-lg font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent drop-shadow-lg" data-v-65547d95> SpaceTalk.live </h1></div></div>',1)),t("div",Hn,[t("div",Xn,[c[10]||(c[10]=t("div",{class:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"},null,-1)),t("span",null,j(W.value)+" online",1)]),U.value>0?(p(),b("div",Jn," Today: "+j(U.value)+" voices ",1)):B("",!0)]),t("div",Kn,[t("div",{class:"relative",ref_key:"vibeDropdownRef",ref:Oe},[t("div",{onClick:Wt,class:"cursor-pointer bg-purple-500/20 border border-purple-500/30 rounded-full h-8 flex items-center justify-between px-3 text-xs shadow-lg shadow-purple-500/20 text-white hover:bg-purple-500/30 active:scale-95 transition-all duration-150"},[t("span",Qn,j(Et(w.value))+" "+j(At(w.value)),1),t("span",{class:z(["ml-2 text-xs transition-transform duration-300",{"rotate-180":y.value}])},"â–¼",2)]),y.value?(p(),b("div",Zn,[t("div",ea,[(p(),b(ne,null,ae(F,T=>t("div",{key:T.value,onClick:X=>It(T.value),class:z(["px-3 py-2 hover:bg-gray-700/80 cursor-pointer transition-colors flex items-center gap-2",{"bg-gray-700/70":w.value===T.value}])},[t("span",oa,j(T.emoji),1),t("span",null,j(T.text),1)],10,ta)),64))])])):B("",!0)],512),t("button",{onClick:c[0]||(c[0]=T=>S.value=!0),class:"bg-violet-500/20 border border-violet-500/30 rounded-full h-8 px-3 text-xs hover:bg-violet-500/30 active:scale-95 transition-all duration-150 shadow-lg shadow-violet-500/20"}," ðŸ” Filters ")])])]),t("main",na,[t("div",aa,[re(Ao,{status:m.value,"partner-info":k.value,"error-message":f.value,"show-status":!0},null,8,["status","partner-info","error-message"]),t("div",la,[lt(t("input",{type:"checkbox",id:"auto-reconnect","onUpdate:modelValue":c[1]||(c[1]=T=>N.value=T),class:"w-3 h-3 rounded border-gray-600 bg-gray-700 text-emerald-500 focus:ring-emerald-500 focus:ring-1"},null,512),[[zt,N.value]]),c[12]||(c[12]=t("label",{for:"auto-reconnect",class:"text-xs text-gray-400 cursor-pointer"}," Auto-reconnect to others ",-1))]),re(Uo,{"is-muted":n.value,"is-disabled":m.value!=="connected",onToggleMute:ht,onFindNext:Ge,onToggleChat:yt,onToggleGames:c[2]||(c[2]=T=>r.value=!0),onToggleHistory:c[3]||(c[3]=T=>D.value=!0),onToggleDonation:c[4]||(c[4]=T=>R.value=!0)},null,8,["is-muted","is-disabled"]),t("div",ra,[t("p",sa,'"'+j(de.value)+'"',1)])])]),c[13]||(c[13]=be('<footer class="p-4 border-t border-white/10" data-v-65547d95><div class="max-w-md mx-auto text-center space-y-2" data-v-65547d95><h3 class="text-sm font-semibold text-emerald-400" data-v-65547d95>Community Guidelines</h3><div class="text-xs text-gray-300 space-y-1" data-v-65547d95><p data-v-65547d95>â€¢ Must be 18+ years old to use this service</p><p data-v-65547d95>â€¢ Be respectful and kind to other users</p><p data-v-65547d95>â€¢ No harassment, hate speech, or inappropriate content</p><p data-v-65547d95>â€¢ Report any misconduct using the report feature</p><p data-v-65547d95>â€¢ Your privacy and safety are our priority</p></div><p class="text-xs text-gray-400 mt-3" data-v-65547d95> By using SpaceTalk.live, you agree to follow these guidelines </p><div class="flex justify-center gap-3 mt-4 text-xs" data-v-65547d95><a href="#" class="bg-cyan-500/20 border border-cyan-500/30 rounded-full px-3 py-1.5 text-cyan-300 hover:text-cyan-200 hover:bg-cyan-500/30 transition-all shadow-lg shadow-cyan-500/20" data-v-65547d95> â„¹ï¸ About </a><a href="https://instagram.com" target="_blank" class="bg-pink-500/20 border border-pink-500/30 rounded-full px-3 py-1.5 text-pink-300 hover:text-pink-200 hover:bg-pink-500/30 transition-all shadow-lg shadow-pink-500/20" data-v-65547d95> ðŸ“· Instagram </a><a href="https://facebook.com" target="_blank" class="bg-blue-500/20 border border-blue-500/30 rounded-full px-3 py-1.5 text-blue-300 hover:text-blue-200 hover:bg-blue-500/30 transition-all shadow-lg shadow-blue-500/20" data-v-65547d95> ðŸ“˜ Facebook </a><a href="mailto:contact@spacetalk.live" class="bg-emerald-500/20 border border-emerald-500/30 rounded-full px-3 py-1.5 text-emerald-300 hover:text-emerald-200 hover:bg-emerald-500/30 transition-all shadow-lg shadow-emerald-500/20" data-v-65547d95> ðŸ“§ Contact </a></div></div></footer>',1))]),D.value?(p(),b("div",ia,[t("div",ca,[t("div",ua,[c[14]||(c[14]=t("h2",{class:"text-lg font-semibold text-indigo-400"},"ðŸ“ž Call History",-1)),t("button",{onClick:c[5]||(c[5]=T=>D.value=!1),class:"text-gray-400 hover:text-white text-xl"}," âœ• ")]),t("div",da,[i.value.length===0?(p(),b("div",fa,c[15]||(c[15]=[t("p",{class:"text-gray-400 text-sm"},"No recent calls",-1),t("p",{class:"text-xs text-gray-500 mt-1"},"Your last 3 conversations will appear here",-1)]))):(p(!0),b(ne,{key:1},ae(i.value,(T,X)=>(p(),b("div",{key:T.id,class:"bg-gray-700 rounded-lg p-3 flex items-center justify-between hover:bg-gray-600 transition-colors"},[t("div",ga,[t("span",va,j(T.flag),1),t("div",null,[t("p",ma,j(T.country),1),t("p",pa,j($t(T.timestamp)),1)])]),t("div",ba," #"+j(X+1),1)]))),128))]),i.value.length>0?(p(),b("p",ha," History clears when you leave the page ")):B("",!0)])])):B("",!0),S.value?(p(),b("div",ya,[t("div",xa,[t("div",Ca,[c[16]||(c[16]=t("h2",{class:"text-lg font-semibold text-emerald-400"},"Filters & Preferences",-1)),t("button",{onClick:c[6]||(c[6]=T=>S.value=!1),class:"text-gray-400 hover:text-white text-xl"}," âœ• ")]),t("div",wa,[t("div",null,[c[18]||(c[18]=t("label",{class:"block text-sm font-medium mb-3 text-emerald-400"},"Preferred Countries",-1)),t("div",Ta,[I.value.length===0?(p(),b("p",ka,"No countries selected")):(p(),b("div",Ra,[(p(!0),b(ne,null,ae(I.value,T=>(p(),b("span",{key:T,class:"bg-emerald-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1"},[t("span",Sa,j(ze(T)),1),Pe(" "+j(qe(T))+" ",1),t("button",{onClick:X=>Tt(T),class:"text-emerald-200 hover:text-white ml-1"}," âœ• ",8,_a)]))),128))]))]),t("div",{class:"mt-2 relative preferred-dropdown",ref_key:"preferredDropdownRef",ref:Ee},[t("div",{onClick:Ve,class:"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white"},c[17]||(c[17]=[t("span",{class:"text-gray-300"},"Add preferred country...",-1),t("span",{class:"ml-1"},"â–¼",-1)]))],512),c[19]||(c[19]=t("p",{class:"text-xs text-gray-400 mt-2"},"You'll be matched only with users from these countries",-1))]),t("div",null,[c[21]||(c[21]=t("label",{class:"block text-sm font-medium mb-3 text-red-400"},"Blocked Countries",-1)),t("div",$a,[C.value.length===0?(p(),b("p",Wa,"No countries blocked")):(p(),b("div",Ia,[(p(!0),b(ne,null,ae(C.value,T=>(p(),b("span",{key:T,class:"bg-red-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1"},[t("span",Ea,j(ze(T)),1),Pe(" "+j(qe(T))+" ",1),t("button",{onClick:X=>Rt(T),class:"text-red-200 hover:text-white ml-1"}," âœ• ",8,Aa)]))),128))]))]),t("div",{class:"mt-2 relative blocked-dropdown",ref_key:"blockedDropdownRef",ref:Ae},[t("div",{onClick:Ye,class:"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white"},c[20]||(c[20]=[t("span",{class:"text-gray-300"},"Add blocked country...",-1),t("span",{class:"ml-1"},"â–¼",-1)]))],512),c[22]||(c[22]=t("p",{class:"text-xs text-gray-400 mt-2"},"You won't be matched with users from these countries",-1))])]),t("div",{class:"flex gap-2 mt-8"},[t("button",{onClick:St,class:"flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg text-sm transition-colors"}," Clear All "),t("button",{onClick:_t,class:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-lg text-sm transition-colors"}," Apply Filters ")])])])):B("",!0),O.value?(p(),b("div",Oa,[t("div",Da,[Be.value.length===0?(p(),b("div",ja,"No more countries available")):B("",!0),(p(!0),b(ne,null,ae(Be.value,T=>(p(),b("div",{key:T.value,onClick:()=>{wt(T.value),Ve()},class:"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2"},[t("span",Pa,j(T.flag),1),t("span",Na,j(T.name),1)],8,Ma))),128))])])):B("",!0),M.value?(p(),b("div",Fa,[t("div",La,[Ue.value.length===0?(p(),b("div",Ba,"No more countries available")):B("",!0),(p(!0),b(ne,null,ae(Ue.value,T=>(p(),b("div",{key:T.value,onClick:()=>{kt(T.value),Ye()},class:"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2"},[t("span",Ga,j(T.flag),1),t("span",za,j(T.name),1)],8,Ua))),128))])])):B("",!0),re(en,{"is-open":g.value,onClose:c[7]||(c[7]=T=>g.value=!1),messages:G.value,onSendMessage:xt,"is-connected":m.value==="connected"},null,8,["is-open","messages","is-connected"]),re(An,{"is-open":r.value,onClose:c[8]||(c[8]=T=>r.value=!1),"is-connected":m.value==="connected",onSelectGame:Ct,"partner-id":s.value||"","initial-game-room-id":Le.value},null,8,["is-open","is-connected","partner-id","initial-game-room-id"]),re(Pn,{"is-open":R.value,onClose:c[9]||(c[9]=T=>R.value=!1)},null,8,["is-open"]),m.value==="connected"?(p(),b("div",qa,[re(Gn,{showControls:!1})])):B("",!0)]))}});const at=he(Va,[["__scopeId","data-v-65547d95"]]),Ya=Vt({history:Yt("/"),routes:[{path:"/",name:"home",component:at},{path:"/game/:roomId",name:"game",component:at,props:!0}]}),ft=Ht(Kt);ft.use(Ya);ft.mount("#app");
//# sourceMappingURL=index-6ff48a10.js.map
