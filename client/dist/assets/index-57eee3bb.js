var qa=Object.defineProperty;var za=(t,n,e)=>n in t?qa(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var Ue=(t,n,e)=>(za(t,typeof n!="symbol"?n+"":n,e),e);import{r as N,o as Ve,a as xt,g as na,d as je,c as j,b as Qe,u as Ga,e as H,R as Va,s as Nn,w as Te,f as Ee,h as Ka,T as Ya,i,n as se,t as Y,j as te,F as _e,k as Pe,l as Pr,m as Pt,v as Kt,p as ra,q as ze,x as ft,y as Xa,z as xn,A as Mr,B as Or,C as Qa,D as Za,E as Ja,G as es,H as ts}from"./vue-vendor-cc684da0.js";import{l as ns}from"./socket-vendor-d9998155.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}})();const rs=()=>window.location.origin,ae=N(null),cn=N(null),St=N(!1);let Rt=null;const Ut=N("idle"),Et=N(""),qt=N(0),os=10,as=1e3,ss=1e4,is=45e3,ls=3e4;function Ie(){const t=!!na();ae.value||n(),t&&(Ve(()=>{ae.value||n()}),xt(()=>{ae.value&&o(),Rt&&(clearInterval(Rt),Rt=null)}));function n(){const c=rs(),u=localStorage.getItem("spacechat_user_id");ae.value=ns(c,{autoConnect:!0,reconnection:!0,reconnectionAttempts:os,reconnectionDelay:as,reconnectionDelayMax:ss,timeout:ls,transports:["websocket"],extraHeaders:{"X-Client-Version":"1.0.0"},query:u?{userId:u}:void 0,forceNew:!1,withCredentials:!0}),r(),e()}function e(){Rt&&clearInterval(Rt),Rt=setInterval(()=>{ae.value&&St.value&&ae.value.emit("heartbeat")},is)}function r(){ae.value&&(ae.value.on("connect",()=>{var u,f;console.log("Socket connected"),St.value=!0;const c=localStorage.getItem("spacechat_user_id");(u=ae.value)==null||u.emit("user:identify",{prevUserId:c||void 0},s=>{console.log("Identified with server, user ID:",s),cn.value=s,localStorage.setItem("spacechat_user_id",s)}),(f=ae.value)==null||f.emit("get-online-count")}),ae.value.on("disconnect",()=>{console.log("Socket disconnected"),St.value=!1}),ae.value.on("reconnect",c=>{var f;console.log(`Socket reconnected after ${c} attempts`),St.value=!0;const u=localStorage.getItem("spacechat_user_id");u&&((f=ae.value)==null||f.emit("user:identify",{prevUserId:u},s=>{var l;console.log("Re-identified with server after reconnection, user ID:",s),cn.value=s,s!==u&&localStorage.setItem("spacechat_user_id",s),(l=ae.value)==null||l.emit("get-online-count")}))}),ae.value.on("reconnect_attempt",c=>{console.log(`Socket reconnection attempt ${c}`)}),ae.value.on("reconnect_error",c=>{console.error("Socket reconnection error:",c)}),ae.value.on("reconnect_failed",()=>{console.error("Socket reconnection failed"),setTimeout(()=>{St.value||(console.log("Attempting to reinitialize socket connection..."),o(),n())},5e3)}),ae.value.on("error",c=>{console.error("Socket error:",c)}),ae.value.on("pong",()=>{}),ae.value.on("user-id",c=>{console.log("Received user ID from server:",c),cn.value=c,localStorage.setItem("spacechat_user_id",c)}),ae.value.on("queue-timeout",c=>{console.log("Queue timeout:",c),Ut.value="timeout",Et.value="We couldn't find a suitable match in the allotted time. Please try again.",qt.value=c.waitTime,window.dispatchEvent(new CustomEvent("queue-status-changed",{detail:{status:"timeout",message:Et.value,waitTime:c.waitTime}}))}),ae.value.on("queue-waiting",c=>{console.log("Queue waiting notification:",c),Ut.value="waiting",Et.value="We're still looking for a match for you. Please wait...",qt.value=c.waitTime,window.dispatchEvent(new CustomEvent("queue-status-changed",{detail:{status:"waiting",message:Et.value,waitTime:c.waitTime}}))}),ae.value.on("matched",()=>{Ut.value="matched",Et.value="",qt.value=0}),ae.value.on("join-queue",()=>{Ut.value="waiting",Et.value="Looking for someone matching your preferences...",qt.value=0}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&ae.value&&ae.value.connected&&(ae.value.emit("heartbeat"),console.log("Tab became visible, sending heartbeat"))}))}function o(){ae.value&&(ae.value.off("connect"),ae.value.off("disconnect"),ae.value.off("reconnect"),ae.value.off("reconnect_attempt"),ae.value.off("reconnect_error"),ae.value.off("reconnect_failed"),ae.value.off("error"),ae.value.off("user-id"),ae.value.off("pong"),ae.value.off("queue-timeout"),ae.value.off("queue-waiting"))}function a(){ae.value?(console.log("Forcing socket reconnection..."),ae.value.disconnect(),ae.value.connect()):n()}return{socket:ae,userId:cn,isConnected:St,queueStatus:Ut,queueMessage:Et,queueWaitTime:qt,reconnect:a,isInSetupContext:t}}function cs(){const{socket:t}=Ie(),n=!!na(),e=N(!0),r=N(Date.now()),o=3e4,a=3e5;let c=0,u=null;const f=()=>{const d=Date.now();r.value=d,e.value=!0,d-c>o&&(c=d,t.value&&t.value.connected&&(t.value.emit("user-activity"),console.log("[ActivityTracker] تم إرسال تحديث النشاط للخادم"))),s()},s=()=>{u&&clearTimeout(u),u=window.setTimeout(()=>{e.value=!1,console.log("[ActivityTracker] المستخدم غير نشط الآن")},a)},l=()=>{["mousedown","mousemove","keydown","scroll","touchstart","click","touchmove"].forEach(y=>{document.addEventListener(y,f,{passive:!0})}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&f()}),f()},v=()=>{["mousedown","mousemove","keydown","scroll","touchstart","click","touchmove"].forEach(y=>{document.removeEventListener(y,f)}),document.removeEventListener("visibilitychange",f),u&&(clearTimeout(u),u=null)};return n?(Ve(()=>{l()}),xt(()=>{v()})):l(),{isActive:e,lastActivity:r,updateActivity:f,setupEventListeners:l,cleanupEventListeners:v}}const us={class:"app-container"},ds=je({__name:"App",setup(t){return cs(),(n,e)=>(H(),j("div",us,[Qe(Ga(Va))]))}});function oa(t,n){return function(){return t.apply(n,arguments)}}const{toString:fs}=Object.prototype,{getPrototypeOf:Wr}=Object,{iterator:Cn,toStringTag:aa}=Symbol,wn=(t=>n=>{const e=fs.call(n);return t[e]||(t[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),et=t=>(t=t.toLowerCase(),n=>wn(n)===t),En=t=>n=>typeof n===t,{isArray:Mt}=Array,Yt=En("undefined");function xs(t){return t!==null&&!Yt(t)&&t.constructor!==null&&!Yt(t.constructor)&&Ge(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const sa=et("ArrayBuffer");function vs(t){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(t):n=t&&t.buffer&&sa(t.buffer),n}const gs=En("string"),Ge=En("function"),ia=En("number"),_n=t=>t!==null&&typeof t=="object",ms=t=>t===!0||t===!1,vn=t=>{if(wn(t)!=="object")return!1;const n=Wr(t);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(aa in t)&&!(Cn in t)},ps=et("Date"),hs=et("File"),bs=et("Blob"),ys=et("FileList"),Cs=t=>_n(t)&&Ge(t.pipe),ws=t=>{let n;return t&&(typeof FormData=="function"&&t instanceof FormData||Ge(t.append)&&((n=wn(t))==="formdata"||n==="object"&&Ge(t.toString)&&t.toString()==="[object FormData]"))},Es=et("URLSearchParams"),[_s,As,Bs,ks]=["ReadableStream","Request","Response","Headers"].map(et),Ds=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Xt(t,n,{allOwnKeys:e=!1}={}){if(t===null||typeof t>"u")return;let r,o;if(typeof t!="object"&&(t=[t]),Mt(t))for(r=0,o=t.length;r<o;r++)n.call(null,t[r],r,t);else{const a=e?Object.getOwnPropertyNames(t):Object.keys(t),c=a.length;let u;for(r=0;r<c;r++)u=a[r],n.call(null,t[u],u,t)}}function la(t,n){n=n.toLowerCase();const e=Object.keys(t);let r=e.length,o;for(;r-- >0;)if(o=e[r],n===o.toLowerCase())return o;return null}const Bt=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),ca=t=>!Yt(t)&&t!==Bt;function Dr(){const{caseless:t}=ca(this)&&this||{},n={},e=(r,o)=>{const a=t&&la(n,o)||o;vn(n[a])&&vn(r)?n[a]=Dr(n[a],r):vn(r)?n[a]=Dr({},r):Mt(r)?n[a]=r.slice():n[a]=r};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&Xt(arguments[r],e);return n}const Ts=(t,n,e,{allOwnKeys:r}={})=>(Xt(n,(o,a)=>{e&&Ge(o)?t[a]=oa(o,e):t[a]=o},{allOwnKeys:r}),t),Fs=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Ss=(t,n,e,r)=>{t.prototype=Object.create(n.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:n.prototype}),e&&Object.assign(t.prototype,e)},Rs=(t,n,e,r)=>{let o,a,c;const u={};if(n=n||{},t==null)return n;do{for(o=Object.getOwnPropertyNames(t),a=o.length;a-- >0;)c=o[a],(!r||r(c,t,n))&&!u[c]&&(n[c]=t[c],u[c]=!0);t=e!==!1&&Wr(t)}while(t&&(!e||e(t,n))&&t!==Object.prototype);return n},$s=(t,n,e)=>{t=String(t),(e===void 0||e>t.length)&&(e=t.length),e-=n.length;const r=t.indexOf(n,e);return r!==-1&&r===e},Is=t=>{if(!t)return null;if(Mt(t))return t;let n=t.length;if(!ia(n))return null;const e=new Array(n);for(;n-- >0;)e[n]=t[n];return e},Ps=(t=>n=>t&&n instanceof t)(typeof Uint8Array<"u"&&Wr(Uint8Array)),Ms=(t,n)=>{const r=(t&&t[Cn]).call(t);let o;for(;(o=r.next())&&!o.done;){const a=o.value;n.call(t,a[0],a[1])}},Os=(t,n)=>{let e;const r=[];for(;(e=t.exec(n))!==null;)r.push(e);return r},Ws=et("HTMLFormElement"),Ns=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,r,o){return r.toUpperCase()+o}),Xr=(({hasOwnProperty:t})=>(n,e)=>t.call(n,e))(Object.prototype),Ls=et("RegExp"),ua=(t,n)=>{const e=Object.getOwnPropertyDescriptors(t),r={};Xt(e,(o,a)=>{let c;(c=n(o,a,t))!==!1&&(r[a]=c||o)}),Object.defineProperties(t,r)},Hs=t=>{ua(t,(n,e)=>{if(Ge(t)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const r=t[e];if(Ge(r)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},js=(t,n)=>{const e={},r=o=>{o.forEach(a=>{e[a]=!0})};return Mt(t)?r(t):r(String(t).split(n)),e},Us=()=>{},qs=(t,n)=>t!=null&&Number.isFinite(t=+t)?t:n;function zs(t){return!!(t&&Ge(t.append)&&t[aa]==="FormData"&&t[Cn])}const Gs=t=>{const n=new Array(10),e=(r,o)=>{if(_n(r)){if(n.indexOf(r)>=0)return;if(!("toJSON"in r)){n[o]=r;const a=Mt(r)?[]:{};return Xt(r,(c,u)=>{const f=e(c,o+1);!Yt(f)&&(a[u]=f)}),n[o]=void 0,a}}return r};return e(t,0)},Vs=et("AsyncFunction"),Ks=t=>t&&(_n(t)||Ge(t))&&Ge(t.then)&&Ge(t.catch),da=((t,n)=>t?setImmediate:n?((e,r)=>(Bt.addEventListener("message",({source:o,data:a})=>{o===Bt&&a===e&&r.length&&r.shift()()},!1),o=>{r.push(o),Bt.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",Ge(Bt.postMessage)),Ys=typeof queueMicrotask<"u"?queueMicrotask.bind(Bt):typeof process<"u"&&process.nextTick||da,Xs=t=>t!=null&&Ge(t[Cn]),W={isArray:Mt,isArrayBuffer:sa,isBuffer:xs,isFormData:ws,isArrayBufferView:vs,isString:gs,isNumber:ia,isBoolean:ms,isObject:_n,isPlainObject:vn,isReadableStream:_s,isRequest:As,isResponse:Bs,isHeaders:ks,isUndefined:Yt,isDate:ps,isFile:hs,isBlob:bs,isRegExp:Ls,isFunction:Ge,isStream:Cs,isURLSearchParams:Es,isTypedArray:Ps,isFileList:ys,forEach:Xt,merge:Dr,extend:Ts,trim:Ds,stripBOM:Fs,inherits:Ss,toFlatObject:Rs,kindOf:wn,kindOfTest:et,endsWith:$s,toArray:Is,forEachEntry:Ms,matchAll:Os,isHTMLForm:Ws,hasOwnProperty:Xr,hasOwnProp:Xr,reduceDescriptors:ua,freezeMethods:Hs,toObjectSet:js,toCamelCase:Ns,noop:Us,toFiniteNumber:qs,findKey:la,global:Bt,isContextDefined:ca,isSpecCompliantForm:zs,toJSONObject:Gs,isAsyncFn:Vs,isThenable:Ks,setImmediate:da,asap:Ys,isIterable:Xs};function ce(t,n,e,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",n&&(this.code=n),e&&(this.config=e),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}W.inherits(ce,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:W.toJSONObject(this.config),code:this.code,status:this.status}}});const fa=ce.prototype,xa={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{xa[t]={value:t}});Object.defineProperties(ce,xa);Object.defineProperty(fa,"isAxiosError",{value:!0});ce.from=(t,n,e,r,o,a)=>{const c=Object.create(fa);return W.toFlatObject(t,c,function(f){return f!==Error.prototype},u=>u!=="isAxiosError"),ce.call(c,t.message,n,e,r,o),c.cause=t,c.name=t.name,a&&Object.assign(c,a),c};const Qs=null;function Tr(t){return W.isPlainObject(t)||W.isArray(t)}function va(t){return W.endsWith(t,"[]")?t.slice(0,-2):t}function Qr(t,n,e){return t?t.concat(n).map(function(o,a){return o=va(o),!e&&a?"["+o+"]":o}).join(e?".":""):n}function Zs(t){return W.isArray(t)&&!t.some(Tr)}const Js=W.toFlatObject(W,{},null,function(n){return/^is[A-Z]/.test(n)});function An(t,n,e){if(!W.isObject(t))throw new TypeError("target must be an object");n=n||new FormData,e=W.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,x){return!W.isUndefined(x[h])});const r=e.metaTokens,o=e.visitor||l,a=e.dots,c=e.indexes,f=(e.Blob||typeof Blob<"u"&&Blob)&&W.isSpecCompliantForm(n);if(!W.isFunction(o))throw new TypeError("visitor must be a function");function s(g){if(g===null)return"";if(W.isDate(g))return g.toISOString();if(!f&&W.isBlob(g))throw new ce("Blob is not supported. Use a Buffer instead.");return W.isArrayBuffer(g)||W.isTypedArray(g)?f&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function l(g,h,x){let p=g;if(g&&!x&&typeof g=="object"){if(W.endsWith(h,"{}"))h=r?h:h.slice(0,-2),g=JSON.stringify(g);else if(W.isArray(g)&&Zs(g)||(W.isFileList(g)||W.endsWith(h,"[]"))&&(p=W.toArray(g)))return h=va(h),p.forEach(function(b,C){!(W.isUndefined(b)||b===null)&&n.append(c===!0?Qr([h],C,a):c===null?h:h+"[]",s(b))}),!1}return Tr(g)?!0:(n.append(Qr(x,h,a),s(g)),!1)}const v=[],d=Object.assign(Js,{defaultVisitor:l,convertValue:s,isVisitable:Tr});function y(g,h){if(!W.isUndefined(g)){if(v.indexOf(g)!==-1)throw Error("Circular reference detected in "+h.join("."));v.push(g),W.forEach(g,function(p,m){(!(W.isUndefined(p)||p===null)&&o.call(n,p,W.isString(m)?m.trim():m,h,d))===!0&&y(p,h?h.concat(m):[m])}),v.pop()}}if(!W.isObject(t))throw new TypeError("data must be an object");return y(t),n}function Zr(t){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return n[r]})}function Nr(t,n){this._pairs=[],t&&An(t,this,n)}const ga=Nr.prototype;ga.append=function(n,e){this._pairs.push([n,e])};ga.toString=function(n){const e=n?function(r){return n.call(this,r,Zr)}:Zr;return this._pairs.map(function(o){return e(o[0])+"="+e(o[1])},"").join("&")};function e0(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ma(t,n,e){if(!n)return t;const r=e&&e.encode||e0;W.isFunction(e)&&(e={serialize:e});const o=e&&e.serialize;let a;if(o?a=o(n,e):a=W.isURLSearchParams(n)?n.toString():new Nr(n,e).toString(r),a){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class t0{constructor(){this.handlers=[]}use(n,e,r){return this.handlers.push({fulfilled:n,rejected:e,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){W.forEach(this.handlers,function(r){r!==null&&n(r)})}}const Jr=t0,pa={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},n0=typeof URLSearchParams<"u"?URLSearchParams:Nr,r0=typeof FormData<"u"?FormData:null,o0=typeof Blob<"u"?Blob:null,a0={isBrowser:!0,classes:{URLSearchParams:n0,FormData:r0,Blob:o0},protocols:["http","https","file","blob","url","data"]},Lr=typeof window<"u"&&typeof document<"u",Fr=typeof navigator=="object"&&navigator||void 0,s0=Lr&&(!Fr||["ReactNative","NativeScript","NS"].indexOf(Fr.product)<0),i0=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),l0=Lr&&window.location.href||"http://localhost",c0=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Lr,hasStandardBrowserEnv:s0,hasStandardBrowserWebWorkerEnv:i0,navigator:Fr,origin:l0},Symbol.toStringTag,{value:"Module"})),We={...c0,...a0};function u0(t,n){return An(t,new We.classes.URLSearchParams,Object.assign({visitor:function(e,r,o,a){return We.isNode&&W.isBuffer(e)?(this.append(r,e.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},n))}function d0(t){return W.matchAll(/\w+|\[(\w*)]/g,t).map(n=>n[0]==="[]"?"":n[1]||n[0])}function f0(t){const n={},e=Object.keys(t);let r;const o=e.length;let a;for(r=0;r<o;r++)a=e[r],n[a]=t[a];return n}function ha(t){function n(e,r,o,a){let c=e[a++];if(c==="__proto__")return!0;const u=Number.isFinite(+c),f=a>=e.length;return c=!c&&W.isArray(o)?o.length:c,f?(W.hasOwnProp(o,c)?o[c]=[o[c],r]:o[c]=r,!u):((!o[c]||!W.isObject(o[c]))&&(o[c]=[]),n(e,r,o[c],a)&&W.isArray(o[c])&&(o[c]=f0(o[c])),!u)}if(W.isFormData(t)&&W.isFunction(t.entries)){const e={};return W.forEachEntry(t,(r,o)=>{n(d0(r),o,e,0)}),e}return null}function x0(t,n,e){if(W.isString(t))try{return(n||JSON.parse)(t),W.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(e||JSON.stringify)(t)}const Hr={transitional:pa,adapter:["xhr","http","fetch"],transformRequest:[function(n,e){const r=e.getContentType()||"",o=r.indexOf("application/json")>-1,a=W.isObject(n);if(a&&W.isHTMLForm(n)&&(n=new FormData(n)),W.isFormData(n))return o?JSON.stringify(ha(n)):n;if(W.isArrayBuffer(n)||W.isBuffer(n)||W.isStream(n)||W.isFile(n)||W.isBlob(n)||W.isReadableStream(n))return n;if(W.isArrayBufferView(n))return n.buffer;if(W.isURLSearchParams(n))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let u;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return u0(n,this.formSerializer).toString();if((u=W.isFileList(n))||r.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return An(u?{"files[]":n}:n,f&&new f,this.formSerializer)}}return a||o?(e.setContentType("application/json",!1),x0(n)):n}],transformResponse:[function(n){const e=this.transitional||Hr.transitional,r=e&&e.forcedJSONParsing,o=this.responseType==="json";if(W.isResponse(n)||W.isReadableStream(n))return n;if(n&&W.isString(n)&&(r&&!this.responseType||o)){const c=!(e&&e.silentJSONParsing)&&o;try{return JSON.parse(n)}catch(u){if(c)throw u.name==="SyntaxError"?ce.from(u,ce.ERR_BAD_RESPONSE,this,null,this.response):u}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:We.classes.FormData,Blob:We.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};W.forEach(["delete","get","head","post","put","patch"],t=>{Hr.headers[t]={}});const jr=Hr,v0=W.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),g0=t=>{const n={};let e,r,o;return t&&t.split(`
`).forEach(function(c){o=c.indexOf(":"),e=c.substring(0,o).trim().toLowerCase(),r=c.substring(o+1).trim(),!(!e||n[e]&&v0[e])&&(e==="set-cookie"?n[e]?n[e].push(r):n[e]=[r]:n[e]=n[e]?n[e]+", "+r:r)}),n},eo=Symbol("internals");function zt(t){return t&&String(t).trim().toLowerCase()}function gn(t){return t===!1||t==null?t:W.isArray(t)?t.map(gn):String(t)}function m0(t){const n=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=e.exec(t);)n[r[1]]=r[2];return n}const p0=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Ln(t,n,e,r,o){if(W.isFunction(r))return r.call(this,n,e);if(o&&(n=e),!!W.isString(n)){if(W.isString(r))return n.indexOf(r)!==-1;if(W.isRegExp(r))return r.test(n)}}function h0(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,e,r)=>e.toUpperCase()+r)}function b0(t,n){const e=W.toCamelCase(" "+n);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+e,{value:function(o,a,c){return this[r].call(this,n,o,a,c)},configurable:!0})})}class Bn{constructor(n){n&&this.set(n)}set(n,e,r){const o=this;function a(u,f,s){const l=zt(f);if(!l)throw new Error("header name must be a non-empty string");const v=W.findKey(o,l);(!v||o[v]===void 0||s===!0||s===void 0&&o[v]!==!1)&&(o[v||f]=gn(u))}const c=(u,f)=>W.forEach(u,(s,l)=>a(s,l,f));if(W.isPlainObject(n)||n instanceof this.constructor)c(n,e);else if(W.isString(n)&&(n=n.trim())&&!p0(n))c(g0(n),e);else if(W.isObject(n)&&W.isIterable(n)){let u={},f,s;for(const l of n){if(!W.isArray(l))throw TypeError("Object iterator must return a key-value pair");u[s=l[0]]=(f=u[s])?W.isArray(f)?[...f,l[1]]:[f,l[1]]:l[1]}c(u,e)}else n!=null&&a(e,n,r);return this}get(n,e){if(n=zt(n),n){const r=W.findKey(this,n);if(r){const o=this[r];if(!e)return o;if(e===!0)return m0(o);if(W.isFunction(e))return e.call(this,o,r);if(W.isRegExp(e))return e.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,e){if(n=zt(n),n){const r=W.findKey(this,n);return!!(r&&this[r]!==void 0&&(!e||Ln(this,this[r],r,e)))}return!1}delete(n,e){const r=this;let o=!1;function a(c){if(c=zt(c),c){const u=W.findKey(r,c);u&&(!e||Ln(r,r[u],u,e))&&(delete r[u],o=!0)}}return W.isArray(n)?n.forEach(a):a(n),o}clear(n){const e=Object.keys(this);let r=e.length,o=!1;for(;r--;){const a=e[r];(!n||Ln(this,this[a],a,n,!0))&&(delete this[a],o=!0)}return o}normalize(n){const e=this,r={};return W.forEach(this,(o,a)=>{const c=W.findKey(r,a);if(c){e[c]=gn(o),delete e[a];return}const u=n?h0(a):String(a).trim();u!==a&&delete e[a],e[u]=gn(o),r[u]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const e=Object.create(null);return W.forEach(this,(r,o)=>{r!=null&&r!==!1&&(e[o]=n&&W.isArray(r)?r.join(", "):r)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,e])=>n+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...e){const r=new this(n);return e.forEach(o=>r.set(o)),r}static accessor(n){const r=(this[eo]=this[eo]={accessors:{}}).accessors,o=this.prototype;function a(c){const u=zt(c);r[u]||(b0(o,c),r[u]=!0)}return W.isArray(n)?n.forEach(a):a(n),this}}Bn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);W.reduceDescriptors(Bn.prototype,({value:t},n)=>{let e=n[0].toUpperCase()+n.slice(1);return{get:()=>t,set(r){this[e]=r}}});W.freezeMethods(Bn);const Je=Bn;function Hn(t,n){const e=this||jr,r=n||e,o=Je.from(r.headers);let a=r.data;return W.forEach(t,function(u){a=u.call(e,a,o.normalize(),n?n.status:void 0)}),o.normalize(),a}function ba(t){return!!(t&&t.__CANCEL__)}function Ot(t,n,e){ce.call(this,t??"canceled",ce.ERR_CANCELED,n,e),this.name="CanceledError"}W.inherits(Ot,ce,{__CANCEL__:!0});function ya(t,n,e){const r=e.config.validateStatus;!e.status||!r||r(e.status)?t(e):n(new ce("Request failed with status code "+e.status,[ce.ERR_BAD_REQUEST,ce.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function y0(t){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return n&&n[1]||""}function C0(t,n){t=t||10;const e=new Array(t),r=new Array(t);let o=0,a=0,c;return n=n!==void 0?n:1e3,function(f){const s=Date.now(),l=r[a];c||(c=s),e[o]=f,r[o]=s;let v=a,d=0;for(;v!==o;)d+=e[v++],v=v%t;if(o=(o+1)%t,o===a&&(a=(a+1)%t),s-c<n)return;const y=l&&s-l;return y?Math.round(d*1e3/y):void 0}}function w0(t,n){let e=0,r=1e3/n,o,a;const c=(s,l=Date.now())=>{e=l,o=null,a&&(clearTimeout(a),a=null),t.apply(null,s)};return[(...s)=>{const l=Date.now(),v=l-e;v>=r?c(s,l):(o=s,a||(a=setTimeout(()=>{a=null,c(o)},r-v)))},()=>o&&c(o)]}const hn=(t,n,e=3)=>{let r=0;const o=C0(50,250);return w0(a=>{const c=a.loaded,u=a.lengthComputable?a.total:void 0,f=c-r,s=o(f),l=c<=u;r=c;const v={loaded:c,total:u,progress:u?c/u:void 0,bytes:f,rate:s||void 0,estimated:s&&u&&l?(u-c)/s:void 0,event:a,lengthComputable:u!=null,[n?"download":"upload"]:!0};t(v)},e)},to=(t,n)=>{const e=t!=null;return[r=>n[0]({lengthComputable:e,total:t,loaded:r}),n[1]]},no=t=>(...n)=>W.asap(()=>t(...n)),E0=We.hasStandardBrowserEnv?((t,n)=>e=>(e=new URL(e,We.origin),t.protocol===e.protocol&&t.host===e.host&&(n||t.port===e.port)))(new URL(We.origin),We.navigator&&/(msie|trident)/i.test(We.navigator.userAgent)):()=>!0,_0=We.hasStandardBrowserEnv?{write(t,n,e,r,o,a){const c=[t+"="+encodeURIComponent(n)];W.isNumber(e)&&c.push("expires="+new Date(e).toGMTString()),W.isString(r)&&c.push("path="+r),W.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function A0(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function B0(t,n){return n?t.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):t}function Ca(t,n,e){let r=!A0(n);return t&&(r||e==!1)?B0(t,n):n}const ro=t=>t instanceof Je?{...t}:t;function kt(t,n){n=n||{};const e={};function r(s,l,v,d){return W.isPlainObject(s)&&W.isPlainObject(l)?W.merge.call({caseless:d},s,l):W.isPlainObject(l)?W.merge({},l):W.isArray(l)?l.slice():l}function o(s,l,v,d){if(W.isUndefined(l)){if(!W.isUndefined(s))return r(void 0,s,v,d)}else return r(s,l,v,d)}function a(s,l){if(!W.isUndefined(l))return r(void 0,l)}function c(s,l){if(W.isUndefined(l)){if(!W.isUndefined(s))return r(void 0,s)}else return r(void 0,l)}function u(s,l,v){if(v in n)return r(s,l);if(v in t)return r(void 0,s)}const f={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:u,headers:(s,l,v)=>o(ro(s),ro(l),v,!0)};return W.forEach(Object.keys(Object.assign({},t,n)),function(l){const v=f[l]||o,d=v(t[l],n[l],l);W.isUndefined(d)&&v!==u||(e[l]=d)}),e}const wa=t=>{const n=kt({},t);let{data:e,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:a,headers:c,auth:u}=n;n.headers=c=Je.from(c),n.url=ma(Ca(n.baseURL,n.url,n.allowAbsoluteUrls),t.params,t.paramsSerializer),u&&c.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let f;if(W.isFormData(e)){if(We.hasStandardBrowserEnv||We.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((f=c.getContentType())!==!1){const[s,...l]=f?f.split(";").map(v=>v.trim()).filter(Boolean):[];c.setContentType([s||"multipart/form-data",...l].join("; "))}}if(We.hasStandardBrowserEnv&&(r&&W.isFunction(r)&&(r=r(n)),r||r!==!1&&E0(n.url))){const s=o&&a&&_0.read(a);s&&c.set(o,s)}return n},k0=typeof XMLHttpRequest<"u",D0=k0&&function(t){return new Promise(function(e,r){const o=wa(t);let a=o.data;const c=Je.from(o.headers).normalize();let{responseType:u,onUploadProgress:f,onDownloadProgress:s}=o,l,v,d,y,g;function h(){y&&y(),g&&g(),o.cancelToken&&o.cancelToken.unsubscribe(l),o.signal&&o.signal.removeEventListener("abort",l)}let x=new XMLHttpRequest;x.open(o.method.toUpperCase(),o.url,!0),x.timeout=o.timeout;function p(){if(!x)return;const b=Je.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders()),w={data:!u||u==="text"||u==="json"?x.responseText:x.response,status:x.status,statusText:x.statusText,headers:b,config:t,request:x};ya(function(D){e(D),h()},function(D){r(D),h()},w),x=null}"onloadend"in x?x.onloadend=p:x.onreadystatechange=function(){!x||x.readyState!==4||x.status===0&&!(x.responseURL&&x.responseURL.indexOf("file:")===0)||setTimeout(p)},x.onabort=function(){x&&(r(new ce("Request aborted",ce.ECONNABORTED,t,x)),x=null)},x.onerror=function(){r(new ce("Network Error",ce.ERR_NETWORK,t,x)),x=null},x.ontimeout=function(){let C=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const w=o.transitional||pa;o.timeoutErrorMessage&&(C=o.timeoutErrorMessage),r(new ce(C,w.clarifyTimeoutError?ce.ETIMEDOUT:ce.ECONNABORTED,t,x)),x=null},a===void 0&&c.setContentType(null),"setRequestHeader"in x&&W.forEach(c.toJSON(),function(C,w){x.setRequestHeader(w,C)}),W.isUndefined(o.withCredentials)||(x.withCredentials=!!o.withCredentials),u&&u!=="json"&&(x.responseType=o.responseType),s&&([d,g]=hn(s,!0),x.addEventListener("progress",d)),f&&x.upload&&([v,y]=hn(f),x.upload.addEventListener("progress",v),x.upload.addEventListener("loadend",y)),(o.cancelToken||o.signal)&&(l=b=>{x&&(r(!b||b.type?new Ot(null,t,x):b),x.abort(),x=null)},o.cancelToken&&o.cancelToken.subscribe(l),o.signal&&(o.signal.aborted?l():o.signal.addEventListener("abort",l)));const m=y0(o.url);if(m&&We.protocols.indexOf(m)===-1){r(new ce("Unsupported protocol "+m+":",ce.ERR_BAD_REQUEST,t));return}x.send(a||null)})},T0=(t,n)=>{const{length:e}=t=t?t.filter(Boolean):[];if(n||e){let r=new AbortController,o;const a=function(s){if(!o){o=!0,u();const l=s instanceof Error?s:this.reason;r.abort(l instanceof ce?l:new Ot(l instanceof Error?l.message:l))}};let c=n&&setTimeout(()=>{c=null,a(new ce(`timeout ${n} of ms exceeded`,ce.ETIMEDOUT))},n);const u=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(s=>{s.unsubscribe?s.unsubscribe(a):s.removeEventListener("abort",a)}),t=null)};t.forEach(s=>s.addEventListener("abort",a));const{signal:f}=r;return f.unsubscribe=()=>W.asap(u),f}},F0=T0,S0=function*(t,n){let e=t.byteLength;if(!n||e<n){yield t;return}let r=0,o;for(;r<e;)o=r+n,yield t.slice(r,o),r=o},R0=async function*(t,n){for await(const e of $0(t))yield*S0(e,n)},$0=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const n=t.getReader();try{for(;;){const{done:e,value:r}=await n.read();if(e)break;yield r}}finally{await n.cancel()}},oo=(t,n,e,r)=>{const o=R0(t,n);let a=0,c,u=f=>{c||(c=!0,r&&r(f))};return new ReadableStream({async pull(f){try{const{done:s,value:l}=await o.next();if(s){u(),f.close();return}let v=l.byteLength;if(e){let d=a+=v;e(d)}f.enqueue(new Uint8Array(l))}catch(s){throw u(s),s}},cancel(f){return u(f),o.return()}},{highWaterMark:2})},kn=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Ea=kn&&typeof ReadableStream=="function",I0=kn&&(typeof TextEncoder=="function"?(t=>n=>t.encode(n))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),_a=(t,...n)=>{try{return!!t(...n)}catch{return!1}},P0=Ea&&_a(()=>{let t=!1;const n=new Request(We.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!n}),ao=64*1024,Sr=Ea&&_a(()=>W.isReadableStream(new Response("").body)),bn={stream:Sr&&(t=>t.body)};kn&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(n=>{!bn[n]&&(bn[n]=W.isFunction(t[n])?e=>e[n]():(e,r)=>{throw new ce(`Response type '${n}' is not supported`,ce.ERR_NOT_SUPPORT,r)})})})(new Response);const M0=async t=>{if(t==null)return 0;if(W.isBlob(t))return t.size;if(W.isSpecCompliantForm(t))return(await new Request(We.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(W.isArrayBufferView(t)||W.isArrayBuffer(t))return t.byteLength;if(W.isURLSearchParams(t)&&(t=t+""),W.isString(t))return(await I0(t)).byteLength},O0=async(t,n)=>{const e=W.toFiniteNumber(t.getContentLength());return e??M0(n)},W0=kn&&(async t=>{let{url:n,method:e,data:r,signal:o,cancelToken:a,timeout:c,onDownloadProgress:u,onUploadProgress:f,responseType:s,headers:l,withCredentials:v="same-origin",fetchOptions:d}=wa(t);s=s?(s+"").toLowerCase():"text";let y=F0([o,a&&a.toAbortSignal()],c),g;const h=y&&y.unsubscribe&&(()=>{y.unsubscribe()});let x;try{if(f&&P0&&e!=="get"&&e!=="head"&&(x=await O0(l,r))!==0){let w=new Request(n,{method:"POST",body:r,duplex:"half"}),A;if(W.isFormData(r)&&(A=w.headers.get("content-type"))&&l.setContentType(A),w.body){const[D,S]=to(x,hn(no(f)));r=oo(w.body,ao,D,S)}}W.isString(v)||(v=v?"include":"omit");const p="credentials"in Request.prototype;g=new Request(n,{...d,signal:y,method:e.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:p?v:void 0});let m=await fetch(g);const b=Sr&&(s==="stream"||s==="response");if(Sr&&(u||b&&h)){const w={};["status","statusText","headers"].forEach(z=>{w[z]=m[z]});const A=W.toFiniteNumber(m.headers.get("content-length")),[D,S]=u&&to(A,hn(no(u),!0))||[];m=new Response(oo(m.body,ao,D,()=>{S&&S(),h&&h()}),w)}s=s||"text";let C=await bn[W.findKey(bn,s)||"text"](m,t);return!b&&h&&h(),await new Promise((w,A)=>{ya(w,A,{data:C,headers:Je.from(m.headers),status:m.status,statusText:m.statusText,config:t,request:g})})}catch(p){throw h&&h(),p&&p.name==="TypeError"&&/Load failed|fetch/i.test(p.message)?Object.assign(new ce("Network Error",ce.ERR_NETWORK,t,g),{cause:p.cause||p}):ce.from(p,p&&p.code,t,g)}}),Rr={http:Qs,xhr:D0,fetch:W0};W.forEach(Rr,(t,n)=>{if(t){try{Object.defineProperty(t,"name",{value:n})}catch{}Object.defineProperty(t,"adapterName",{value:n})}});const so=t=>`- ${t}`,N0=t=>W.isFunction(t)||t===null||t===!1,Aa={getAdapter:t=>{t=W.isArray(t)?t:[t];const{length:n}=t;let e,r;const o={};for(let a=0;a<n;a++){e=t[a];let c;if(r=e,!N0(e)&&(r=Rr[(c=String(e)).toLowerCase()],r===void 0))throw new ce(`Unknown adapter '${c}'`);if(r)break;o[c||"#"+a]=r}if(!r){const a=Object.entries(o).map(([u,f])=>`adapter ${u} `+(f===!1?"is not supported by the environment":"is not available in the build"));let c=n?a.length>1?`since :
`+a.map(so).join(`
`):" "+so(a[0]):"as no adapter specified";throw new ce("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return r},adapters:Rr};function jn(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ot(null,t)}function io(t){return jn(t),t.headers=Je.from(t.headers),t.data=Hn.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Aa.getAdapter(t.adapter||jr.adapter)(t).then(function(r){return jn(t),r.data=Hn.call(t,t.transformResponse,r),r.headers=Je.from(r.headers),r},function(r){return ba(r)||(jn(t),r&&r.response&&(r.response.data=Hn.call(t,t.transformResponse,r.response),r.response.headers=Je.from(r.response.headers))),Promise.reject(r)})}const Ba="1.9.0",Dn={};["object","boolean","number","function","string","symbol"].forEach((t,n)=>{Dn[t]=function(r){return typeof r===t||"a"+(n<1?"n ":" ")+t}});const lo={};Dn.transitional=function(n,e,r){function o(a,c){return"[Axios v"+Ba+"] Transitional option '"+a+"'"+c+(r?". "+r:"")}return(a,c,u)=>{if(n===!1)throw new ce(o(c," has been removed"+(e?" in "+e:"")),ce.ERR_DEPRECATED);return e&&!lo[c]&&(lo[c]=!0,console.warn(o(c," has been deprecated since v"+e+" and will be removed in the near future"))),n?n(a,c,u):!0}};Dn.spelling=function(n){return(e,r)=>(console.warn(`${r} is likely a misspelling of ${n}`),!0)};function L0(t,n,e){if(typeof t!="object")throw new ce("options must be an object",ce.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let o=r.length;for(;o-- >0;){const a=r[o],c=n[a];if(c){const u=t[a],f=u===void 0||c(u,a,t);if(f!==!0)throw new ce("option "+a+" must be "+f,ce.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new ce("Unknown option "+a,ce.ERR_BAD_OPTION)}}const mn={assertOptions:L0,validators:Dn},st=mn.validators;class yn{constructor(n){this.defaults=n||{},this.interceptors={request:new Jr,response:new Jr}}async request(n,e){try{return await this._request(n,e)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const a=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(n,e){typeof n=="string"?(e=e||{},e.url=n):e=n||{},e=kt(this.defaults,e);const{transitional:r,paramsSerializer:o,headers:a}=e;r!==void 0&&mn.assertOptions(r,{silentJSONParsing:st.transitional(st.boolean),forcedJSONParsing:st.transitional(st.boolean),clarifyTimeoutError:st.transitional(st.boolean)},!1),o!=null&&(W.isFunction(o)?e.paramsSerializer={serialize:o}:mn.assertOptions(o,{encode:st.function,serialize:st.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),mn.assertOptions(e,{baseUrl:st.spelling("baseURL"),withXsrfToken:st.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let c=a&&W.merge(a.common,a[e.method]);a&&W.forEach(["delete","get","head","post","put","patch","common"],g=>{delete a[g]}),e.headers=Je.concat(c,a);const u=[];let f=!0;this.interceptors.request.forEach(function(h){typeof h.runWhen=="function"&&h.runWhen(e)===!1||(f=f&&h.synchronous,u.unshift(h.fulfilled,h.rejected))});const s=[];this.interceptors.response.forEach(function(h){s.push(h.fulfilled,h.rejected)});let l,v=0,d;if(!f){const g=[io.bind(this),void 0];for(g.unshift.apply(g,u),g.push.apply(g,s),d=g.length,l=Promise.resolve(e);v<d;)l=l.then(g[v++],g[v++]);return l}d=u.length;let y=e;for(v=0;v<d;){const g=u[v++],h=u[v++];try{y=g(y)}catch(x){h.call(this,x);break}}try{l=io.call(this,y)}catch(g){return Promise.reject(g)}for(v=0,d=s.length;v<d;)l=l.then(s[v++],s[v++]);return l}getUri(n){n=kt(this.defaults,n);const e=Ca(n.baseURL,n.url,n.allowAbsoluteUrls);return ma(e,n.params,n.paramsSerializer)}}W.forEach(["delete","get","head","options"],function(n){yn.prototype[n]=function(e,r){return this.request(kt(r||{},{method:n,url:e,data:(r||{}).data}))}});W.forEach(["post","put","patch"],function(n){function e(r){return function(a,c,u){return this.request(kt(u||{},{method:n,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}yn.prototype[n]=e(),yn.prototype[n+"Form"]=e(!0)});const pn=yn;class Ur{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(a){e=a});const r=this;this.promise.then(o=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](o);r._listeners=null}),this.promise.then=o=>{let a;const c=new Promise(u=>{r.subscribe(u),a=u}).then(o);return c.cancel=function(){r.unsubscribe(a)},c},n(function(a,c,u){r.reason||(r.reason=new Ot(a,c,u),e(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const e=this._listeners.indexOf(n);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const n=new AbortController,e=r=>{n.abort(r)};return this.subscribe(e),n.signal.unsubscribe=()=>this.unsubscribe(e),n.signal}static source(){let n;return{token:new Ur(function(o){n=o}),cancel:n}}}const H0=Ur;function j0(t){return function(e){return t.apply(null,e)}}function U0(t){return W.isObject(t)&&t.isAxiosError===!0}const $r={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($r).forEach(([t,n])=>{$r[n]=t});const q0=$r;function ka(t){const n=new pn(t),e=oa(pn.prototype.request,n);return W.extend(e,pn.prototype,n,{allOwnKeys:!0}),W.extend(e,n,null,{allOwnKeys:!0}),e.create=function(o){return ka(kt(t,o))},e}const Ae=ka(jr);Ae.Axios=pn;Ae.CanceledError=Ot;Ae.CancelToken=H0;Ae.isCancel=ba;Ae.VERSION=Ba;Ae.toFormData=An;Ae.AxiosError=ce;Ae.Cancel=Ae.CanceledError;Ae.all=function(n){return Promise.all(n)};Ae.spread=j0;Ae.isAxiosError=U0;Ae.mergeConfig=kt;Ae.AxiosHeaders=Je;Ae.formToJSON=t=>ha(W.isHTMLForm(t)?new FormData(t):t);Ae.getAdapter=Aa.getAdapter;Ae.HttpStatusCode=q0;Ae.default=Ae;const co=Ae,ut="d2e4870307a7be95c6173111",dt="hmmLdoyJSvJe2KV2",z0="5d6664673bdb0b63f8da4ed1dd055a57a702";let qr=!1;async function G0(){try{const t=await fetch(`https://spacetalk.metered.live/api/v1/turn/credentials?apiKey=${z0}`);if(!t.ok)return console.error("Failed to fetch TURN credentials from API:",t.status,t.statusText),null;const n=await t.json();return n&&Array.isArray(n)?(qr=!0,console.log("Successfully fetched TURN credentials from Metered API"),{iceServers:n,iceCandidatePoolSize:15,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}):(console.warn("API returned invalid TURN credentials format, using fallback"),null)}catch(t){return console.error("Failed to fetch TURN credentials from API, using fallback:",t),null}}async function V0(){try{const t=window.location.origin;console.log(`Fetching TURN credentials from ${t}/api/turn-credentials`);const n=new AbortController,e=setTimeout(()=>n.abort(),8e3),r=await co.get(`${t}/api/turn-credentials`,{signal:n.signal,timeout:8e3});return clearTimeout(e),r.data&&r.data.success&&r.data.rtcConfig?(qr=!0,console.log("Successfully fetched TURN credentials from server"),r.data.rtcConfig):(console.warn("Server returned invalid TURN credentials format, using fallback"),null)}catch(t){return co.isAxiosError(t)?t.code==="ECONNABORTED"||t.message.includes("timeout")?console.error("TURN credentials request timed out"):t.response?console.error(`TURN credentials request failed with status ${t.response.status}`):t.request?console.error("TURN credentials request made but no response received"):console.error("Failed to fetch TURN credentials:",t.message):console.error("Failed to fetch TURN credentials, using fallback:",t),null}}const zr={iceServers:[{urls:"stun:stun.relay.metered.ca:80"},{urls:"turn:global.relay.metered.ca:80",username:ut,credential:dt},{urls:"turn:global.relay.metered.ca:80?transport=tcp",username:ut,credential:dt},{urls:"turn:global.relay.metered.ca:443",username:ut,credential:dt},{urls:"turns:global.relay.metered.ca:443?transport=tcp",username:ut,credential:dt},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"}],iceCandidatePoolSize:15,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},uo={iceServers:[{urls:"turn:global.relay.metered.ca:80",username:ut,credential:dt},{urls:"turn:global.relay.metered.ca:80?transport=tcp",username:ut,credential:dt},{urls:"turn:global.relay.metered.ca:443",username:ut,credential:dt},{urls:"turns:global.relay.metered.ca:443?transport=tcp",username:ut,credential:dt}],iceCandidatePoolSize:15,iceTransportPolicy:"relay",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},fo={iceServers:[{urls:"stun:stun.relay.metered.ca:80"},{urls:"stun:stun.l.google.com:19302"},{urls:"turn:global.relay.metered.ca:80",username:ut,credential:dt}],iceCandidatePoolSize:8,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};async function K0(){try{const t=await G0();if(t)return t;if(!qr){const n=await V0();if(n)return n}}catch(t){console.error("Error fetching optimal configuration:",t)}return zr}function Y0(){const t="test";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(n){return console.error("localStorage is not available:",n),!1}}function Da(){const t=N(Y0());function n(a,c){if(!t.value){console.warn("localStorage is not available, cannot set item");return}try{localStorage.setItem(a,c)}catch(u){console.error("Failed to set localStorage item:",u)}}function e(a){if(!t.value)return console.warn("localStorage is not available, cannot get item"),null;try{return localStorage.getItem(a)}catch(c){return console.error("Failed to get localStorage item:",c),null}}function r(a){if(!t.value){console.warn("localStorage is not available, cannot remove item");return}try{localStorage.removeItem(a)}catch(c){console.error("Failed to remove localStorage item:",c)}}function o(){if(!t.value){console.warn("localStorage is not available, cannot clear storage");return}try{localStorage.clear()}catch(a){console.error("Failed to clear localStorage:",a)}}return{isAvailable:t,setItem:n,getItem:e,removeItem:r,clear:o}}function Vt(){const{getItem:t,setItem:n}=Da(),e="spacechat_microphone_muted";function r(c){n(e,c?"true":"false")}function o(){const c=t(e);return c===null?null:c==="true"}function a(c){return new Promise(async u=>{try{const f=o();f!==null&&(console.log(`[Storage] Found saved microphone state: ${f?"muted":"unmuted"}`),f===!0&&await c())}catch(f){console.error("[Storage] Error applying saved microphone state:",f)}u()})}return{saveMicrophoneState:r,getSavedMicrophoneState:o,applySavedMicrophoneState:a}}let At=zr;const Ta=N(At);K0().then(t=>{At=t,Ta.value=t,console.log("Loaded optimal WebRTC configuration from server")}).catch(t=>{console.error("Failed to load optimal configuration, using fallback:",t)});let Z=null,re=null,le=null;const $e=N("new"),Ye=N(!1),qe=N(null),oe=!0;let He="",Ze="",xo=null,Me=!1,un=!1,Oe=0;const _t=15;let Xe=[],$t=null;const X0=8e3,Q0=800;let It=null,lt=0;const dn=10,Z0=1e3;async function Fa(){if(!Z)return{error:"No peer connection available"};try{const t={};return(await Z.getStats()).forEach(e=>{e.type==="transport"?t.transport={bytesReceived:e.bytesReceived,bytesSent:e.bytesSent,dtlsState:e.dtlsState,selectedCandidatePairId:e.selectedCandidatePairId}:e.type==="candidate-pair"&&e.selected?t.selectedCandidatePair={localCandidateId:e.localCandidateId,remoteCandidateId:e.remoteCandidateId,state:e.state,availableOutgoingBitrate:e.availableOutgoingBitrate}:e.type==="local-candidate"||e.type==="remote-candidate"?(t.candidates||(t.candidates=[]),t.candidates.push({type:e.type,id:e.id,ip:e.ip,port:e.port,protocol:e.protocol,candidateType:e.candidateType})):(e.type==="media-source"||e.type==="track"||e.type==="media-playout")&&(t.media||(t.media=[]),t.media.push({type:e.type,id:e.id,kind:e.kind,audioLevel:e.audioLevel,trackIdentifier:e.trackIdentifier}))}),t}catch(t){return console.error("[WebRTC] Error getting stats:",t),{error:"Failed to get stats: "+t}}}function J0(){Ir();const t=setInterval(async()=>{Z&&($e.value==="connected"||$e.value==="connecting")?(xo=await Fa(),console.log("[WebRTC] Connection stats:",xo)):Ir()},5e3);window.__webrtcStatsTimer=t}function Ir(){const t=window.__webrtcStatsTimer;t&&(clearInterval(t),window.__webrtcStatsTimer=null)}function Sa(){const{socket:t,userId:n,isInSetupContext:e}=Ie(),r=Nn(Z),o=Nn(re),a=Nn(le),c=$e,u=Ye,f=qe;N({echoCancellation:!0,noiseSuppression:!0});const s=async()=>{if(re&&re.getAudioTracks().length>0)return console.log("[WebRTC] Reusing existing local stream"),re;try{oe&&console.log("[WebRTC] Requesting microphone access");const k=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1}),R=k.getAudioTracks();if(R.length===0)throw new Error("No audio tracks available in media stream");oe&&(console.log(`[WebRTC] Got local stream with ${R.length} audio tracks`),console.log("[WebRTC] Audio track settings:",R[0].getSettings())),re=k,o.value=k;const{getSavedMicrophoneState:$}=Vt();return $()===!0?(oe&&console.log("[WebRTC] Applying saved mute state to new stream (muted)"),R.forEach(I=>{I.enabled=!1}),Ye.value=!0,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!0}}))):(R.forEach(I=>{I.enabled=!0}),Ye.value=!1),k}catch(k){throw console.error("[WebRTC] Error accessing microphone:",k),Ze=`Failed to access microphone: ${k}`,k}},l=()=>{if(Z)try{Z.close(),Z=null,le&&(le.getTracks().forEach(k=>{k.stop()}),le=null)}catch(k){console.error("[WebRTC] Error cleaning up old peer connection:",k)}try{const k=new RTCPeerConnection(Ta.value);return k.onnegotiationneeded=async R=>{if(oe&&console.log("[WebRTC] Negotiation needed event",R),!ei(k)||Me){oe&&console.log("[WebRTC] Skipping negotiation - already in progress or not in stable state");return}Me=!0;try{oe&&console.log("[WebRTC] Starting negotiation"),B()}catch($){console.error("[WebRTC] Negotiation error:",$),Ze=`Negotiation error: ${$}`,Me=!1}},k.oniceconnectionstatechange=()=>{oe&&console.log("[WebRTC] ICE Connection state changed to:",k.iceConnectionState),k.iceConnectionState==="connected"||k.iceConnectionState==="completed"?(Ze="",Oe=0,A(),J0()):(k.iceConnectionState==="disconnected"||k.iceConnectionState==="failed"||k.iceConnectionState==="closed")&&(pt(k.iceConnectionState),oe&&console.log("[WebRTC] ICE Connection terminated:",k.iceConnectionState),qe.value&&t.value&&t.value.emit("webrtc-connection-state",{to:qe.value,state:k.iceConnectionState,reason:"ice-connection-state-change"}),(k.iceConnectionState==="failed"||k.iceConnectionState==="closed")&&setTimeout(()=>{(k.iceConnectionState==="failed"||k.iceConnectionState==="closed")&&pt("failed")},2e3))},k.onicecandidate=R=>{var $;R.candidate?(oe&&console.log("[WebRTC] New ICE candidate:",R.candidate),window.__localIceCandidates||(window.__localIceCandidates=[]),window.__localIceCandidates.push(R.candidate),f.value?($=t.value)==null||$.emit("webrtc-signal",{type:"ice-candidate",candidate:R.candidate,to:f.value}):(Xe.push(R.candidate),oe&&console.log("[WebRTC] Storing ICE candidate for later. Total pending:",Xe.length))):(oe&&console.log("[WebRTC] ICE gathering complete"),Xe.length>0&&f.value&&(Xe.forEach(F=>{var I;(I=t.value)==null||I.emit("webrtc-signal",{type:"ice-candidate",candidate:F,to:f.value})}),oe&&console.log(`[WebRTC] Sent ${Xe.length} pending ICE candidates`),Xe=[]))},k.onicegatheringstatechange=()=>{oe&&console.log("[WebRTC] ICE gathering state changed to:",k.iceGatheringState)},k.onconnectionstatechange=()=>{oe&&console.log("[WebRTC] Connection state changed to:",k.connectionState),pt(k.connectionState),k.connectionState==="connected"?(Ze="",Oe=0):(k.connectionState==="failed"||k.connectionState==="disconnected"||k.connectionState==="closed")&&k.connectionState==="failed"&&!Ze&&(Ze="PeerConnection failed")},k.onsignalingstatechange=()=>{oe&&console.log("[WebRTC] Signaling state changed to:",k.signalingState),k.signalingState==="stable"&&(Me=!1)},k.ontrack=R=>{oe&&console.log("[WebRTC] Track received:",R.track),le||(le=new MediaStream,a.value=le,console.log("[WebRTC] Created new remote stream")),le.addTrack(R.track),console.log(`[WebRTC] Added ${R.track.kind} track to remote stream, now has ${le.getTracks().length} tracks`),setTimeout(()=>{if(le){const $=le.getTracks();console.log(`[WebRTC] Remote stream has ${$.length} tracks after adding`),$.forEach(F=>{console.log(`[WebRTC] Track: ${F.kind}, enabled: ${F.enabled}, muted: ${F.muted}, readyState: ${F.readyState}`),F.kind==="audio"&&(!F.enabled||F.muted)&&(console.log("[WebRTC] 🔴 Found disabled or muted audio track, enabling it"),F.enabled=!0)})}},500),oe&&(R.track.onunmute=()=>{console.log("[WebRTC] Track unmuted:",R.track.kind)},R.track.onmute=()=>{console.log("[WebRTC] Track muted:",R.track.kind),R.track.enabled=!0},R.track.onended=()=>{console.log("[WebRTC] Track ended:",R.track.kind)})},S(k),Z=k,k}catch(k){throw console.error("[WebRTC] Error creating peer connection:",k),He=`Creation error: ${k}`,Ze="Failed to create connection",pt("failed"),k}},v=async k=>{if(!k||!t.value){const R="لا يمكن إنشاء الاتصال: معرّف الشريك أو الاتصال غير متوفر";return console.error(`[WebRTC] ${R}`),He=R,{error:R}}qe.value=k,f.value=k;try{re||await s();const R=l();if(re)re.getTracks().forEach($=>{R.addTrack($,re)});else throw new Error("لا يمكن الوصول للميكروفون");return pt("connecting"),R}catch(R){return console.error("[WebRTC] Error establishing connection:",R),He=`خطأ في إنشاء الاتصال: ${R}`,{error:He}}},d=async k=>{if(window.__webrtcConnectionTimeout&&clearTimeout(window.__webrtcConnectionTimeout),Me)return console.warn("[WebRTC] مفاوضة جارية بالفعل، تأجيل العرض الجديد"),new Promise(R=>{setTimeout(async()=>{R(Me?{waiting:"Negotiation in progress"}:await d(k))},1e3)});Me=!0;try{const R=await v(k);if(R.error)return R;oe&&console.log("[WebRTC] Creating offer");const $=await R.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1});return oe&&console.log("[WebRTC] Setting local description"),await R.setLocalDescription($),t.value&&k&&(t.value.emit("voice-offer",{offer:R.localDescription,to:k}),t.value.emit("webrtc-signal",{type:"offer",offer:R.localDescription,to:k})),S(R),A(),oe&&console.log("[WebRTC] Offer creation complete"),{success:!0}}catch(R){return console.error("[WebRTC] Error creating offer:",R),He=`Error creating offer: ${R}`,Me=!1,{error:`Failed to create offer: ${R}`}}finally{setTimeout(()=>{Me=!1},2e3)}},y=k=>{if(console.log("Waiting for ICE gathering to complete..."),k.iceGatheringState==="complete")return console.log("ICE gathering already complete"),Promise.resolve();const R=6e3,$=500,F=Math.ceil(R/$);let I=0,L=0;return new Promise(K=>{const V=()=>{if(I++,k.iceGatheringState==="complete"){console.log(`ICE gathering complete after ${I} attempts`),K();return}if(window.__localIceCandidates&&window.__localIceCandidates.length>L&&(L=window.__localIceCandidates.length,console.log(`ICE candidates collected so far: ${L}`)),L>=3&&I>F/2){console.log(`Sufficient ICE candidates (${L}) collected after ${I} attempts`),K();return}if(I>=F){console.log(`Reached maximum attempts (${F}), proceeding with ${L} ICE candidates`),K();return}setTimeout(V,$)};k.addEventListener("icegatheringstatechange",()=>{console.log("ICE gathering state changed:",k.iceGatheringState),k.iceGatheringState==="complete"&&K()}),setTimeout(V,0)})},g=async(k,R)=>{if(!t.value){console.error("[WebRTC] Cannot handle offer: socket not available");return}console.log("[WebRTC] Received offer from:",R),console.log("[WebRTC] Offer SDP:",k.sdp),qe.value=R,f.value=R;try{re||(oe&&console.log("[WebRTC] Initializing local stream before handling offer"),await s());const $=l();if(re&&($.getSenders().length===0?(oe&&console.log("[WebRTC] Adding local tracks to connection"),re.getTracks().forEach(L=>{$.addTrack(L,re)})):oe&&console.log("[WebRTC] Senders already exist, not adding tracks again")),$e.value="connecting",c.value="connecting",oe&&console.log("[WebRTC] Setting remote description (offer)"),await $.setRemoteDescription(new RTCSessionDescription(k)),Xe.length>0){oe&&console.log(`[WebRTC] Adding ${Xe.length} pending ICE candidates`);for(const I of Xe)try{await $.addIceCandidate(I)}catch(L){console.error("[WebRTC] Error adding pending ICE candidate:",L)}Xe=[]}oe&&console.log("[WebRTC] Creating answer");const F=await $.createAnswer({offerToReceiveAudio:!0});oe&&console.log("[WebRTC] Answer SDP:",F.sdp),oe&&console.log("[WebRTC] Setting local description (answer)"),await $.setLocalDescription(F),$.getTransceivers().forEach(I=>{if(I.receiver.track.kind==="audio"&&(console.log("[WebRTC] Ensuring audio transceiver is set to receive"),I.direction!=="sendrecv"&&I.direction!=="recvonly"))try{I.direction="sendrecv"}catch(L){console.error("[WebRTC] Could not update transceiver direction:",L)}}),await y($),oe&&console.log("[WebRTC] Sending answer to:",R),t.value.emit("voice-answer",{answer:$.localDescription,to:R}),t.value.emit("webrtc-signal",{type:"answer",answer:$.localDescription,to:R}),S($),A(),oe&&console.log("[WebRTC] Offer handling and answer creation complete")}catch($){console.error("[WebRTC] Error handling offer:",$),He=`Error handling offer: ${$}`,setTimeout(()=>{t.value&&f.value&&(console.log("[WebRTC] Re-negotiating after offer error"),d(f.value))},2e3)}},h=async k=>{try{if(!Z){oe&&console.log("[WebRTC] Cannot handle answer: no peer connection available");return}const R=Z.signalingState;if(oe&&console.log(`[WebRTC] Current signaling state before handling answer: ${R}`),R==="have-local-offer"){oe&&console.log("[WebRTC] Setting remote description from answer");try{await Z.setRemoteDescription(new RTCSessionDescription(k)),oe&&console.log("[WebRTC] Remote description set successfully, signaling state now: "+Z.signalingState)}catch($){if(console.error("[WebRTC] Error setting remote description:",$),$.toString().includes("InvalidStateError"))if(console.warn("[WebRTC] Invalid state error, attempting to recover"),await new Promise(F=>setTimeout(F,1e3)),Z.signalingState==="have-local-offer")try{oe&&console.log("[WebRTC] Retrying set remote description after delay"),await Z.setRemoteDescription(new RTCSessionDescription(k)),oe&&console.log("[WebRTC] Remote description set successfully on retry")}catch(F){console.error("[WebRTC] Final error setting remote description:",F)}else console.warn(`[WebRTC] Cannot set remote answer, wrong state: ${Z.signalingState}`)}}else console.warn(`[WebRTC] Cannot set remote description: wrong signaling state: ${R}`),R==="stable"?oe&&console.log("[WebRTC] Already in stable state, ignoring answer"):R==="have-remote-offer"&&(console.warn("[WebRTC] We have a remote offer but received an answer - signaling confusion"),Oe<_t&&(Oe++,oe&&console.log(`[WebRTC] Resetting connection due to signaling confusion (${Oe}/${_t})`),p(),setTimeout(()=>{f.value&&d(f.value)},2e3)))}catch(R){console.error("[WebRTC] Error handling answer:",R),He=`Error handling answer: ${R}`,console.log("[WebRTC] Attempting to recover from answer error"),Oe<_t&&await C()}},x=async()=>{const k=!Ye.value,{saveMicrophoneState:R}=Vt();if(R(k),k)return console.log("[WebRTC] Muting microphone - stopping all tracks"),re&&re.getAudioTracks().forEach($=>{$.enabled=!1}),Ye.value=!0,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!0}})),!0;console.log("[WebRTC] Unmuting microphone");try{if(re&&re.getAudioTracks().length>0)return re.getAudioTracks().forEach(F=>{F.enabled=!0}),Ye.value=!1,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!1}})),!0;const $=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1});if($.getAudioTracks().length===0)throw new Error("No audio tracks available");if(re=$,o.value=$,Z&&$)try{const I=Z.getSenders().find(L=>L.track&&L.track.kind==="audio");if(I){const L=$.getAudioTracks()[0];L&&I.replaceTrack(L)}else $.getAudioTracks().length>0&&$.getAudioTracks().forEach(L=>{Z&&Z.addTrack(L,$)})}catch(F){console.error("[WebRTC] Error adding audio tracks:",F)}return Ye.value=!1,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!1}})),!0}catch($){console.error("[WebRTC] Error unmuting microphone:",$);try{const F=await navigator.mediaDevices.getUserMedia({audio:!0});return re=F,o.value=F,Ye.value=!1,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:!1}})),!0}catch(F){return console.error("[WebRTC] Fallback microphone access also failed:",F),!1}}},p=()=>{if(console.log("[WebRTC] Closing connection"),D(),Z){try{Z.ontrack=null,Z.onicecandidate=null,Z.oniceconnectionstatechange=null,Z.onicegatheringstatechange=null,Z.onsignalingstatechange=null,Z.onconnectionstatechange=null;try{Z.getTransceivers&&Z.getTransceivers().forEach(k=>{k.stop&&k.stop()})}catch{}Z.close(),oe&&console.log("[WebRTC] Peer connection closed")}catch(k){console.error("[WebRTC] Error closing peer connection:",k)}Z=null}le&&(le.getTracks().forEach(k=>{k.stop()}),le=new MediaStream,a.value=le),$e.value="closed",c.value="closed",window.dispatchEvent(new CustomEvent("connection-closed",{detail:{timestamp:Date.now()}}))},m=()=>{p(),U(),re&&(re.getTracks().forEach(k=>{k.stop()}),re=null,o.value=null),le&&(le.getTracks().forEach(k=>{k.stop()}),le=new MediaStream,a.value=le),Z=null,r.value=null,$e.value="closed",c.value="closed",lt=0};function b(){var k,R;if(!t.value){console.log("[WebRTC] No socket available, cannot set up listeners");return}console.log("[WebRTC] Setting up socket listeners"),t.value.off("webrtc-signal"),t.value.off("ice-candidate"),t.value.off("partner-disconnected"),t.value.off("webrtc-connection-failed"),t.value.off("connection-timeout"),t.value.off("webrtc-connection-state"),t.value.off("voice-offer"),t.value.off("voice-answer"),t.value.on("webrtc-signal",async $=>{if(console.log(`[WebRTC] Received ${$.type} signal from ${$.from}`),qe.value=$.from,f.value=$.from,$.type==="offer"&&$.offer)try{await g($.offer,$.from)}catch(F){console.error("[WebRTC] Error handling offer:",F),He=`Error handling offer: ${F}`,t.value&&t.value.emit("webrtc-connection-failed",{to:$.from,reason:`Failed to handle offer: ${F}`})}else if($.type==="answer"&&$.answer)try{await h($.answer)}catch(F){console.error("[WebRTC] Error handling answer:",F),He=`Error handling answer: ${F}`,t.value&&t.value.emit("webrtc-connection-failed",{to:$.from,reason:`Failed to handle answer: ${F}`})}}),t.value.on("ice-candidate",async $=>{if(console.log(`[WebRTC] Received ICE candidate from ${$.from}`),$.from!==f.value){console.log("[WebRTC] Ignoring ICE candidate from different partner");return}try{await z($.candidate)}catch(F){console.error("[WebRTC] Error handling ICE candidate:",F),He=`Error handling ICE candidate: ${F}`}}),t.value.on("webrtc-connection-failed",$=>{console.log(`[WebRTC] Connection failed notification from ${$.from}: ${$.reason}`),Oe<_t?(Oe++,console.log(`[WebRTC] Partner reported connection failure. Retry ${Oe}/${_t}`),$.from===f.value&&setTimeout(()=>{f.value&&t.value&&d($.from)},Q0)):($e.value="failed",He=`Partner reported failure: ${$.reason}`)}),t.value.on("partner-disconnected",($={})=>{console.log("[WebRTC] Partner disconnected event:",$),p(),D(),Ir(),qe.value=null,f.value=null,$e.value="closed",c.value="closed",$&&$.reason&&console.log(`[WebRTC] Disconnection reason: ${$.reason}`),console.log("[WebRTC] WebRTC connection fully closed due to partner disconnection"),window.dispatchEvent(new CustomEvent("connection-state-changed",{detail:{state:"disconnected",reason:$.reason||"partner-left"}}))}),t.value.on("webrtc-connection-state",$=>{console.log(`[WebRTC] Received connection state update from partner: ${$.state} (reason: ${$.reason})`),($.state==="failed"||$.state==="closed"||$.state==="disconnected")&&($.state==="failed"||$.state==="closed"?(pt("failed"),window.dispatchEvent(new CustomEvent("connection-state-changed",{detail:{state:"failed",reason:$.reason||"connection-failed"}})),Z&&Z.connectionState!=="closed"&&(console.log("[WebRTC] Closing local connection due to remote state:",$.state),p())):(console.log("[WebRTC] Partner connection state is disconnected, waiting to see if it recovers"),window.dispatchEvent(new CustomEvent("connection-state-changed",{detail:{state:"disconnected",reason:"network-disconnect",temporary:!0}}))))}),t.value.on("disconnect-partner",()=>{console.log("[WebRTC] Disconnect partner event received - preserving mic mute state");const $=Ye.value;console.log(`[WebRTC] Current mute state before disconnect: ${$?"muted":"unmuted"}`)}),t.value.on("matched",async $=>{if(console.log("[WebRTC] Matched event received - ensuring mic state is correct"),$&&$.partnerId&&(f.value=$.partnerId,qe.value=$.partnerId),re&&re.getAudioTracks().length>0){const{getSavedMicrophoneState:F}=Vt(),I=F();I!==null&&(console.log(`[WebRTC] Applying saved mic state to active stream: ${I?"muted":"unmuted"}`),re.getAudioTracks().forEach(L=>{L.enabled=!I}),Ye.value=I,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:I}})))}else try{await s()}catch(F){console.error("[WebRTC] Error initializing stream after match:",F)}}),(k=t.value)==null||k.on("disconnect",()=>{console.log("[WebRTC] Socket disconnected, cleaning up WebRTC connection"),U()}),(R=t.value)==null||R.on("reconnect",()=>{console.log("[WebRTC] Socket reconnected, attempting to recover WebRTC connection"),qe.value&&It===null&&P(qe.value)})}b(),xt(()=>{U()});async function C(){if(!(!Z||!f.value)){console.log("[WebRTC] Attempting connection recovery");try{if(un=!0,At===zr?(At=fo,console.log("[WebRTC] Switching to fast configuration for quicker connection")):Oe>5&&(At=uo,console.log("[WebRTC] Switching to TURN-only configuration")),Z.restartIce){Z.restartIce();const k=await Z.createOffer({iceRestart:!0,offerToReceiveAudio:!0});await Z.setLocalDescription(k),t.value&&(t.value.emit("offer",{offer:Z.localDescription,to:f.value}),t.value.emit("webrtc-signal",{type:"offer",offer:Z.localDescription,to:f.value}))}setTimeout(()=>{un=!1},500)}catch(k){console.error("[WebRTC] Recovery attempt failed:",k),un=!1,Oe<_t&&setTimeout(()=>{p(),f.value&&d(f.value)},200)}}}function w(){typeof window<"u"&&(window.__webrtc_debug={connectionState:$e.value,connectionRetryCount:Oe,lastConnectionError:He,failureReason:Ze,isNegotiating:Me,isRestartingIce:un,pendingCandidates:Xe.length,hasLocalTracks:re?re.getAudioTracks().length>0:!1,hasRemoteTracks:le?le.getAudioTracks().length>0:!1})}Te(()=>$e.value,()=>{w()});function A(){$t&&clearInterval($t),typeof window<"u"&&(window.__localIceCandidates=[],window.__remoteIceCandidates=[],window.__iceCandidatePairs=[]),Z&&(Z.onicecandidate=k=>{k.candidate&&(console.log("[WebRTC] ICE candidate generated:",k.candidate.candidate),typeof window<"u"&&(window.__localIceCandidates=window.__localIceCandidates||[],window.__localIceCandidates.push({candidate:k.candidate.candidate,timestamp:Date.now()})),t.value&&qe.value&&t.value.emit("ice-candidate",{candidate:k.candidate,to:qe.value}))}),$t=window.setInterval(()=>{if(!Z||$e.value!=="connecting"&&$e.value!=="connected"){D();return}try{Q(),Fa().then(k=>{k&&k.iceCandidatePairs&&typeof window<"u"&&(window.__iceCandidatePairs=k.iceCandidatePairs)})}catch(k){console.error("[WebRTC] Error monitoring connection:",k)}},X0)}function D(){$t&&(clearInterval($t),$t=null)}function S(k){if(!f.value)return;window.__webrtcConnectionTimeout&&clearTimeout(window.__webrtcConnectionTimeout);const R=5e3;window.__webrtcConnectionTimeout=setTimeout(()=>{(k.connectionState==="connecting"||k.connectionState==="new")&&(console.log(`[WebRTC] Connection not established after ${R/1e3} seconds, trying fast config`),At=fo,f.value&&!Me&&d(f.value),window.__webrtcConnectionTimeout=setTimeout(()=>{var $,F,I;if(k.connectionState==="connecting"||k.connectionState==="new"){console.log("[WebRTC] Connection still not established, trying TURN-only config");const L={localCandidates:(($=window.__localIceCandidates)==null?void 0:$.length)||0,remoteCandidates:((F=window.__remoteIceCandidates)==null?void 0:F.length)||0,iceCandidatePairsCount:((I=window.__iceCandidatePairs)==null?void 0:I.length)||0};console.log("[WebRTC] Connection diagnostic info:",JSON.stringify(L)),At=uo,p(),f.value&&setTimeout(()=>{d(f.value)},200)}},5e3))},R)}const z=async k=>{if(!Z){console.log("[WebRTC] Received ICE candidate but no peer connection exists");return}try{if(oe&&console.log("[WebRTC] Adding received ICE candidate:",k.candidate),window.__remoteIceCandidates||(window.__remoteIceCandidates=[]),window.__remoteIceCandidates.push(k),!Z.remoteDescription||!Z.localDescription){oe&&console.log("[WebRTC] Delaying ICE candidate addition until descriptions are set"),setTimeout(async()=>{if(Z&&Z.remoteDescription){oe&&console.log("[WebRTC] Adding delayed ICE candidate after timeout");try{await Z.addIceCandidate(k)}catch(R){console.error("[WebRTC] Error adding delayed ICE candidate:",R)}}},1e3);return}await Z.addIceCandidate(k),oe&&console.log("[WebRTC] Successfully added ICE candidate")}catch(R){console.error("[WebRTC] Error adding ICE candidate:",R),He=`Error adding ICE candidate: ${R}`,setTimeout(async()=>{if(Z&&Z.remoteDescription){console.log("[WebRTC] Retrying to add ICE candidate after error");try{await Z.addIceCandidate(k),oe&&console.log("[WebRTC] Successfully added ICE candidate on retry")}catch($){console.error("[WebRTC] Error adding ICE candidate on retry:",$)}}},2e3)}};function B(){if(!Z||!f.value||Me){console.log("[WebRTC] Cannot start negotiation: missing connection, partner ID, or already negotiating");return}console.log("[WebRTC] Starting new negotiation"),Me=!0;try{Z.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1}).then(k=>{if(Z)return Z.setLocalDescription(k)}).then(()=>{!Z||!t.value||!f.value||(t.value.emit("voice-offer",{offer:Z.localDescription,to:f.value}),oe&&console.log("[WebRTC] Sent renegotiation offer"))}).catch(k=>{console.error("[WebRTC] Error during negotiation:",k)}).finally(()=>{setTimeout(()=>{Me=!1},2e3)})}catch(k){console.error("[WebRTC] Failed to start negotiation:",k),Me=!1}}const _={connectionState:$e.value,iceCandidatesGenerated:Xe.length,localStreamActive:!!re&&re.active,remoteStreamActive:!!le&&le.active,localTracks:re?re.getAudioTracks().length:0,remoteTracks:le?le.getAudioTracks().length:0,connectionRetries:Oe,lastError:He||Ze||"",isAudioMuted:Ye.value,forceReconnect:()=>Z&&$e.value!=="new"?(C(),!0):!1},O=async()=>{if(!re){console.log("[WebRTC] No local stream to restore microphone state on");return}const{getSavedMicrophoneState:k}=Vt(),R=k();if(R===null){console.log("[WebRTC] No saved microphone state found");return}console.log(`[WebRTC] Restoring saved microphone state: ${R?"muted":"unmuted"}`),re&&re.getAudioTracks().length>0&&(re.getAudioTracks().forEach($=>{console.log(`[WebRTC] Setting track '${$.label}' enabled = ${!R}`),$.enabled=!R}),Ye.value=R,window.dispatchEvent(new CustomEvent("microphone-state-changed",{detail:{isMuted:R}})))},E=async(k=null)=>{var R;console.log(`[WebRTC] Initializing connection with partner ${k||"unknown"}`);try{qe.value=k,lt=0,re||await s(),await O(),Z&&p(),l(),A(),Z&&S(Z),k&&((R=t.value)==null||R.emit("ready-for-call",{to:k})),console.log("[WebRTC] Connection initialized successfully")}catch($){throw console.error("[WebRTC] Failed to initialize connection:",$),Q(),$}};function P(k){p(),lt++;const R=Math.min(Z0*Math.pow(1.5,lt-1),3e4);console.log(`[WebRTC] Attempting reconnection ${lt}/${dn} after ${R}ms`),U(),It=window.setTimeout(async()=>{var $,F,I;if(It=null,lt>=dn){console.log(`[WebRTC] Reached maximum reconnection attempts (${dn})`),pt("failed"),($=t.value)==null||$.emit("webrtc-connection-state",{state:"failed",to:k,details:{attempts:lt}}),(F=t.value)==null||F.emit("return-to-queue",{reason:"connection-failed"});return}try{await E(k),k&&((I=t.value)==null||I.emit("webrtc-reconnect",{to:k,details:{attempts:lt}}),B())}catch(L){console.error("[WebRTC] Reconnection attempt failed:",L),lt<dn?P(k):pt("failed")}},R)}function U(){It!==null&&(clearTimeout(It),It=null)}function Q(){if(console.log("[WebRTC] 🔍 Diagnosing connection issues"),!Z)return console.log("[WebRTC] 🔴 No connection exists"),!1;if(console.log(`[WebRTC] Connection state: ${Z.connectionState}`),console.log(`[WebRTC] ICE connection state: ${Z.iceConnectionState}`),console.log(`[WebRTC] Signaling state: ${Z.signalingState}`),!re||re.getAudioTracks().length===0){console.log("[WebRTC] 🔴 No local audio stream");try{s().catch(R=>console.error("[WebRTC] Failed to reinitialize local stream:",R))}catch(R){console.error("[WebRTC] Error initializing stream:",R)}return!1}if(!le||le.getAudioTracks().length===0){console.log("[WebRTC] 🔴 No remote audio stream");const $=Z.getReceivers().filter(F=>F.track&&F.track.kind==="audio");if($.length>0&&(le||(le=new MediaStream),$.forEach(F=>{F.track&&(console.log("[WebRTC] Adding track from receiver to remote stream:",F.track.id),le.addTrack(F.track))}),a.value=le),!le||le.getAudioTracks().length===0)return!Me&&qe.value&&B(),!1}return setTimeout(()=>{const R=document.querySelectorAll("audio");R.length>0&&le&&(console.log(`[WebRTC] Found ${R.length} audio elements, ensuring they use remote stream`),Array.from(R).forEach(($,F)=>{$.srcObject!==le&&(console.log(`[WebRTC] Audio element ${F} not using correct stream, updating`),$.srcObject=le,$.muted=!1,$.volume=1,$.play().catch(I=>console.log("[WebRTC] Error playing audio:",I)))}))},100),[...(re==null?void 0:re.getTracks())||[],...(le==null?void 0:le.getTracks())||[]].every(R=>R.kind!=="audio"||R.kind==="audio"&&R.enabled)||(console.log("[WebRTC] 🟠 Found disabled tracks, enabling them"),le==null||le.getAudioTracks().forEach(R=>{R.enabled=!0}),Ye.value||re==null||re.getAudioTracks().forEach(R=>{R.enabled=!0})),!0}return{socket:t,peerConnection:r,remoteStream:a,localStream:o,connectionState:c,isAudioMuted:u,partnerId:f,createOffer:d,handleOffer:g,handleAnswer:h,handleIceCandidate:z,toggleMicrophone:x,closeConnection:p,initializeLocalStream:s,cleanup:m,diagnosticReport:_,restoreMicrophoneState:O,initializeConnection:E,diagnoseAndFixConnection:Q,startNegotiation:B,attemptReconnection:P}}function ei(t){return t.signalingState==="stable"||t.signalingState==="have-remote-offer"}function pt(t){$e.value!==t&&(console.log(`[WebRTC] Connection state changing from ${$e.value} to ${t}`),$e.value=t,t==="connected"||t==="completed"?(Ze="",He="",Oe=0,console.log("[WebRTC] Connection established successfully")):(t==="failed"||t==="disconnected")&&(console.warn(`[WebRTC] Connection ${t}: ${Ze||"Unknown reason"}`),t==="failed"&&(Oe++,console.log(`[WebRTC] Connection failure count: ${Oe}/${_t}`))))}const Re=[];for(let t=0;t<256;++t)Re.push((t+256).toString(16).slice(1));function ti(t,n=0){return(Re[t[n+0]]+Re[t[n+1]]+Re[t[n+2]]+Re[t[n+3]]+"-"+Re[t[n+4]]+Re[t[n+5]]+"-"+Re[t[n+6]]+Re[t[n+7]]+"-"+Re[t[n+8]]+Re[t[n+9]]+"-"+Re[t[n+10]]+Re[t[n+11]]+Re[t[n+12]]+Re[t[n+13]]+Re[t[n+14]]+Re[t[n+15]]).toLowerCase()}let Un;const ni=new Uint8Array(16);function ri(){if(!Un){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Un=crypto.getRandomValues.bind(crypto)}return Un(ni)}const oi=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),vo={randomUUID:oi};function Ra(t,n,e){var o;if(vo.randomUUID&&!n&&!t)return vo.randomUUID();t=t||{};const r=t.random??((o=t.rng)==null?void 0:o.call(t))??ri();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){if(e=e||0,e<0||e+16>n.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let a=0;a<16;++a)n[e+a]=r[a];return n}return ti(r)}var ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ai(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function si(t){if(t.__esModule)return t;var n=t.default;if(typeof n=="function"){var e=function r(){return this instanceof r?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};e.prototype=n.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var o=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return t[r]}})}),e}var $a={exports:{}};function ii(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qn={exports:{}};const li={},ci=Object.freeze(Object.defineProperty({__proto__:null,default:li},Symbol.toStringTag,{value:"Module"})),ui=si(ci);var go;function fe(){return go||(go=1,function(t,n){(function(e,r){t.exports=r()})(ue,function(){var e=e||function(r,o){var a;if(typeof window<"u"&&window.crypto&&(a=window.crypto),typeof self<"u"&&self.crypto&&(a=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(a=globalThis.crypto),!a&&typeof window<"u"&&window.msCrypto&&(a=window.msCrypto),!a&&typeof ue<"u"&&ue.crypto&&(a=ue.crypto),!a&&typeof ii=="function")try{a=ui}catch{}var c=function(){if(a){if(typeof a.getRandomValues=="function")try{return a.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof a.randomBytes=="function")try{return a.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},u=Object.create||function(){function m(){}return function(b){var C;return m.prototype=b,C=new m,m.prototype=null,C}}(),f={},s=f.lib={},l=s.Base=function(){return{extend:function(m){var b=u(this);return m&&b.mixIn(m),(!b.hasOwnProperty("init")||this.init===b.init)&&(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var m=this.extend();return m.init.apply(m,arguments),m},init:function(){},mixIn:function(m){for(var b in m)m.hasOwnProperty(b)&&(this[b]=m[b]);m.hasOwnProperty("toString")&&(this.toString=m.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),v=s.WordArray=l.extend({init:function(m,b){m=this.words=m||[],b!=o?this.sigBytes=b:this.sigBytes=m.length*4},toString:function(m){return(m||y).stringify(this)},concat:function(m){var b=this.words,C=m.words,w=this.sigBytes,A=m.sigBytes;if(this.clamp(),w%4)for(var D=0;D<A;D++){var S=C[D>>>2]>>>24-D%4*8&255;b[w+D>>>2]|=S<<24-(w+D)%4*8}else for(var z=0;z<A;z+=4)b[w+z>>>2]=C[z>>>2];return this.sigBytes+=A,this},clamp:function(){var m=this.words,b=this.sigBytes;m[b>>>2]&=4294967295<<32-b%4*8,m.length=r.ceil(b/4)},clone:function(){var m=l.clone.call(this);return m.words=this.words.slice(0),m},random:function(m){for(var b=[],C=0;C<m;C+=4)b.push(c());return new v.init(b,m)}}),d=f.enc={},y=d.Hex={stringify:function(m){for(var b=m.words,C=m.sigBytes,w=[],A=0;A<C;A++){var D=b[A>>>2]>>>24-A%4*8&255;w.push((D>>>4).toString(16)),w.push((D&15).toString(16))}return w.join("")},parse:function(m){for(var b=m.length,C=[],w=0;w<b;w+=2)C[w>>>3]|=parseInt(m.substr(w,2),16)<<24-w%8*4;return new v.init(C,b/2)}},g=d.Latin1={stringify:function(m){for(var b=m.words,C=m.sigBytes,w=[],A=0;A<C;A++){var D=b[A>>>2]>>>24-A%4*8&255;w.push(String.fromCharCode(D))}return w.join("")},parse:function(m){for(var b=m.length,C=[],w=0;w<b;w++)C[w>>>2]|=(m.charCodeAt(w)&255)<<24-w%4*8;return new v.init(C,b)}},h=d.Utf8={stringify:function(m){try{return decodeURIComponent(escape(g.stringify(m)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(m){return g.parse(unescape(encodeURIComponent(m)))}},x=s.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new v.init,this._nDataBytes=0},_append:function(m){typeof m=="string"&&(m=h.parse(m)),this._data.concat(m),this._nDataBytes+=m.sigBytes},_process:function(m){var b,C=this._data,w=C.words,A=C.sigBytes,D=this.blockSize,S=D*4,z=A/S;m?z=r.ceil(z):z=r.max((z|0)-this._minBufferSize,0);var B=z*D,_=r.min(B*4,A);if(B){for(var O=0;O<B;O+=D)this._doProcessBlock(w,O);b=w.splice(0,B),C.sigBytes-=_}return new v.init(b,_)},clone:function(){var m=l.clone.call(this);return m._data=this._data.clone(),m},_minBufferSize:0});s.Hasher=x.extend({cfg:l.extend(),init:function(m){this.cfg=this.cfg.extend(m),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(m){return this._append(m),this._process(),this},finalize:function(m){m&&this._append(m);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(m){return function(b,C){return new m.init(C).finalize(b)}},_createHmacHelper:function(m){return function(b,C){return new p.HMAC.init(m,C).finalize(b)}}});var p=f.algo={};return f}(Math);return e})}(qn)),qn.exports}var zn={exports:{}},mo;function Tn(){return mo||(mo=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){return function(r){var o=e,a=o.lib,c=a.Base,u=a.WordArray,f=o.x64={};f.Word=c.extend({init:function(s,l){this.high=s,this.low=l}}),f.WordArray=c.extend({init:function(s,l){s=this.words=s||[],l!=r?this.sigBytes=l:this.sigBytes=s.length*8},toX32:function(){for(var s=this.words,l=s.length,v=[],d=0;d<l;d++){var y=s[d];v.push(y.high),v.push(y.low)}return u.create(v,this.sigBytes)},clone:function(){for(var s=c.clone.call(this),l=s.words=this.words.slice(0),v=l.length,d=0;d<v;d++)l[d]=l[d].clone();return s}})}(),e})}(zn)),zn.exports}var Gn={exports:{}},po;function di(){return po||(po=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){return function(){if(typeof ArrayBuffer=="function"){var r=e,o=r.lib,a=o.WordArray,c=a.init,u=a.init=function(f){if(f instanceof ArrayBuffer&&(f=new Uint8Array(f)),(f instanceof Int8Array||typeof Uint8ClampedArray<"u"&&f instanceof Uint8ClampedArray||f instanceof Int16Array||f instanceof Uint16Array||f instanceof Int32Array||f instanceof Uint32Array||f instanceof Float32Array||f instanceof Float64Array)&&(f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength)),f instanceof Uint8Array){for(var s=f.byteLength,l=[],v=0;v<s;v++)l[v>>>2]|=f[v]<<24-v%4*8;c.call(this,l,s)}else c.apply(this,arguments)};u.prototype=a}}(),e.lib.WordArray})}(Gn)),Gn.exports}var Vn={exports:{}},ho;function fi(){return ho||(ho=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=r.enc;c.Utf16=c.Utf16BE={stringify:function(f){for(var s=f.words,l=f.sigBytes,v=[],d=0;d<l;d+=2){var y=s[d>>>2]>>>16-d%4*8&65535;v.push(String.fromCharCode(y))}return v.join("")},parse:function(f){for(var s=f.length,l=[],v=0;v<s;v++)l[v>>>1]|=f.charCodeAt(v)<<16-v%2*16;return a.create(l,s*2)}},c.Utf16LE={stringify:function(f){for(var s=f.words,l=f.sigBytes,v=[],d=0;d<l;d+=2){var y=u(s[d>>>2]>>>16-d%4*8&65535);v.push(String.fromCharCode(y))}return v.join("")},parse:function(f){for(var s=f.length,l=[],v=0;v<s;v++)l[v>>>1]|=u(f.charCodeAt(v)<<16-v%2*16);return a.create(l,s*2)}};function u(f){return f<<8&4278255360|f>>>8&16711935}}(),e.enc.Utf16})}(Vn)),Vn.exports}var Kn={exports:{}},bo;function Dt(){return bo||(bo=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=r.enc;c.Base64={stringify:function(f){var s=f.words,l=f.sigBytes,v=this._map;f.clamp();for(var d=[],y=0;y<l;y+=3)for(var g=s[y>>>2]>>>24-y%4*8&255,h=s[y+1>>>2]>>>24-(y+1)%4*8&255,x=s[y+2>>>2]>>>24-(y+2)%4*8&255,p=g<<16|h<<8|x,m=0;m<4&&y+m*.75<l;m++)d.push(v.charAt(p>>>6*(3-m)&63));var b=v.charAt(64);if(b)for(;d.length%4;)d.push(b);return d.join("")},parse:function(f){var s=f.length,l=this._map,v=this._reverseMap;if(!v){v=this._reverseMap=[];for(var d=0;d<l.length;d++)v[l.charCodeAt(d)]=d}var y=l.charAt(64);if(y){var g=f.indexOf(y);g!==-1&&(s=g)}return u(f,s,v)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function u(f,s,l){for(var v=[],d=0,y=0;y<s;y++)if(y%4){var g=l[f.charCodeAt(y-1)]<<y%4*2,h=l[f.charCodeAt(y)]>>>6-y%4*2,x=g|h;v[d>>>2]|=x<<24-d%4*8,d++}return a.create(v,d)}}(),e.enc.Base64})}(Kn)),Kn.exports}var Yn={exports:{}},yo;function xi(){return yo||(yo=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=r.enc;c.Base64url={stringify:function(f,s){s===void 0&&(s=!0);var l=f.words,v=f.sigBytes,d=s?this._safe_map:this._map;f.clamp();for(var y=[],g=0;g<v;g+=3)for(var h=l[g>>>2]>>>24-g%4*8&255,x=l[g+1>>>2]>>>24-(g+1)%4*8&255,p=l[g+2>>>2]>>>24-(g+2)%4*8&255,m=h<<16|x<<8|p,b=0;b<4&&g+b*.75<v;b++)y.push(d.charAt(m>>>6*(3-b)&63));var C=d.charAt(64);if(C)for(;y.length%4;)y.push(C);return y.join("")},parse:function(f,s){s===void 0&&(s=!0);var l=f.length,v=s?this._safe_map:this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var y=0;y<v.length;y++)d[v.charCodeAt(y)]=y}var g=v.charAt(64);if(g){var h=f.indexOf(g);h!==-1&&(l=h)}return u(f,l,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function u(f,s,l){for(var v=[],d=0,y=0;y<s;y++)if(y%4){var g=l[f.charCodeAt(y-1)]<<y%4*2,h=l[f.charCodeAt(y)]>>>6-y%4*2,x=g|h;v[d>>>2]|=x<<24-d%4*8,d++}return a.create(v,d)}}(),e.enc.Base64url})}(Yn)),Yn.exports}var Xn={exports:{}},Co;function Tt(){return Co||(Co=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){return function(r){var o=e,a=o.lib,c=a.WordArray,u=a.Hasher,f=o.algo,s=[];(function(){for(var h=0;h<64;h++)s[h]=r.abs(r.sin(h+1))*4294967296|0})();var l=f.MD5=u.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(h,x){for(var p=0;p<16;p++){var m=x+p,b=h[m];h[m]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360}var C=this._hash.words,w=h[x+0],A=h[x+1],D=h[x+2],S=h[x+3],z=h[x+4],B=h[x+5],_=h[x+6],O=h[x+7],E=h[x+8],P=h[x+9],U=h[x+10],Q=h[x+11],k=h[x+12],R=h[x+13],$=h[x+14],F=h[x+15],I=C[0],L=C[1],K=C[2],V=C[3];I=v(I,L,K,V,w,7,s[0]),V=v(V,I,L,K,A,12,s[1]),K=v(K,V,I,L,D,17,s[2]),L=v(L,K,V,I,S,22,s[3]),I=v(I,L,K,V,z,7,s[4]),V=v(V,I,L,K,B,12,s[5]),K=v(K,V,I,L,_,17,s[6]),L=v(L,K,V,I,O,22,s[7]),I=v(I,L,K,V,E,7,s[8]),V=v(V,I,L,K,P,12,s[9]),K=v(K,V,I,L,U,17,s[10]),L=v(L,K,V,I,Q,22,s[11]),I=v(I,L,K,V,k,7,s[12]),V=v(V,I,L,K,R,12,s[13]),K=v(K,V,I,L,$,17,s[14]),L=v(L,K,V,I,F,22,s[15]),I=d(I,L,K,V,A,5,s[16]),V=d(V,I,L,K,_,9,s[17]),K=d(K,V,I,L,Q,14,s[18]),L=d(L,K,V,I,w,20,s[19]),I=d(I,L,K,V,B,5,s[20]),V=d(V,I,L,K,U,9,s[21]),K=d(K,V,I,L,F,14,s[22]),L=d(L,K,V,I,z,20,s[23]),I=d(I,L,K,V,P,5,s[24]),V=d(V,I,L,K,$,9,s[25]),K=d(K,V,I,L,S,14,s[26]),L=d(L,K,V,I,E,20,s[27]),I=d(I,L,K,V,R,5,s[28]),V=d(V,I,L,K,D,9,s[29]),K=d(K,V,I,L,O,14,s[30]),L=d(L,K,V,I,k,20,s[31]),I=y(I,L,K,V,B,4,s[32]),V=y(V,I,L,K,E,11,s[33]),K=y(K,V,I,L,Q,16,s[34]),L=y(L,K,V,I,$,23,s[35]),I=y(I,L,K,V,A,4,s[36]),V=y(V,I,L,K,z,11,s[37]),K=y(K,V,I,L,O,16,s[38]),L=y(L,K,V,I,U,23,s[39]),I=y(I,L,K,V,R,4,s[40]),V=y(V,I,L,K,w,11,s[41]),K=y(K,V,I,L,S,16,s[42]),L=y(L,K,V,I,_,23,s[43]),I=y(I,L,K,V,P,4,s[44]),V=y(V,I,L,K,k,11,s[45]),K=y(K,V,I,L,F,16,s[46]),L=y(L,K,V,I,D,23,s[47]),I=g(I,L,K,V,w,6,s[48]),V=g(V,I,L,K,O,10,s[49]),K=g(K,V,I,L,$,15,s[50]),L=g(L,K,V,I,B,21,s[51]),I=g(I,L,K,V,k,6,s[52]),V=g(V,I,L,K,S,10,s[53]),K=g(K,V,I,L,U,15,s[54]),L=g(L,K,V,I,A,21,s[55]),I=g(I,L,K,V,E,6,s[56]),V=g(V,I,L,K,F,10,s[57]),K=g(K,V,I,L,_,15,s[58]),L=g(L,K,V,I,R,21,s[59]),I=g(I,L,K,V,z,6,s[60]),V=g(V,I,L,K,Q,10,s[61]),K=g(K,V,I,L,D,15,s[62]),L=g(L,K,V,I,P,21,s[63]),C[0]=C[0]+I|0,C[1]=C[1]+L|0,C[2]=C[2]+K|0,C[3]=C[3]+V|0},_doFinalize:function(){var h=this._data,x=h.words,p=this._nDataBytes*8,m=h.sigBytes*8;x[m>>>5]|=128<<24-m%32;var b=r.floor(p/4294967296),C=p;x[(m+64>>>9<<4)+15]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,x[(m+64>>>9<<4)+14]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,h.sigBytes=(x.length+1)*4,this._process();for(var w=this._hash,A=w.words,D=0;D<4;D++){var S=A[D];A[D]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}return w},clone:function(){var h=u.clone.call(this);return h._hash=this._hash.clone(),h}});function v(h,x,p,m,b,C,w){var A=h+(x&p|~x&m)+b+w;return(A<<C|A>>>32-C)+x}function d(h,x,p,m,b,C,w){var A=h+(x&m|p&~m)+b+w;return(A<<C|A>>>32-C)+x}function y(h,x,p,m,b,C,w){var A=h+(x^p^m)+b+w;return(A<<C|A>>>32-C)+x}function g(h,x,p,m,b,C,w){var A=h+(p^(x|~m))+b+w;return(A<<C|A>>>32-C)+x}o.MD5=u._createHelper(l),o.HmacMD5=u._createHmacHelper(l)}(Math),e.MD5})}(Xn)),Xn.exports}var Qn={exports:{}},wo;function Ia(){return wo||(wo=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=o.Hasher,u=r.algo,f=[],s=u.SHA1=c.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,v){for(var d=this._hash.words,y=d[0],g=d[1],h=d[2],x=d[3],p=d[4],m=0;m<80;m++){if(m<16)f[m]=l[v+m]|0;else{var b=f[m-3]^f[m-8]^f[m-14]^f[m-16];f[m]=b<<1|b>>>31}var C=(y<<5|y>>>27)+p+f[m];m<20?C+=(g&h|~g&x)+1518500249:m<40?C+=(g^h^x)+1859775393:m<60?C+=(g&h|g&x|h&x)-1894007588:C+=(g^h^x)-899497514,p=x,x=h,h=g<<30|g>>>2,g=y,y=C}d[0]=d[0]+y|0,d[1]=d[1]+g|0,d[2]=d[2]+h|0,d[3]=d[3]+x|0,d[4]=d[4]+p|0},_doFinalize:function(){var l=this._data,v=l.words,d=this._nDataBytes*8,y=l.sigBytes*8;return v[y>>>5]|=128<<24-y%32,v[(y+64>>>9<<4)+14]=Math.floor(d/4294967296),v[(y+64>>>9<<4)+15]=d,l.sigBytes=v.length*4,this._process(),this._hash},clone:function(){var l=c.clone.call(this);return l._hash=this._hash.clone(),l}});r.SHA1=c._createHelper(s),r.HmacSHA1=c._createHmacHelper(s)}(),e.SHA1})}(Qn)),Qn.exports}var Zn={exports:{}},Eo;function Gr(){return Eo||(Eo=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){return function(r){var o=e,a=o.lib,c=a.WordArray,u=a.Hasher,f=o.algo,s=[],l=[];(function(){function y(p){for(var m=r.sqrt(p),b=2;b<=m;b++)if(!(p%b))return!1;return!0}function g(p){return(p-(p|0))*4294967296|0}for(var h=2,x=0;x<64;)y(h)&&(x<8&&(s[x]=g(r.pow(h,1/2))),l[x]=g(r.pow(h,1/3)),x++),h++})();var v=[],d=f.SHA256=u.extend({_doReset:function(){this._hash=new c.init(s.slice(0))},_doProcessBlock:function(y,g){for(var h=this._hash.words,x=h[0],p=h[1],m=h[2],b=h[3],C=h[4],w=h[5],A=h[6],D=h[7],S=0;S<64;S++){if(S<16)v[S]=y[g+S]|0;else{var z=v[S-15],B=(z<<25|z>>>7)^(z<<14|z>>>18)^z>>>3,_=v[S-2],O=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;v[S]=B+v[S-7]+O+v[S-16]}var E=C&w^~C&A,P=x&p^x&m^p&m,U=(x<<30|x>>>2)^(x<<19|x>>>13)^(x<<10|x>>>22),Q=(C<<26|C>>>6)^(C<<21|C>>>11)^(C<<7|C>>>25),k=D+Q+E+l[S]+v[S],R=U+P;D=A,A=w,w=C,C=b+k|0,b=m,m=p,p=x,x=k+R|0}h[0]=h[0]+x|0,h[1]=h[1]+p|0,h[2]=h[2]+m|0,h[3]=h[3]+b|0,h[4]=h[4]+C|0,h[5]=h[5]+w|0,h[6]=h[6]+A|0,h[7]=h[7]+D|0},_doFinalize:function(){var y=this._data,g=y.words,h=this._nDataBytes*8,x=y.sigBytes*8;return g[x>>>5]|=128<<24-x%32,g[(x+64>>>9<<4)+14]=r.floor(h/4294967296),g[(x+64>>>9<<4)+15]=h,y.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var y=u.clone.call(this);return y._hash=this._hash.clone(),y}});o.SHA256=u._createHelper(d),o.HmacSHA256=u._createHmacHelper(d)}(Math),e.SHA256})}(Zn)),Zn.exports}var Jn={exports:{}},_o;function vi(){return _o||(_o=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Gr())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=r.algo,u=c.SHA256,f=c.SHA224=u.extend({_doReset:function(){this._hash=new a.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var s=u._doFinalize.call(this);return s.sigBytes-=4,s}});r.SHA224=u._createHelper(f),r.HmacSHA224=u._createHmacHelper(f)}(),e.SHA224})}(Jn)),Jn.exports}var er={exports:{}},Ao;function Pa(){return Ao||(Ao=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Tn())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.Hasher,c=r.x64,u=c.Word,f=c.WordArray,s=r.algo;function l(){return u.create.apply(u,arguments)}var v=[l(1116352408,3609767458),l(1899447441,602891725),l(3049323471,3964484399),l(3921009573,2173295548),l(961987163,4081628472),l(1508970993,3053834265),l(2453635748,2937671579),l(2870763221,3664609560),l(3624381080,2734883394),l(310598401,1164996542),l(607225278,1323610764),l(1426881987,3590304994),l(1925078388,4068182383),l(2162078206,991336113),l(2614888103,633803317),l(3248222580,3479774868),l(3835390401,2666613458),l(4022224774,944711139),l(264347078,2341262773),l(604807628,2007800933),l(770255983,1495990901),l(1249150122,1856431235),l(1555081692,3175218132),l(1996064986,2198950837),l(2554220882,3999719339),l(2821834349,766784016),l(2952996808,2566594879),l(3210313671,3203337956),l(3336571891,1034457026),l(3584528711,2466948901),l(113926993,3758326383),l(338241895,168717936),l(666307205,1188179964),l(773529912,1546045734),l(1294757372,1522805485),l(1396182291,2643833823),l(1695183700,2343527390),l(1986661051,1014477480),l(2177026350,1206759142),l(2456956037,344077627),l(2730485921,1290863460),l(2820302411,3158454273),l(3259730800,3505952657),l(3345764771,106217008),l(3516065817,3606008344),l(3600352804,1432725776),l(4094571909,1467031594),l(275423344,851169720),l(430227734,3100823752),l(506948616,1363258195),l(659060556,3750685593),l(883997877,3785050280),l(958139571,3318307427),l(1322822218,3812723403),l(1537002063,2003034995),l(1747873779,3602036899),l(1955562222,1575990012),l(2024104815,1125592928),l(2227730452,2716904306),l(2361852424,442776044),l(2428436474,593698344),l(2756734187,3733110249),l(3204031479,2999351573),l(3329325298,3815920427),l(3391569614,3928383900),l(3515267271,566280711),l(3940187606,3454069534),l(4118630271,4000239992),l(116418474,1914138554),l(174292421,2731055270),l(289380356,3203993006),l(460393269,320620315),l(685471733,587496836),l(852142971,1086792851),l(1017036298,365543100),l(1126000580,2618297676),l(1288033470,3409855158),l(1501505948,4234509866),l(1607167915,987167468),l(1816402316,1246189591)],d=[];(function(){for(var g=0;g<80;g++)d[g]=l()})();var y=s.SHA512=a.extend({_doReset:function(){this._hash=new f.init([new u.init(1779033703,4089235720),new u.init(3144134277,2227873595),new u.init(1013904242,4271175723),new u.init(2773480762,1595750129),new u.init(1359893119,2917565137),new u.init(2600822924,725511199),new u.init(528734635,4215389547),new u.init(1541459225,327033209)])},_doProcessBlock:function(g,h){for(var x=this._hash.words,p=x[0],m=x[1],b=x[2],C=x[3],w=x[4],A=x[5],D=x[6],S=x[7],z=p.high,B=p.low,_=m.high,O=m.low,E=b.high,P=b.low,U=C.high,Q=C.low,k=w.high,R=w.low,$=A.high,F=A.low,I=D.high,L=D.low,K=S.high,V=S.low,me=z,xe=B,ye=_,ie=O,it=E,nt=P,rt=U,ot=Q,Ne=k,Be=R,vt=$,ee=F,X=I,ne=L,de=K,pe=V,he=0;he<80;he++){var be,ve,J=d[he];if(he<16)ve=J.high=g[h+he*2]|0,be=J.low=g[h+he*2+1]|0;else{var ke=d[he-15],Se=ke.high,bt=ke.low,Ft=(Se>>>1|bt<<31)^(Se>>>8|bt<<24)^Se>>>7,Qt=(bt>>>1|Se<<31)^(bt>>>8|Se<<24)^(bt>>>7|Se<<25),Zt=d[he-2],gt=Zt.high,yt=Zt.low,Fn=(gt>>>19|yt<<13)^(gt<<3|yt>>>29)^gt>>>6,Jt=(yt>>>19|gt<<13)^(yt<<3|gt>>>29)^(yt>>>6|gt<<26),en=d[he-7],Sn=en.high,Rn=en.low,tn=d[he-16],nn=tn.high,Ct=tn.low;be=Qt+Rn,ve=Ft+Sn+(be>>>0<Qt>>>0?1:0),be=be+Jt,ve=ve+Fn+(be>>>0<Jt>>>0?1:0),be=be+Ct,ve=ve+nn+(be>>>0<Ct>>>0?1:0),J.high=ve,J.low=be}var $n=Ne&vt^~Ne&X,Wt=Be&ee^~Be&ne,wt=me&ye^me&it^ye&it,In=xe&ie^xe&nt^ie&nt,Pn=(me>>>28|xe<<4)^(me<<30|xe>>>2)^(me<<25|xe>>>7),rn=(xe>>>28|me<<4)^(xe<<30|me>>>2)^(xe<<25|me>>>7),Nt=(Ne>>>14|Be<<18)^(Ne>>>18|Be<<14)^(Ne<<23|Be>>>9),Lt=(Be>>>14|Ne<<18)^(Be>>>18|Ne<<14)^(Be<<23|Ne>>>9),mt=v[he],on=mt.high,an=mt.low,Le=pe+Lt,at=de+Nt+(Le>>>0<pe>>>0?1:0),Le=Le+Wt,at=at+$n+(Le>>>0<Wt>>>0?1:0),Le=Le+an,at=at+on+(Le>>>0<an>>>0?1:0),Le=Le+be,at=at+ve+(Le>>>0<be>>>0?1:0),sn=rn+In,Mn=Pn+wt+(sn>>>0<rn>>>0?1:0);de=X,pe=ne,X=vt,ne=ee,vt=Ne,ee=Be,Be=ot+Le|0,Ne=rt+at+(Be>>>0<ot>>>0?1:0)|0,rt=it,ot=nt,it=ye,nt=ie,ye=me,ie=xe,xe=Le+sn|0,me=at+Mn+(xe>>>0<Le>>>0?1:0)|0}B=p.low=B+xe,p.high=z+me+(B>>>0<xe>>>0?1:0),O=m.low=O+ie,m.high=_+ye+(O>>>0<ie>>>0?1:0),P=b.low=P+nt,b.high=E+it+(P>>>0<nt>>>0?1:0),Q=C.low=Q+ot,C.high=U+rt+(Q>>>0<ot>>>0?1:0),R=w.low=R+Be,w.high=k+Ne+(R>>>0<Be>>>0?1:0),F=A.low=F+ee,A.high=$+vt+(F>>>0<ee>>>0?1:0),L=D.low=L+ne,D.high=I+X+(L>>>0<ne>>>0?1:0),V=S.low=V+pe,S.high=K+de+(V>>>0<pe>>>0?1:0)},_doFinalize:function(){var g=this._data,h=g.words,x=this._nDataBytes*8,p=g.sigBytes*8;h[p>>>5]|=128<<24-p%32,h[(p+128>>>10<<5)+30]=Math.floor(x/4294967296),h[(p+128>>>10<<5)+31]=x,g.sigBytes=h.length*4,this._process();var m=this._hash.toX32();return m},clone:function(){var g=a.clone.call(this);return g._hash=this._hash.clone(),g},blockSize:1024/32});r.SHA512=a._createHelper(y),r.HmacSHA512=a._createHmacHelper(y)}(),e.SHA512})}(er)),er.exports}var tr={exports:{}},Bo;function gi(){return Bo||(Bo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Tn(),Pa())})(ue,function(e){return function(){var r=e,o=r.x64,a=o.Word,c=o.WordArray,u=r.algo,f=u.SHA512,s=u.SHA384=f.extend({_doReset:function(){this._hash=new c.init([new a.init(3418070365,3238371032),new a.init(1654270250,914150663),new a.init(2438529370,812702999),new a.init(355462360,4144912697),new a.init(1731405415,4290775857),new a.init(2394180231,1750603025),new a.init(3675008525,1694076839),new a.init(1203062813,3204075428)])},_doFinalize:function(){var l=f._doFinalize.call(this);return l.sigBytes-=16,l}});r.SHA384=f._createHelper(s),r.HmacSHA384=f._createHmacHelper(s)}(),e.SHA384})}(tr)),tr.exports}var nr={exports:{}},ko;function mi(){return ko||(ko=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Tn())})(ue,function(e){return function(r){var o=e,a=o.lib,c=a.WordArray,u=a.Hasher,f=o.x64,s=f.Word,l=o.algo,v=[],d=[],y=[];(function(){for(var x=1,p=0,m=0;m<24;m++){v[x+5*p]=(m+1)*(m+2)/2%64;var b=p%5,C=(2*x+3*p)%5;x=b,p=C}for(var x=0;x<5;x++)for(var p=0;p<5;p++)d[x+5*p]=p+(2*x+3*p)%5*5;for(var w=1,A=0;A<24;A++){for(var D=0,S=0,z=0;z<7;z++){if(w&1){var B=(1<<z)-1;B<32?S^=1<<B:D^=1<<B-32}w&128?w=w<<1^113:w<<=1}y[A]=s.create(D,S)}})();var g=[];(function(){for(var x=0;x<25;x++)g[x]=s.create()})();var h=l.SHA3=u.extend({cfg:u.cfg.extend({outputLength:512}),_doReset:function(){for(var x=this._state=[],p=0;p<25;p++)x[p]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(x,p){for(var m=this._state,b=this.blockSize/2,C=0;C<b;C++){var w=x[p+2*C],A=x[p+2*C+1];w=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,A=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360;var D=m[C];D.high^=A,D.low^=w}for(var S=0;S<24;S++){for(var z=0;z<5;z++){for(var B=0,_=0,O=0;O<5;O++){var D=m[z+5*O];B^=D.high,_^=D.low}var E=g[z];E.high=B,E.low=_}for(var z=0;z<5;z++)for(var P=g[(z+4)%5],U=g[(z+1)%5],Q=U.high,k=U.low,B=P.high^(Q<<1|k>>>31),_=P.low^(k<<1|Q>>>31),O=0;O<5;O++){var D=m[z+5*O];D.high^=B,D.low^=_}for(var R=1;R<25;R++){var B,_,D=m[R],$=D.high,F=D.low,I=v[R];I<32?(B=$<<I|F>>>32-I,_=F<<I|$>>>32-I):(B=F<<I-32|$>>>64-I,_=$<<I-32|F>>>64-I);var L=g[d[R]];L.high=B,L.low=_}var K=g[0],V=m[0];K.high=V.high,K.low=V.low;for(var z=0;z<5;z++)for(var O=0;O<5;O++){var R=z+5*O,D=m[R],me=g[R],xe=g[(z+1)%5+5*O],ye=g[(z+2)%5+5*O];D.high=me.high^~xe.high&ye.high,D.low=me.low^~xe.low&ye.low}var D=m[0],ie=y[S];D.high^=ie.high,D.low^=ie.low}},_doFinalize:function(){var x=this._data,p=x.words;this._nDataBytes*8;var m=x.sigBytes*8,b=this.blockSize*32;p[m>>>5]|=1<<24-m%32,p[(r.ceil((m+1)/b)*b>>>5)-1]|=128,x.sigBytes=p.length*4,this._process();for(var C=this._state,w=this.cfg.outputLength/8,A=w/8,D=[],S=0;S<A;S++){var z=C[S],B=z.high,_=z.low;B=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360,_=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,D.push(_),D.push(B)}return new c.init(D,w)},clone:function(){for(var x=u.clone.call(this),p=x._state=this._state.slice(0),m=0;m<25;m++)p[m]=p[m].clone();return x}});o.SHA3=u._createHelper(h),o.HmacSHA3=u._createHmacHelper(h)}(Math),e.SHA3})}(nr)),nr.exports}var rr={exports:{}},Do;function pi(){return Do||(Do=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(r){var o=e,a=o.lib,c=a.WordArray,u=a.Hasher,f=o.algo,s=c.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),l=c.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),v=c.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),d=c.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),y=c.create([0,1518500249,1859775393,2400959708,2840853838]),g=c.create([1352829926,1548603684,1836072691,2053994217,0]),h=f.RIPEMD160=u.extend({_doReset:function(){this._hash=c.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(A,D){for(var S=0;S<16;S++){var z=D+S,B=A[z];A[z]=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360}var _=this._hash.words,O=y.words,E=g.words,P=s.words,U=l.words,Q=v.words,k=d.words,R,$,F,I,L,K,V,me,xe,ye;K=R=_[0],V=$=_[1],me=F=_[2],xe=I=_[3],ye=L=_[4];for(var ie,S=0;S<80;S+=1)ie=R+A[D+P[S]]|0,S<16?ie+=x($,F,I)+O[0]:S<32?ie+=p($,F,I)+O[1]:S<48?ie+=m($,F,I)+O[2]:S<64?ie+=b($,F,I)+O[3]:ie+=C($,F,I)+O[4],ie=ie|0,ie=w(ie,Q[S]),ie=ie+L|0,R=L,L=I,I=w(F,10),F=$,$=ie,ie=K+A[D+U[S]]|0,S<16?ie+=C(V,me,xe)+E[0]:S<32?ie+=b(V,me,xe)+E[1]:S<48?ie+=m(V,me,xe)+E[2]:S<64?ie+=p(V,me,xe)+E[3]:ie+=x(V,me,xe)+E[4],ie=ie|0,ie=w(ie,k[S]),ie=ie+ye|0,K=ye,ye=xe,xe=w(me,10),me=V,V=ie;ie=_[1]+F+xe|0,_[1]=_[2]+I+ye|0,_[2]=_[3]+L+K|0,_[3]=_[4]+R+V|0,_[4]=_[0]+$+me|0,_[0]=ie},_doFinalize:function(){var A=this._data,D=A.words,S=this._nDataBytes*8,z=A.sigBytes*8;D[z>>>5]|=128<<24-z%32,D[(z+64>>>9<<4)+14]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,A.sigBytes=(D.length+1)*4,this._process();for(var B=this._hash,_=B.words,O=0;O<5;O++){var E=_[O];_[O]=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360}return B},clone:function(){var A=u.clone.call(this);return A._hash=this._hash.clone(),A}});function x(A,D,S){return A^D^S}function p(A,D,S){return A&D|~A&S}function m(A,D,S){return(A|~D)^S}function b(A,D,S){return A&S|D&~S}function C(A,D,S){return A^(D|~S)}function w(A,D){return A<<D|A>>>32-D}o.RIPEMD160=u._createHelper(h),o.HmacRIPEMD160=u._createHmacHelper(h)}(),e.RIPEMD160})}(rr)),rr.exports}var or={exports:{}},To;function Vr(){return To||(To=1,function(t,n){(function(e,r){t.exports=r(fe())})(ue,function(e){(function(){var r=e,o=r.lib,a=o.Base,c=r.enc,u=c.Utf8,f=r.algo;f.HMAC=a.extend({init:function(s,l){s=this._hasher=new s.init,typeof l=="string"&&(l=u.parse(l));var v=s.blockSize,d=v*4;l.sigBytes>d&&(l=s.finalize(l)),l.clamp();for(var y=this._oKey=l.clone(),g=this._iKey=l.clone(),h=y.words,x=g.words,p=0;p<v;p++)h[p]^=1549556828,x[p]^=909522486;y.sigBytes=g.sigBytes=d,this.reset()},reset:function(){var s=this._hasher;s.reset(),s.update(this._iKey)},update:function(s){return this._hasher.update(s),this},finalize:function(s){var l=this._hasher,v=l.finalize(s);l.reset();var d=l.finalize(this._oKey.clone().concat(v));return d}})})()})}(or)),or.exports}var ar={exports:{}},Fo;function hi(){return Fo||(Fo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Gr(),Vr())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.Base,c=o.WordArray,u=r.algo,f=u.SHA256,s=u.HMAC,l=u.PBKDF2=a.extend({cfg:a.extend({keySize:128/32,hasher:f,iterations:25e4}),init:function(v){this.cfg=this.cfg.extend(v)},compute:function(v,d){for(var y=this.cfg,g=s.create(y.hasher,v),h=c.create(),x=c.create([1]),p=h.words,m=x.words,b=y.keySize,C=y.iterations;p.length<b;){var w=g.update(d).finalize(x);g.reset();for(var A=w.words,D=A.length,S=w,z=1;z<C;z++){S=g.finalize(S),g.reset();for(var B=S.words,_=0;_<D;_++)A[_]^=B[_]}h.concat(w),m[0]++}return h.sigBytes=b*4,h}});r.PBKDF2=function(v,d,y){return l.create(y).compute(v,d)}}(),e.PBKDF2})}(ar)),ar.exports}var sr={exports:{}},So;function ht(){return So||(So=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Ia(),Vr())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.Base,c=o.WordArray,u=r.algo,f=u.MD5,s=u.EvpKDF=a.extend({cfg:a.extend({keySize:128/32,hasher:f,iterations:1}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,v){for(var d,y=this.cfg,g=y.hasher.create(),h=c.create(),x=h.words,p=y.keySize,m=y.iterations;x.length<p;){d&&g.update(d),d=g.update(l).finalize(v),g.reset();for(var b=1;b<m;b++)d=g.finalize(d),g.reset();h.concat(d)}return h.sigBytes=p*4,h}});r.EvpKDF=function(l,v,d){return s.create(d).compute(l,v)}}(),e.EvpKDF})}(sr)),sr.exports}var ir={exports:{}},Ro;function Fe(){return Ro||(Ro=1,function(t,n){(function(e,r,o){t.exports=r(fe(),ht())})(ue,function(e){e.lib.Cipher||function(r){var o=e,a=o.lib,c=a.Base,u=a.WordArray,f=a.BufferedBlockAlgorithm,s=o.enc;s.Utf8;var l=s.Base64,v=o.algo,d=v.EvpKDF,y=a.Cipher=f.extend({cfg:c.extend(),createEncryptor:function(B,_){return this.create(this._ENC_XFORM_MODE,B,_)},createDecryptor:function(B,_){return this.create(this._DEC_XFORM_MODE,B,_)},init:function(B,_,O){this.cfg=this.cfg.extend(O),this._xformMode=B,this._key=_,this.reset()},reset:function(){f.reset.call(this),this._doReset()},process:function(B){return this._append(B),this._process()},finalize:function(B){B&&this._append(B);var _=this._doFinalize();return _},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function B(_){return typeof _=="string"?z:A}return function(_){return{encrypt:function(O,E,P){return B(E).encrypt(_,O,E,P)},decrypt:function(O,E,P){return B(E).decrypt(_,O,E,P)}}}}()});a.StreamCipher=y.extend({_doFinalize:function(){var B=this._process(!0);return B},blockSize:1});var g=o.mode={},h=a.BlockCipherMode=c.extend({createEncryptor:function(B,_){return this.Encryptor.create(B,_)},createDecryptor:function(B,_){return this.Decryptor.create(B,_)},init:function(B,_){this._cipher=B,this._iv=_}}),x=g.CBC=function(){var B=h.extend();B.Encryptor=B.extend({processBlock:function(O,E){var P=this._cipher,U=P.blockSize;_.call(this,O,E,U),P.encryptBlock(O,E),this._prevBlock=O.slice(E,E+U)}}),B.Decryptor=B.extend({processBlock:function(O,E){var P=this._cipher,U=P.blockSize,Q=O.slice(E,E+U);P.decryptBlock(O,E),_.call(this,O,E,U),this._prevBlock=Q}});function _(O,E,P){var U,Q=this._iv;Q?(U=Q,this._iv=r):U=this._prevBlock;for(var k=0;k<P;k++)O[E+k]^=U[k]}return B}(),p=o.pad={},m=p.Pkcs7={pad:function(B,_){for(var O=_*4,E=O-B.sigBytes%O,P=E<<24|E<<16|E<<8|E,U=[],Q=0;Q<E;Q+=4)U.push(P);var k=u.create(U,E);B.concat(k)},unpad:function(B){var _=B.words[B.sigBytes-1>>>2]&255;B.sigBytes-=_}};a.BlockCipher=y.extend({cfg:y.cfg.extend({mode:x,padding:m}),reset:function(){var B;y.reset.call(this);var _=this.cfg,O=_.iv,E=_.mode;this._xformMode==this._ENC_XFORM_MODE?B=E.createEncryptor:(B=E.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==B?this._mode.init(this,O&&O.words):(this._mode=B.call(E,this,O&&O.words),this._mode.__creator=B)},_doProcessBlock:function(B,_){this._mode.processBlock(B,_)},_doFinalize:function(){var B,_=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(_.pad(this._data,this.blockSize),B=this._process(!0)):(B=this._process(!0),_.unpad(B)),B},blockSize:128/32});var b=a.CipherParams=c.extend({init:function(B){this.mixIn(B)},toString:function(B){return(B||this.formatter).stringify(this)}}),C=o.format={},w=C.OpenSSL={stringify:function(B){var _,O=B.ciphertext,E=B.salt;return E?_=u.create([1398893684,1701076831]).concat(E).concat(O):_=O,_.toString(l)},parse:function(B){var _,O=l.parse(B),E=O.words;return E[0]==1398893684&&E[1]==1701076831&&(_=u.create(E.slice(2,4)),E.splice(0,4),O.sigBytes-=16),b.create({ciphertext:O,salt:_})}},A=a.SerializableCipher=c.extend({cfg:c.extend({format:w}),encrypt:function(B,_,O,E){E=this.cfg.extend(E);var P=B.createEncryptor(O,E),U=P.finalize(_),Q=P.cfg;return b.create({ciphertext:U,key:O,iv:Q.iv,algorithm:B,mode:Q.mode,padding:Q.padding,blockSize:B.blockSize,formatter:E.format})},decrypt:function(B,_,O,E){E=this.cfg.extend(E),_=this._parse(_,E.format);var P=B.createDecryptor(O,E).finalize(_.ciphertext);return P},_parse:function(B,_){return typeof B=="string"?_.parse(B,this):B}}),D=o.kdf={},S=D.OpenSSL={execute:function(B,_,O,E,P){if(E||(E=u.random(64/8)),P)var U=d.create({keySize:_+O,hasher:P}).compute(B,E);else var U=d.create({keySize:_+O}).compute(B,E);var Q=u.create(U.words.slice(_),O*4);return U.sigBytes=_*4,b.create({key:U,iv:Q,salt:E})}},z=a.PasswordBasedCipher=A.extend({cfg:A.cfg.extend({kdf:S}),encrypt:function(B,_,O,E){E=this.cfg.extend(E);var P=E.kdf.execute(O,B.keySize,B.ivSize,E.salt,E.hasher);E.iv=P.iv;var U=A.encrypt.call(this,B,_,P.key,E);return U.mixIn(P),U},decrypt:function(B,_,O,E){E=this.cfg.extend(E),_=this._parse(_,E.format);var P=E.kdf.execute(O,B.keySize,B.ivSize,_.salt,E.hasher);E.iv=P.iv;var U=A.decrypt.call(this,B,_,P.key,E);return U}})}()})}(ir)),ir.exports}var lr={exports:{}},$o;function bi(){return $o||($o=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return e.mode.CFB=function(){var r=e.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(a,c){var u=this._cipher,f=u.blockSize;o.call(this,a,c,f,u),this._prevBlock=a.slice(c,c+f)}}),r.Decryptor=r.extend({processBlock:function(a,c){var u=this._cipher,f=u.blockSize,s=a.slice(c,c+f);o.call(this,a,c,f,u),this._prevBlock=s}});function o(a,c,u,f){var s,l=this._iv;l?(s=l.slice(0),this._iv=void 0):s=this._prevBlock,f.encryptBlock(s,0);for(var v=0;v<u;v++)a[c+v]^=s[v]}return r}(),e.mode.CFB})}(lr)),lr.exports}var cr={exports:{}},Io;function yi(){return Io||(Io=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return e.mode.CTR=function(){var r=e.lib.BlockCipherMode.extend(),o=r.Encryptor=r.extend({processBlock:function(a,c){var u=this._cipher,f=u.blockSize,s=this._iv,l=this._counter;s&&(l=this._counter=s.slice(0),this._iv=void 0);var v=l.slice(0);u.encryptBlock(v,0),l[f-1]=l[f-1]+1|0;for(var d=0;d<f;d++)a[c+d]^=v[d]}});return r.Decryptor=o,r}(),e.mode.CTR})}(cr)),cr.exports}var ur={exports:{}},Po;function Ci(){return Po||(Po=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return e.mode.CTRGladman=function(){var r=e.lib.BlockCipherMode.extend();function o(u){if((u>>24&255)===255){var f=u>>16&255,s=u>>8&255,l=u&255;f===255?(f=0,s===255?(s=0,l===255?l=0:++l):++s):++f,u=0,u+=f<<16,u+=s<<8,u+=l}else u+=1<<24;return u}function a(u){return(u[0]=o(u[0]))===0&&(u[1]=o(u[1])),u}var c=r.Encryptor=r.extend({processBlock:function(u,f){var s=this._cipher,l=s.blockSize,v=this._iv,d=this._counter;v&&(d=this._counter=v.slice(0),this._iv=void 0),a(d);var y=d.slice(0);s.encryptBlock(y,0);for(var g=0;g<l;g++)u[f+g]^=y[g]}});return r.Decryptor=c,r}(),e.mode.CTRGladman})}(ur)),ur.exports}var dr={exports:{}},Mo;function wi(){return Mo||(Mo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return e.mode.OFB=function(){var r=e.lib.BlockCipherMode.extend(),o=r.Encryptor=r.extend({processBlock:function(a,c){var u=this._cipher,f=u.blockSize,s=this._iv,l=this._keystream;s&&(l=this._keystream=s.slice(0),this._iv=void 0),u.encryptBlock(l,0);for(var v=0;v<f;v++)a[c+v]^=l[v]}});return r.Decryptor=o,r}(),e.mode.OFB})}(dr)),dr.exports}var fr={exports:{}},Oo;function Ei(){return Oo||(Oo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return e.mode.ECB=function(){var r=e.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(o,a){this._cipher.encryptBlock(o,a)}}),r.Decryptor=r.extend({processBlock:function(o,a){this._cipher.decryptBlock(o,a)}}),r}(),e.mode.ECB})}(fr)),fr.exports}var xr={exports:{}},Wo;function _i(){return Wo||(Wo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return e.pad.AnsiX923={pad:function(r,o){var a=r.sigBytes,c=o*4,u=c-a%c,f=a+u-1;r.clamp(),r.words[f>>>2]|=u<<24-f%4*8,r.sigBytes+=u},unpad:function(r){var o=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=o}},e.pad.Ansix923})}(xr)),xr.exports}var vr={exports:{}},No;function Ai(){return No||(No=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return e.pad.Iso10126={pad:function(r,o){var a=o*4,c=a-r.sigBytes%a;r.concat(e.lib.WordArray.random(c-1)).concat(e.lib.WordArray.create([c<<24],1))},unpad:function(r){var o=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=o}},e.pad.Iso10126})}(vr)),vr.exports}var gr={exports:{}},Lo;function Bi(){return Lo||(Lo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return e.pad.Iso97971={pad:function(r,o){r.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(r,o)},unpad:function(r){e.pad.ZeroPadding.unpad(r),r.sigBytes--}},e.pad.Iso97971})}(gr)),gr.exports}var mr={exports:{}},Ho;function ki(){return Ho||(Ho=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return e.pad.ZeroPadding={pad:function(r,o){var a=o*4;r.clamp(),r.sigBytes+=a-(r.sigBytes%a||a)},unpad:function(r){for(var o=r.words,a=r.sigBytes-1,a=r.sigBytes-1;a>=0;a--)if(o[a>>>2]>>>24-a%4*8&255){r.sigBytes=a+1;break}}},e.pad.ZeroPadding})}(mr)),mr.exports}var pr={exports:{}},jo;function Di(){return jo||(jo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding})}(pr)),pr.exports}var hr={exports:{}},Uo;function Ti(){return Uo||(Uo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Fe())})(ue,function(e){return function(r){var o=e,a=o.lib,c=a.CipherParams,u=o.enc,f=u.Hex,s=o.format;s.Hex={stringify:function(l){return l.ciphertext.toString(f)},parse:function(l){var v=f.parse(l);return c.create({ciphertext:v})}}}(),e.format.Hex})}(hr)),hr.exports}var br={exports:{}},qo;function Fi(){return qo||(qo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Dt(),Tt(),ht(),Fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.BlockCipher,c=r.algo,u=[],f=[],s=[],l=[],v=[],d=[],y=[],g=[],h=[],x=[];(function(){for(var b=[],C=0;C<256;C++)C<128?b[C]=C<<1:b[C]=C<<1^283;for(var w=0,A=0,C=0;C<256;C++){var D=A^A<<1^A<<2^A<<3^A<<4;D=D>>>8^D&255^99,u[w]=D,f[D]=w;var S=b[w],z=b[S],B=b[z],_=b[D]*257^D*16843008;s[w]=_<<24|_>>>8,l[w]=_<<16|_>>>16,v[w]=_<<8|_>>>24,d[w]=_;var _=B*16843009^z*65537^S*257^w*16843008;y[D]=_<<24|_>>>8,g[D]=_<<16|_>>>16,h[D]=_<<8|_>>>24,x[D]=_,w?(w=S^b[b[b[B^S]]],A^=b[b[A]]):w=A=1}})();var p=[0,1,2,4,8,16,32,64,128,27,54],m=c.AES=a.extend({_doReset:function(){var b;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var C=this._keyPriorReset=this._key,w=C.words,A=C.sigBytes/4,D=this._nRounds=A+6,S=(D+1)*4,z=this._keySchedule=[],B=0;B<S;B++)B<A?z[B]=w[B]:(b=z[B-1],B%A?A>6&&B%A==4&&(b=u[b>>>24]<<24|u[b>>>16&255]<<16|u[b>>>8&255]<<8|u[b&255]):(b=b<<8|b>>>24,b=u[b>>>24]<<24|u[b>>>16&255]<<16|u[b>>>8&255]<<8|u[b&255],b^=p[B/A|0]<<24),z[B]=z[B-A]^b);for(var _=this._invKeySchedule=[],O=0;O<S;O++){var B=S-O;if(O%4)var b=z[B];else var b=z[B-4];O<4||B<=4?_[O]=b:_[O]=y[u[b>>>24]]^g[u[b>>>16&255]]^h[u[b>>>8&255]]^x[u[b&255]]}}},encryptBlock:function(b,C){this._doCryptBlock(b,C,this._keySchedule,s,l,v,d,u)},decryptBlock:function(b,C){var w=b[C+1];b[C+1]=b[C+3],b[C+3]=w,this._doCryptBlock(b,C,this._invKeySchedule,y,g,h,x,f);var w=b[C+1];b[C+1]=b[C+3],b[C+3]=w},_doCryptBlock:function(b,C,w,A,D,S,z,B){for(var _=this._nRounds,O=b[C]^w[0],E=b[C+1]^w[1],P=b[C+2]^w[2],U=b[C+3]^w[3],Q=4,k=1;k<_;k++){var R=A[O>>>24]^D[E>>>16&255]^S[P>>>8&255]^z[U&255]^w[Q++],$=A[E>>>24]^D[P>>>16&255]^S[U>>>8&255]^z[O&255]^w[Q++],F=A[P>>>24]^D[U>>>16&255]^S[O>>>8&255]^z[E&255]^w[Q++],I=A[U>>>24]^D[O>>>16&255]^S[E>>>8&255]^z[P&255]^w[Q++];O=R,E=$,P=F,U=I}var R=(B[O>>>24]<<24|B[E>>>16&255]<<16|B[P>>>8&255]<<8|B[U&255])^w[Q++],$=(B[E>>>24]<<24|B[P>>>16&255]<<16|B[U>>>8&255]<<8|B[O&255])^w[Q++],F=(B[P>>>24]<<24|B[U>>>16&255]<<16|B[O>>>8&255]<<8|B[E&255])^w[Q++],I=(B[U>>>24]<<24|B[O>>>16&255]<<16|B[E>>>8&255]<<8|B[P&255])^w[Q++];b[C]=R,b[C+1]=$,b[C+2]=F,b[C+3]=I},keySize:256/32});r.AES=a._createHelper(m)}(),e.AES})}(br)),br.exports}var yr={exports:{}},zo;function Si(){return zo||(zo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Dt(),Tt(),ht(),Fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.WordArray,c=o.BlockCipher,u=r.algo,f=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],v=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],y=u.DES=c.extend({_doReset:function(){for(var p=this._key,m=p.words,b=[],C=0;C<56;C++){var w=f[C]-1;b[C]=m[w>>>5]>>>31-w%32&1}for(var A=this._subKeys=[],D=0;D<16;D++){for(var S=A[D]=[],z=l[D],C=0;C<24;C++)S[C/6|0]|=b[(s[C]-1+z)%28]<<31-C%6,S[4+(C/6|0)]|=b[28+(s[C+24]-1+z)%28]<<31-C%6;S[0]=S[0]<<1|S[0]>>>31;for(var C=1;C<7;C++)S[C]=S[C]>>>(C-1)*4+3;S[7]=S[7]<<5|S[7]>>>27}for(var B=this._invSubKeys=[],C=0;C<16;C++)B[C]=A[15-C]},encryptBlock:function(p,m){this._doCryptBlock(p,m,this._subKeys)},decryptBlock:function(p,m){this._doCryptBlock(p,m,this._invSubKeys)},_doCryptBlock:function(p,m,b){this._lBlock=p[m],this._rBlock=p[m+1],g.call(this,4,252645135),g.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),g.call(this,1,1431655765);for(var C=0;C<16;C++){for(var w=b[C],A=this._lBlock,D=this._rBlock,S=0,z=0;z<8;z++)S|=v[z][((D^w[z])&d[z])>>>0];this._lBlock=D,this._rBlock=A^S}var B=this._lBlock;this._lBlock=this._rBlock,this._rBlock=B,g.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),g.call(this,16,65535),g.call(this,4,252645135),p[m]=this._lBlock,p[m+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function g(p,m){var b=(this._lBlock>>>p^this._rBlock)&m;this._rBlock^=b,this._lBlock^=b<<p}function h(p,m){var b=(this._rBlock>>>p^this._lBlock)&m;this._lBlock^=b,this._rBlock^=b<<p}r.DES=c._createHelper(y);var x=u.TripleDES=c.extend({_doReset:function(){var p=this._key,m=p.words;if(m.length!==2&&m.length!==4&&m.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var b=m.slice(0,2),C=m.length<4?m.slice(0,2):m.slice(2,4),w=m.length<6?m.slice(0,2):m.slice(4,6);this._des1=y.createEncryptor(a.create(b)),this._des2=y.createEncryptor(a.create(C)),this._des3=y.createEncryptor(a.create(w))},encryptBlock:function(p,m){this._des1.encryptBlock(p,m),this._des2.decryptBlock(p,m),this._des3.encryptBlock(p,m)},decryptBlock:function(p,m){this._des3.decryptBlock(p,m),this._des2.encryptBlock(p,m),this._des1.decryptBlock(p,m)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=c._createHelper(x)}(),e.TripleDES})}(yr)),yr.exports}var Cr={exports:{}},Go;function Ri(){return Go||(Go=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Dt(),Tt(),ht(),Fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.StreamCipher,c=r.algo,u=c.RC4=a.extend({_doReset:function(){for(var l=this._key,v=l.words,d=l.sigBytes,y=this._S=[],g=0;g<256;g++)y[g]=g;for(var g=0,h=0;g<256;g++){var x=g%d,p=v[x>>>2]>>>24-x%4*8&255;h=(h+y[g]+p)%256;var m=y[g];y[g]=y[h],y[h]=m}this._i=this._j=0},_doProcessBlock:function(l,v){l[v]^=f.call(this)},keySize:256/32,ivSize:0});function f(){for(var l=this._S,v=this._i,d=this._j,y=0,g=0;g<4;g++){v=(v+1)%256,d=(d+l[v])%256;var h=l[v];l[v]=l[d],l[d]=h,y|=l[(l[v]+l[d])%256]<<24-g*8}return this._i=v,this._j=d,y}r.RC4=a._createHelper(u);var s=c.RC4Drop=u.extend({cfg:u.cfg.extend({drop:192}),_doReset:function(){u._doReset.call(this);for(var l=this.cfg.drop;l>0;l--)f.call(this)}});r.RC4Drop=a._createHelper(s)}(),e.RC4})}(Cr)),Cr.exports}var wr={exports:{}},Vo;function $i(){return Vo||(Vo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Dt(),Tt(),ht(),Fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.StreamCipher,c=r.algo,u=[],f=[],s=[],l=c.Rabbit=a.extend({_doReset:function(){for(var d=this._key.words,y=this.cfg.iv,g=0;g<4;g++)d[g]=(d[g]<<8|d[g]>>>24)&16711935|(d[g]<<24|d[g]>>>8)&4278255360;var h=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],x=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var g=0;g<4;g++)v.call(this);for(var g=0;g<8;g++)x[g]^=h[g+4&7];if(y){var p=y.words,m=p[0],b=p[1],C=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,w=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,A=C>>>16|w&4294901760,D=w<<16|C&65535;x[0]^=C,x[1]^=A,x[2]^=w,x[3]^=D,x[4]^=C,x[5]^=A,x[6]^=w,x[7]^=D;for(var g=0;g<4;g++)v.call(this)}},_doProcessBlock:function(d,y){var g=this._X;v.call(this),u[0]=g[0]^g[5]>>>16^g[3]<<16,u[1]=g[2]^g[7]>>>16^g[5]<<16,u[2]=g[4]^g[1]>>>16^g[7]<<16,u[3]=g[6]^g[3]>>>16^g[1]<<16;for(var h=0;h<4;h++)u[h]=(u[h]<<8|u[h]>>>24)&16711935|(u[h]<<24|u[h]>>>8)&4278255360,d[y+h]^=u[h]},blockSize:128/32,ivSize:64/32});function v(){for(var d=this._X,y=this._C,g=0;g<8;g++)f[g]=y[g];y[0]=y[0]+1295307597+this._b|0,y[1]=y[1]+3545052371+(y[0]>>>0<f[0]>>>0?1:0)|0,y[2]=y[2]+886263092+(y[1]>>>0<f[1]>>>0?1:0)|0,y[3]=y[3]+1295307597+(y[2]>>>0<f[2]>>>0?1:0)|0,y[4]=y[4]+3545052371+(y[3]>>>0<f[3]>>>0?1:0)|0,y[5]=y[5]+886263092+(y[4]>>>0<f[4]>>>0?1:0)|0,y[6]=y[6]+1295307597+(y[5]>>>0<f[5]>>>0?1:0)|0,y[7]=y[7]+3545052371+(y[6]>>>0<f[6]>>>0?1:0)|0,this._b=y[7]>>>0<f[7]>>>0?1:0;for(var g=0;g<8;g++){var h=d[g]+y[g],x=h&65535,p=h>>>16,m=((x*x>>>17)+x*p>>>15)+p*p,b=((h&4294901760)*h|0)+((h&65535)*h|0);s[g]=m^b}d[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,d[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,d[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,d[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,d[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,d[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,d[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,d[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}r.Rabbit=a._createHelper(l)}(),e.Rabbit})}(wr)),wr.exports}var Er={exports:{}},Ko;function Ii(){return Ko||(Ko=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Dt(),Tt(),ht(),Fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.StreamCipher,c=r.algo,u=[],f=[],s=[],l=c.RabbitLegacy=a.extend({_doReset:function(){var d=this._key.words,y=this.cfg.iv,g=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],h=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var x=0;x<4;x++)v.call(this);for(var x=0;x<8;x++)h[x]^=g[x+4&7];if(y){var p=y.words,m=p[0],b=p[1],C=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,w=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,A=C>>>16|w&4294901760,D=w<<16|C&65535;h[0]^=C,h[1]^=A,h[2]^=w,h[3]^=D,h[4]^=C,h[5]^=A,h[6]^=w,h[7]^=D;for(var x=0;x<4;x++)v.call(this)}},_doProcessBlock:function(d,y){var g=this._X;v.call(this),u[0]=g[0]^g[5]>>>16^g[3]<<16,u[1]=g[2]^g[7]>>>16^g[5]<<16,u[2]=g[4]^g[1]>>>16^g[7]<<16,u[3]=g[6]^g[3]>>>16^g[1]<<16;for(var h=0;h<4;h++)u[h]=(u[h]<<8|u[h]>>>24)&16711935|(u[h]<<24|u[h]>>>8)&4278255360,d[y+h]^=u[h]},blockSize:128/32,ivSize:64/32});function v(){for(var d=this._X,y=this._C,g=0;g<8;g++)f[g]=y[g];y[0]=y[0]+1295307597+this._b|0,y[1]=y[1]+3545052371+(y[0]>>>0<f[0]>>>0?1:0)|0,y[2]=y[2]+886263092+(y[1]>>>0<f[1]>>>0?1:0)|0,y[3]=y[3]+1295307597+(y[2]>>>0<f[2]>>>0?1:0)|0,y[4]=y[4]+3545052371+(y[3]>>>0<f[3]>>>0?1:0)|0,y[5]=y[5]+886263092+(y[4]>>>0<f[4]>>>0?1:0)|0,y[6]=y[6]+1295307597+(y[5]>>>0<f[5]>>>0?1:0)|0,y[7]=y[7]+3545052371+(y[6]>>>0<f[6]>>>0?1:0)|0,this._b=y[7]>>>0<f[7]>>>0?1:0;for(var g=0;g<8;g++){var h=d[g]+y[g],x=h&65535,p=h>>>16,m=((x*x>>>17)+x*p>>>15)+p*p,b=((h&4294901760)*h|0)+((h&65535)*h|0);s[g]=m^b}d[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,d[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,d[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,d[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,d[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,d[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,d[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,d[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}r.RabbitLegacy=a._createHelper(l)}(),e.RabbitLegacy})}(Er)),Er.exports}var _r={exports:{}},Yo;function Pi(){return Yo||(Yo=1,function(t,n){(function(e,r,o){t.exports=r(fe(),Dt(),Tt(),ht(),Fe())})(ue,function(e){return function(){var r=e,o=r.lib,a=o.BlockCipher,c=r.algo;const u=16,f=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],s=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var l={pbox:[],sbox:[]};function v(x,p){let m=p>>24&255,b=p>>16&255,C=p>>8&255,w=p&255,A=x.sbox[0][m]+x.sbox[1][b];return A=A^x.sbox[2][C],A=A+x.sbox[3][w],A}function d(x,p,m){let b=p,C=m,w;for(let A=0;A<u;++A)b=b^x.pbox[A],C=v(x,b)^C,w=b,b=C,C=w;return w=b,b=C,C=w,C=C^x.pbox[u],b=b^x.pbox[u+1],{left:b,right:C}}function y(x,p,m){let b=p,C=m,w;for(let A=u+1;A>1;--A)b=b^x.pbox[A],C=v(x,b)^C,w=b,b=C,C=w;return w=b,b=C,C=w,C=C^x.pbox[1],b=b^x.pbox[0],{left:b,right:C}}function g(x,p,m){for(let D=0;D<4;D++){x.sbox[D]=[];for(let S=0;S<256;S++)x.sbox[D][S]=s[D][S]}let b=0;for(let D=0;D<u+2;D++)x.pbox[D]=f[D]^p[b],b++,b>=m&&(b=0);let C=0,w=0,A=0;for(let D=0;D<u+2;D+=2)A=d(x,C,w),C=A.left,w=A.right,x.pbox[D]=C,x.pbox[D+1]=w;for(let D=0;D<4;D++)for(let S=0;S<256;S+=2)A=d(x,C,w),C=A.left,w=A.right,x.sbox[D][S]=C,x.sbox[D][S+1]=w;return!0}var h=c.Blowfish=a.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var x=this._keyPriorReset=this._key,p=x.words,m=x.sigBytes/4;g(l,p,m)}},encryptBlock:function(x,p){var m=d(l,x[p],x[p+1]);x[p]=m.left,x[p+1]=m.right},decryptBlock:function(x,p){var m=y(l,x[p],x[p+1]);x[p]=m.left,x[p+1]=m.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=a._createHelper(h)}(),e.Blowfish})}(_r)),_r.exports}(function(t,n){(function(e,r,o){t.exports=r(fe(),Tn(),di(),fi(),Dt(),xi(),Tt(),Ia(),Gr(),vi(),Pa(),gi(),mi(),pi(),Vr(),hi(),ht(),Fe(),bi(),yi(),Ci(),wi(),Ei(),_i(),Ai(),Bi(),ki(),Di(),Ti(),Fi(),Si(),Ri(),$i(),Ii(),Pi())})(ue,function(e){return e})})($a);var Mi=$a.exports;const Ar=ai(Mi);var ct=(t=>(t.SENDING="sending",t.SENT="sent",t.DELIVERED="delivered",t.READ="read",t.FAILED="failed",t))(ct||{});const Xo="spacetalk-secure-key-2023";class Oi{constructor(n){Ue(this,"messages",N({}));Ue(this,"pendingMessages",N({}));Ue(this,"unreadMessages",N({}));Ue(this,"messageExpiryDays",30);this.storageProvider=n,this.loadAllChats(),this.setupAutoCleanup(),Te(this.messages,()=>{this.saveAllChats()},{deep:!0}),Te(this.pendingMessages,()=>{this.savePendingMessages()},{deep:!0})}createMessage(n,e,r){const o=this.encryptMessage(n);return{id:Ra(),sender:r?"me":"partner",text:o,originalText:r?n:void 0,timestamp:Date.now(),status:r?"sending":"delivered",retryCount:0,expiresAt:Date.now()+this.messageExpiryDays*24*60*60*1e3}}addMessage(n,e){const r=this.getConversationKey(e);this.messages.value[r]||(this.messages.value[r]=[]),this.messages.value[r].push(n),this.saveAllChats()}updateMessageStatus(n,e){let r=!1;return Object.keys(this.messages.value).forEach(o=>{const a=this.messages.value[o],c=a.findIndex(u=>u.id===n);c!==-1&&(a[c].status=e,r=!0)}),r&&this.saveAllChats(),r}addToPendingMessages(n,e){this.pendingMessages.value[e]||(this.pendingMessages.value[e]=[]),this.pendingMessages.value[e].push(n),this.savePendingMessages()}removeFromPendingMessages(n,e){if(!this.pendingMessages.value[e])return!1;const r=this.pendingMessages.value[e].length;return this.pendingMessages.value[e]=this.pendingMessages.value[e].filter(o=>o.id!==n),r!==this.pendingMessages.value[e].length?(this.savePendingMessages(),!0):!1}getPendingMessages(n){return this.pendingMessages.value[n]||[]}getAllPendingMessages(){return this.pendingMessages.value}getMessages(n){const e=this.getConversationKey(n);return(this.messages.value[e]||[]).map(o=>o.sender==="partner"?{...o,text:this.decryptMessage(o.text)}:{...o,text:o.originalText||this.decryptMessage(o.text)})}markAsRead(n){this.unreadMessages.value[n]=!1;const e=this.getConversationKey(n),r=this.messages.value[e]||[];let o=!1;r.forEach(a=>{a.sender==="partner"&&a.status==="delivered"&&(a.status="read",o=!0)}),o&&this.saveAllChats()}hasUnreadMessages(n){return!!this.unreadMessages.value[n]}setUnread(n,e){this.unreadMessages.value[n]=e}clearChat(n){const e=this.getConversationKey(n);this.messages.value[e]&&(this.messages.value[e]=[],this.saveAllChats()),this.pendingMessages.value[n]&&(this.pendingMessages.value[n]=[],this.savePendingMessages())}clearAllChats(){this.messages.value={},this.unreadMessages.value={},this.pendingMessages.value={},this.saveAllChats(),this.savePendingMessages()}encryptMessage(n){try{return Ar.AES.encrypt(n,Xo).toString()}catch(e){return console.error("Failed to encrypt message:",e),n}}decryptMessage(n){try{return Ar.AES.decrypt(n,Xo).toString(Ar.enc.Utf8)}catch(e){return console.error("Failed to decrypt message:",e),n}}getConversationKey(n){return`chat_${n}`}saveAllChats(){if(this.storageProvider.isAvailable)try{this.storageProvider.setItem("chat_messages",JSON.stringify(this.messages.value)),this.storageProvider.setItem("chat_unread",JSON.stringify(this.unreadMessages.value))}catch(n){console.error("Failed to save chats:",n)}}loadAllChats(){if(this.storageProvider.isAvailable)try{const n=this.storageProvider.getItem("chat_messages");n&&(this.messages.value=JSON.parse(n));const e=this.storageProvider.getItem("chat_unread");e&&(this.unreadMessages.value=JSON.parse(e))}catch(n){console.error("Failed to load chats:",n)}}savePendingMessages(){if(this.storageProvider.isAvailable)try{this.storageProvider.setItem("chat_pending_messages",JSON.stringify(this.pendingMessages.value))}catch(n){console.error("Failed to save pending messages:",n)}}loadPendingMessages(){if(this.storageProvider.isAvailable)try{const n=this.storageProvider.getItem("chat_pending_messages");n&&(this.pendingMessages.value=JSON.parse(n))}catch(n){console.error("Failed to load pending messages:",n)}}setupAutoCleanup(){setInterval(()=>this.cleanupExpiredMessages(),24*60*60*1e3),this.cleanupExpiredMessages()}cleanupExpiredMessages(){const n=Date.now();let e=!1;Object.keys(this.messages.value).forEach(r=>{const o=this.messages.value[r].length;this.messages.value[r]=this.messages.value[r].filter(a=>!a.expiresAt||a.expiresAt>n),o!==this.messages.value[r].length&&(e=!0)}),e&&this.saveAllChats()}}class Wi{constructor(n){Ue(this,"currentPartnerId",null);Ue(this,"isListening",!1);Ue(this,"retryTimeout",null);Ue(this,"typingTimeout",null);Ue(this,"DEBUG",!0);this.model=n,this.setupSocketListeners(),this.scheduleRetryCheck()}setupSocketListeners(){const{socket:n}=Ie();if(!n.value){this.DEBUG&&console.log("[ChatController] No socket available, cannot set up listeners");return}this.isListening&&(n.value.off("chat-message"),n.value.off("message-received"),n.value.off("message-read"),n.value.off("typing"),n.value.off("check-pending-messages"),this.isListening=!1),n.value.on("check-pending-messages",()=>{var e;this.DEBUG&&console.log("[ChatController] Server requested to check pending messages"),(e=n.value)==null||e.emit("get-pending-messages")}),n.value.on("chat-message",e=>{this.DEBUG&&(console.log("[ChatController] Received chat message:",e),console.log("[ChatController] Current partner ID:",this.currentPartnerId));const r=this.model.createMessage(e.text,e.from,!1);r.id=e.id,r.timestamp=e.timestamp,this.model.addMessage(r,e.from),e.from!==this.currentPartnerId?(this.DEBUG&&console.log(`[ChatController] Message from ${e.from} marked as unread (not current partner)`),this.model.setUnread(e.from,!0)):(this.DEBUG&&console.log(`[ChatController] Message from current partner ${e.from}, marking as read`),this.sendReadReceipt(e.id,e.from)),this.sendDeliveryReceipt(e.id,e.from)}),n.value.on("message-received",e=>{this.DEBUG&&console.log("[ChatController] Message delivery receipt:",e),this.model.updateMessageStatus(e.id,ct.DELIVERED)}),n.value.on("message-read",e=>{this.DEBUG&&console.log("[ChatController] Message read receipt:",e),this.model.updateMessageStatus(e.id,ct.READ)}),n.value.on("typing",e=>{this.DEBUG&&console.log("[ChatController] Typing indicator:",e),window.dispatchEvent(new CustomEvent("chat:typing",{detail:{partnerId:e.from,isTyping:e.isTyping}}))}),this.isListening=!0,this.DEBUG&&console.log("[ChatController] Chat listeners setup complete")}setCurrentPartner(n){this.currentPartnerId=n,n&&this.model.markAsRead(n)}sendMessage(n,e){if(!n.trim()||!e)return!1;const r=this.model.createMessage(n,e,!0);this.model.addMessage(r,e);const{socket:o,isConnected:a}=Ie();return o.value&&a.value?this.sendMessageToServer(r,e):(r.status=ct.FAILED,this.model.addToPendingMessages(r,e)),!0}sendMessageToServer(n,e){const{socket:r}=Ie();if(!r.value){n.status=ct.FAILED,this.model.addToPendingMessages(n,e);return}this.model.updateMessageStatus(n.id,ct.SENDING),this.DEBUG&&console.log(`[ChatController] Sending message to server: ID=${n.id}, to=${e}, text=${n.originalText||n.text}`),r.value.emit("chat-message",{id:n.id,text:n.originalText||n.text,to:e,timestamp:n.timestamp},o=>{o&&o.success?(this.DEBUG&&console.log(`[ChatController] Server acknowledged message ${n.id}`),this.model.updateMessageStatus(n.id,ct.SENT)):(this.DEBUG&&console.log(`[ChatController] Server rejected message ${n.id}: ${(o==null?void 0:o.error)||"Unknown error"}`),this.model.updateMessageStatus(n.id,ct.FAILED),this.model.addToPendingMessages(n,e))})}resendMessage(n,e){const o=this.model.getPendingMessages(e).find(a=>a.id===n);if(!o){this.DEBUG&&console.log(`[ChatController] Message ${n} not found in pending messages`);const c=this.model.getMessages(e).find(u=>u.id===n&&u.status===ct.FAILED);return c?c.retryCount>=3?(this.DEBUG&&console.log(`[ChatController] Message ${n} has reached maximum retry attempts`),!1):(c.retryCount++,this.sendMessageToServer(c,e),!0):(this.DEBUG&&console.log(`[ChatController] Message ${n} not found in regular messages either`),!1)}return o.retryCount>=3?(this.DEBUG&&console.log(`[ChatController] Message ${n} has reached maximum retry attempts`),!1):(o.retryCount++,this.model.removeFromPendingMessages(n,e),this.sendMessageToServer(o,e),!0)}retryPendingMessages(){const{isConnected:n}=Ie();if(!n.value){this.DEBUG&&console.log("[ChatController] Not connected, skipping retry of pending messages");return}const e=this.model.getAllPendingMessages();Object.keys(e).forEach(r=>{const o=[...e[r]];this.DEBUG&&console.log(`[ChatController] Retrying ${o.length} pending messages for partner ${r}`),o.forEach(a=>{a.retryCount<3&&(this.model.removeFromPendingMessages(a.id,r),this.sendMessageToServer(a,r))})})}scheduleRetryCheck(){this.retryTimeout=setInterval(()=>{this.DEBUG&&console.log("[ChatController] Running scheduled retry check for pending messages"),this.retryPendingMessages()},3e4)}sendDeliveryReceipt(n,e){const{socket:r,isConnected:o}=Ie();if(!r.value||!o.value){this.DEBUG&&console.log("[ChatController] Cannot send delivery receipt: not connected");return}this.DEBUG&&console.log(`[ChatController] Sending delivery receipt for message ${n} to ${e}`),r.value.emit("message-received",{id:n,to:e})}sendReadReceipt(n,e){const{socket:r,isConnected:o}=Ie();if(!r.value||!o.value){this.DEBUG&&console.log("[ChatController] Cannot send read receipt: not connected");return}this.DEBUG&&console.log(`[ChatController] Sending read receipt for message ${n} to ${e}`),r.value.emit("message-read",{id:n,to:e})}sendTypingIndicator(n){const{socket:e,isConnected:r}=Ie();!e.value||!r.value||!n||(this.typingTimeout&&clearTimeout(this.typingTimeout),e.value.emit("typing",{to:n,isTyping:!0}),this.typingTimeout=setTimeout(()=>{e.value&&r.value&&e.value.emit("typing",{to:n,isTyping:!1})},3e3))}getMessages(n){return this.model.getMessages(n)}hasUnreadMessages(n){return this.model.hasUnreadMessages(n)}markAsRead(n){this.model.markAsRead(n)}clearChat(n){this.model.clearChat(n)}clearAllChats(){this.model.clearAllChats()}cleanup(){const{socket:n}=Ie();n.value&&(n.value.off("chat-message"),n.value.off("message-received"),n.value.off("message-read"),n.value.off("typing")),this.retryTimeout&&clearInterval(this.retryTimeout),this.typingTimeout&&clearTimeout(this.typingTimeout),this.isListening=!1}}N({});const Br=N(null);N({});N(!1);N({});let Qo=null,De=null,Zo=!1;function Ni(){const t=Da();Ie(),Zo||(console.log("[ChatService] Initializing chat service with MVC architecture"),Qo=new Oi(t),De=new Wi(Qo),Zo=!0);function n(l){Br.value=l,De&&De.setCurrentPartner(l)}function e(l,v=null){const d=v||Br.value;return!d||!l.trim()||!De?!1:De.sendMessage(l,d)}function r(l,v){return De?De.resendMessage(l,v):!1}function o(l){return!l||!De?[]:De.getMessages(l)}function a(l){return!l||!De?!1:De.hasUnreadMessages(l)}function c(l){!l||!De||De.markAsRead(l)}function u(l){!l||!De||De.sendTypingIndicator(l)}function f(l){De&&De.clearChat(l)}function s(){De&&De.clearAllChats()}return{currentPartnerId:Br,setCurrentPartner:n,sendMessage:e,resendMessage:r,getMessages:o,hasUnreadMessages:a,markAsRead:c,handleTyping:u,clearChat:f,clearAllChats:s}}const Gt="/assets/Circle-e098ae42.png",Li={class:"bg-white/5 backdrop-blur-sm rounded-2xl p-4 sm:p-6 text-center border border-white/10"},Hi={key:"disconnected"},ji={key:"disconnecting"},Ui={class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},qi={class:"text-xs sm:text-sm text-red-300"},zi={key:"searching"},Gi={key:"matched"},Vi={class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},Ki={key:0,class:"flex items-center justify-center gap-2 text-gray-300"},Yi={class:"text-lg sm:text-xl"},Xi={class:"text-xs sm:text-sm font-medium"},Qi={key:"connected"},Zi={class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},Ji={key:0,class:"flex items-center justify-center gap-2 text-gray-300"},el={class:"text-lg sm:text-xl"},tl={class:"text-xs sm:text-sm font-medium"},nl={key:0,class:"mt-3 sm:mt-4 text-xs"},rl={class:"flex items-center justify-center gap-1 sm:gap-2"},ol={class:"text-gray-300"},al={key:0,class:"text-red-400 mt-1 text-xs"},sl=je({__name:"connection-card",props:{status:{type:String,default:"disconnected"},partnerInfo:{type:Object,default:null},errorMessage:{type:String,default:""},showStatus:{type:Boolean,default:!0},disconnectReason:{type:String,default:""}},setup(t){const n=t,e=N(n.status),r=Ee(()=>{switch(n.disconnectReason){case"skip":return"Skipped";case"network-disconnect":return"Connection Lost";case"inactivity":return"Inactive Connection";case"matching":return"Finding New Partner";default:return"Disconnected"}}),o=Ee(()=>{switch(n.disconnectReason){case"skip":return"The conversation has been skipped";case"network-disconnect":return"The connection with your partner was lost";case"inactivity":return"The call ended due to inactivity";case"matching":return"Looking for a new partner...";default:return"The call has been ended"}});Te(()=>n.partnerInfo,(v,d)=>{console.log("PartnerInfo changed in connection-card:",{new:v?"Present":"Null",old:d?"Present":"Null",status:n.status})},{deep:!0}),Te(()=>n.status,(v,d)=>{console.log("Status changed in connection-card:",{new:v,old:d}),e.value=d,v==="disconnected"&&n.partnerInfo!==null&&console.warn("Warning: Partner info still present when status is disconnected")});const a=Ee(()=>e.value==="disconnected"&&n.status==="searching"?"idle-to-search":e.value==="searching"&&n.status==="matched"?"search-to-match":e.value==="matched"&&n.status==="connected"?"match-to-connect":n.status==="disconnected"?"to-idle":n.status==="disconnecting"?"to-disconnecting":"fade"),c=v=>{},u=(v,d)=>{},f=v=>{},s=Ee(()=>{switch(n.status){case"searching":return"Searching...";case"matched":return"Partner found, connecting...";case"connected":return"Connected";case"disconnecting":return"Call ended";default:return"Disconnected"}}),l=v=>{switch(v.toLowerCase()){case"any":return"Go With the Flow";case"chill":return"Chill";case"fun":return"Fun";case"curious":return"Curious";case"creative":return"Creative";default:return v}};return Ve(()=>{window.addEventListener("connection-closed",()=>{console.log("Connection-closed event received in connection-card")})}),(v,d)=>(H(),j("div",Li,[Qe(Ya,{name:a.value,mode:"out-in",onBeforeLeave:c,onEnter:u,onAfterEnter:f},{default:Ka(()=>{var y,g;return[t.status==="disconnected"?(H(),j("div",Hi,d[0]||(d[0]=[i("div",{class:"status-container"},[i("div",{class:"status-circle"},[i("img",{src:Gt,alt:"Connection Circle",class:"circle-image"}),i("div",{class:"thin-ring idle-ring"})])],-1),i("h2",{class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},"Ready to Connect",-1),i("p",{class:"text-xs sm:text-sm text-gray-300"},'Press "Next" to find someone to talk with',-1)]))):t.status==="disconnecting"?(H(),j("div",ji,[d[1]||(d[1]=i("div",{class:"status-container"},[i("div",{class:"status-circle"},[i("img",{src:Gt,alt:"Connection Circle",class:"circle-image pulse-effect"}),i("div",{class:"thin-ring disconnecting-ring"})])],-1)),i("h2",Ui,Y(r.value),1),i("p",qi,Y(o.value),1)])):t.status==="searching"?(H(),j("div",zi,d[2]||(d[2]=[i("div",{class:"status-container"},[i("div",{class:"status-circle"},[i("img",{src:Gt,alt:"Connection Circle",class:"circle-image pulse-effect"}),i("div",{class:"thin-ring search-ring"})])],-1),i("h2",{class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},"Searching...",-1),i("p",{class:"text-xs sm:text-sm text-gray-300"},"Looking for someone to talk to",-1)]))):t.status==="matched"?(H(),j("div",Gi,[d[3]||(d[3]=i("div",{class:"status-container"},[i("div",{class:"status-circle"},[i("img",{src:Gt,alt:"Connection Circle",class:"circle-image fast-rotate"}),i("div",{class:"thin-ring match-ring"})])],-1)),i("h2",Vi,Y((y=t.partnerInfo)!=null&&y.vibe?l(t.partnerInfo.vibe):"Match Found!"),1),t.partnerInfo?(H(),j("div",Ki,[i("span",Yi,Y(t.partnerInfo.flag||"🌍"),1),i("span",Xi,Y(t.partnerInfo.country),1)])):te("",!0),d[4]||(d[4]=i("p",{class:"text-xs sm:text-sm text-yellow-400 mt-1 sm:mt-2"},"Setting up voice connection...",-1))])):t.status==="connected"?(H(),j("div",Qi,[d[5]||(d[5]=i("div",{class:"status-container"},[i("div",{class:"status-circle"},[i("img",{src:Gt,alt:"Connection Circle",class:"circle-image"}),i("div",{class:"thin-ring connect-ring"})])],-1)),i("h2",Zi,Y((g=t.partnerInfo)!=null&&g.vibe?l(t.partnerInfo.vibe):"Connected!"),1),t.partnerInfo?(H(),j("div",Ji,[i("span",el,Y(t.partnerInfo.flag||"🌍"),1),i("span",tl,Y(t.partnerInfo.country),1)])):te("",!0),d[6]||(d[6]=i("p",{class:"text-xs sm:text-sm text-green-400 mt-1 sm:mt-2"},"You can talk now",-1))])):te("",!0)]}),_:1},8,["name"]),t.showStatus&&t.status!=="disconnected"?(H(),j("div",nl,[i("div",rl,[i("span",{class:se({"text-green-400":t.status==="connected","text-yellow-400":t.status==="matched","text-blue-400":t.status==="searching","text-red-400":t.status==="disconnecting"})},"●",2),i("span",ol,Y(s.value),1)]),t.errorMessage?(H(),j("p",al,Y(t.errorMessage),1)):te("",!0)])):te("",!0)]))}});const tt=(t,n)=>{const e=t.__vccOpts||t;for(const[r,o]of n)e[r]=o;return e},il=tt(sl,[["__scopeId","data-v-f2f75ee4"]]),ll={class:"space-y-2 sm:space-y-3 md:space-y-4 px-1 sm:px-2"},cl={class:"flex justify-center items-center gap-2 sm:gap-3 md:gap-4"},ul=["disabled"],dl={class:"relative"},fl={key:0,class:"text-white text-base sm:text-lg md:text-xl"},xl={key:1,class:"text-white text-base sm:text-lg md:text-xl"},vl={key:2,class:"absolute -top-1 -right-1 w-2 h-2 sm:w-3 sm:h-3 bg-yellow-300 rounded-full animate-pulse"},gl=["disabled"],ml={class:"flex flex-wrap justify-center gap-1 sm:gap-2 md:gap-3"},pl=je({__name:"control-buttons",props:{isMuted:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!0}},emits:["toggle-mute","find-next","toggle-chat","toggle-games","toggle-history","toggle-donation"],setup(t,{emit:n}){const e=t,r=n,o=N(!1),a=N(e.isMuted);Te(()=>e.isMuted,f=>{a.value=f});function c(f){const{isMuted:s}=f.detail;a.value=s}function u(){o.value||(o.value=!0,r("toggle-mute"),setTimeout(()=>{o.value=!1},200),setTimeout(()=>{try{const f=document.querySelector("audio");f&&f.paused&&f.play().catch(s=>{console.warn("Could not auto-play audio after mute toggle:",s)})}catch(f){console.error("Error trying to auto-play:",f)}},300))}return Ve(()=>{const{getSavedMicrophoneState:f}=Vt(),s=f();s!==null&&(a.value=s),window.addEventListener("microphone-state-changed",c)}),xt(()=>{window.removeEventListener("microphone-state-changed",c)}),(f,s)=>(H(),j("div",ll,[i("div",cl,[i("button",{onClick:u,class:se(["w-11 h-11 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center transition-all shadow-xl transform hover:scale-110",a.value?"bg-gradient-to-r from-red-400 to-pink-400 shadow-red-400/70":"bg-gradient-to-r from-emerald-400 to-green-400 hover:from-green-400 hover:to-emerald-400 shadow-emerald-400/70"]),disabled:o.value},[i("div",dl,[a.value?(H(),j("span",xl,"🔇")):(H(),j("span",fl,"🎤")),o.value?(H(),j("span",vl)):te("",!0)])],10,ul),i("button",{onClick:s[0]||(s[0]=l=>f.$emit("find-next")),class:"w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-gradient-to-r from-orange-400 to-yellow-400 hover:from-yellow-400 hover:to-orange-400 rounded-full flex items-center justify-center shadow-2xl shadow-orange-400/80 transition-all transform hover:scale-110"},s[5]||(s[5]=[i("span",{class:"text-white text-xl sm:text-2xl md:text-3xl"},"📞",-1)])),i("button",{onClick:s[1]||(s[1]=l=>f.$emit("toggle-chat")),disabled:t.isDisabled,class:se(["w-11 h-11 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center shadow-xl transition-all transform hover:scale-110",t.isDisabled?"bg-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-blue-400 to-cyan-400 hover:from-cyan-400 hover:to-blue-400 shadow-blue-400/70"])},s[6]||(s[6]=[i("span",{class:"text-white text-base sm:text-lg md:text-xl"},"💬",-1)]),10,gl)]),i("div",ml,[i("button",{onClick:s[2]||(s[2]=l=>f.$emit("toggle-games")),class:"bg-gradient-to-r from-purple-400 to-pink-400 hover:from-pink-400 hover:to-purple-400 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-purple-400/70 transition-all transform hover:scale-110 whitespace-nowrap"}," 🎮 Games "),i("button",{onClick:s[3]||(s[3]=l=>f.$emit("toggle-history")),class:"bg-gradient-to-r from-indigo-400 to-blue-400 hover:from-blue-400 hover:to-indigo-400 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-indigo-400/70 transition-all transform hover:scale-110 whitespace-nowrap"}," 📞 History "),i("button",{onClick:s[4]||(s[4]=l=>f.$emit("toggle-donation")),class:"bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-orange-400 hover:to-yellow-400 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-yellow-400/70 transition-all animate-pulse transform hover:scale-110 whitespace-nowrap"}," ❤️ Support ")])]))}}),hl={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},bl={class:"bg-gray-900 rounded-lg w-full max-w-md mx-auto h-[80vh] flex flex-col"},yl={class:"flex items-center justify-between p-4 border-b border-gray-700"},Cl={key:0,class:"h-full flex items-center justify-center text-gray-500"},wl={key:1,class:"space-y-2"},El={class:"flex justify-between gap-2"},_l={class:"text-xs text-gray-400"},Al={class:"mt-1 text-white break-words"},Bl={class:"p-3 border-t border-gray-700"},kl=["disabled"],Dl=["disabled"],Tl=je({__name:"chat-modal",props:{isOpen:{type:Boolean,default:!1},isConnected:{type:Boolean,default:!1},messages:{type:Array,default:()=>[]}},emits:["close","send-message"],setup(t,{emit:n}){const e=t,r=n,o=N(""),a=N(null),c=()=>{o.value.trim()&&e.isConnected&&(r("send-message",o.value),o.value="")},u=async()=>{await ra(),a.value&&(a.value.scrollTop=a.value.scrollHeight)},f=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return Te(()=>e.messages,()=>{u()},{deep:!0}),Te(()=>e.isOpen,s=>{s&&u()}),Ve(()=>{e.isOpen&&u()}),(s,l)=>t.isOpen?(H(),j("div",hl,[i("div",bl,[i("div",yl,[l[2]||(l[2]=i("div",{class:"flex items-center"},[i("span",{class:"text-white text-lg font-medium"},"💬 Chat")],-1)),i("button",{onClick:l[0]||(l[0]=v=>s.$emit("close")),class:"text-gray-400 hover:text-white"}," ✕ ")]),i("div",{class:"flex-1 p-4 overflow-y-auto",ref_key:"messagesContainerRef",ref:a},[t.messages.length===0?(H(),j("div",Cl,l[3]||(l[3]=[i("div",{class:"text-center"},[i("p",null,"No messages yet"),i("p",{class:"text-sm mt-1"},"Send a message to start the conversation")],-1)]))):(H(),j("div",wl,[(H(!0),j(_e,null,Pe(t.messages,v=>(H(),j("div",{key:v.id,class:se(["rounded-lg p-3 max-w-[80%]",v.isOwn?"bg-blue-700 ml-auto":"bg-gray-700 mr-auto"])},[i("div",El,[i("span",{class:se(["text-sm",v.isOwn?"text-blue-200":"text-gray-200"])},Y(v.isOwn?"You":"Partner"),3),i("span",_l,Y(f(v.timestamp)),1)]),i("p",Al,Y(v.text||v.message),1)],2))),128))]))],512),i("div",Bl,[i("form",{onSubmit:Pr(c,["prevent"]),class:"flex gap-2"},[Pt(i("input",{"onUpdate:modelValue":l[1]||(l[1]=v=>o.value=v),type:"text",placeholder:"Type a message...",class:"flex-1 bg-gray-800 border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!t.isConnected},null,8,kl),[[Kt,o.value]]),i("button",{type:"submit",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",disabled:!t.isConnected||!o.value.trim()}," Send ",8,Dl)],32)])])])):te("",!0)}});class Fl{constructor(n=[]){Ue(this,"sounds",new Map);Ue(this,"isMuted",!1);Ue(this,"defaultVolume",.5);Ue(this,"soundPaths",{click:"/sounds/click.mp3",win:"/sounds/win.mp3",lose:"/sounds/lose.mp3",draw:"/sounds/draw.mp3",move:"/sounds/move.mp3",notification:"/sounds/notification.mp3",countdown:"/sounds/countdown.mp3",gameStart:"/sounds/game-start.mp3",gameOver:"/sounds/game-over.mp3",correct:"/sounds/correct.mp3",incorrect:"/sounds/incorrect.mp3",button:"/sounds/button.mp3"});n.length>0&&n.forEach(o=>{o in this.soundPaths&&this.preloadSound(o)});const e=localStorage.getItem("gameSoundMuted");e&&(this.isMuted=e==="true");const r=localStorage.getItem("gameSoundVolume");r&&(this.defaultVolume=parseFloat(r))}preloadSound(n){if(this.soundPaths[n]){const e=new Audio(this.soundPaths[n]);e.preload="auto",this.sounds.set(n,e)}}playSound(n,e={}){if(this.isMuted)return;this.sounds.has(n)||this.preloadSound(n);const r=this.sounds.get(n);r&&(r.pause(),r.currentTime=0,r.volume=e.volume!==void 0?e.volume:this.defaultVolume,r.loop=e.loop||!1,r.play().catch(o=>{console.warn(`Failed to play sound ${n}:`,o)}))}toggleMute(){return this.isMuted=!this.isMuted,localStorage.setItem("gameSoundMuted",this.isMuted.toString()),this.isMuted&&this.stopAllSounds(),this.isMuted}isSoundMuted(){return this.isMuted}setVolume(n){this.defaultVolume=Math.max(0,Math.min(1,n)),localStorage.setItem("gameSoundVolume",this.defaultVolume.toString())}stopAllSounds(){this.sounds.forEach(n=>{n.pause(),n.currentTime=0})}stopSound(n){const e=this.sounds.get(n);e&&(e.pause(),e.currentTime=0)}}class fn{static addWinEffect(n,e=2e3){n.classList.add("win-effect"),setTimeout(()=>{n.classList.remove("win-effect")},e)}static addLoseEffect(n,e=1e3){n.classList.add("lose-effect"),setTimeout(()=>{n.classList.remove("lose-effect")},e)}static addDrawEffect(n,e=1500){n.classList.add("draw-effect"),setTimeout(()=>{n.classList.remove("draw-effect")},e)}static addPulseEffect(n,e="rgba(139, 92, 246, 0.5)",r=1e3){const o=n.style.border,a=n.style.boxShadow;n.style.border=`2px solid ${e}`,n.style.boxShadow=`0 0 10px ${e}`,n.style.transition="all 0.3s ease",setTimeout(()=>{n.style.border=o,n.style.boxShadow=a},r)}static addMoveEffect(n,e,r=10,o=300){const a=n.style.position,c=n.style.transform;a!=="relative"&&a!=="absolute"&&(n.style.position="relative");let u="";switch(e){case"up":u=`translateY(-${r}px)`;break;case"down":u=`translateY(${r}px)`;break;case"left":u=`translateX(-${r}px)`;break;case"right":u=`translateX(${r}px)`;break}n.style.transform=u,n.style.transition=`transform ${o}ms ease`,setTimeout(()=>{n.style.transform=c},o)}}const ge=new Fl(["click","win","lose","move","notification"]),Sl={class:"w-full p-2"},Rl={class:"flex justify-between items-center mb-4 game-header"},$l={key:0,class:"text-yellow-300 animate-pulse"},Il={key:1},Pl={key:2},Ml={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 mb-4 game-board"},Ol={class:"mb-4 w-full"},Wl={class:"flex items-center justify-between gap-4 mb-2"},Nl={class:"flex items-center"},Ll={class:"text-center ml-2"},Hl={key:0,class:"flex items-center"},jl={class:"flex items-center justify-center p-1 bg-gray-700/50 rounded-lg"},Ul={class:"ml-2 text-sm text-gray-300"},ql={class:"flex items-center"},zl={class:"text-center mr-2"},Gl={key:0,class:"bg-gray-700/40 rounded-lg p-2 text-sm text-gray-300 mb-3"},Vl={class:"flex justify-between mb-1"},Kl={class:"flex justify-between mb-1"},Yl={class:"flex justify-between"},Xl={class:"grid grid-cols-3 gap-3 mb-4"},Ql=["onClick","disabled"],Zl={key:0,class:"text-blue-400"},Jl={key:1,class:"text-green-400"},ec={key:0,class:"text-center mt-4 animate__animated animate__fadeIn"},tc={key:1,class:"text-center mt-4 animate__animated animate__fadeIn"},nc={key:2,class:"text-center mt-4"},rc={key:0,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},oc={class:"bg-gray-800 p-4 rounded-lg max-w-xs w-full text-center"},ac={class:"flex justify-center gap-3"},sc=6e4,ic=je({__name:"TicTacToe",props:{partnerId:{type:String,required:!0},isFirstPlayer:{type:Boolean,default:!0},partnerReady:{type:Boolean,default:!1}},emits:["back","error"],setup(t,{emit:n}){const e=t,r=n,{socket:o}=Ie(),a=N("waiting"),c=N(["","","","","","","","",""]),u=N(e.isFirstPlayer?"X":"O"),f=N(e.isFirstPlayer?"O":"X"),s=N("X"),l=N(null),v=N(null),d=N(Date.now()),y=N([]),g=N([]);N(ge.isSoundMuted());const h=N(!1),x=N({moves:0,movesByPlayer:{},gameTime:0,gameStartTime:Date.now()}),p=Ee(()=>s.value===u.value),m=E=>{const P=Math.floor(E/60),U=E%60;return`${P}:${U<10?"0":""}${U}`},b=E=>{var P;if(!(a.value!=="playing"||c.value[E]!==""||!p.value||l.value!==null))try{ge.playSound("move"),c.value[E]=u.value,s.value=f.value,d.value=Date.now(),g.value[E]&&fn.addPulseEffect(g.value[E],u.value==="X"?"rgba(59, 130, 246, 0.5)":"rgba(16, 185, 129, 0.5)");const U={index:E};(P=o.value)==null||P.emit("game-move",{gameType:"tic-tac-toe",move:U,to:e.partnerId}),C(),w()}catch{S("Failed to make a move. Please try again.")}},C=()=>{const E=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const P of E){const[U,Q,k]=P;if(c.value[U]!==""&&c.value[U]===c.value[Q]&&c.value[U]===c.value[k])return a.value="finished",l.value=c.value[U],y.value=P,setTimeout(()=>{P.forEach(R=>{g.value[R]&&fn.addWinEffect(g.value[R])})},100),l.value===u.value?ge.playSound("win"):ge.playSound("lose"),!0}return c.value.every(P=>P!=="")?(a.value="finished",l.value="tie",ge.playSound("draw"),!0):!1},w=()=>{v.value&&clearTimeout(v.value),v.value=window.setTimeout(()=>{var E;a.value==="playing"&&l.value===null&&((E=o.value)==null||E.emit("game-ping",{to:e.partnerId,gameType:"tic-tac-toe"}),setTimeout(()=>{a.value==="playing"&&l.value===null&&A()},5e3))},sc)},A=()=>{a.value==="playing"&&(a.value="finished",S("Lost connection with your partner. The game has ended."),ge.playSound("notification"))},D=()=>{var E;try{ge.playSound("click"),c.value=["","","","","","","","",""],l.value=null,a.value="playing",y.value=[];const P=u.value;u.value=f.value,f.value=P,s.value="X",(E=o.value)==null||E.emit("game-reset",{gameType:"tic-tac-toe",to:e.partnerId,swapRoles:!0}),w()}catch{S("Failed to reset the game. Please try again.")}},S=E=>{r("error",E),console.error(E)},z=E=>{var P,U,Q;if(console.log("Received server state update:",E),E.board&&(c.value=E.board.map(k=>k===null?"":k)),E.currentSymbol?s.value=E.currentSymbol:E.currentTurn&&E.marks&&(s.value=E.marks[E.currentTurn]||"X"),E.playerSymbols){const k=(P=o.value)==null?void 0:P.id,R=e.partnerId;k&&E.playerSymbols[k]&&(u.value=E.playerSymbols[k],f.value=E.playerSymbols[R])}else if(E.marks){const k=((U=o.value)==null?void 0:U.id)||"";u.value=E.marks[k]||"X";const R=Object.keys(E.marks).filter($=>$!==k);R.length>0&&(f.value=E.marks[R[0]]||"O")}if(E.gameOver)if(a.value="finished",E.winner){const k=((Q=o.value)==null?void 0:Q.id)||"";E.winner===k?(l.value=u.value,ge.playSound("win")):(l.value=f.value,ge.playSound("lose"))}else E.isDraw&&(l.value="tie",ge.playSound("draw"));else a.value="playing";E.winningLine&&(y.value=E.winningLine,y.value.length>0&&setTimeout(()=>{y.value.forEach(k=>{g.value[k]&&fn.addWinEffect(g.value[k])})},100)),E.stats&&(x.value=E.stats),E.gameOver||C()};Ve(()=>{if(!o.value){S("Socket connection not available");return}o.value.on("game-move",E=>{if(E.gameType==="tic-tac-toe"&&E.from===e.partnerId)try{if(E.gameState){z(E.gameState),ge.playSound("move"),w();return}let P=-1;if(typeof E.move=="object"&&E.move!==null?typeof E.move.index=="number"?P=E.move.index:typeof E.move.row=="number"&&typeof E.move.col=="number"&&(P=E.move.row*3+E.move.col):typeof E.move=="number"&&(P=E.move),P<0||P>=9){S("Received invalid move from partner");return}c.value[P]=f.value,s.value=u.value,d.value=Date.now(),ge.playSound("move"),g.value[P]&&fn.addPulseEffect(g.value[P],f.value==="X"?"rgba(59, 130, 246, 0.5)":"rgba(16, 185, 129, 0.5)"),C(),w()}catch{S("Error processing partner's move")}}),o.value.on("game-reset",E=>{if(E.gameType==="tic-tac-toe"&&E.from===e.partnerId)try{if(E.gameState){z(E.gameState),ge.playSound("gameStart"),w();return}if(c.value=["","","","","","","","",""],l.value=null,a.value="playing",y.value=[],E.swapRoles){const P=u.value;u.value=f.value,f.value=P}s.value="X",ge.playSound("gameStart"),w(),console.log(`Game reset received. My symbol is now ${u.value}, partner's symbol is ${f.value}`)}catch{S("Error resetting the game")}}),o.value.on("game-state",E=>{if(E.gameType==="tic-tac-toe")try{z(E)}catch{S("Error updating game state")}}),o.value.on("game-ping",E=>{var P;E.from===e.partnerId&&((P=o.value)==null||P.emit("game-pong",{to:e.partnerId,gameType:"tic-tac-toe"}),d.value=Date.now())}),o.value.on("game-pong",E=>{E.from===e.partnerId&&(d.value=Date.now(),console.log("Received pong from partner, connection is active"))}),o.value.on("game-notification",E=>{E.from===e.partnerId&&(E.type==="leave"?console.log("Partner is leaving the game"):console.log(`Game notification from partner: ${E.message}`))}),o.value.on("game-partner-joined",E=>{E.from===e.partnerId&&(a.value="playing",ge.playSound("gameStart"),w())}),o.value.on("game-partner-left",E=>{if(E.from===e.partnerId){a.value="finished";const P=document.createElement("div");P.className="fixed top-4 right-4 bg-yellow-600/80 text-white px-4 py-2 rounded-lg shadow-lg z-50",P.innerHTML=`
        <div class="flex items-center gap-2">
          <span>⚠️</span>
          <span>Your partner has left the game</span>
        </div>
      `,document.body.appendChild(P),setTimeout(()=>{document.body.removeChild(P),r("back")},3e3),ge.playSound("click"),v.value&&(clearTimeout(v.value),v.value=null)}}),e.isFirstPlayer||(a.value="playing",ge.playSound("gameStart"),w())}),xt(()=>{o.value&&(o.value.off("game-move"),o.value.off("game-reset"),o.value.off("game-partner-joined"),o.value.off("game-partner-left"),o.value.off("game-state"),o.value.off("game-notification"),o.value.off("game-ping"),o.value.off("game-pong"),e.partnerId&&(o.value.emit("game-notification",{to:e.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{var E;(E=o.value)==null||E.emit("game-leave-room",{roomId:`tictactoe-${e.partnerId}`,to:e.partnerId})},200))),v.value&&(clearTimeout(v.value),v.value=null)});const B=N(!1),_=()=>{B.value=!1,o.value&&e.partnerId?(o.value.emit("game-notification",{to:e.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{var E;(E=o.value)==null||E.emit("game-leave-room",{roomId:`tictactoe-${e.partnerId}`,to:e.partnerId}),r("back")},200)):r("back")},O=()=>{ge.playSound("click"),B.value=!0};return(E,P)=>(H(),j(_e,null,[i("div",Sl,[i("div",Rl,[P[2]||(P[2]=i("h2",{class:"text-xl font-bold text-purple-400"},"Tic Tac Toe",-1)),i("div",{class:se(["text-white text-sm px-3 py-1 rounded-full game-status",{"bg-yellow-600/30":a.value==="waiting","bg-green-600/30":p.value&&a.value==="playing","bg-red-600/30":!p.value&&a.value==="playing","bg-purple-600/30":l.value}])},[a.value==="waiting"?(H(),j("span",$l," Waiting for partner... ")):l.value?(H(),j("span",Il,Y(l.value===u.value?"You Won! 🎉":l.value==="tie"?"It's a Tie! 🤝":"You Lost! 😢"),1)):(H(),j("span",Pl,Y(p.value?"Your Turn":"Partner's Turn"),1))],2)]),i("div",Ml,[i("div",{class:se(["flex flex-col items-center",[{"opacity-70":a.value==="waiting"||!p.value&&!l.value}]])},[i("div",Ol,[i("div",Wl,[i("div",Nl,[i("div",{class:se([{"ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800":u.value==="X"},"w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-lg font-bold"])}," X ",2),i("div",Ll,[P[3]||(P[3]=i("p",{class:"text-gray-300 text-sm"},"You",-1)),i("p",{class:se(["font-bold text-lg",{"text-blue-400":u.value==="X","text-green-400":u.value==="O"}])},Y(u.value),3)])]),a.value==="playing"?(H(),j("div",Hl,[i("div",jl,[i("div",{class:se(["w-2 h-2 rounded-full",{"bg-green-400 animate-pulse":p.value,"bg-red-400":!p.value}])},null,2),i("span",Ul,Y(p.value?"Your Turn":"Partner's Turn"),1)])])):te("",!0),i("div",ql,[i("div",zl,[P[4]||(P[4]=i("p",{class:"text-gray-300 text-sm"},"Partner",-1)),i("p",{class:se(["font-bold text-lg",{"text-blue-400":f.value==="X","text-green-400":f.value==="O"}])},Y(f.value),3)]),i("div",{class:se([{"ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800":u.value==="O"},"w-10 h-10 rounded-full bg-green-600 flex items-center justify-center text-lg font-bold"])}," O ",2)])]),h.value?(H(),j("div",Gl,[i("div",Vl,[P[5]||(P[5]=i("span",null,"Moves:",-1)),i("span",null,Y(x.value.moves),1)]),i("div",Kl,[P[6]||(P[6]=i("span",null,"Your Moves:",-1)),i("span",null,Y(x.value.movesByPlayer[e.partnerId]||0),1)]),i("div",Yl,[P[7]||(P[7]=i("span",null,"Game Time:",-1)),i("span",null,Y(m(x.value.gameTime)),1)])])):te("",!0),i("button",{onClick:P[0]||(P[0]=U=>h.value=!h.value),class:"w-full text-xs bg-gray-700/30 hover:bg-gray-700/50 py-1 rounded-lg transition-colors text-gray-400"},Y(h.value?"Hide Stats":"Show Stats"),1)]),i("div",Xl,[(H(!0),j(_e,null,Pe(c.value,(U,Q)=>(H(),j("button",{key:Q,onClick:k=>b(Q),disabled:U!==""||!p.value||l.value!==null||a.value==="waiting",ref_for:!0,ref:k=>{k&&(g.value[Q]=k)},class:se(["w-20 h-20 rounded-lg flex items-center justify-center text-3xl font-bold transition-all duration-300 game-cell game-transition",{"game-interactive bg-gray-700 hover:bg-gray-600":U===""&&p.value&&!l.value&&a.value!=="waiting","bg-gray-700/50":U===""&&(!p.value||l.value!==null||a.value==="waiting"),"bg-blue-600/20":U==="X","bg-green-600/20":U==="O","cursor-not-allowed":U!==""||!p.value||l.value!==null||a.value==="waiting","hover:bg-purple-700/50":p.value&&U===""&&!l.value&&a.value==="playing","win-effect":y.value.includes(Q)}])},[U==="X"?(H(),j("span",Zl,"X")):U==="O"?(H(),j("span",Jl,"O")):te("",!0)],10,Ql))),128))]),l.value?(H(),j("div",ec,[i("button",{onClick:D,class:"game-button bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm transition-colors mb-2 game-interactive"}," Play Again "),P[8]||(P[8]=i("p",{class:"text-sm text-gray-400 mt-1"}," In the next round, symbols (X/O) will be swapped ",-1))])):a.value==="finished"?(H(),j("div",tc,[i("button",{onClick:D,class:"game-button bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm transition-colors mb-2 game-interactive"}," Play Again "),P[9]||(P[9]=i("p",{class:"text-sm text-gray-400 mt-1"}," In the next round, symbols (X/O) will be swapped ",-1))])):te("",!0),a.value==="waiting"?(H(),j("div",nc,P[10]||(P[10]=[i("div",{class:"bg-yellow-600/20 rounded-lg p-4 animate-pulse"},[i("p",{class:"text-yellow-300 mb-1"},"Waiting for your partner to join..."),i("p",{class:"text-sm text-gray-300"},[ze(" You'll play as "),i("span",{class:"font-bold text-blue-400"},"X")])],-1)]))):te("",!0)],2)]),i("div",{class:"flex justify-end mb-4"},[i("button",{onClick:O,class:"game-button bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors game-interactive"}," Back to Games ")])]),B.value?(H(),j("div",rc,[i("div",oc,[P[11]||(P[11]=i("h3",{class:"text-lg font-semibold mb-3 text-white"},"Are you sure?",-1)),P[12]||(P[12]=i("p",{class:"text-sm text-gray-300 mb-4"}," Leaving the game will end it for your partner too. ",-1)),i("div",ac,[i("button",{onClick:P[1]||(P[1]=U=>B.value=!1),class:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"}," Cancel "),i("button",{onClick:_,class:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm"}," Leave ")])])])):te("",!0)],64))}});const lc=tt(ic,[["__scopeId","data-v-9065bc8e"]]),cc={class:"w-full p-2"},uc={class:"flex justify-between items-center mb-4"},dc={key:0,class:"text-yellow-300 animate-pulse flex items-center"},fc={key:1,class:"flex items-center"},xc={key:2,class:"flex items-center"},vc={key:3,class:"flex items-center"},gc={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 md:p-6 mb-4 border border-gray-700/50 shadow-xl"},mc={class:"flex justify-center items-center gap-4 md:gap-8 mb-6 w-full"},pc={class:"text-center p-2 bg-blue-900/20 rounded-lg backdrop-blur-sm border border-blue-800/30 min-w-[70px]"},hc={class:"text-2xl font-bold text-blue-400"},bc={class:"text-center px-4 py-2 bg-gray-700/50 rounded-lg border border-gray-600/30"},yc={class:"text-xl font-bold text-white"},Cc={class:"text-center p-2 bg-green-900/20 rounded-lg backdrop-blur-sm border border-green-800/30 min-w-[70px]"},wc={class:"text-2xl font-bold text-green-400"},Ec={class:"w-full mb-4"},_c={key:0,class:"flex flex-col items-center mb-6 animate__animated animate__fadeIn"},Ac={class:"flex justify-center items-center gap-6 md:gap-10 mb-6"},Bc={class:"text-center"},kc={class:"text-center"},Dc={key:1,class:"animate__animated animate__fadeIn"},Tc={class:"text-center mb-6"},Fc={class:"inline-block px-3 py-1 rounded-full bg-gray-700/70 text-sm text-gray-300 mb-2"},Sc={class:"flex justify-center items-center gap-3 md:gap-6"},Rc=["onClick"],$c={class:"text-4xl mb-2"},Ic={class:"text-xs text-gray-300"},Pc={key:2,class:"text-center"},Mc={key:3,class:"text-center"},Oc={key:0,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},Wc={class:"bg-gray-800 p-4 rounded-lg max-w-xs w-full text-center"},Nc={class:"flex justify-center gap-3"},Jo=10,Lc=je({__name:"RockPaperScissors",props:{partnerId:{type:String,required:!0},partnerReady:{type:Boolean,default:!1}},emits:["back","error"],setup(t,{emit:n}){const e=t,r=n,{socket:o}=Ie(),a=[{value:"rock",name:"Rock",emoji:"👊"},{value:"paper",name:"Paper",emoji:"✋"},{value:"scissors",name:"Scissors",emoji:"✌️"}],c=N("waiting"),u=N(null),f=N(null),s=N(0),l=N(0),v=N(1),d=N(null),y=N(Jo),g=N(null),h=N(!1),x=Ee(()=>d.value==="win"?"You Win!":d.value==="lose"?"You Lose!":d.value==="tie"?"It's a Tie!":""),p=B=>{if(!B)return"❓";const _=a.find(O=>O.value===B);return _?_.emoji:"❓"},m=()=>{var B;c.value="choosing",u.value=null,f.value=null,d.value=null,A(),(B=o.value)==null||B.emit("game-start-round",{gameType:"rock-paper-scissors",to:e.partnerId,round:v.value})},b=B=>{var _;u.value=B,(_=o.value)==null||_.emit("game-move",{gameType:"rock-paper-scissors",move:{choice:B,round:v.value},to:e.partnerId}),console.log(`Sent move to server: ${B}, round: ${v.value}`),f.value&&C()},C=()=>{!u.value||!f.value||(D(),c.value="result",u.value===f.value?d.value="tie":u.value==="rock"&&f.value==="scissors"||u.value==="paper"&&f.value==="rock"||u.value==="scissors"&&f.value==="paper"?(d.value="win",s.value++):(d.value="lose",l.value++),v.value++)},w=()=>{m()},A=()=>{y.value=Jo,g.value&&clearInterval(g.value),g.value=window.setInterval(()=>{if(y.value--,y.value<=0&&(D(),!u.value)){const B=Math.floor(Math.random()*a.length);b(a[B].value)}},1e3)},D=()=>{g.value&&(clearInterval(g.value),g.value=null)},S=()=>{h.value=!0},z=()=>{h.value=!1,o.value&&e.partnerId?(o.value.emit("game-notification",{to:e.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{var B;(B=o.value)==null||B.emit("game-leave-room",{roomId:`rps-${e.partnerId}`,to:e.partnerId}),r("back")},200)):r("back")};return Ve(()=>{var B,_,O,E,P;e.partnerReady&&(c.value="ready"),(B=o.value)==null||B.on("game-move",U=>{if(U.from===e.partnerId&&U.gameType==="rock-paper-scissors"){let Q=null;if(typeof U.move=="string"?Q=U.move:typeof U.move=="object"&&U.move!==null&&(Q=U.move.choice),!Q||!["rock","paper","scissors"].includes(Q)){console.error("Received invalid move from partner:",U.move);return}console.log(`Received move from partner: ${Q}`),f.value=Q,u.value&&C()}}),(_=o.value)==null||_.on("game-start-round",U=>{U.from===e.partnerId&&U.gameType==="rock-paper-scissors"&&(c.value="choosing",u.value=null,f.value=null,d.value=null,v.value=U.round,A())}),(O=o.value)==null||O.on("game-partner-joined",U=>{U.from===e.partnerId&&(c.value="ready")}),(E=o.value)==null||E.on("game-partner-left",U=>{if(U.from===e.partnerId){D(),c.value="waiting";const Q=document.createElement("div");Q.className="fixed top-4 right-4 bg-yellow-600/80 text-white px-4 py-2 rounded-lg shadow-lg z-50",Q.innerHTML=`
        <div class="flex items-center gap-2">
          <span>⚠️</span>
          <span>Your partner has left the game</span>
        </div>
      `,document.body.appendChild(Q),setTimeout(()=>{document.body.removeChild(Q),handleBackToGames()},3e3)}}),(P=o.value)==null||P.on("game-reset",U=>{U.from===e.partnerId&&U.gameType==="rock-paper-scissors"&&(s.value=0,l.value=0,v.value=1,c.value="ready")})}),xt(()=>{var B,_,O,E,P;D(),o.value&&e.partnerId&&(o.value.emit("game-notification",{to:e.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{var U;(U=o.value)==null||U.emit("game-leave-room",{roomId:`rps-${e.partnerId}`,to:e.partnerId})},200)),(B=o.value)==null||B.off("game-move"),(_=o.value)==null||_.off("game-start-round"),(O=o.value)==null||O.off("game-partner-joined"),(E=o.value)==null||E.off("game-partner-left"),(P=o.value)==null||P.off("game-reset")}),(B,_)=>(H(),j(_e,null,[i("div",cc,[i("div",uc,[_[5]||(_[5]=i("h2",{class:"text-xl font-bold text-purple-400"},[i("span",{class:"hidden sm:inline"},"Rock Paper Scissors"),i("span",{class:"sm:hidden"},"RPS Game")],-1)),i("div",{class:se(["text-white text-sm px-3 py-1 rounded-full backdrop-blur-sm shadow-lg",{"bg-yellow-600/40 border border-yellow-500/30":c.value==="waiting","bg-green-600/40 border border-green-500/30":c.value==="ready","bg-blue-600/40 border border-blue-500/30":c.value==="choosing","bg-purple-600/40 border border-purple-500/30":c.value==="result"}])},[c.value==="waiting"?(H(),j("span",dc,_[1]||(_[1]=[i("span",{class:"inline-block w-2 h-2 bg-yellow-400 rounded-full mr-2 animate-ping"},null,-1),ze(" Waiting... ")]))):c.value==="ready"?(H(),j("span",fc,_[2]||(_[2]=[i("span",{class:"inline-block w-2 h-2 bg-green-400 rounded-full mr-2"},null,-1),ze(" Ready! ")]))):c.value==="choosing"?(H(),j("span",xc,_[3]||(_[3]=[i("span",{class:"inline-block w-2 h-2 bg-blue-400 rounded-full mr-2"},null,-1),ze(" Choose ")]))):c.value==="result"?(H(),j("span",vc,[_[4]||(_[4]=i("span",{class:"inline-block w-2 h-2 bg-purple-400 rounded-full mr-2"},null,-1)),ze(" "+Y(x.value),1)])):te("",!0)],2)]),i("div",gc,[i("div",{class:se(["flex flex-col items-center",{"opacity-70":c.value==="waiting"}])},[i("div",mc,[i("div",pc,[_[6]||(_[6]=i("div",{class:"text-sm text-gray-300 mb-1"},"You",-1)),i("div",hc,Y(s.value),1)]),i("div",bc,[_[7]||(_[7]=i("div",{class:"text-sm text-gray-300"},"Round",-1)),i("div",yc,Y(v.value),1)]),i("div",Cc,[_[8]||(_[8]=i("div",{class:"text-sm text-gray-300 mb-1"},"Partner",-1)),i("div",wc,Y(l.value),1)])]),i("div",Ec,[c.value==="result"?(H(),j("div",_c,[i("div",Ac,[i("div",Bc,[i("div",{class:se(["w-20 h-20 md:w-24 md:h-24 bg-blue-500/20 rounded-full flex items-center justify-center text-4xl md:text-5xl mb-2 shadow-lg border border-blue-400/30 transform transition-all",{"scale-110 ring-2 ring-blue-400 ring-opacity-50":d.value==="win"}])},Y(p(u.value)),3),_[9]||(_[9]=i("div",{class:"text-sm text-blue-400"},"You",-1))]),_[11]||(_[11]=i("div",{class:"text-2xl font-bold text-white bg-gray-700/50 rounded-full h-10 w-10 flex items-center justify-center"},"VS",-1)),i("div",kc,[i("div",{class:se(["w-20 h-20 md:w-24 md:h-24 bg-green-500/20 rounded-full flex items-center justify-center text-4xl md:text-5xl mb-2 shadow-lg border border-green-400/30 transform transition-all",{"scale-110 ring-2 ring-green-400 ring-opacity-50":d.value==="lose"}])},Y(p(f.value)),3),_[10]||(_[10]=i("div",{class:"text-sm text-green-400"},"Partner",-1))])]),i("div",{class:se(["text-xl font-bold mb-4 py-2 px-4 rounded-lg",{"bg-yellow-500/10 text-yellow-400 border border-yellow-500/30":d.value==="tie","bg-green-500/10 text-green-400 border border-green-500/30":d.value==="win","bg-red-500/10 text-red-400 border border-red-500/30":d.value==="lose"}])},Y(x.value),3),i("button",{onClick:w,class:"mt-2 px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"}," Play Again ")])):c.value==="choosing"?(H(),j("div",Dc,[i("div",Tc,[_[13]||(_[13]=i("p",{class:"text-lg text-white mb-1"},"Choose your move:",-1)),i("div",Fc,[_[12]||(_[12]=ze(" Time: ")),i("span",{class:se(["font-mono text-white",{"text-red-400":y.value<=3}])},Y(y.value)+"s",3)])]),i("div",Sc,[(H(),j(_e,null,Pe(a,O=>i("button",{key:O.value,onClick:E=>b(O.value),class:se(["w-[90px] h-[90px] md:w-24 md:h-24 rounded-lg flex flex-col items-center justify-center transition-all shadow-lg hover:shadow-xl",{"bg-blue-600/30 border border-blue-500/30 scale-105":u.value===O.value,"bg-gray-800/80 border border-gray-700/50 hover:bg-gray-700/70 hover:scale-105 active:scale-95":u.value!==O.value}])},[i("span",$c,Y(O.emoji),1),i("span",Ic,Y(O.name),1)],10,Rc)),64))])])):c.value==="waiting"?(H(),j("div",Pc,_[14]||(_[14]=[ft('<div class="bg-yellow-600/20 rounded-lg p-4 border border-yellow-500/30 shadow-lg animate-pulse" data-v-27a86712><div class="w-16 h-16 mx-auto mb-3 relative" data-v-27a86712><div class="absolute inset-0 bg-yellow-500/20 rounded-full animate-ping" data-v-27a86712></div><div class="absolute inset-2 bg-yellow-500/30 rounded-full animate-ping animation-delay-300" data-v-27a86712></div><div class="absolute inset-4 bg-yellow-500/40 rounded-full animate-ping animation-delay-600" data-v-27a86712></div><div class="absolute inset-0 flex items-center justify-center" data-v-27a86712><span class="text-2xl" data-v-27a86712>👥</span></div></div><p class="text-yellow-300 mb-1 font-medium" data-v-27a86712>Waiting for your partner to join...</p><p class="text-sm text-gray-300" data-v-27a86712>Game will start automatically</p></div>',1)]))):c.value==="ready"?(H(),j("div",Mc,[_[15]||(_[15]=ft('<div class="bg-green-600/20 rounded-lg p-4 border border-green-500/30 shadow-lg mb-4" data-v-27a86712><div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center bg-green-500/30 rounded-full" data-v-27a86712><span class="text-2xl" data-v-27a86712>🎮</span></div><p class="text-lg text-white mb-1" data-v-27a86712>Both players are ready!</p><p class="text-sm text-gray-300 mb-4" data-v-27a86712>Prepare for an epic battle</p></div>',1)),i("button",{onClick:m,class:"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"}," Start Game ")])):te("",!0)])],2)]),i("div",{class:"flex justify-between"},[i("button",{onClick:S,class:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95"}," Back to Games ")])]),h.value?(H(),j("div",Oc,[i("div",Wc,[_[16]||(_[16]=i("h3",{class:"text-lg font-semibold mb-3 text-white"},"Are you sure?",-1)),_[17]||(_[17]=i("p",{class:"text-sm text-gray-300 mb-4"}," Leaving the game will end it for your partner too. ",-1)),i("div",Nc,[i("button",{onClick:_[0]||(_[0]=O=>h.value=!1),class:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"}," Cancel "),i("button",{onClick:z,class:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm"}," Leave ")])])])):te("",!0)],64))}});const Hc=tt(Lc,[["__scopeId","data-v-27a86712"]]),jc={class:"w-full p-2",dir:"auto"},Uc={class:"flex justify-between items-center mb-4"},qc={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 md:p-6 mb-4 border border-gray-700/50 shadow-xl"},zc={class:"flex justify-center items-center gap-4 md:gap-8 mb-6 w-full"},Gc={class:"text-center p-2 bg-blue-900/20 rounded-lg backdrop-blur-sm border border-blue-800/30 min-w-[80px]"},Vc={class:"text-2xl font-bold text-blue-400"},Kc={key:0,class:"text-center px-4 py-2 bg-gray-700/50 rounded-lg border border-gray-600/30"},Yc={class:"text-center p-2 bg-green-900/20 rounded-lg backdrop-blur-sm border border-green-800/30 min-w-[80px]"},Xc={class:"text-2xl font-bold text-green-400"},Qc={class:"text-center p-2 bg-purple-900/20 rounded-lg backdrop-blur-sm border border-purple-800/30 min-w-[80px]"},Zc={class:"text-2xl font-bold text-purple-400"},Jc={class:"w-full mb-4"},eu={key:0,class:"animate__animated animate__fadeIn"},tu={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},nu={class:"mb-4"},ru=["dir","disabled"],ou={key:0,class:"text-xs text-red-400 mt-1"},au={key:1,class:"text-xs text-gray-400 mt-1"},su={class:"mb-4"},iu={class:"flex gap-2"},lu={class:"text-center"},cu=["disabled"],uu={key:1,class:"animate__animated animate__fadeIn"},du={key:2,class:"animate__animated animate__fadeIn"},fu={class:"mb-6"},xu={class:"bg-gray-700/50 rounded-lg p-4 shadow-inner mb-4"},vu={class:"flex justify-between items-center mb-2"},gu={class:"text-xs text-gray-400"},mu=["dir"],pu={class:"mb-4"},hu={class:"flex gap-2"},bu=["dir","maxlength"],yu=["disabled"],Cu={key:0,class:"text-xs text-red-400 mt-1"},wu={key:1,class:"text-xs text-gray-400 mt-1"},Eu={class:"bg-gray-700/30 rounded-lg p-3 max-h-28 overflow-y-auto"},_u={key:0,class:"text-gray-400 italic text-sm"},Au={class:"text-gray-400 w-5"},Bu=["dir"],ku={key:3,class:"animate__animated animate__fadeIn"},Du={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},Tu={class:"flex justify-between items-center mb-2"},Fu=["dir"],Su=["dir"],Ru={class:"mt-4 text-sm text-gray-300"},$u={key:0},Iu={class:"mt-2"},Pu={class:"bg-gray-700/30 rounded-lg p-3 max-h-36 overflow-y-auto"},Mu={key:0,class:"text-gray-400 italic text-sm"},Ou={class:"text-gray-400 w-5"},Wu=["dir"],Nu={key:4,class:"animate__animated animate__fadeIn"},Lu={class:"text-center mb-6"},Hu={class:"w-20 h-20 mx-auto mb-4 flex items-center justify-center bg-purple-500/30 rounded-full"},ju={class:"text-3xl"},Uu={class:"text-2xl font-bold text-white mb-2"},qu={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},zu={class:"text-2xl font-bold text-purple-400 mb-2",dir:"rtl"},Gu={key:0,class:"text-green-400 mt-4"},Vu={key:1,class:"text-yellow-400 mt-4"},Ku={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},Yu={class:"flex justify-between items-center"},Xu={class:"text-xl font-bold text-green-400"},Qu={class:"text-xl font-bold text-blue-400"},Zu={key:5,class:"text-center"},Ju={key:0,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},ed={class:"bg-gray-800 p-4 rounded-lg max-w-xs w-full text-center"},td={class:"text-lg font-semibold mb-3 text-white"},nd={class:"text-sm text-gray-300 mb-4"},rd={class:"flex justify-center gap-3"},od=je({__name:"WordGalaxy",props:{partnerId:{type:String,required:!0},partnerReady:{type:Boolean,default:!1}},emits:["back","error"],setup(t,{emit:n}){const e=t,r=n,{socket:o,userId:a}=Ie(),c=N(""),u=N(""),f=N(!1),s=N("waiting"),l=N(!1),v=N(""),d=N(0),y=N([]),g=N([]),h=N(0),x=N("medium"),p=N(""),m=N([]),b=N(0),C=N(!1),w=N(0),A=N("Watching you set up the game..."),D=N(0),S=N(0),z=N(1),B=N([]),_=N(0),O=N(null),E=N(!1),P={easy:{attempts:10,time:60,multiplier:1},medium:{attempts:8,time:45,multiplier:1.5},hard:{attempts:6,time:30,multiplier:2}};N(ge.isSoundMuted());const U=ee=>/[\u0600-\u06FF]/.test(ee),Q=ee=>/^[a-zA-Z\u0600-\u06FF]+$/.test(ee),k=Ee(()=>v.value&&U(v.value)?"rtl":"ltr"),R=()=>{if(c.value="",v.value.length>0&&v.value.length<3){c.value="The word must be at least 3 letters";return}v.value.length>0&&!Q(v.value)&&(v.value=v.value.replace(/[^a-zA-Z\u0600-\u06FF]/g,""),c.value="Only Arabic or English letters are allowed")},$=()=>{if(u.value="",p.value.length>0&&p.value.length!==d.value){u.value=`The word must be ${d.value} letters long`;return}p.value.length>0&&!Q(p.value)&&(p.value=p.value.replace(/[^a-zA-Z\u0600-\u06FF]/g,""),u.value="Only Arabic or English letters are allowed")},F=Ee(()=>P[x.value].attempts),I=Ee(()=>P[x.value].time),L=Ee(()=>F.value-b.value),K=Ee(()=>v.value.length>=3&&v.value.length<=15&&Q(v.value)&&!c.value),V=()=>{var ee;K.value&&(v.value=v.value.trim(),ge.playSound("gameStart"),(ee=o.value)==null||ee.emit("game-word-setup",{gameType:"word-galaxy",to:e.partnerId,wordLength:v.value.length,difficulty:x.value}),s.value="guessing",d.value=v.value.length,me())},me=()=>{y.value=Array(d.value).fill("_"),g.value=[],h.value=0},xe=()=>{O.value&&clearInterval(O.value),_.value=I.value,E.value=!0,O.value=window.setInterval(()=>{var ee;_.value--,_.value<=0&&(ye(),l.value||(s.value="complete",C.value=!1,(ee=o.value)==null||ee.emit("game-move",{gameType:"word-galaxy",move:"timeout",to:e.partnerId})))},1e3)},ye=()=>{O.value&&(clearInterval(O.value),O.value=null)},ie=()=>{var X,ne;if(!p.value||p.value.length!==d.value)return;if(!Q(p.value)){p.value=p.value.replace(/[^a-zA-Z\u0600-\u06FF]/g,""),u.value="Only Arabic or English letters are allowed";return}const ee=p.value.trim();u.value="",ge.playSound("move"),(X=o.value)==null||X.emit("game-move",{gameType:"word-galaxy",move:ee,to:e.partnerId}),p.value="",b.value++,b.value>=F.value&&(s.value="complete",C.value=!1,ye(),ge.playSound("lose"),(ne=o.value)==null||ne.emit("game-move",{gameType:"word-galaxy",move:"out-of-attempts",to:e.partnerId}))},it=ee=>{var be;const X=v.value,ne=ee;let de=0;const pe=[...g.value];if(U(X))for(let ve=0;ve<X.length;ve++)ne[ve]===X[ve]&&(de++,pe.includes(ve)||pe.push(ve));else for(let ve=0;ve<X.length;ve++)ne[ve]===X[ve]&&(de++,pe.includes(ve)||pe.push(ve));if(g.value=pe,h.value=pe.length,m.value.push({word:ne,matches:de}),A.value=`Made guess: "${ne}" (${de} matches)`,de<X.length){const ve=10*P[x.value].multiplier;S.value+=Math.round(ve),de>0?ge.playSound("correct"):ge.playSound("incorrect")}else ge.playSound("win");(be=o.value)==null||be.emit("game-guess-result",{gameType:"word-galaxy",to:e.partnerId,result:{word:X,originalGuess:ne,matches:de,revealedPositions:pe,isCorrect:de===X.length,creatorEarnedPoints:de<X.length?Math.round(10*P[x.value].multiplier):0}}),de===X.length&&(y.value=X.split(""),h.value=d.value,s.value="complete",C.value=!1,v.value=X,ye(),rt())},nt=ee=>{m.value.push({word:ee.originalGuess||p.value,matches:ee.matches}),ee.creatorEarnedPoints&&(S.value+=ee.creatorEarnedPoints);for(let X=0;X<d.value;X++)ee.revealedPositions.includes(X)&&(y.value[X]=ee.word[X]);h.value=ee.revealedPositions.length,ee.isCorrect?(y.value=ee.word.split(""),h.value=d.value,s.value="complete",C.value=!0,v.value=ee.word,ye(),ge.playSound("win"),rt()):ee.matches>0?ge.playSound("correct"):ge.playSound("incorrect")},rt=()=>{var ee,X;if(C.value){if(!l.value){const de=P[x.value].multiplier,pe=(F.value-b.value)*5,he=Math.round(_.value/3),be=Math.round((50+pe+he)*de);D.value+=be,(ee=o.value)==null||ee.emit("game-score-update",{gameType:"word-galaxy",to:e.partnerId,guesserScore:D.value,creatorScore:S.value})}}else if(l.value){const de=P[x.value].multiplier,pe=Math.round(30*de);S.value+=pe,(X=o.value)==null||X.emit("game-score-update",{gameType:"word-galaxy",to:e.partnerId,guesserScore:D.value,creatorScore:S.value})}B.value.push({creator:l.value&&!C.value?Math.round(30*P[x.value].multiplier):0,guesser:!l.value&&C.value?Math.round((50+(F.value-b.value)*5+Math.round(_.value/3))*P[x.value].multiplier):0})},ot=ee=>ee===0?"bg-red-500/30 text-red-300":ee===d.value?"bg-green-500/30 text-green-300":ee>=d.value/2?"bg-yellow-500/30 text-yellow-300":"bg-blue-500/30 text-blue-300",Ne=()=>{var X;s.value="setup",v.value="",y.value=[],g.value=[],h.value=0,p.value="",m.value=[],b.value=0,C.value=!1,w.value=0,E.value=!1,z.value++;const ee=l.value;l.value=!ee,console.log(`Play Again clicked: Round ${z.value}, Swapping roles - I was ${ee?"creator":"guesser"}, now I am ${l.value?"creator":"guesser"}`),(X=o.value)==null||X.emit("game-reset",{gameType:"word-galaxy",to:e.partnerId,swapRoles:!1,shouldBeCreator:!l.value,roundCount:z.value,guesserScore:D.value,creatorScore:S.value})},Be=()=>{f.value=!0,ge.playSound("button")},vt=()=>{var ee;f.value=!1,(ee=o.value)==null||ee.emit("game-leave",{gameType:"word-galaxy",to:e.partnerId}),r("back")};return Ve(()=>{var ee,X,ne,de,pe,he,be,ve;if(e.partnerReady){if(s.value="setup",z.value===1){const J=a.value||"",ke=e.partnerId||"";l.value=J<ke,console.log(`Role assignment: My ID ${J}, Partner ID ${ke}, I am ${l.value?"word creator":"guesser"}`)}ge.playSound("gameStart")}(ee=o.value)==null||ee.on("game-word-setup",J=>{J.from===e.partnerId&&J.gameType==="word-galaxy"&&(d.value=J.wordLength,x.value=J.difficulty,s.value="guessing",l.value=!1,me(),xe())}),(X=o.value)==null||X.on("game-score-update",J=>{J.from===e.partnerId&&J.gameType==="word-galaxy"&&(J.guesserScore!==void 0&&(D.value=J.guesserScore),J.creatorScore!==void 0&&(S.value=J.creatorScore))}),(ne=o.value)==null||ne.on("game-move",J=>{if(J.from===e.partnerId&&J.gameType==="word-galaxy"){const ke=J.move;typeof ke=="string"&&(ke==="timeout"?(s.value="complete",C.value=!0,A.value="Ran out of time!",rt()):ke==="out-of-attempts"?(s.value="complete",C.value=!0,A.value="Ran out of attempts!",rt()):it(ke))}}),(de=o.value)==null||de.on("game-guess-result",J=>{J.from===e.partnerId&&J.gameType==="word-galaxy"&&nt(J.result)}),(pe=o.value)==null||pe.on("game-partner-joined",J=>{if(J.from===e.partnerId&&(s.value="setup",z.value===1)){const ke=a.value||"",Se=e.partnerId||"";l.value=ke<Se,console.log(`Partner joined: My ID ${ke}, Partner ID ${Se}, I am ${l.value?"word creator":"guesser"}`)}}),(he=o.value)==null||he.on("game-partner-left",()=>{s.value="waiting",ye(),ge.playSound("notification");const J=document.createElement("div");J.className="fixed top-4 right-4 bg-yellow-600/80 text-white px-4 py-2 rounded-lg shadow-lg z-50",J.innerHTML=`
      <div class="flex items-center gap-2">
        <span>⚠️</span>
        <span>Your partner has left the game</span>
      </div>
    `,document.body.appendChild(J),setTimeout(()=>{document.body.removeChild(J),r("back")},3e3)}),(be=o.value)==null||be.on("game-reset",J=>{if(J.from===e.partnerId&&J.gameType==="word-galaxy"&&(console.log("Received game-reset from partner with data:",JSON.stringify({roundCount:J.roundCount,shouldBeCreator:J.shouldBeCreator})),s.value="setup",v.value="",y.value=[],g.value=[],h.value=0,p.value="",m.value=[],b.value=0,C.value=!1,w.value=0,ye(),E.value=!1,J.roundCount&&(z.value=J.roundCount),J.guesserScore!==void 0&&(D.value=J.guesserScore),J.creatorScore!==void 0&&(S.value=J.creatorScore),J.shouldBeCreator!==void 0)){const ke=l.value;l.value=J.shouldBeCreator,console.log(`Reset from partner: Round ${z.value}, Changing role from ${ke?"creator":"guesser"} to ${l.value?"creator":"guesser"}`)}}),(ve=o.value)==null||ve.on("game-notification",J=>{J.from===e.partnerId&&J.gameType==="word-galaxy"&&console.log(`Game notification from partner: ${J.message}`)})}),xt(()=>{var ee,X,ne,de,pe,he,be,ve;ye(),ge.stopAllSounds(),(ee=o.value)==null||ee.off("game-word-setup"),(X=o.value)==null||X.off("game-move"),(ne=o.value)==null||ne.off("game-guess-result"),(de=o.value)==null||de.off("game-score-update"),(pe=o.value)==null||pe.off("game-partner-joined"),(he=o.value)==null||he.off("game-partner-left"),(be=o.value)==null||be.off("game-reset"),(ve=o.value)==null||ve.off("game-notification")}),Ee(()=>s.value!=="complete"?null:l.value?C.value?"failed":"guessed":C.value?"guessed":"failed"),(ee,X)=>(H(),j(_e,null,[i("div",jc,[i("div",Uc,[X[6]||(X[6]=i("h2",{class:"text-xl font-bold text-purple-400"},[i("span",{class:"hidden sm:inline"},"Word Galaxy"),i("span",{class:"sm:hidden"},"Word Game")],-1)),i("div",{class:se(["text-white text-sm px-3 py-1 rounded-full backdrop-blur-sm shadow-lg",{"bg-yellow-600/40 border border-yellow-500/30":s.value==="waiting","bg-green-600/40 border border-green-500/30":s.value==="setup","bg-blue-600/40 border border-blue-500/30":s.value==="guessing","bg-purple-600/40 border border-purple-500/30":s.value==="complete"}])},Y(ee.gameStateLabel),3)]),i("div",qc,[i("div",{class:se(["flex flex-col items-center",{"opacity-70":s.value==="waiting"}])},[i("div",zc,[i("div",Gc,[X[7]||(X[7]=i("div",{class:"text-sm text-gray-300 mb-1"},"Attempts",-1)),i("div",Vc,Y(b.value)+"/"+Y(F.value),1)]),s.value==="guessing"&&!l.value?(H(),j("div",Kc,[X[8]||(X[8]=i("div",{class:"text-sm text-gray-300"},"Time",-1)),i("div",{class:se(["text-xl font-bold",{"text-red-400":_.value<10,"text-yellow-400":_.value<20,"text-white":_.value>=20}])},Y(_.value)+"s",3)])):te("",!0),i("div",Yc,[X[9]||(X[9]=i("div",{class:"text-sm text-gray-300 mb-1"},"Score",-1)),i("div",Xc,Y(l.value?S.value:D.value),1)]),i("div",Qc,[X[10]||(X[10]=i("div",{class:"text-sm text-gray-300 mb-1"},"Round",-1)),i("div",Zc,Y(z.value),1)])]),i("div",Jc,[s.value==="setup"&&l.value?(H(),j("div",eu,[X[13]||(X[13]=ft('<div class="text-center mb-6" data-v-f9483a22><div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center bg-green-500/30 rounded-full" data-v-f9483a22><span class="text-2xl" data-v-f9483a22>💬</span></div><h3 class="text-xl font-bold text-white mb-2" data-v-f9483a22>Create a Word</h3><p class="text-gray-300 mb-4" data-v-f9483a22>Enter a word for your partner to guess</p></div>',1)),i("div",tu,[i("div",nu,[X[11]||(X[11]=i("label",{class:"block text-gray-300 text-sm mb-2"},"Your Word:",-1)),Pt(i("input",{"onUpdate:modelValue":X[0]||(X[0]=ne=>v.value=ne),dir:U(v.value)?"rtl":"ltr",class:"w-full bg-gray-900 text-white px-4 py-2 rounded border border-gray-600 focus:border-purple-500 focus:outline-none",placeholder:"Enter a word...",maxlength:"15",disabled:s.value!=="setup",onInput:R},null,40,ru),[[Kt,v.value]]),c.value?(H(),j("p",ou,Y(c.value),1)):(H(),j("p",au,"The word should be 3-15 letters long"))]),i("div",su,[X[12]||(X[12]=i("label",{class:"block text-gray-300 text-sm mb-2"},"Difficulty:",-1)),i("div",iu,[i("button",{onClick:X[1]||(X[1]=ne=>x.value="easy"),class:se(["flex-1 px-4 py-2 rounded-lg text-sm transition-all",x.value==="easy"?"bg-green-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"])}," Easy ",2),i("button",{onClick:X[2]||(X[2]=ne=>x.value="medium"),class:se(["flex-1 px-4 py-2 rounded-lg text-sm transition-all",x.value==="medium"?"bg-yellow-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"])}," Medium ",2),i("button",{onClick:X[3]||(X[3]=ne=>x.value="hard"),class:se(["flex-1 px-4 py-2 rounded-lg text-sm transition-all",x.value==="hard"?"bg-red-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"])}," Hard ",2)])])]),i("div",lu,[i("button",{onClick:V,class:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:pointer-events-none",disabled:!K.value}," Start Game ",8,cu)])])):s.value==="setup"&&!l.value?(H(),j("div",uu,X[14]||(X[14]=[ft('<div class="text-center mb-6" data-v-f9483a22><div class="w-16 h-16 mx-auto mb-3 relative" data-v-f9483a22><div class="absolute inset-0 bg-blue-500/20 rounded-full animate-ping" data-v-f9483a22></div><div class="absolute inset-2 bg-blue-500/30 rounded-full animate-ping animation-delay-300" data-v-f9483a22></div><div class="absolute inset-0 flex items-center justify-center" data-v-f9483a22><span class="text-2xl" data-v-f9483a22>🔤</span></div></div><h3 class="text-xl font-bold text-white mb-2" data-v-f9483a22>Get Ready!</h3><p class="text-gray-300" data-v-f9483a22>Your partner is creating a word for you to guess...</p></div><div class="bg-gray-700/50 rounded-lg p-4 mb-4" data-v-f9483a22><h4 class="font-bold text-white mb-2" data-v-f9483a22>How to Play:</h4><ul class="text-gray-300 text-sm space-y-2 list-disc pl-4" data-v-f9483a22><li data-v-f9483a22>Your partner will create a secret word</li><li data-v-f9483a22>You&#39;ll see a blurred version of the word</li><li data-v-f9483a22>Type guesses to reveal more letters</li><li data-v-f9483a22>You need to guess the word before the timer runs out</li><li data-v-f9483a22>You win if you guess correctly, your partner wins if you don&#39;t</li></ul></div>',2)]))):s.value==="guessing"&&!l.value?(H(),j("div",du,[i("div",fu,[i("div",xu,[i("div",vu,[X[15]||(X[15]=i("span",{class:"text-sm text-gray-400"},"The Secret Word:",-1)),i("span",gu,Y(h.value)+"/"+Y(d.value)+" letters revealed",1)]),i("div",{class:"flex justify-center gap-1 md:gap-2 flex-wrap",dir:k.value},[(H(!0),j(_e,null,Pe(y.value,(ne,de)=>(H(),j("div",{key:de,class:se(["w-8 h-10 md:w-10 md:h-12 flex items-center justify-center rounded bg-gray-800/80 border text-lg md:text-xl font-bold",ne==="_"?"border-gray-700 text-gray-500":"border-purple-500 text-white"])},Y(ne),3))),128))],8,mu)]),i("div",pu,[X[16]||(X[16]=i("label",{class:"block text-gray-300 text-sm mb-2"},"Your Guess:",-1)),i("div",hu,[Pt(i("input",{"onUpdate:modelValue":X[4]||(X[4]=ne=>p.value=ne),dir:U(p.value)||U(v.value.value)?"rtl":"ltr",class:"flex-1 bg-gray-900 text-white px-4 py-2 rounded-l border border-gray-600 focus:border-purple-500 focus:outline-none",placeholder:"Type your guess...",maxlength:d.value,onKeyup:Xa(ie,["enter"]),onInput:$},null,40,bu),[[Kt,p.value]]),i("button",{onClick:ie,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-r transition-all",disabled:!p.value||p.value.length!==d.value}," Submit ",8,yu)]),u.value?(H(),j("p",Cu,Y(u.value),1)):(H(),j("p",wu,Y(L.value)+" attempts remaining ",1))]),i("div",Eu,[m.value.length===0?(H(),j("p",_u,"Your previous guesses will appear here...")):te("",!0),(H(!0),j(_e,null,Pe(m.value,(ne,de)=>(H(),j("div",{key:de,class:"text-sm flex items-center mb-1"},[i("span",Au,Y(de+1)+".",1),i("span",{dir:U(ne.word)||U(v.value.value)?"rtl":"ltr",class:"text-gray-300 mr-2"},Y(ne.word),9,Bu),i("span",{class:se(["text-xs px-1.5 py-0.5 rounded",ot(ne.matches)])},Y(ne.matches)+" matching ",3)]))),128))])])])):s.value==="guessing"&&l.value?(H(),j("div",ku,[i("div",Du,[i("div",Tu,[X[17]||(X[17]=i("span",{class:"text-gray-300"},"Your Secret Word:",-1)),i("span",{class:"text-white font-bold",dir:U(v.value)?"rtl":"ltr"},Y(v.value),9,Fu)]),i("div",{class:"flex justify-center gap-1 md:gap-2 flex-wrap",dir:k.value},[(H(!0),j(_e,null,Pe(v.value,(ne,de)=>(H(),j("div",{key:de,class:se(["w-8 h-10 md:w-10 md:h-12 flex items-center justify-center rounded border border-purple-500 text-lg md:text-xl font-bold",g.value.includes(de)?"bg-purple-600/30 text-white":"bg-gray-800 text-gray-500"])},Y(ne),3))),128))],8,Su),i("div",Ru,[E.value?(H(),j("p",$u,[X[18]||(X[18]=i("span",{class:"text-yellow-400 font-bold"},"Time remaining:",-1)),ze(" "+Y(_.value)+"s ",1)])):te("",!0),i("p",Iu,[X[19]||(X[19]=i("span",{class:"text-purple-400 font-bold"},"Status:",-1)),ze(" "+Y(A.value),1)])])]),i("div",Pu,[m.value.length===0?(H(),j("p",Mu,"Partner's guesses will appear here...")):te("",!0),(H(!0),j(_e,null,Pe(m.value,(ne,de)=>(H(),j("div",{key:de,class:"text-sm flex items-center mb-1"},[i("span",Ou,Y(de+1)+".",1),i("span",{dir:U(ne.word)||U(v.value)?"rtl":"ltr",class:"text-gray-300 mr-2"},Y(ne.word),9,Wu),i("span",{class:se(["text-xs px-1.5 py-0.5 rounded",ot(ne.matches)])},Y(ne.matches)+" matching ",3)]))),128))])])):s.value==="complete"?(H(),j("div",Nu,[i("div",Lu,[i("div",Hu,[i("span",ju,Y(C.value?"🎉":"🔍"),1)]),i("h3",Uu,Y(C.value?"You Won!":"You Lost!"),1),i("div",qu,[X[20]||(X[20]=i("p",{class:"text-gray-300 mb-2"},"The secret word was:",-1)),i("div",zu,Y(v.value),1),C.value?(H(),j("p",Gu,Y(l.value?"Your partner couldn't solve it!":"Solved in "+b.value+" attempts!"),1)):(H(),j("p",Vu,Y(l.value?"Your partner solved it!":"Better luck next time!"),1))]),i("div",Ku,[X[23]||(X[23]=i("h4",{class:"text-lg font-bold text-white mb-2"},"Scores",-1)),i("div",Yu,[i("div",null,[X[21]||(X[21]=i("p",{class:"text-gray-300"},"You:",-1)),i("p",Xu,Y(l.value?S.value:D.value),1)]),i("div",null,[X[22]||(X[22]=i("p",{class:"text-gray-300"},"Partner:",-1)),i("p",Qu,Y(l.value?D.value:S.value),1)])]),X[24]||(X[24]=i("p",{class:"text-xs text-gray-400 mt-2"},"Points are saved until you exit the game",-1))]),i("button",{onClick:Ne,class:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"}," Play Again ")])])):s.value==="waiting"?(H(),j("div",Zu,X[25]||(X[25]=[ft('<div class="bg-yellow-600/20 rounded-lg p-4 border border-yellow-500/30 shadow-lg animate-pulse" data-v-f9483a22><div class="w-16 h-16 mx-auto mb-3 relative" data-v-f9483a22><div class="absolute inset-0 bg-yellow-500/20 rounded-full animate-ping" data-v-f9483a22></div><div class="absolute inset-2 bg-yellow-500/30 rounded-full animate-ping animation-delay-300" data-v-f9483a22></div><div class="absolute inset-4 bg-yellow-500/40 rounded-full animate-ping animation-delay-600" data-v-f9483a22></div><div class="absolute inset-0 flex items-center justify-center" data-v-f9483a22><span class="text-2xl" data-v-f9483a22>👥</span></div></div><p class="text-yellow-300 mb-1 font-medium" data-v-f9483a22>Waiting for your partner to join...</p><p class="text-sm text-gray-300" data-v-f9483a22>Game will start automatically</p></div>',1)]))):te("",!0)])],2)]),i("div",{class:"flex justify-between"},[i("button",{onClick:Be,class:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95"}," Back to Games ")])]),f.value?(H(),j("div",Ju,[i("div",ed,[i("h3",td,Y(U(v.value)?"هل أنت متأكد؟":"Are you sure?"),1),i("p",nd,Y(U(v.value)?"مغادرة اللعبة ستنهيها لشريكك أيضًا.":"Leaving the game will end it for your partner too."),1),i("div",rd,[i("button",{onClick:X[5]||(X[5]=ne=>f.value=!1),class:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm"},Y(U(v.value)?"إلغاء":"Cancel"),1),i("button",{onClick:vt,class:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm"},Y(U(v.value)?"مغادرة":"Leave"),1)])])])):te("",!0)],64))}});const ad=tt(od,[["__scopeId","data-v-f9483a22"]]),sd={key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-2 sm:p-4"},id={class:"bg-[#1e1e2e] rounded-lg w-full max-w-md mx-auto shadow-2xl relative overflow-hidden"},ld={class:"flex items-center justify-between p-2 sm:p-3 border-b border-gray-800"},cd={key:1,class:"p-3 sm:p-4"},ud={class:"grid grid-cols-2 gap-2 sm:gap-4 mb-3 sm:mb-4"},dd=["disabled"],fd=["disabled"],xd=["disabled"],vd={key:2,class:"text-center p-4 sm:p-6"},gd={class:"mb-4"},md={class:"text-sm sm:text-base text-gray-300"},pd={key:3},hd=je({__name:"games-modal",props:{isOpen:{type:Boolean,default:!1},partnerId:{type:String,required:!0},isConnected:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:n}){const{socket:e,userId:r}=Ie(),o=t,a=N(null),c=N(null),u=N(!0),f=N(null),s=N(!1),l=N(""),v=x=>{console.log(`[Game Debug] ${x}`),l.value=x},d=x=>{var m;if(!o.isConnected)return;v(`Starting game: ${x} with partner: ${o.partnerId}`),c.value=null,a.value=x,u.value=!0,s.value=!1;const p=[r.value,o.partnerId].sort();if(f.value=`${x}-${p[0]}-${p[1]}`,v(`Created game room: ${f.value}`),(m=e.value)==null||m.emit("game-join-room",{gameType:x,roomId:f.value,to:o.partnerId,isFirstPlayer:!0}),e.value&&o.partnerId){const b=`invite-${Date.now()}-${Math.floor(Math.random()*1e4)}`;e.value.emit("game-invite",{gameType:x,to:o.partnerId,inviteId:b}),console.log(`Sent game invitation for ${x} to ${o.partnerId}`),h("Invitation sent! Waiting for response...","info")}},y=()=>{var x;o.partnerId?((x=e.value)==null||x.emit("game-leave-notification",{gameType:a.value||"unknown",to:o.partnerId,message:"Your partner returned to the game menu"}),e.value&&e.value.emit("game-notification",{gameType:a.value||"unknown",to:o.partnerId,message:"Your partner has left the game",type:"leave"}),setTimeout(()=>{f.value&&e.value&&e.value.emit("game-leave-room",{roomId:f.value,to:o.partnerId}),a.value=null,c.value=null,u.value=!0,f.value=null,s.value=!1},100)):(a.value=null,c.value=null,u.value=!0,f.value=null,s.value=!1)},g=x=>{c.value=x,v(`Error: ${x}`)};Ve(()=>{var x,p,m,b,C;v("Setting up game events"),document.addEventListener("select-game",w=>{const{gameType:A,partnerId:D}=w.detail;if(A&&D&&D===o.partnerId){v(`Received direct game selection: ${A}`),a.value=A,c.value=null,u.value=!1,s.value=!0;const S=[r.value,o.partnerId].sort();f.value=`${A}-${S[0]}-${S[1]}`,v(`Created game room: ${f.value}`)}}),(x=e.value)==null||x.on("game-room-invite",w=>{var A;w.from===o.partnerId&&(v(`Received invitation to join game room: ${w.roomId}`),f.value=w.roomId,a.value=w.gameType,u.value=!1,(A=e.value)==null||A.emit("game-join-room",{gameType:w.gameType,roomId:w.roomId,to:o.partnerId,isFirstPlayer:!1}))}),(p=e.value)==null||p.on("game-partner-joined",w=>{w.from===o.partnerId&&(v(`Partner joined the game: ${w.gameType}`),s.value=!0)}),(m=e.value)==null||m.on("game-error",w=>{(w.from==="system"||w.from===o.partnerId)&&(c.value=w.message||"An error occurred in the game.",v(`Game error: ${w.message}`))}),(b=e.value)==null||b.on("game-partner-left",w=>{a.value&&(v("Partner left the game - closing silently"),a.value=null,f.value=null,s.value=!1,c.value=null)}),(C=e.value)==null||C.on("game-notification",w=>{w.from===o.partnerId&&v(`Notification from partner: ${w.message}`)})}),xt(()=>{var x,p,m,b,C,w;(x=e.value)==null||x.off("game-room-invite"),(p=e.value)==null||p.off("game-partner-joined"),(m=e.value)==null||m.off("game-error"),(b=e.value)==null||b.off("game-partner-left"),(C=e.value)==null||C.off("game-notification"),f.value&&((w=e.value)==null||w.emit("game-leave-room",{roomId:f.value,to:o.partnerId})),document.removeEventListener("select-game",()=>{})}),Te(()=>o.isOpen,x=>{x||y()});const h=(x,p="info")=>{const m=document.createElement("div");let b="bg-blue-600";p==="success"&&(b="bg-emerald-600"),p==="error"&&(b="bg-red-600"),m.className=`fixed bottom-4 right-4 ${b} text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in`,m.style.animationDuration="0.3s",m.innerHTML=x,document.body.appendChild(m),setTimeout(()=>{m.style.opacity="0",m.style.transition="opacity 0.3s ease",setTimeout(()=>{document.body.removeChild(m)},300)},3e3)};return(x,p)=>t.isOpen?(H(),j("div",sd,[i("div",id,[i("div",ld,[p[4]||(p[4]=i("div",{class:"flex items-center gap-2"},[i("span",{class:"text-purple-400 text-lg sm:text-xl"},"🎮"),i("h2",{class:"text-lg sm:text-xl font-semibold text-[#a881fc]"},"Space Games")],-1)),i("button",{onClick:p[0]||(p[0]=m=>x.$emit("close")),class:"text-gray-400 hover:text-white text-lg"}," ✕ ")]),te("",!0),a.value?c.value?(H(),j("div",vd,[i("div",gd,[p[10]||(p[10]=i("div",{class:"w-12 h-12 sm:w-16 sm:h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-2"},[i("span",{class:"text-xl sm:text-2xl"},"⚠️")],-1)),p[11]||(p[11]=i("h3",{class:"text-lg sm:text-xl font-bold mb-2 text-red-400"},"Game Error",-1)),i("p",md,Y(c.value),1)]),i("button",{onClick:y,class:"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors mt-2"}," Back to Games ")])):(H(),j("div",pd,[a.value==="tic-tac-toe"?(H(),xn(lc,{key:0,partnerId:t.partnerId,isFirstPlayer:u.value,partnerReady:s.value,onBack:y,onError:g},null,8,["partnerId","isFirstPlayer","partnerReady"])):te("",!0),a.value==="rock-paper-scissors"?(H(),xn(Hc,{key:1,partnerId:t.partnerId,partnerReady:s.value,onBack:y,onError:g},null,8,["partnerId","partnerReady"])):te("",!0),a.value==="word-galaxy"?(H(),xn(ad,{key:2,partnerId:t.partnerId,partnerReady:s.value,onBack:y,onError:g},null,8,["partnerId","partnerReady"])):te("",!0)])):(H(),j("div",cd,[i("div",ud,[i("button",{class:se(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!t.isConnected}]),disabled:!t.isConnected,onClick:p[1]||(p[1]=m=>d("rock-paper-scissors"))},p[5]||(p[5]=[i("div",{class:"bg-yellow-500 text-white w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl"},"👊",-1),i("div",{class:"text-white text-xs sm:text-sm font-medium"},"Rock Paper Scissors",-1),i("div",{class:"text-xs text-gray-400 hidden sm:block"},"vs Partner",-1)]),10,dd),i("button",{class:se(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!t.isConnected}]),disabled:!t.isConnected,onClick:p[2]||(p[2]=m=>d("word-galaxy"))},p[6]||(p[6]=[i("div",{class:"bg-white text-gray-800 w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl"},"💬",-1),i("div",{class:"text-white text-xs sm:text-sm font-medium"},"Word Galaxy",-1),i("div",{class:"text-xs text-gray-400 hidden sm:block"},"Word Guessing Game",-1)]),10,fd),i("button",{class:se(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!t.isConnected}]),disabled:!t.isConnected,onClick:p[3]||(p[3]=m=>d("tic-tac-toe"))},p[7]||(p[7]=[i("div",{class:"bg-red-600 text-white w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl"},"⭕",-1),i("div",{class:"text-white text-xs sm:text-sm font-medium"},"Tic-Tac-Toe",-1),i("div",{class:"text-xs text-gray-400 hidden sm:block"},"vs Partner",-1)]),10,xd),i("button",{class:se(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center relative",{"opacity-50 cursor-not-allowed":!0}]),disabled:""},p[8]||(p[8]=[ft('<div class="absolute inset-0 flex items-center justify-center bg-[#2e2e42]/80 rounded-lg" data-v-d5876d55><span class="bg-purple-500 text-white text-xs px-2 py-1 rounded-md font-medium" data-v-d5876d55>Coming Soon</span></div><div class="bg-purple-600 text-white w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl" data-v-d5876d55>🎲</div><div class="text-white text-xs sm:text-sm font-medium" data-v-d5876d55>Mystery Game</div><div class="text-xs text-gray-400 hidden sm:block" data-v-d5876d55>More Fun Ahead</div>',4)]))]),p[9]||(p[9]=i("p",{class:"text-center text-xs sm:text-sm text-gray-400 mt-2"}," Connect to play with others ",-1))]))])])):te("",!0)}});const bd=tt(hd,[["__scopeId","data-v-d5876d55"]]),yd={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},Cd={class:"bg-gray-900 rounded-lg w-full max-w-md mx-auto p-6"},wd={class:"flex items-center justify-between mb-6"},Ed={class:"grid grid-cols-3 gap-4 mb-6"},_d=je({__name:"donation-modal",props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(t,{emit:n}){const e=n,r=N(15),o=c=>{r.value=c},a=()=>{window.open(`https://www.paypal.com/paypalme/spacetalk/${r.value}`,"_blank"),e("close")};return(c,u)=>t.isOpen?(H(),j("div",yd,[i("div",Cd,[i("div",wd,[u[4]||(u[4]=i("div",{class:"flex items-center gap-2"},[i("span",{class:"text-red-400 text-xl"},"❤️"),i("h2",{class:"text-lg font-semibold text-violet-400"},"Support SpaceTalk")],-1)),i("button",{onClick:u[0]||(u[0]=f=>c.$emit("close")),class:"text-gray-400 hover:text-white text-lg"}," ✕ ")]),u[8]||(u[8]=i("div",{class:"mb-6 text-center"},[i("p",{class:"text-gray-300"},"Keep SpaceTalk free for everyone")],-1)),i("div",Ed,[i("button",{class:se(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",r.value===5?"ring-2 ring-emerald-500 scale-105":""]),onClick:u[1]||(u[1]=f=>o(5))},u[5]||(u[5]=[i("div",{class:"text-lg font-bold text-white"},"$5",-1),i("div",{class:"text-sm text-gray-400"},"Coffee",-1)]),2),i("button",{class:se(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",r.value===15?"ring-2 ring-emerald-500 scale-105":""]),onClick:u[2]||(u[2]=f=>o(15))},u[6]||(u[6]=[i("div",{class:"text-lg font-bold text-white"},"$15",-1),i("div",{class:"text-sm text-gray-400"},"Fuel",-1)]),2),i("button",{class:se(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",r.value===50?"ring-2 ring-emerald-500 scale-105":""]),onClick:u[3]||(u[3]=f=>o(50))},u[7]||(u[7]=[i("div",{class:"text-lg font-bold text-white"},"$50",-1),i("div",{class:"text-sm text-gray-400"},"Rocket",-1)]),2)]),u[9]||(u[9]=i("div",{class:"flex justify-center items-center gap-1 mb-6"},[i("span",{class:"text-yellow-400"},"⭐"),i("span",{class:"text-sm text-gray-300"},"Boost development")],-1)),i("button",{class:"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-3 rounded-lg transition-colors mb-2 active:scale-95 transform duration-150",onClick:a}," Donate via PayPal "),u[10]||(u[10]=i("div",{class:"text-xs text-gray-500 text-center"}," Secure payments via PayPal ",-1))])])):te("",!0)}}),Ad={class:"fixed inset-0 overflow-hidden pointer-events-none"},Bd=je({__name:"starfield",setup(t){const n=N([]);Ve(()=>{e()});const e=()=>{const o=[];for(let a=0;a<50;a++)o.push({id:a,x:Math.random()*100,y:Math.random()*100,size:Math.random()*2+1,opacity:Math.random()*.7+.3,duration:Math.random()*8+2});n.value=o};return(r,o)=>(H(),j("div",Ad,[(H(!0),j(_e,null,Pe(n.value,a=>(H(),j("div",{key:a.id,class:"absolute rounded-full bg-white",style:Mr({width:`${a.size}px`,height:`${a.size}px`,top:`${a.y}%`,left:`${a.x}%`,opacity:a.opacity,boxShadow:`0 0 ${a.size*2}px rgba(255, 255, 255, ${a.opacity})`,animation:`twinkle ${a.duration}s infinite ease-in-out`})},null,4))),128))]))}});const kd=tt(Bd,[["__scopeId","data-v-f4bff5a3"]]),kr=!1,Dd=10,Td=je({__name:"AudioOutput",props:{showControls:{type:Boolean,default:!0}},setup(t){const{remoteStream:n,connectionState:e,partnerId:r,isAudioMuted:o}=Sa(),a=N(null),c=N(.8),u=N(!1),f=N(0),s=Ee(()=>(n.value!==null&&n.value?n.value.getAudioTracks().length>0:!1)&&n.value?n.value.getAudioTracks().some(C=>C.enabled):!1);Ee(()=>n.value?n.value.getAudioTracks().filter(p=>p.enabled&&p.readyState==="live").length:0),Ee(()=>u.value&&s.value?"connected":(e.value==="connected"&&!s.value&&!u.value&&setTimeout(g,500),e.value)),Te(()=>n.value,p=>{g(),f.value=0,setTimeout(h,500)}),Te(()=>o.value,p=>{!p&&n.value&&a.value&&setTimeout(()=>{a.value&&a.value.paused&&a.value.play().catch(m=>{})},300)}),Te(()=>e.value,p=>{p==="connected"?setTimeout(()=>{g(),h()},1e3):p==="new"||p==="connecting"?f.value=0:(p==="disconnected"||p==="failed")&&x()}),Te(()=>r.value,p=>{u.value=!1,f.value=0,p||a.value&&(a.value.srcObject=null)}),Ve(()=>{g(),a.value&&(a.value.onplaying=()=>{u.value=!0},a.value.onpause=()=>{u.value=!1},a.value.onended=()=>{u.value=!1},a.value.onerror=p=>{console.error("[AudioOutput] Audio error:",p),u.value=!1},a.value.volume=c.value),document.addEventListener("visibilitychange",y),v()}),Or(()=>{a.value&&(a.value.srcObject=null),document.removeEventListener("visibilitychange",y),d()});let l=null;function v(){d(),l=window.setInterval(()=>{!u.value&&s.value&&e.value==="connected"&&(g(),h())},5e3)}function d(){l&&(clearInterval(l),l=null)}function y(){document.visibilityState==="visible"&&(g(),setTimeout(()=>{!u.value&&s.value&&h()},500))}function g(){a.value&&(n.value?(a.value.srcObject=n.value,n.value.getAudioTracks().forEach(p=>{p.enabled=!0}),h()):(a.value.srcObject=null,u.value=!1))}async function h(){if(!(!a.value||!a.value.srcObject))try{const p=n.value&&n.value.getAudioTracks().length>0;await a.value.play(),u.value=!0,f.value=0}catch(p){if(console.error("[AudioOutput] Error playing audio:",p),u.value=!1,p instanceof DOMException&&p.name==="NotAllowedError"&&console.warn("[AudioOutput] Audio play was blocked by browser policy, user interaction needed"),f.value<Dd){f.value++;const m=f.value*1e3;setTimeout(h,m)}else console.warn("[AudioOutput] Max retry attempts reached, manual play required")}}function x(){f.value=0,a.value&&(a.value.srcObject=null),setTimeout(()=>{g(),h()},500)}return(p,m)=>(H(),j("div",null,[i("audio",{ref_key:"audioElement",ref:a,autoplay:"",playsinline:"",class:"hidden"},null,512),te("",!0)]))}});const Fd=tt(Td,[["__scopeId","data-v-f63dc209"]]),Sd={class:"flex items-center"},Rd={key:0,class:"spinner mr-3"},$d={key:1,class:"timeout-icon mr-3"},Id={class:"content flex-grow"},Pd={class:"message"},Md={key:0,class:"wait-time"},Od={key:2,class:"flex-shrink-0"},Wd=je({__name:"queue-status",emits:["retry"],setup(t,{emit:n}){const e=Ie(),r=N(e.queueStatus.value),o=N(e.queueMessage.value),a=N(e.queueWaitTime.value),c=Ee(()=>r.value!=="idle"&&r.value!=="matched"),u=Ee(()=>r.value==="waiting"),f=Ee(()=>r.value==="timeout"),s=Ee(()=>({waiting:u.value,timeout:f.value}));function l(g){if(g<60)return`${g} seconds`;if(g<3600){const h=Math.floor(g/60),x=g%60;return`${h} ${h===1?"minute":"minutes"}${x>0?` and ${x} ${x===1?"second":"seconds"}`:""}`}else{const h=Math.floor(g/3600),x=Math.floor(g%3600/60);return`${h} ${h===1?"hour":"hours"}${x>0?` and ${x} ${x===1?"minute":"minutes"}`:""}`}}function v(){e.socket.value&&(r.value="idle",y("retry"))}function d(g){const h=g.detail;r.value=h.status,o.value=h.message,a.value=h.waitTime}const y=n;return Ve(()=>{r.value=e.queueStatus.value,o.value=e.queueMessage.value,a.value=e.queueWaitTime.value,window.addEventListener("queue-status-changed",d)}),xt(()=>{window.removeEventListener("queue-status-changed",d)}),(g,h)=>c.value?(H(),j("div",{key:0,class:se(["queue-status",s.value])},[i("div",Sd,[u.value?(H(),j("div",Rd)):f.value?(H(),j("div",$d,"⏱️")):te("",!0),i("div",Id,[i("div",Pd,Y(o.value),1),a.value>0?(H(),j("div",Md," Wait time: "+Y(l(a.value)),1)):te("",!0)]),f.value?(H(),j("div",Od,[i("button",{onClick:v,class:"retry-button"}," Try Again ")])):te("",!0)])],2)):te("",!0)}});const Nd=tt(Wd,[["__scopeId","data-v-7301a6d5"]]),Ld={class:"filter-feedback"},Hd={key:0,class:"mt-2 p-2 bg-emerald-900/30 rounded-lg"},jd={class:"text-xs text-emerald-300"},Ud={class:"font-medium"},qd={class:"w-full bg-gray-700 rounded-full h-2 mt-1"},zd={key:1,class:"mt-2"},Gd={class:"text-xs text-gray-400"},Vd={key:2,class:"mt-2"},Kd={class:"text-xs text-gray-400"},Yd=je({__name:"CountryFilterFeedback",props:{preferredCountries:{type:Array,required:!0},blockedCountries:{type:Array,required:!0},onlineUsers:{type:Number,default:0},countries:{type:Array,required:!0}},setup(t){const n=t,e=Ee(()=>{if(n.preferredCountries.length===0)return 100;const o=195,a=n.preferredCountries.length/o*100;return Math.min(Math.round(a),100)}),r=o=>{const a=n.countries.find(c=>c.value===o);return a?a.name:o};return(o,a)=>(H(),j("div",Ld,[t.preferredCountries.length>0?(H(),j("div",Hd,[i("p",jd,[i("span",Ud,Y(e.value)+"%",1),a[0]||(a[0]=ze(" of users match your preferences "))]),i("div",qd,[i("div",{class:"bg-emerald-500 h-2 rounded-full",style:Mr({width:`${e.value}%`})},null,4)])])):te("",!0),t.preferredCountries.length>0?(H(),j("div",zd,[i("p",Gd,[a[1]||(a[1]=ze(" Your current preferences will match you only with users from: ")),(H(!0),j(_e,null,Pe(t.preferredCountries,(c,u)=>(H(),j("span",{key:c},Y(r(c))+Y(u<t.preferredCountries.length-1?", ":""),1))),128))])])):te("",!0),t.blockedCountries.length>0?(H(),j("div",Vd,[i("p",Kd,[a[2]||(a[2]=ze(" You will not be matched with users from: ")),(H(!0),j(_e,null,Pe(t.blockedCountries,(c,u)=>(H(),j("span",{key:c},Y(r(c))+Y(u<t.blockedCountries.length-1?", ":""),1))),128))])])):te("",!0)]))}});const Xd=tt(Yd,[["__scopeId","data-v-bceab852"]]),Qd={class:"bg-gradient-to-br from-indigo-900 to-purple-900 rounded-2xl p-6 w-full max-w-sm border border-indigo-500/50 shadow-2xl animate-bounce-in"},Zd={class:"text-center"},Jd={class:"w-24 h-24 mx-auto mb-4 rounded-full bg-gradient-to-br from-indigo-600 to-purple-700 flex items-center justify-center shadow-lg shadow-indigo-500/30 animate-pulse"},ef={class:"text-4xl"},tf={class:"text-white/90 text-sm mb-2"},nf={class:"font-medium text-indigo-300"},rf={class:"mt-4 mb-3 relative"},of={class:"h-3 bg-gray-700/70 rounded-full overflow-hidden backdrop-blur-sm shadow-inner"},af={class:"text-sm text-indigo-200 mt-2 font-medium"},ea=30,sf=je({__name:"GameInviteNotification",props:{gameType:{},from:{},inviteId:{}},emits:["accept","decline","timeout"],setup(t,{emit:n}){const e=t,r=n,o=N(ea);let a=null;const c=Ee(()=>o.value/ea*100);Ve(()=>{const d=new Audio("/sounds/notification.mp3");d.volume=.3,d.play().catch(y=>console.log("Error playing sound",y)),a=window.setInterval(()=>{o.value-=.1,o.value<=0&&u()},100)}),Or(()=>{a!==null&&clearInterval(a)});const u=()=>{a!==null&&clearInterval(a),r("timeout",{inviteId:e.inviteId})},f=()=>{a!==null&&clearInterval(a),r("accept",{inviteId:e.inviteId,gameType:e.gameType,from:e.from})},s=()=>{a!==null&&clearInterval(a),r("decline",{inviteId:e.inviteId,from:e.from})},l=d=>({"rock-paper-scissors":"Rock Paper Scissors","tic-tac-toe":"Tic-Tac-Toe","word-galaxy":"Word Galaxy",trivia:"Trivia Quiz"})[d]||d,v=d=>({"rock-paper-scissors":"✂️","tic-tac-toe":"⭕","word-galaxy":"🌌",trivia:"❓"})[d]||"🎮";return(d,y)=>(H(),j("div",{class:"fixed inset-0 flex items-center justify-center z-50 bg-black/70",onClick:Pr(s,["self"])},[i("div",Qd,[y[2]||(y[2]=i("div",{class:"absolute inset-0 -z-10 bg-gradient-to-r from-purple-600/20 to-indigo-600/20 rounded-2xl blur-xl animate-pulse"},null,-1)),i("div",Zd,[i("div",Jd,[i("span",ef,Y(v(d.gameType)),1)]),y[1]||(y[1]=i("p",{class:"text-white text-xl font-semibold mb-2 text-shadow"},"Game Invitation",-1)),i("p",tf,[y[0]||(y[0]=ze(" You've been invited to play ")),i("span",nf,Y(l(d.gameType)),1)]),i("div",rf,[i("div",of,[i("div",{class:"h-full bg-gradient-to-r from-indigo-500 to-purple-500 animate-pulse-slow",style:Mr({width:`${c.value}%`})},null,4)]),i("p",af,Y(Math.ceil(o.value))+"s remaining ",1)])]),i("div",{class:"mt-6 grid grid-cols-2 gap-4"},[i("button",{onClick:s,class:"bg-gray-700/80 hover:bg-gray-600 text-white px-6 py-3 rounded-xl text-sm transition-all duration-300 hover:scale-105 backdrop-blur-sm shadow-lg"}," Decline "),i("button",{onClick:f,class:"bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white px-6 py-3 rounded-xl text-sm transition-all duration-300 hover:scale-105 shadow-lg shadow-indigo-500/30 font-medium"}," Accept ")])])]))}});const lf=tt(sf,[["__scopeId","data-v-7a75153e"]]),cf={class:"min-h-screen font-sans"},uf={class:"relative min-h-screen z-10 text-white"},df={class:"p-2 sm:p-4 border-b border-white/10"},ff={class:"max-w-4xl mx-auto"},xf={class:"flex justify-center gap-2 mb-2 sm:mb-3"},vf={class:"bg-green-500/20 rounded-full px-2 py-1 text-xs flex items-center gap-1"},gf={key:0,class:"bg-purple-500/20 rounded-full px-2 py-1 text-xs"},mf={class:"grid grid-cols-2 gap-2 text-xs relative"},pf={class:"flex items-center truncate"},hf={key:0,class:"absolute top-full left-0 mt-1 w-full bg-gray-800/95 backdrop-blur-md border border-gray-700 rounded-xl shadow-xl z-20 overflow-hidden transition-all duration-200 animate-dropdown"},bf={class:"py-1"},yf=["onClick"],Cf={class:"text-sm"},wf={class:"flex-1 p-2 sm:p-4"},Ef={class:"max-w-md mx-auto space-y-4 sm:space-y-6"},_f={class:"flex items-center justify-center gap-2 mb-2 sm:mb-4"},Af={class:"relative inline-block w-10 h-5 mr-2"},Bf={class:"text-center"},kf={class:"text-xs text-gray-400 italic"},Df={class:"p-2 sm:p-4 border-t border-white/10"},Tf={class:"max-w-md mx-auto text-center space-y-1 sm:space-y-2"},Ff={class:"grid grid-cols-2 md:flex md:flex-wrap justify-center gap-2 mt-2 sm:mt-4 text-xs"},Sf={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},Rf={class:"bg-gray-800 rounded-2xl p-6 w-full max-w-sm"},$f={class:"flex justify-between items-center mb-4"},If={class:"space-y-3"},Pf={key:0,class:"text-center py-8"},Mf={class:"flex items-center gap-3"},Of={class:"text-2xl"},Wf={class:"text-white text-sm font-medium"},Nf={class:"text-gray-400 text-xs"},Lf={class:"text-xs text-gray-500"},Hf={key:0,class:"text-xs text-gray-500 text-center mt-4"},jf={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-20 p-4"},Uf={class:"bg-gray-800 rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto relative"},qf={class:"flex justify-between items-center mb-6"},zf={class:"space-y-6"},Gf={class:"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide"},Vf={key:0,class:"text-xs text-gray-400 p-2"},Kf={key:1,class:"flex flex-wrap gap-2"},Yf={class:"flag-icon"},Xf=["onClick"],Qf={class:"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide"},Zf={key:0,class:"text-xs text-gray-400 p-2"},Jf={key:1,class:"flex flex-wrap gap-2"},ex={class:"flag-icon"},tx=["onClick"],nx={key:2,class:"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer preferred-outer"},rx={class:"py-1 w-full"},ox={class:"px-3 py-2 border-b border-gray-600"},ax={key:0,class:"text-xs text-gray-400 px-3 py-2"},sx=["onClick"],ix={class:"flag-icon w-6 text-center"},lx={class:"text-sm"},cx={key:3,class:"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer blocked-outer"},ux={class:"py-1 w-full"},dx={class:"px-3 py-2 border-b border-gray-600"},fx={key:0,class:"text-xs text-gray-400 px-3 py-2"},xx=["onClick"],vx={class:"flag-icon w-6 text-center"},gx={class:"text-sm"},mx={key:4,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"},px={class:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-xl p-6 w-full max-w-lg shadow-2xl border border-purple-500/30"},hx={class:"flex justify-between items-center mb-6"},bx={class:"space-y-6 text-gray-200"},yx={class:"flex justify-center pt-4"},Cx={key:5,class:"hidden"},wx={key:6,class:"fixed inset-0 flex items-center justify-center z-50 p-4 bg-black/50"},Ex={class:"bg-gradient-to-br from-purple-900 to-indigo-900 rounded-2xl p-6 w-full max-w-sm border border-purple-500/30 shadow-xl"},_x={class:"text-center"},Ax={class:"text-white/80 text-sm"},Bx={class:"mt-4 text-center"},kx=je({__name:"HomeView",setup(t){const n=N("disconnected"),e=N(null),r=N(null),o=N(""),a=N(!1);let c=null;const u=N(!1),f=N(!1),s=N(!1),l=N(!1),v=N(!1),d=N(!1),y=N(0),g=N(0),h=N(!1),x=N([]),p=N([]),m=N([]),b=N("any"),C=N(!1),w=N([]),A=N([]),D=N(!1),S=N(!1),z=N(""),B=N([]),_=N(""),O=N([]),E=[{value:"any",text:"Go With the Flow",emoji:"🌟"},{value:"chill",text:"Chill",emoji:"😌"},{value:"fun",text:"Fun",emoji:"🎉"},{value:"curious",text:"Curious",emoji:"🤔"},{value:"creative",text:"Creative",emoji:"🎨"}],P=N([{value:"any",label:"🌍 Any Country",name:"Any Country",flag:"🌍"},{value:"ae",label:"🇦🇪 UAE",name:"United Arab Emirates",flag:"🇦🇪"},{value:"af",label:"🇦🇫 Afghanistan",name:"Afghanistan",flag:"🇦🇫"},{value:"al",label:"🇦🇱 Albania",name:"Albania",flag:"🇦🇱"},{value:"dz",label:"🇩🇿 Algeria",name:"Algeria",flag:"🇩🇿"},{value:"ar",label:"🇦🇷 Argentina",name:"Argentina",flag:"🇦🇷"},{value:"au",label:"🇦🇺 Australia",name:"Australia",flag:"🇦🇺"},{value:"at",label:"🇦🇹 Austria",name:"Austria",flag:"🇦🇹"},{value:"bh",label:"🇧🇭 Bahrain",name:"Bahrain",flag:"🇧🇭"},{value:"bd",label:"🇧🇩 Bangladesh",name:"Bangladesh",flag:"🇧🇩"},{value:"be",label:"🇧🇪 Belgium",name:"Belgium",flag:"🇧🇪"},{value:"br",label:"🇧🇷 Brazil",name:"Brazil",flag:"🇧🇷"},{value:"ca",label:"🇨🇦 Canada",name:"Canada",flag:"🇨🇦"},{value:"cn",label:"🇨🇳 China",name:"China",flag:"🇨🇳"},{value:"dk",label:"🇩🇰 Denmark",name:"Denmark",flag:"🇩🇰"},{value:"eg",label:"🇪🇬 Egypt",name:"Egypt",flag:"🇪🇬"},{value:"fi",label:"🇫🇮 Finland",name:"Finland",flag:"🇫🇮"},{value:"fr",label:"🇫🇷 France",name:"France",flag:"🇫🇷"},{value:"de",label:"🇩🇪 Germany",name:"Germany",flag:"🇩🇪"},{value:"gr",label:"🇬🇷 Greece",name:"Greece",flag:"🇬🇷"},{value:"hk",label:"🇭🇰 Hong Kong",name:"Hong Kong",flag:"🇭🇰"},{value:"hu",label:"🇭🇺 Hungary",name:"Hungary",flag:"🇭🇺"},{value:"in",label:"🇮🇳 India",name:"India",flag:"🇮🇳"},{value:"id",label:"🇮🇩 Indonesia",name:"Indonesia",flag:"🇮🇩"},{value:"ir",label:"🇮🇷 Iran",name:"Iran",flag:"🇮🇷"},{value:"iq",label:"🇮🇶 Iraq",name:"Iraq",flag:"🇮🇶"},{value:"ie",label:"🇮🇪 Ireland",name:"Ireland",flag:"🇮🇪"},{value:"it",label:"🇮🇹 Italy",name:"Italy",flag:"🇮🇹"},{value:"jp",label:"🇯🇵 Japan",name:"Japan",flag:"🇯🇵"},{value:"jo",label:"🇯🇴 Jordan",name:"Jordan",flag:"🇯🇴"},{value:"kz",label:"🇰🇿 Kazakhstan",name:"Kazakhstan",flag:"🇰🇿"},{value:"kr",label:"🇰🇷 Korea",name:"South Korea",flag:"🇰🇷"},{value:"kw",label:"🇰🇼 Kuwait",name:"Kuwait",flag:"🇰🇼"},{value:"lb",label:"🇱🇧 Lebanon",name:"Lebanon",flag:"🇱🇧"},{value:"ly",label:"🇱🇾 Libya",name:"Libya",flag:"🇱🇾"},{value:"my",label:"🇲🇾 Malaysia",name:"Malaysia",flag:"🇲🇾"},{value:"mx",label:"🇲🇽 Mexico",name:"Mexico",flag:"🇲🇽"},{value:"ma",label:"🇲🇦 Morocco",name:"Morocco",flag:"🇲🇦"},{value:"nl",label:"🇳🇱 Netherlands",name:"Netherlands",flag:"🇳🇱"},{value:"nz",label:"🇳🇿 New Zealand",name:"New Zealand",flag:"🇳🇿"},{value:"ng",label:"🇳🇬 Nigeria",name:"Nigeria",flag:"🇳🇬"},{value:"no",label:"🇳🇴 Norway",name:"Norway",flag:"🇳🇴"},{value:"om",label:"🇴🇲 Oman",name:"Oman",flag:"🇴🇲"},{value:"pk",label:"🇵🇰 Pakistan",name:"Pakistan",flag:"🇵🇰"},{value:"ps",label:"🇵🇸 Palestine",name:"Palestine",flag:"🇵🇸"},{value:"ph",label:"🇵🇭 Philippines",name:"Philippines",flag:"🇵🇭"},{value:"pl",label:"🇵🇱 Poland",name:"Poland",flag:"🇵🇱"},{value:"pt",label:"🇵🇹 Portugal",name:"Portugal",flag:"🇵🇹"},{value:"qa",label:"🇶🇦 Qatar",name:"Qatar",flag:"🇶🇦"},{value:"ro",label:"🇷🇴 Romania",name:"Romania",flag:"🇷🇴"},{value:"ru",label:"🇷🇺 Russia",name:"Russia",flag:"🇷🇺"},{value:"sa",label:"🇸🇦 Saudi Arabia",name:"Saudi Arabia",flag:"🇸🇦"},{value:"sg",label:"🇸🇬 Singapore",name:"Singapore",flag:"🇸🇬"},{value:"za",label:"🇿🇦 South Africa",name:"South Africa",flag:"🇿🇦"},{value:"es",label:"🇪🇸 Spain",name:"Spain",flag:"🇪🇸"},{value:"sd",label:"🇸🇩 Sudan",name:"Sudan",flag:"🇸🇩"},{value:"se",label:"🇸🇪 Sweden",name:"Sweden",flag:"🇸🇪"},{value:"ch",label:"🇨🇭 Switzerland",name:"Switzerland",flag:"🇨🇭"},{value:"sy",label:"🇸🇾 Syria",name:"Syria",flag:"🇸🇾"},{value:"tw",label:"🇹🇼 Taiwan",name:"Taiwan",flag:"🇹🇼"},{value:"th",label:"🇹🇭 Thailand",name:"Thailand",flag:"🇹🇭"},{value:"tn",label:"🇹🇳 Tunisia",name:"Tunisia",flag:"🇹🇳"},{value:"tr",label:"🇹🇷 Turkey",name:"Turkey",flag:"🇹🇷"},{value:"ua",label:"🇺🇦 Ukraine",name:"Ukraine",flag:"🇺🇦"},{value:"gb",label:"🇬🇧 UK",name:"United Kingdom",flag:"🇬🇧"},{value:"us",label:"🇺🇸 USA",name:"United States",flag:"🇺🇸"},{value:"ye",label:"🇾🇪 Yemen",name:"Yemen",flag:"🇾🇪"}]),U=async()=>{try{const M=await fetch("/api/countries");if(!M.ok)throw new Error("Failed to load countries");let T=await M.json();if(!T||T.length===0){console.log("Using static countries list");return}T=T.filter(Ke=>Ke.value!=="il"),T.some(Ke=>Ke.value==="ps")||T.push({value:"ps",label:"🇵🇸 Palestine",name:"Palestine",flag:"🇵🇸"}),T.some(Ke=>Ke.value==="eg")||T.push({value:"eg",label:"🇪🇬 Egypt",name:"Egypt",flag:"🇪🇬"}),T.sort((Ke,G)=>Ke.name.localeCompare(G.name)),P.value=[{value:"any",label:"🌍 Any Country",name:"Any Country",flag:"🌍"},...T],console.log("Countries loaded:",P.value.length),console.log("Filtered out Israel and ensured Palestine and Egypt are included"),B.value=[...pe.value],O.value=[...he.value]}catch(M){console.error("Failed to load countries list:",M)}},Q=N(null),k=["You're not alone in the universe.","Every voice carries a story from across the stars.","Connection transcends distance in the cosmic web.","Discover new worlds through conversation.","In space, every voice matters."],R=N(k[Math.floor(Math.random()*k.length)]),$=Ie(),F=$.socket,{isConnected:I}=$,L=Sa(),{peerConnection:K,remoteStream:V,localStream:me,connectionState:xe,isAudioMuted:ye,partnerId:ie,createOffer:it,handleOffer:nt,handleAnswer:rt,handleIceCandidate:ot,toggleMicrophone:Ne,closeConnection:Be,restoreMicrophoneState:vt,diagnoseAndFixConnection:ee}=L,X=Ni(),ne=Za(),de=N(ne.params.roomId||null);Te(()=>de.value,M=>{M&&(f.value=!0)},{immediate:!0});const pe=Ee(()=>P.value.filter(M=>M.value!=="any"&&!w.value.includes(M.value)&&!A.value.includes(M.value))),he=Ee(()=>P.value.filter(M=>M.value!=="any"&&!A.value.includes(M.value)&&!w.value.includes(M.value))),be=N(""),ve=N(!1),J=N(!1),ke=N(""),Se=N(null),bt=async()=>{await Ne(),a.value=ye.value,n.value==="connected"&&setTimeout(()=>{const M=document.querySelector("audio");M&&M.paused&&M.play().catch(()=>{})},300)},Ft=async()=>{if(console.log("Finding next partner"),!me.value)try{await L.initializeLocalStream(),console.log("Microphone initialized")}catch(M){console.error("Failed to access microphone",M),alert("Please allow microphone access to use voice chat");return}if(F.value&&(F.value.emit("ping"),console.log("Sending ping to update activity status")),J.value){Wn("Please wait before trying again");return}F.value&&(e.value?(console.log("Disconnecting from current partner"),ve.value=!0,F.value.emit("disconnect-partner",{reason:"skip"}),Be(),await(()=>new Promise(T=>{const q=()=>{L.connectionState.value==="closed"?(console.log("Connection successfully closed, proceeding to search"),T()):(console.log(`Waiting for connection to close, current state: ${L.connectionState.value}`),setTimeout(q,300))};setTimeout(q,500)}))(),n.value="searching",o.value="",console.log("Clearing partner data from UI"),e.value=null,r.value=null,x.value=[],console.log("Finding new partner with preferences"),F.value.emit("join-queue",{vibe:b.value,preferences:{preferredCountries:w.value.length?w.value:void 0,blockedCountries:A.value.length?A.value:void 0}}),g.value++,setTimeout(()=>{ve.value=!1},500)):(e.value=null,r.value=null,n.value="searching",o.value="",console.log("Finding new partner with preferences"),F.value.emit("join-queue",{vibe:b.value,preferences:{preferredCountries:w.value.length?w.value:void 0,blockedCountries:A.value.length?A.value:void 0}}),g.value++))},Qt=()=>{u.value=!u.value,u.value&&e.value&&X.markAsRead(e.value)},Zt=M=>{if(F.value&&e.value){const T=Ra();F.value.emit("chat-message",{id:T,text:M,to:e.value,timestamp:Date.now()}),x.value.push({id:T,message:M,isOwn:!0,timestamp:Date.now()})}},gt=M=>{if(console.log(`Selected game: ${M}`),F.value&&e.value){const T=`invite-${Date.now()}-${Math.floor(Math.random()*1e4)}`;F.value.emit("game-invite",{gameType:M,to:e.value,inviteId:T}),jt("Game invitation sent!","info")}else jt("Cannot send invitation - no partner connected","error")},yt=M=>{M&&!w.value.includes(M)&&w.value.push(M)},Fn=M=>{w.value=w.value.filter(T=>T!==M)},Jt=M=>{if(M&&!A.value.includes(M)){A.value.push(M);const T=Ct(M);console.log(`Added ${T} (${M}) to blocked countries list`),localStorage.setItem("blockedCountries",JSON.stringify(A.value))}},en=M=>{A.value=A.value.filter(q=>q!==M);const T=Ct(M);console.log(`Removed ${T} (${M}) from blocked countries list`),localStorage.setItem("blockedCountries",JSON.stringify(A.value))},Sn=()=>{w.value=[],A.value=[],localStorage.removeItem("preferredCountries"),localStorage.removeItem("blockedCountries")},Rn=()=>{console.log("Applying filters with the following settings:"),console.log("- Blocked countries:",A.value.length?A.value:"None"),console.log("- Preferred countries:",w.value.length?w.value:"None"),v.value=!1,on(),tn(),Le()},tn=()=>{const M=document.createElement("div");M.className="fixed bottom-4 right-4 bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-lg z-50",M.innerHTML=`
    <div class="flex items-center gap-2">
      <span>✓</span>
      <span>Filter settings applied successfully</span>
    </div>
  `,document.body.appendChild(M),setTimeout(()=>{M.classList.add("opacity-0","transition-opacity","duration-300"),setTimeout(()=>{document.body.removeChild(M)},300)},3e3)},nn=M=>{const T=P.value.find(q=>q.value===M);return T?T.flag:"🏳️"},Ct=M=>{const T=P.value.find(q=>q.value===M);return T?T.name:"Earth"},$n=M=>new Date(M).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Wt=(M,T,q)=>{M.value=!M.value,M.value&&(T.forEach(Ce=>Ce.value=!1),q!=null&&q.updatePositions&&mt(),q!=null&&q.resetSearch&&(q.resetSearch.query.value="",q.resetSearch.list.value=[...q.resetSearch.source]))},wt=M=>{M==="vibe"?(C.value=!C.value,D.value=!1,S.value=!1):M==="preferred"?Na():M==="blocked"&&La()},In=M=>{b.value=M,C.value=!1},Pn=M=>{const T=E.find(q=>q.value===M);return T?T.emoji:"🌟"},rn=M=>{const T=E.find(q=>q.value===M);return T?T.text:"Go With the Flow"},Nt=N(null),Lt=N(null),mt=()=>{ra(()=>{var Ke,G;const M=(Ke=Nt.value)==null?void 0:Ke.getBoundingClientRect(),T=(G=Lt.value)==null?void 0:G.getBoundingClientRect(),q=document.querySelector(".preferred-outer"),Ce=document.querySelector(".blocked-outer");M&&q&&(q.style.left=`${M.left}px`,q.style.top=`${M.bottom+5}px`,q.style.width=`${M.width}px`),T&&Ce&&(Ce.style.left=`${T.left}px`,Ce.style.top=`${T.bottom+5}px`,Ce.style.width=`${T.width}px`)})},on=()=>{localStorage.setItem("preferredCountries",JSON.stringify(w.value)),localStorage.setItem("blockedCountries",JSON.stringify(A.value))},an=()=>{try{const M=localStorage.getItem("preferredCountries"),T=localStorage.getItem("blockedCountries");M&&(w.value=JSON.parse(M)),T&&(A.value=JSON.parse(T))}catch(M){console.error("Error loading filter settings:",M)}},Le=()=>{F.value&&I.value?(console.log("Restarting matching with updated filters:",{preferredCountries:w.value,blockedCountries:A.value}),F.value.emit("startMatching",{preferredCountries:w.value.length>0?w.value:null,blockedCountries:A.value}),n.value="searching",o.value=""):console.warn("Cannot restart matching - socket not connected")};Te(n,M=>{console.log(`Connection status changed to: ${M}`),M==="connected"?(c&&clearInterval(c),c=setInterval(()=>{e.value&&xe.value!=="connected"&&(console.log("Connection health check: WebRTC not connected but partnerId exists"),["failed","closed","disconnected"].includes(xe.value)&&(console.log("Connection appears to be broken - resetting UI state"),n.value="disconnected",e.value=null,r.value=null))},2e3)):M==="disconnected"&&c&&(clearInterval(c),c=null)}),Ve(async()=>{var M,T,q,Ce,Ke;console.log("Home view mounted"),U();try{const G=localStorage.getItem("preferredCountries"),we=localStorage.getItem("blockedCountries");G&&(w.value=JSON.parse(G)),we&&(A.value=JSON.parse(we));const ln=localStorage.getItem("autoReconnect");ln&&(h.value=ln==="true")}catch(G){console.error("Error loading saved preferences:",G)}F.value&&(F.value.on("filters-updated",G=>{G.success&&console.log("Filters updated successfully on server")}),F.value.on("user-location",G=>{console.log("Received user location:",G),G&&G.countryCode&&G.country?(Q.value=G,w.value.length===0&&G.countryCode!=="unknown"&&G.countryCode!=="earth"&&(console.log(`Adding user's country ${G.country} (${G.countryCode}) to preferred countries`),w.value.push(G.countryCode),on()),console.log(`Your location: ${G.flag} ${G.country}`)):console.warn("Received incomplete location data:",G)}),F.value.on("online-count",G=>{let we;if(typeof G=="number")we=G;else if(typeof G=="object"&&G!==null&&"count"in G)we=G.count;else{console.error("Received invalid online count data:",G);return}console.log(`Received online count update: ${we}`),y.value=we}),F.value.on("online-count-update",G=>{console.log(`Received online count update via update event: ${G.count}`),y.value=G.count}),F.value.on("matched",G=>{console.log("Partner matched with event:",G),n.value="matched",o.value="",e.value=G.partnerId,r.value={id:G.partnerId,country:G.country||"Earth",countryCode:G.countryCode||"unknown",flag:G.flag||"🌍",vibe:G.vibe||"any"},p.value.unshift({id:Date.now().toString(),country:r.value.country,flag:r.value.flag,timestamp:Date.now()}),p.value.length>3&&(p.value=p.value.slice(0,3)),G.partnerId&&(console.log("Initiating WebRTC connection with partner immediately"),it(G.partnerId),setTimeout(()=>{n.value==="matched"&&xe.value==="connected"&&(console.log("WebRTC connection established, updating UI state"),n.value="connected")},2e3))}),F.value.on("direct-connection-established",G=>{console.log("Direct connection established:",G),n.value="connected",e.value=G.partnerId,r.value={id:G.partnerId,country:G.country||"Earth",countryCode:G.countryCode||"unknown",flag:G.flag||"🌍"}}),F.value.on("user-skipped",G=>{console.log("User skipped event received",G),Ht("disconnecting",{reason:"disconnected",message:"The other user disconnected"})}),F.value.on("user-disconnected",G=>{console.log("User disconnected event received",G);let we;G.reason==="connection-lost"?we="The other user's connection was lost":we="The other user disconnected",Ht("disconnecting",{reason:"disconnected",message:we})}),F.value.on("skip-confirmed",G=>{console.log("Skip confirmed by server:",G)}),F.value.on("disconnect-confirmed",G=>{console.log("Disconnect confirmed by server:",G)}),F.value.on("chat-message",G=>{x.value.push({id:G.id||Date.now().toString(),message:G.text||G.message||"",isOwn:!1,timestamp:G.timestamp||Date.now()}),G.id&&G.from&&F.value&&(console.log(`Sending receipt confirmation for message ${G.id}`),F.value.emit("message-received",{id:G.id,to:G.from}))}),F.value.on("error",G=>{if(console.error("Socket error:",G),G.type==="rate-limit"){const we=G.waitTime||60;Wn(`Please wait ${we} seconds before trying again`,3e3),n.value==="searching"&&(n.value="disconnected")}}),F.value.on("voice-offer",at),F.value.on("voice-answer",sn),F.value.on("ice-candidate",Mn),F.value.emit("get-online-count"),setTimeout(()=>{h.value&&n.value==="disconnected"&&(console.log("Auto-call is enabled - automatically finding a partner"),Ft())},1e3),F.value.on("queue-join-error",G=>{if(console.error("Queue join error:",G),G.reason==="rate-limited"){const we=G.waitTime||60;Wn(`Please wait ${we} seconds before trying to connect again`,3e3),n.value==="searching"&&(n.value="disconnected")}}),(M=F.value)==null||M.on("game-invite",G=>{console.log(`[Game] Received game invitation for ${G.gameType} from ${G.from}`),m.value.push({id:G.inviteId||`invite-${Date.now()}`,gameType:G.gameType,from:G.from,timestamp:Date.now()});const we=new Audio("/sounds/game-invite.mp3");we.volume=.7,we.play().catch(ln=>console.log("Error playing sound",ln)),"vibrate"in navigator&&navigator.vibrate([200,100,400])}),(T=F.value)==null||T.on("game-invite-accepted",G=>{var we;console.log(`[Game] ${G.from} accepted your game invitation for ${G.gameType}`),jt("Invitation accepted!","success"),e.value=G.from,f.value=!0,(we=F.value)==null||we.emit("game-join",{gameType:G.gameType,partnerId:G.from})}),(q=F.value)==null||q.on("game-invite-declined",G=>{console.log(`[Game] ${G.from} declined your game invitation`),jt("Invitation declined","error")}),(Ce=F.value)==null||Ce.on("game-invite-timeout",G=>{console.log(`[Game] Game invitation ${G.inviteId} timed out`),jt("Invitation expired","info")}),(Ke=F.value)==null||Ke.on("game-join-confirmed",G=>{console.log(`[Game] Join confirmed for game ${G.gameType} in room ${G.roomId}`)})),document.addEventListener("click",Kr),window.addEventListener("resize",mt),document.addEventListener("scroll",mt,!0),an(),await vt(),a.value=ye.value,window.addEventListener("connection-closed",()=>{console.log("Connection-closed event detected in HomeView")}),window.addEventListener("connection-state-changed",G=>{if(console.log("Connection state changed event received:",G.detail),(G.detail.state==="disconnected"||G.detail.state==="failed")&&n.value!=="disconnected"&&n.value!=="disconnecting"){const we=G.detail.temporary?"Connection temporarily lost. Trying to reconnect...":"Connection lost. The call has ended.";Ht("disconnecting",{reason:G.detail.reason||"network-disconnect",message:we,temporary:G.detail.temporary})}}),window.addEventListener("queue-status-changed",Yr)}),Or(()=>{console.log("Home view unmounting, cleaning up connection"),Be(),c&&(clearInterval(c),c=null),F.value&&(F.value.off("online-count"),F.value.off("matched"),F.value.off("direct-connection-established"),F.value.off("user-skipped"),F.value.off("user-disconnected"),F.value.off("skip-confirmed"),F.value.off("disconnect-confirmed"),F.value.off("queue-join-error"),F.value.off("chat-message"),F.value.off("error"),F.value.off("voice-offer"),F.value.off("voice-answer"),F.value.off("ice-candidate"),F.value.off("online-count-update"),F.value.off("game-invite"),F.value.off("game-invite-accepted"),F.value.off("game-invite-declined"),F.value.off("game-invite-timeout"),F.value.off("game-join-confirmed")),document.removeEventListener("click",Kr),window.removeEventListener("resize",mt),document.removeEventListener("scroll",mt,!0),window.removeEventListener("connection-closed",()=>{}),Se.value&&(clearTimeout(Se.value),Se.value=null),window.removeEventListener("queue-status-changed",Yr)});const at=async M=>{console.log("Received voice offer - forwarding to WebRTC service"),nt(M.offer,M.from)},sn=async M=>{console.log("Received voice answer - forwarding to WebRTC service"),rt(M.answer)},Mn=async M=>{console.log("Received ICE candidate - forwarding to WebRTC service"),ot(M.candidate)};Te(xe,M=>{console.log(`WebRTC connection state changed to: ${M}`),M==="connected"?n.value==="matched"&&Ht("connected"):["failed","closed","disconnected"].includes(M)&&(console.log(`WebRTC connection is now ${M}, updating UI if needed`),e.value&&n.value!=="disconnected"&&n.value!=="disconnecting"&&Ht("disconnecting",{reason:M==="disconnected"?"network-disconnect":"disconnected",message:M==="disconnected"?"Connection lost. Trying to reconnect...":"Connection closed."}))});const On=N(null),Kr=M=>{const T=M.target;if(On.value&&!On.value.contains(T)&&(C.value=!1),D.value){const q=Nt.value,Ce=document.querySelector(".preferred-outer");q&&Ce&&!q.contains(T)&&!Ce.contains(T)&&(D.value=!1)}if(S.value){const q=Lt.value,Ce=document.querySelector(".blocked-outer");q&&Ce&&!q.contains(T)&&!Ce.contains(T)&&(S.value=!1)}};function Oa(){F.value&&(F.value.emit("join-queue",{vibe:b.value,preferences:{preferredCountries:w.value.length?w.value:void 0,blockedCountries:A.value.length?A.value:void 0}}),n.value="searching",console.log("Manual retry initiated, keeping auto-reconnect off"))}Te(h,M=>{localStorage.setItem("autoReconnect",M.toString()),M&&n.value==="disconnected"&&(console.log("Auto-call enabled - automatically finding a partner"),Ft())}),Te(()=>n.value,M=>{M==="searching"&&(o.value="")});function Wn(M,T=3e3){ke.value=M,J.value=!0,Se.value&&clearTimeout(Se.value),Se.value=window.setTimeout(()=>{J.value=!1,ke.value="",Se.value=null},T)}const Yr=M=>{const T=M;T.detail&&T.detail.status==="timeout"&&(console.log("Queue timeout detected, disabling auto-reconnect"),h.value=!1,n.value="disconnected")},Wa=()=>{if(he.value)if(_.value.trim()==="")O.value=[...he.value];else{const M=_.value.toLowerCase().trim();O.value=he.value.filter(T=>T.name.toLowerCase().includes(M)||T.value.toLowerCase().includes(M))}},Na=()=>{Wt(D,[S,C],{updatePositions:!0,resetSearch:{query:z,list:B,source:pe.value}})},La=()=>{Wt(S,[D,C],{updatePositions:!0,resetSearch:{query:_,list:O,source:he.value}})},Ht=(M,T={})=>{if(console.log(`Handling connection state change to: ${M} with reason: ${T.reason||"none"}`),M==="disconnecting"){if(be.value=T.reason||"disconnected",T.message&&(o.value=T.message,setTimeout(()=>{o.value=""},5e3)),n.value="disconnecting",!T.temporary){const q=T.skipDelay?0:2e3;setTimeout(()=>{n.value==="disconnecting"&&(e.value=null,r.value=null,n.value="disconnected",be.value="",o.value="",Be(),h.value&&(console.log("Auto-call is enabled - finding new partner after disconnection"),setTimeout(()=>{n.value==="disconnected"&&h.value&&(console.log("Auto-call: Starting new call automatically"),Ft())},1e3)))},q)}}else n.value=M,M==="searching"&&(o.value="")},Ha=M=>{console.log(`Accepting game invitation: ${M.gameType} from ${M.from}`),m.value=m.value.filter(T=>T.id!==M.inviteId),F.value&&(F.value.emit("game-invite-accept",{inviteId:M.inviteId,gameType:M.gameType,to:M.from}),e.value=M.from,f.value=!0,F.value.emit("game-join",{gameType:M.gameType,partnerId:M.from}))},ja=M=>{console.log(`Declining game invitation from ${M.from}`),m.value=m.value.filter(T=>T.id!==M.inviteId),F.value&&F.value.emit("game-invite-decline",{inviteId:M.inviteId,to:M.from})},Ua=M=>{if(console.log(`Game invitation timed out: ${M.inviteId}`),m.value=m.value.filter(T=>T.id!==M.inviteId),F.value){const T=m.value.find(q=>q.id===M.inviteId);T&&F.value.emit("game-invite-timeout",{inviteId:M.inviteId,to:T.from})}},jt=(M,T="info")=>{const q=document.createElement("div");let Ce="bg-blue-600";T==="success"&&(Ce="bg-emerald-600"),T==="error"&&(Ce="bg-red-600"),q.className=`fixed bottom-4 right-4 ${Ce} text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in`,q.style.animationDuration="0.3s",q.innerHTML=M,document.body.appendChild(q),setTimeout(()=>{q.style.opacity="0",q.style.transition="opacity 0.3s ease",setTimeout(()=>{document.body.removeChild(q)},300)},3e3)};return(M,T)=>(H(),j("div",cf,[T[41]||(T[41]=ft('<div class="fixed inset-0 pointer-events-none" data-v-7fd665e9><div class="absolute top-1/4 left-1/4 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl animate-pulse" data-v-7fd665e9></div><div class="absolute top-1/3 right-1/3 w-24 h-24 bg-violet-500/20 rounded-full blur-2xl animate-pulse delay-1000" data-v-7fd665e9></div><div class="absolute bottom-1/4 left-1/3 w-28 h-28 bg-indigo-500/20 rounded-full blur-3xl animate-pulse delay-2000" data-v-7fd665e9></div><div class="absolute top-1/2 right-1/4 w-20 h-20 bg-fuchsia-500/20 rounded-full blur-2xl animate-pulse delay-500" data-v-7fd665e9></div></div>',1)),Qe(kd),i("div",uf,[i("header",df,[i("div",ff,[T[21]||(T[21]=ft('<div class="text-center mb-2 sm:mb-4" data-v-7fd665e9><div class="inline-flex items-center gap-2" data-v-7fd665e9><div class="w-6 h-6 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center shadow-lg shadow-cyan-500/50" data-v-7fd665e9><span class="text-white text-xs" data-v-7fd665e9>✨</span></div><h1 class="text-lg font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent drop-shadow-lg" data-v-7fd665e9> SpaceTalk.live </h1></div></div>',1)),i("div",xf,[i("div",vf,[T[20]||(T[20]=i("div",{class:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"},null,-1)),i("span",null,Y(y.value)+" online",1)]),g.value>0?(H(),j("div",gf," Today: "+Y(g.value)+" voices ",1)):te("",!0)]),i("div",mf,[i("div",{class:"relative",ref_key:"vibeDropdownRef",ref:On},[i("div",{onClick:T[0]||(T[0]=q=>wt("vibe")),class:"cursor-pointer bg-purple-500/20 border border-purple-500/30 rounded-full h-8 flex items-center justify-between px-3 text-xs shadow-lg shadow-purple-500/20 text-white hover:bg-purple-500/30 active:scale-95 transition-all duration-150"},[i("span",pf,Y(Pn(b.value))+" "+Y(rn(b.value)),1),i("span",{class:se(["ml-2 text-xs transition-transform duration-300",{"rotate-180":C.value}])},"▼",2)]),C.value?(H(),j("div",hf,[i("div",bf,[(H(),j(_e,null,Pe(E,q=>i("div",{key:q.value,onClick:Ce=>In(q.value),class:se(["px-3 py-2 hover:bg-gray-700/80 cursor-pointer transition-colors flex items-center gap-2",{"bg-gray-700/70":b.value===q.value}])},[i("span",Cf,Y(q.emoji),1),i("span",null,Y(q.text),1)],10,yf)),64))])])):te("",!0)],512),i("button",{onClick:T[1]||(T[1]=q=>v.value=!0),class:"bg-violet-500/20 border border-violet-500/30 rounded-full h-8 px-3 text-xs hover:bg-violet-500/30 active:scale-95 transition-all duration-150 shadow-lg shadow-violet-500/20"}," 🔍 Filters ")])])]),i("main",wf,[i("div",Ef,[Qe(il,{status:n.value,"partner-info":r.value,"error-message":o.value,"disconnect-reason":be.value,"show-status":!0},null,8,["status","partner-info","error-message","disconnect-reason"]),Qe(Nd,{onRetry:Oa}),i("div",_f,[i("div",Af,[Pt(i("input",{type:"checkbox",id:"auto-reconnect","onUpdate:modelValue":T[2]||(T[2]=q=>h.value=q),class:"opacity-0 w-0 h-0 absolute"},null,512),[[Qa,h.value]]),i("label",{for:"auto-reconnect",class:se(["toggle-label block overflow-hidden h-5 rounded-full bg-gray-700 border border-gray-600 cursor-pointer transition-all duration-300",{"bg-gradient-to-r from-indigo-500 to-purple-500 border-indigo-400":h.value}])},[i("span",{class:se(["dot absolute top-0.5 left-0.5 bg-white w-4 h-4 rounded-full transition-all duration-300 shadow-md",{"transform translate-x-5 bg-white":h.value}])},null,2)],2)]),i("label",{for:"auto-reconnect",class:se(["text-xs font-medium cursor-pointer transition-colors duration-300",h.value?"text-indigo-300":"text-gray-400"])}," Auto-call ",2)]),Qe(pl,{"is-muted":a.value,"is-disabled":n.value!=="connected",onToggleMute:bt,onFindNext:Ft,onToggleChat:Qt,onToggleGames:T[3]||(T[3]=q=>f.value=!0),onToggleHistory:T[4]||(T[4]=q=>l.value=!0),onToggleDonation:T[5]||(T[5]=q=>s.value=!0)},null,8,["is-muted","is-disabled"]),i("div",Bf,[i("p",kf,'"'+Y(R.value)+'"',1)])])]),i("footer",Df,[i("div",Tf,[T[25]||(T[25]=i("h3",{class:"text-sm font-semibold text-emerald-400"},"Community Guidelines",-1)),T[26]||(T[26]=i("div",{class:"text-xs text-gray-300 space-y-0.5 sm:space-y-1"},[i("p",null,"• Must be 18+ years old to use this service"),i("p",null,"• Be respectful and kind to other users"),i("p",null,"• No harassment, hate speech, or inappropriate content"),i("p",null,"• Report any misconduct using the report feature"),i("p",null,"• Your privacy and safety are our priority")],-1)),T[27]||(T[27]=i("p",{class:"text-xs text-gray-400 mt-2 sm:mt-3"}," By using SpaceTalk.live, you agree to follow these guidelines ",-1)),i("div",Ff,[i("a",{href:"#",onClick:T[6]||(T[6]=Pr(q=>d.value=!0,["prevent"])),class:"bg-cyan-500/20 border border-cyan-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-cyan-300 hover:text-cyan-200 hover:bg-cyan-500/30 transition-all shadow-lg shadow-cyan-500/20 text-center"}," ℹ️ About "),T[22]||(T[22]=i("a",{href:"https://instagram.com",target:"_blank",class:"bg-pink-500/20 border border-pink-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-pink-300 hover:text-pink-200 hover:bg-pink-500/30 transition-all shadow-lg shadow-pink-500/20 text-center"}," 📷 Instagram ",-1)),T[23]||(T[23]=i("a",{href:"https://facebook.com",target:"_blank",class:"bg-blue-500/20 border border-blue-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-blue-300 hover:text-blue-200 hover:bg-blue-500/30 transition-all shadow-lg shadow-blue-500/20 text-center"}," 📘 Facebook ",-1)),T[24]||(T[24]=i("a",{href:"mailto:Info@spacetalk.live",class:"bg-emerald-500/20 border border-emerald-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-emerald-300 hover:text-emerald-200 hover:bg-emerald-500/30 transition-all shadow-lg shadow-emerald-500/20 text-center"}," 📧 Contact ",-1))])])])]),l.value?(H(),j("div",Sf,[i("div",Rf,[i("div",$f,[T[28]||(T[28]=i("h2",{class:"text-lg font-semibold text-indigo-400"},"📞 Call History",-1)),i("button",{onClick:T[7]||(T[7]=q=>l.value=!1),class:"text-gray-400 hover:text-white text-xl"}," ✕ ")]),i("div",If,[p.value.length===0?(H(),j("div",Pf,T[29]||(T[29]=[i("p",{class:"text-gray-400 text-sm"},"No recent calls",-1),i("p",{class:"text-xs text-gray-500 mt-1"},"Your last 3 conversations will appear here",-1)]))):(H(!0),j(_e,{key:1},Pe(p.value,(q,Ce)=>(H(),j("div",{key:q.id,class:"bg-gray-700 rounded-lg p-3 flex items-center justify-between hover:bg-gray-600 transition-colors"},[i("div",Mf,[i("span",Of,Y(q.flag),1),i("div",null,[i("p",Wf,Y(q.country),1),i("p",Nf,Y($n(q.timestamp)),1)])]),i("div",Lf," #"+Y(Ce+1),1)]))),128))]),p.value.length>0?(H(),j("p",Hf," History clears when you leave the page ")):te("",!0)])])):te("",!0),v.value?(H(),j("div",jf,[i("div",Uf,[i("div",qf,[T[30]||(T[30]=i("h2",{class:"text-lg font-semibold text-emerald-400"},"Filters & Preferences",-1)),i("button",{onClick:T[8]||(T[8]=q=>v.value=!1),class:"text-gray-400 hover:text-white text-xl"}," ✕ ")]),i("div",zf,[i("div",null,[T[32]||(T[32]=i("label",{class:"block text-sm font-medium mb-3 text-emerald-400"},"Preferred Countries",-1)),i("div",Gf,[w.value.length===0?(H(),j("p",Vf,"No countries selected")):(H(),j("div",Kf,[(H(!0),j(_e,null,Pe(w.value,q=>(H(),j("span",{key:q,class:"bg-emerald-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1"},[i("span",Yf,Y(nn(q)),1),ze(" "+Y(Ct(q))+" ",1),i("button",{onClick:Ce=>Fn(q),class:"text-emerald-200 hover:text-white ml-1"}," ✕ ",8,Xf)]))),128))]))]),i("div",{class:"mt-2 relative preferred-dropdown",ref_key:"preferredDropdownRef",ref:Nt},[i("div",{onClick:T[9]||(T[9]=q=>wt("preferred")),class:"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white"},T[31]||(T[31]=[i("span",{class:"text-gray-300"},"Add preferred country...",-1),i("span",{class:"ml-1"},"▼",-1)]))],512),Qe(Xd,{"preferred-countries":w.value,"blocked-countries":A.value,"online-users":y.value,countries:P.value},null,8,["preferred-countries","blocked-countries","online-users","countries"]),T[33]||(T[33]=i("p",{class:"text-xs text-gray-400 mt-2"},"You'll be matched only with users from these countries",-1))]),i("div",null,[T[35]||(T[35]=i("label",{class:"block text-sm font-medium mb-3 text-red-400"},"Blocked Countries",-1)),i("div",Qf,[A.value.length===0?(H(),j("p",Zf,"No countries blocked")):(H(),j("div",Jf,[(H(!0),j(_e,null,Pe(A.value,q=>(H(),j("span",{key:q,class:"bg-red-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1"},[i("span",ex,Y(nn(q)),1),ze(" "+Y(Ct(q))+" ",1),i("button",{onClick:Ce=>en(q),class:"text-red-200 hover:text-white ml-1"}," ✕ ",8,tx)]))),128))]))]),i("div",{class:"mt-2 relative blocked-dropdown",ref_key:"blockedDropdownRef",ref:Lt},[i("div",{onClick:T[10]||(T[10]=q=>wt("blocked")),class:"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white"},T[34]||(T[34]=[i("span",{class:"text-gray-300"},"Add blocked country...",-1),i("span",{class:"ml-1"},"▼",-1)]))],512),T[36]||(T[36]=i("p",{class:"text-xs text-gray-400 mt-2"},"You won't be matched with users from these countries",-1))])]),i("div",{class:"flex gap-2 mt-8"},[i("button",{onClick:Sn,class:"flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg text-sm transition-colors"}," Clear All "),i("button",{onClick:Rn,class:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-lg text-sm transition-colors"}," Apply Filters ")])])])):te("",!0),D.value?(H(),j("div",nx,[i("div",rx,[i("div",ox,[Pt(i("input",{"onUpdate:modelValue":T[11]||(T[11]=q=>z.value=q),type:"text",placeholder:"Search countries...",class:"w-full px-3 py-2 bg-gray-800 rounded text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:T[12]||(T[12]=(...q)=>M.updateCountrySearch&&M.updateCountrySearch(...q))},null,544),[[Kt,z.value]])]),pe.value.length===0?(H(),j("div",ax,"No more countries available")):te("",!0),(H(!0),j(_e,null,Pe(B.value,q=>(H(),j("div",{key:q.value,onClick:()=>{yt(q.value),wt("preferred")},class:"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2"},[i("span",ix,Y(q.flag),1),i("span",lx,Y(q.name),1)],8,sx))),128))])])):te("",!0),S.value?(H(),j("div",cx,[i("div",ux,[i("div",dx,[Pt(i("input",{"onUpdate:modelValue":T[13]||(T[13]=q=>_.value=q),type:"text",placeholder:"Search countries...",class:"w-full px-3 py-2 bg-gray-800 rounded text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500",onInput:Wa},null,544),[[Kt,_.value]])]),he.value.length===0?(H(),j("div",fx,"No more countries available")):te("",!0),(H(!0),j(_e,null,Pe(O.value,q=>(H(),j("div",{key:q.value,onClick:()=>{Jt(q.value),wt("blocked")},class:"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2"},[i("span",vx,Y(q.flag),1),i("span",gx,Y(q.name),1)],8,xx))),128))])])):te("",!0),Qe(Tl,{"is-open":u.value,onClose:T[14]||(T[14]=q=>u.value=!1),messages:x.value,onSendMessage:Zt,"is-connected":n.value==="connected"},null,8,["is-open","messages","is-connected"]),Qe(bd,{"is-open":f.value,onClose:T[15]||(T[15]=q=>f.value=!1),"is-connected":n.value==="connected",onSelectGame:gt,"partner-id":e.value||"","initial-game-room-id":de.value},null,8,["is-open","is-connected","partner-id","initial-game-room-id"]),Qe(_d,{"is-open":s.value,onClose:T[16]||(T[16]=q=>s.value=!1)},null,8,["is-open"]),d.value?(H(),j("div",mx,[i("div",px,[i("div",hx,[T[37]||(T[37]=i("div",{class:"flex items-center gap-2"},[i("div",{class:"w-8 h-8 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center shadow-lg shadow-cyan-500/50"},[i("span",{class:"text-white text-lg"},"✨")]),i("h2",{class:"text-xl font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent drop-shadow-lg"}," About SpaceTalk ")],-1)),i("button",{onClick:T[17]||(T[17]=q=>d.value=!1),class:"text-gray-400 hover:text-white text-xl transition-colors"}," ✕ ")]),i("div",bx,[T[38]||(T[38]=ft('<p class="text-lg font-medium text-center mb-6 text-cyan-300" data-v-7fd665e9> SpaceTalk — where strangers become voices in the void... and maybe new friends. </p><div class="bg-purple-900/30 p-4 rounded-lg border border-purple-500/20" data-v-7fd665e9><p class="mb-4" data-v-7fd665e9>Tired of endless scrolling?</p><p class="mb-4" data-v-7fd665e9>Sick of typing and deleting that message 5 times?</p><p class="mb-4" data-v-7fd665e9>Yeah — us too.</p><p class="mt-6" data-v-7fd665e9>That&#39;s why we built SpaceTalk: a place where you can simply call someone, talk, and see where the conversation goes. No profiles, no DMs, no filters — just your voice and theirs, connected across the stars (well, the internet, but stars sound cooler ✨).</p></div>',2)),i("div",yx,[i("button",{onClick:T[18]||(T[18]=q=>d.value=!1),class:"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white px-6 py-3 rounded-full text-sm font-medium transition-all shadow-lg shadow-cyan-500/30"}," Start Talking Now ")])])])])):te("",!0),n.value==="connected"?(H(),j("div",Cx,[Qe(Fd,{showControls:!1})])):te("",!0),(H(!0),j(_e,null,Pe(m.value,q=>(H(),xn(lf,{key:q.id,"invite-id":q.id,"game-type":q.gameType,from:q.from,onAccept:Ha,onDecline:ja,onTimeout:Ua},null,8,["invite-id","game-type","from"]))),128)),J.value?(H(),j("div",wx,[i("div",Ex,[i("div",_x,[T[39]||(T[39]=i("div",{class:"w-20 h-20 mx-auto mb-4 rounded-full bg-purple-800 flex items-center justify-center"},[i("span",{class:"text-3xl"},"⏱️")],-1)),T[40]||(T[40]=i("p",{class:"text-white text-lg font-semibold mb-1"},"Rate Limit Reached",-1)),i("p",Ax,Y(ke.value),1)]),i("div",Bx,[i("button",{onClick:T[19]||(T[19]=q=>J.value=!1),class:"bg-purple-700 hover:bg-purple-600 text-white px-6 py-2 rounded-full text-sm transition-colors duration-300"}," OK ")])])])):te("",!0)]))}});const ta=tt(kx,[["__scopeId","data-v-7fd665e9"]]),Dx=Ja({history:es("/"),routes:[{path:"/",name:"home",component:ta},{path:"/game/:roomId",name:"game",component:ta,props:!0}]}),Ma=ts(ds);Ma.use(Dx);Ma.mount("#app");
//# sourceMappingURL=index-57eee3bb.js.map
