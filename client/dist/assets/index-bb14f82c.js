import{d as ye,c as v,a as $e,u as zt,o as d,R as Ut,r as p,b as Re,e as Ge,s as ut,w as ce,f as ie,g as Yt,T as Vt,h as e,n as V,t as R,i as H,F as de,j as ve,k as qt,l as et,v as ft,m as St,p as ge,q as ke,x as Ht,y as dt,z as Jt,A as It,B as Kt,C as Xt,D as Zt,E as Qt,G as ea}from"./vue-vendor-db0abc2b.js";import{l as ta}from"./socket-vendor-d9998155.js";(function(){const k=document.createElement("link").relList;if(k&&k.supports&&k.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))A(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&A(c)}).observe(document,{childList:!0,subtree:!0});function l(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function A(i){if(i.ep)return;i.ep=!0;const n=l(i);fetch(i.href,n)}})();const aa={class:"app-container"},oa=ye({__name:"App",setup(o){return(k,l)=>(d(),v("div",aa,[$e(zt(Ut))]))}});const na=()=>window.location.origin,J=p(null),Xe=p(null),Oe=p(!1);let Ne=null;function Ae(){Re(()=>{J.value||o()}),Ge(()=>{J.value&&A(),Ne&&(clearInterval(Ne),Ne=null)});function o(){const n=na();console.log(`Connecting to socket server at: ${n}`);const c=localStorage.getItem("spacechat_user_id");console.log("Retrieved stored user ID:",c),J.value=ta(n,{autoConnect:!0,reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:3e4,transports:["websocket","polling"],extraHeaders:{"X-Client-Version":"1.0.0"},query:c?{userId:c}:void 0,forceNew:!1,rememberUpgrade:!0,withCredentials:!0}),l(),k()}function k(){Ne&&clearInterval(Ne),Ne=setInterval(()=>{J.value&&Oe.value&&J.value.emit("ping")},3e4)}function l(){J.value&&(J.value.on("connect",()=>{var c,s;console.log("Socket connected"),Oe.value=!0;const n=localStorage.getItem("spacechat_user_id");(c=J.value)==null||c.emit("user:identify",{prevUserId:n||void 0},S=>{console.log("Identified with server, user ID:",S),Xe.value=S,localStorage.setItem("spacechat_user_id",S)}),(s=J.value)==null||s.emit("get-online-count")}),J.value.on("disconnect",()=>{console.log("Socket disconnected"),Oe.value=!1}),J.value.on("reconnect",n=>{var s;console.log(`Socket reconnected after ${n} attempts`),Oe.value=!0;const c=localStorage.getItem("spacechat_user_id");c&&((s=J.value)==null||s.emit("user:identify",{prevUserId:c},S=>{var _;console.log("Re-identified with server after reconnection, user ID:",S),Xe.value=S,S!==c&&localStorage.setItem("spacechat_user_id",S),(_=J.value)==null||_.emit("get-online-count")}))}),J.value.on("reconnect_attempt",n=>{console.log(`Socket reconnection attempt ${n}`)}),J.value.on("reconnect_error",n=>{console.error("Socket reconnection error:",n)}),J.value.on("reconnect_failed",()=>{console.error("Socket reconnection failed"),setTimeout(()=>{Oe.value||(console.log("Attempting to reinitialize socket connection..."),A(),o())},5e3)}),J.value.on("error",n=>{console.error("Socket error:",n)}),J.value.on("pong",()=>{}),J.value.on("user-id",n=>{console.log("Received user ID from server:",n),Xe.value=n,localStorage.setItem("spacechat_user_id",n)}))}function A(){J.value&&(J.value.off("connect"),J.value.off("disconnect"),J.value.off("reconnect"),J.value.off("reconnect_attempt"),J.value.off("reconnect_error"),J.value.off("reconnect_failed"),J.value.off("error"),J.value.off("user-id"),J.value.off("pong"))}function i(){J.value?(console.log("Forcing socket reconnection..."),J.value.disconnect(),J.value.connect()):o()}return{socket:J,isConnected:Oe,userId:Xe,reconnect:i}}const la=86400,Wt=`${Date.now()+la}:spacechat`,Et="openrelayproject",At={iceServers:[{urls:["turns:global.relay.metered.ca:443","turn:global.relay.metered.ca:443?transport=tcp","turn:global.relay.metered.ca:80?transport=tcp","turn:global.relay.metered.ca:80"],username:Wt,credential:Et},{urls:["turn:relay.metered.ca:80","turn:relay.metered.ca:443","turns:relay.metered.ca:443"],username:"dbc12a",credential:"c84ded89b281ae42"},{urls:["turn:global.turn.twilio.com:3478?transport=tcp","turn:global.turn.twilio.com:3478?transport=udp","turns:global.turn.twilio.com:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"},{urls:"stun:openrelay.metered.ca:80"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},wt={iceServers:[{urls:["turns:global.relay.metered.ca:443","turn:global.relay.metered.ca:443?transport=tcp","turn:global.relay.metered.ca:80?transport=tcp","turns:relay.metered.ca:443"],username:Wt,credential:Et},{urls:["turn:relay.metered.ca:443?transport=tcp","turns:relay.metered.ca:443"],username:"dbc12a",credential:"c84ded89b281ae42"},{urls:["turns:global.turn.twilio.com:443?transport=tcp"],username:"openrelayproject",credential:"openrelayproject"}],iceCandidatePoolSize:10,iceTransportPolicy:"relay",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},Ct={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun.cloudflare.com:3478"]},{urls:["turn:relay.metered.ca:443?transport=tcp"],username:"dbc12a",credential:"c84ded89b281ae42"}],iceCandidatePoolSize:5,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};let Fe=At;const sa=Fe;let h=null,B=null,U=null;const ne=p("new"),We=p(!1),Ee=p(null),M=!0;let re="",Ce="",kt=null,oe=!1,ze=!1,ae=0;const _e=15;let be=[],De=null;const ra=8e3,ia=1e3;async function Pt(){if(!h)return{error:"No peer connection available"};try{const o={};return(await h.getStats()).forEach(l=>{l.type==="transport"?o.transport={bytesReceived:l.bytesReceived,bytesSent:l.bytesSent,dtlsState:l.dtlsState,selectedCandidatePairId:l.selectedCandidatePairId}:l.type==="candidate-pair"&&l.selected?o.selectedCandidatePair={localCandidateId:l.localCandidateId,remoteCandidateId:l.remoteCandidateId,state:l.state,availableOutgoingBitrate:l.availableOutgoingBitrate}:l.type==="local-candidate"||l.type==="remote-candidate"?(o.candidates||(o.candidates=[]),o.candidates.push({type:l.type,id:l.id,ip:l.ip,port:l.port,protocol:l.protocol,candidateType:l.candidateType})):(l.type==="media-source"||l.type==="track"||l.type==="media-playout")&&(o.media||(o.media=[]),o.media.push({type:l.type,id:l.id,kind:l.kind,audioLevel:l.audioLevel,trackIdentifier:l.trackIdentifier}))}),o}catch(o){return console.error("[WebRTC] Error getting stats:",o),{error:"Failed to get stats: "+o}}}function ca(){mt();const o=setInterval(async()=>{h&&(ne.value==="connected"||ne.value==="connecting")?(kt=await Pt(),console.log("[WebRTC] Connection stats:",kt)):mt()},5e3);window.__webrtcStatsTimer=o}function mt(){const o=window.__webrtcStatsTimer;o&&(clearInterval(o),window.__webrtcStatsTimer=null)}function pt(){const{socket:o,userId:k}=Ae(),l=ut(h),A=ut(B),i=ut(U),n=ne,c=We,s=Ee;p({echoCancellation:!0,noiseSuppression:!0});const S=async()=>{try{if(B){M&&console.log("[WebRTC] Using existing local stream");const a=B.getAudioTracks();if(a.length===0||!a[0].enabled)M&&console.log("[WebRTC] Existing stream has no active audio tracks, requesting new stream"),B.getTracks().forEach(T=>T.stop()),B=null;else return B}M&&console.log("[WebRTC] Requesting access to microphone with specific constraints");const t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:2},video:!1});if(t.getAudioTracks().length===0)throw console.error("[WebRTC] No audio tracks found in stream"),new Error("No audio tracks available");return M&&(console.log("[WebRTC] Local stream acquired successfully"),console.log("[WebRTC] Audio tracks:",t.getAudioTracks().length),t.getAudioTracks().forEach(T=>{console.log(`[WebRTC] Track: ${T.label}, enabled: ${T.enabled}, muted: ${T.muted}, readyState: ${T.readyState}`),console.log("[WebRTC] Track settings:",JSON.stringify(T.getSettings()))})),t.getTracks().forEach(a=>{a.enabled=!0}),B=t,A.value=t,t}catch(t){console.error("[WebRTC] Error accessing microphone:",t);try{M&&console.log("[WebRTC] Trying fallback with simpler constraints");const a=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});if(a.getAudioTracks().length===0)throw new Error("No audio tracks available");return B=a,A.value=a,a}catch(a){throw console.error("[WebRTC] Fallback also failed:",a),new Error("Could not access microphone. Please check permissions.")}}},_=()=>{if(h)try{h.close(),h=null,U&&(U.getTracks().forEach(t=>{t.stop()}),U=null)}catch(t){console.error("[WebRTC] Error cleaning up old peer connection:",t)}try{const t=new RTCPeerConnection(sa);return t.onnegotiationneeded=async a=>{if(M&&console.log("[WebRTC] Negotiation needed event",a),!ua(t)||oe){M&&console.log("[WebRTC] Skipping negotiation - already in progress or not in stable state");return}oe=!0;try{M&&console.log("[WebRTC] Starting negotiation"),Z()}catch(T){console.error("[WebRTC] Negotiation error:",T),Ce=`Negotiation error: ${T}`,oe=!1}},t.oniceconnectionstatechange=()=>{M&&console.log("[WebRTC] ICE Connection state changed to:",t.iceConnectionState),t.iceConnectionState==="connected"||t.iceConnectionState==="completed"?(Ce="",ae=0,Y(),ca()):(t.iceConnectionState==="disconnected"||t.iceConnectionState==="failed"||t.iceConnectionState==="closed")&&(Ue(t.iceConnectionState),M&&console.log("[WebRTC] ICE Connection terminated:",t.iceConnectionState),Ee.value&&o.value&&o.value.emit("webrtc-connection-state",{to:Ee.value,state:t.iceConnectionState,reason:"ice-connection-state-change"}),(t.iceConnectionState==="failed"||t.iceConnectionState==="closed")&&setTimeout(()=>{(t.iceConnectionState==="failed"||t.iceConnectionState==="closed")&&Ue("failed")},2e3))},t.onicecandidate=a=>{var T;a.candidate?(M&&console.log("[WebRTC] New ICE candidate:",a.candidate),window.__localIceCandidates||(window.__localIceCandidates=[]),window.__localIceCandidates.push(a.candidate),s.value?(T=o.value)==null||T.emit("webrtc-signal",{type:"ice-candidate",candidate:a.candidate,to:s.value}):(be.push(a.candidate),M&&console.log("[WebRTC] Storing ICE candidate for later. Total pending:",be.length))):(M&&console.log("[WebRTC] ICE gathering complete"),be.length>0&&s.value&&(be.forEach($=>{var C;(C=o.value)==null||C.emit("webrtc-signal",{type:"ice-candidate",candidate:$,to:s.value})}),M&&console.log(`[WebRTC] Sent ${be.length} pending ICE candidates`),be=[]))},t.onicegatheringstatechange=()=>{M&&console.log("[WebRTC] ICE gathering state changed to:",t.iceGatheringState)},t.onconnectionstatechange=()=>{M&&console.log("[WebRTC] Connection state changed to:",t.connectionState),Ue(t.connectionState),t.connectionState==="connected"?(Ce="",ae=0):(t.connectionState==="failed"||t.connectionState==="disconnected"||t.connectionState==="closed")&&t.connectionState==="failed"&&!Ce&&(Ce="PeerConnection failed")},t.onsignalingstatechange=()=>{M&&console.log("[WebRTC] Signaling state changed to:",t.signalingState),t.signalingState==="stable"&&(oe=!1)},t.ontrack=a=>{M&&console.log("[WebRTC] Track received:",a.track),U||(U=new MediaStream,i.value=U,console.log("[WebRTC] Created new remote stream")),U.addTrack(a.track),console.log(`[WebRTC] Added ${a.track.kind} track to remote stream, now has ${U.getTracks().length} tracks`),setTimeout(()=>{if(U){const T=U.getTracks();console.log(`[WebRTC] Remote stream has ${T.length} tracks after adding`),T.forEach($=>{console.log(`[WebRTC] Track: ${$.kind}, enabled: ${$.enabled}, muted: ${$.muted}, readyState: ${$.readyState}`),$.kind==="audio"&&(!$.enabled||$.muted)&&(console.log("[WebRTC] ðŸ”´ Found disabled or muted audio track, enabling it"),$.enabled=!0)})}},500),M&&(a.track.onunmute=()=>{console.log("[WebRTC] Track unmuted:",a.track.kind)},a.track.onmute=()=>{console.log("[WebRTC] Track muted:",a.track.kind),a.track.enabled=!0},a.track.onended=()=>{console.log("[WebRTC] Track ended:",a.track.kind)})},X(t),h=t,t}catch(t){throw console.error("[WebRTC] Error creating peer connection:",t),re=`Creation error: ${t}`,Ce="Failed to create connection",Ue("failed"),t}},m=async t=>{if(window.__webrtcConnectionTimeout&&clearTimeout(window.__webrtcConnectionTimeout),!t){const a="Cannot create offer: No target partner ID provided";return console.error(`[WebRTC] ${a}`),re=a,{error:a}}if(!o.value){const a="Cannot create offer: socket not available";return console.error(`[WebRTC] ${a}`),re=a,{error:a}}if(!B)try{M&&console.log("[WebRTC] Initializing local stream before creating offer"),await S()}catch(a){return console.error("[WebRTC] Failed to initialize local stream:",a),re=`Failed to access microphone: ${a}`,{error:`Failed to access microphone: ${a}`}}if(console.log(`[WebRTC] Creating offer for partner: ${t}`),oe)return console.warn("[WebRTC] Negotiation already in progress, deferring new offer"),new Promise(a=>{setTimeout(async()=>{a(oe?{waiting:"Negotiation in progress"}:await m(t))},1e3)});oe=!0,Ee.value=t,s.value=t;try{M&&console.log(`[WebRTC] Setting partner ID: ${t}`);const a=_();if(B){M&&(console.log("[WebRTC] Adding local tracks to connection"),console.log(`[WebRTC] Local stream has ${B.getTracks().length} tracks`));const $=B;if(a.getSenders().length>0){M&&console.log("[WebRTC] Replacing existing senders");let C=0;$.getTracks().forEach(P=>{a.getSenders()[C]?(a.getSenders()[C].replaceTrack(P),C++):a.addTrack(P,$)})}else $.getTracks().forEach(C=>{a.addTrack(C,$)})}else if(console.error("[WebRTC] No local stream to add tracks from"),await S(),B){const $=B;$.getTracks().forEach(C=>{a.addTrack(C,$)})}ne.value="connecting",n.value="connecting",M&&console.log("[WebRTC] Creating offer");const T=await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1});return M&&console.log("[WebRTC] Setting local description"),await a.setLocalDescription(T),o.value&&t&&(M&&console.log("[WebRTC] Sending immediate offer using Trickle ICE"),o.value.emit("voice-offer",{offer:a.localDescription,to:t}),o.value.emit("webrtc-signal",{type:"offer",offer:a.localDescription,to:t})),X(a),Y(),M&&console.log("[WebRTC] Offer creation complete"),{success:!0}}catch(a){return console.error("[WebRTC] Error creating offer:",a),re=`Error creating offer: ${a}`,oe=!1,{error:`Failed to create offer: ${a}`}}finally{setTimeout(()=>{oe=!1},2e3)}},w=t=>t.iceGatheringState==="complete"?(console.log("[WebRTC] ICE gathering already complete"),Promise.resolve()):new Promise(a=>{const T=()=>{t.iceGatheringState==="complete"&&(t.removeEventListener("icegatheringstatechange",T),a())};t.addEventListener("icegatheringstatechange",T),setTimeout(()=>{t.removeEventListener("icegatheringstatechange",T),console.log("[WebRTC] ICE gathering timed out, but continuing anyway"),a()},1e3)}),j=async(t,a)=>{if(!o.value){console.error("[WebRTC] Cannot handle offer: socket not available");return}console.log("[WebRTC] Received offer from:",a),console.log("[WebRTC] Offer SDP:",t.sdp),Ee.value=a,s.value=a;try{B||(M&&console.log("[WebRTC] Initializing local stream before handling offer"),await S());const T=_();if(B&&(T.getSenders().length===0?(M&&console.log("[WebRTC] Adding local tracks to connection"),B.getTracks().forEach(P=>{T.addTrack(P,B)})):M&&console.log("[WebRTC] Senders already exist, not adding tracks again")),ne.value="connecting",n.value="connecting",M&&console.log("[WebRTC] Setting remote description (offer)"),await T.setRemoteDescription(new RTCSessionDescription(t)),be.length>0){M&&console.log(`[WebRTC] Adding ${be.length} pending ICE candidates`);for(const C of be)try{await T.addIceCandidate(C)}catch(P){console.error("[WebRTC] Error adding pending ICE candidate:",P)}be=[]}M&&console.log("[WebRTC] Creating answer");const $=await T.createAnswer({offerToReceiveAudio:!0});M&&console.log("[WebRTC] Answer SDP:",$.sdp),M&&console.log("[WebRTC] Setting local description (answer)"),await T.setLocalDescription($),T.getTransceivers().forEach(C=>{if(C.receiver.track.kind==="audio"&&(console.log("[WebRTC] Ensuring audio transceiver is set to receive"),C.direction!=="sendrecv"&&C.direction!=="recvonly"))try{C.direction="sendrecv"}catch(P){console.error("[WebRTC] Could not update transceiver direction:",P)}}),await w(T),M&&console.log("[WebRTC] Sending answer to:",a),o.value.emit("voice-answer",{answer:T.localDescription,to:a}),o.value.emit("webrtc-signal",{type:"answer",answer:T.localDescription,to:a}),X(T),Y(),M&&console.log("[WebRTC] Offer handling and answer creation complete")}catch(T){console.error("[WebRTC] Error handling offer:",T),re=`Error handling offer: ${T}`,setTimeout(()=>{o.value&&s.value&&(console.log("[WebRTC] Re-negotiating after offer error"),m(s.value))},2e3)}},G=async t=>{try{if(!h){M&&console.log("[WebRTC] Cannot handle answer: no peer connection available");return}const a=h.signalingState;if(M&&console.log(`[WebRTC] Current signaling state before handling answer: ${a}`),a==="have-local-offer"){M&&console.log("[WebRTC] Setting remote description from answer");try{await h.setRemoteDescription(new RTCSessionDescription(t)),M&&console.log("[WebRTC] Remote description set successfully, signaling state now: "+h.signalingState)}catch(T){if(console.error("[WebRTC] Error setting remote description:",T),T.toString().includes("InvalidStateError"))if(console.warn("[WebRTC] Invalid state error, attempting to recover"),await new Promise($=>setTimeout($,1e3)),h.signalingState==="have-local-offer")try{M&&console.log("[WebRTC] Retrying set remote description after delay"),await h.setRemoteDescription(new RTCSessionDescription(t)),M&&console.log("[WebRTC] Remote description set successfully on retry")}catch($){console.error("[WebRTC] Final error setting remote description:",$)}else console.warn(`[WebRTC] Cannot set remote answer, wrong state: ${h.signalingState}`)}}else console.warn(`[WebRTC] Cannot set remote description: wrong signaling state: ${a}`),a==="stable"?M&&console.log("[WebRTC] Already in stable state, ignoring answer"):a==="have-remote-offer"&&(console.warn("[WebRTC] We have a remote offer but received an answer - signaling confusion"),ae<_e&&(ae++,M&&console.log(`[WebRTC] Resetting connection due to signaling confusion (${ae}/${_e})`),g(),setTimeout(()=>{s.value&&m(s.value)},2e3)))}catch(a){console.error("[WebRTC] Error handling answer:",a),re=`Error handling answer: ${a}`,console.log("[WebRTC] Attempting to recover from answer error"),ae<_e&&await x()}},q=async()=>{if(!We.value)return console.log("[WebRTC] Muting microphone - stopping all tracks"),B&&(B.getAudioTracks().forEach(a=>{a.stop()}),B=null,A.value=null),We.value=!0,!1;console.log("[WebRTC] Unmuting microphone - requesting new permission");try{B&&(B.getTracks().forEach(T=>T.stop()),B=null,A.value=null);const a=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:!1});if(a.getAudioTracks().length===0)throw new Error("No audio tracks available");if(B=a,A.value=a,h&&a)try{const $=h.getSenders().find(C=>C.track&&C.track.kind==="audio");if($){const C=a.getAudioTracks()[0];C&&$.replaceTrack(C)}else a.getAudioTracks().length>0&&a.getAudioTracks().forEach(C=>{h&&h.addTrack(C,a)})}catch(T){console.error("[WebRTC] Error adding audio tracks:",T)}return We.value=!1,!0}catch(a){console.error("[WebRTC] Error unmuting microphone:",a);try{const T=await navigator.mediaDevices.getUserMedia({audio:!0});return B=T,A.value=T,We.value=!1,!0}catch(T){return console.error("[WebRTC] Fallback microphone access also failed:",T),!1}}},g=()=>{if(console.log("[WebRTC] Closing connection"),D(),h){try{h.ontrack=null,h.onicecandidate=null,h.oniceconnectionstatechange=null,h.onicegatheringstatechange=null,h.onsignalingstatechange=null,h.onconnectionstatechange=null;try{h.getTransceivers&&h.getTransceivers().forEach(t=>{t.stop&&t.stop()})}catch{}h.close(),M&&console.log("[WebRTC] Peer connection closed")}catch(t){console.error("[WebRTC] Error closing peer connection:",t)}h=null}U&&(U.getTracks().forEach(t=>{t.stop()}),U=new MediaStream,i.value=U),ne.value="closed",n.value="closed"},y=()=>{console.log("[WebRTC] Full cleanup initiated"),g(),B&&(console.log("[WebRTC] Stopping local stream tracks"),B.getTracks().forEach(t=>{t.stop()}),B=null,A.value=null),console.log("[WebRTC] Cleanup complete")};function b(){if(!o.value){console.log("[WebRTC] No socket available, cannot set up listeners");return}console.log("[WebRTC] Setting up socket listeners"),o.value.off("webrtc-signal"),o.value.off("ice-candidate"),o.value.off("partner-disconnected"),o.value.off("webrtc-connection-failed"),o.value.off("connection-timeout"),o.value.off("webrtc-connection-state"),o.value.off("voice-offer"),o.value.off("voice-answer"),o.value.on("webrtc-signal",async t=>{if(console.log(`[WebRTC] Received ${t.type} signal from ${t.from}`),Ee.value=t.from,s.value=t.from,t.type==="offer"&&t.offer)try{await j(t.offer,t.from)}catch(a){console.error("[WebRTC] Error handling offer:",a),re=`Error handling offer: ${a}`,o.value&&o.value.emit("webrtc-connection-failed",{to:t.from,reason:`Failed to handle offer: ${a}`})}else if(t.type==="answer"&&t.answer)try{await G(t.answer)}catch(a){console.error("[WebRTC] Error handling answer:",a),re=`Error handling answer: ${a}`,o.value&&o.value.emit("webrtc-connection-failed",{to:t.from,reason:`Failed to handle answer: ${a}`})}}),o.value.on("ice-candidate",async t=>{if(console.log(`[WebRTC] Received ICE candidate from ${t.from}`),t.from!==s.value){console.log("[WebRTC] Ignoring ICE candidate from different partner");return}try{await fe(t.candidate)}catch(a){console.error("[WebRTC] Error handling ICE candidate:",a),re=`Error handling ICE candidate: ${a}`}}),o.value.on("webrtc-connection-failed",t=>{console.log(`[WebRTC] Connection failed notification from ${t.from}: ${t.reason}`),ae<_e?(ae++,console.log(`[WebRTC] Partner reported connection failure. Retry ${ae}/${_e}`),t.from===s.value&&setTimeout(()=>{s.value&&o.value&&m(t.from)},ia)):(ne.value="failed",re=`Partner reported failure: ${t.reason}`)}),o.value.on("partner-disconnected",(t={})=>{console.log("[WebRTC] Partner disconnected event:",t),g(),D(),mt(),Ee.value=null,s.value=null,ne.value="closed",n.value="closed",t&&t.reason&&console.log(`[WebRTC] Disconnection reason: ${t.reason}`),console.log("[WebRTC] WebRTC connection fully closed due to partner disconnection")}),o.value.on("webrtc-connection-state",t=>{console.log(`[WebRTC] Received connection state update from partner: ${t.state} (reason: ${t.reason})`),(t.state==="failed"||t.state==="closed"||t.state==="disconnected")&&(t.state==="failed"||t.state==="closed"?(Ue("failed"),h&&h.connectionState!=="closed"&&(console.log("[WebRTC] Closing local connection due to remote state:",t.state),g())):console.log("[WebRTC] Partner connection state is disconnected, waiting to see if it recovers"))})}b(),Ge(()=>{l.value=null,A.value=null,i.value=null});function F(){if(!h||!U)return console.log("[WebRTC] Cannot fix tracks: missing connection or stream"),!1;console.log("[WebRTC] Checking and fixing tracks");const t=h.getSenders();if(t.length===0&&B)console.log("[WebRTC] No senders found, re-adding local tracks"),B.getTracks().forEach(T=>{h==null||h.addTrack(T,B)});else if(t.length>0&&B){console.log(`[WebRTC] Found ${t.length} senders, checking state`);const T=B.getTracks();t.forEach($=>{if($.track&&$.track.readyState!=="live"){const C=T.find(P=>{var me;return P.kind===((me=$.track)==null?void 0:me.kind)});C&&(console.log("[WebRTC] Replacing inactive track with active one"),$.replaceTrack(C))}})}const a=h.getReceivers();if(a.length>0){console.log(`[WebRTC] Found ${a.length} receivers`);let T=!1;a.forEach($=>{$.track&&$.track.kind==="audio"&&(T=!0,!(U!=null&&U.getTracks().some(P=>{var me;return P.id===((me=$.track)==null?void 0:me.id)}))&&U&&(console.log("[WebRTC] Adding missing track to remote stream"),U.addTrack($.track)))}),T||console.log("[WebRTC] No audio receivers found!")}L(),I()}function I(){var T;if(console.log("[WebRTC] ðŸ” Diagnosing audio connection issues"),!h)return console.log("[WebRTC] ðŸ”´ No peer connection exists"),!1;console.log(`[WebRTC] Connection state: ${h.connectionState}`),console.log(`[WebRTC] ICE connection state: ${h.iceConnectionState}`),console.log(`[WebRTC] Signaling state: ${h.signalingState}`);const t=h.getReceivers();console.log(`[WebRTC] Connection has ${t.length} receivers`);let a=!1;if(h.getStats().then($=>{$.forEach(C=>{C.type==="inbound-rtp"&&C.kind==="audio"&&(console.log("[WebRTC] Audio receiver stats:",C),C.packetsReceived===0||C.bytesReceived===0?console.log("[WebRTC] ðŸ”´ Warning: No audio packets received!"):console.log(`[WebRTC] âœ… Receiving audio: ${C.packetsReceived} packets, ${C.bytesReceived} bytes`))})}).catch($=>console.error("[WebRTC] Error getting stats:",$)),t.forEach(($,C)=>{const P=$.track;P&&P.kind==="audio"&&(a=!0,console.log(`[WebRTC] Audio receiver ${C} - Track: ${P.label}, enabled: ${P.enabled}, muted: ${P.muted}, readyState: ${P.readyState}`),(!P.enabled||P.muted)&&(console.log("[WebRTC] ðŸŸ  Found disabled/muted audio track, enabling it"),P.enabled=!0),P.onmute=()=>{console.log("[WebRTC] Track muted event - automatically unmuting"),P.enabled=!0},P.onended=()=>{console.log("[WebRTC] Track ended event - attempting to recreate connection"),!ze&&h&&h.connectionState==="connected"&&x()})}),!a){console.log("[WebRTC] ðŸ”´ No audio receivers found. Remote party may not be sending audio.");const $=h.getTransceivers();let C=!1;$.forEach(P=>{if(console.log(`[WebRTC] Transceiver direction: ${P.direction}, currentDirection: ${P.currentDirection}`),P.direction==="sendonly"||P.direction==="inactive")try{console.log("[WebRTC] ðŸŸ  Fixing transceiver direction to sendrecv"),P.direction="sendrecv",C=!0}catch(me){console.error("[WebRTC] Error updating transceiver direction:",me)}}),C&&!oe&&(console.log("[WebRTC] Triggering renegotiation after fixing transceivers"),Z()),h.connectionState==="connected"&&(console.log("[WebRTC] ðŸŸ  Connection is established but no audio receivers. Checking SDP parameters..."),!oe&&s.value&&(console.log("[WebRTC] Trying to recover audio by sending refresh signal"),(T=o.value)==null||T.emit("webrtc-signal",{type:"refresh-tracks",to:s.value})))}if(B){const $=B.getAudioTracks();console.log(`[WebRTC] Local stream has ${$.length} audio tracks`),$.length===0?(console.log("[WebRTC] ðŸ”´ No local audio tracks! Trying to reinitialize microphone..."),S().then(()=>{h&&h.connectionState==="connected"&&(console.log("[WebRTC] Added new local audio tracks, restarting connection"),Z())}).catch(C=>console.error("[WebRTC] Failed to reinitialize local stream:",C))):$.forEach((C,P)=>{console.log(`[WebRTC] Local audio track ${P}: ${C.label}, enabled: ${C.enabled}, muted: ${C.muted}, readyState: ${C.readyState}`),!C.enabled&&!We.value&&(console.log("[WebRTC] ðŸŸ  Local track disabled but not muted by user, enabling it"),C.enabled=!0)})}else console.log("[WebRTC] ðŸ”´ No local stream available");if(U){const $=U.getAudioTracks();if(console.log(`[WebRTC] Remote stream has ${$.length} audio tracks`),$.forEach((C,P)=>{console.log(`[WebRTC] Remote audio track ${P}: ${C.label}, enabled: ${C.enabled}, muted: ${C.muted}, readyState: ${C.readyState}`),(!C.enabled||C.muted)&&(console.log("[WebRTC] ðŸŸ  Found disabled remote audio track, enabling it"),C.enabled=!0),C.readyState!=="live"&&(console.log("[WebRTC] ðŸ”´ Remote track not live! ReadyState:",C.readyState),h&&Array.from(h.getReceivers()).find(he=>he.track&&he.track.id===C.id)||(console.log("[WebRTC] Remote track not found in receivers, attempting to recreate connection"),h&&h.connectionState==="connected"&&!oe&&Z()))}),$.length===0){console.log("[WebRTC] ðŸ”´ No audio tracks in remote stream. Checking for receivers...");const C=h?Array.from(h.getReceivers()).filter(P=>P.track&&P.track.kind==="audio"):[];C.length>0&&(console.log("[WebRTC] Found audio receivers but they are not in remote stream. Adding them now."),C.forEach(P=>{P.track&&U&&(console.log("[WebRTC] Adding track from receiver to remote stream:",P.track.id),U.addTrack(P.track))}),i.value=U)}}else if(h&&h.getReceivers().length>0){console.log("[WebRTC] ðŸ”´ No remote stream but receivers exist! Creating new remote stream"),U=new MediaStream;const $=Array.from(h.getReceivers()).filter(C=>C.track&&C.track.kind==="audio");$.length>0&&$.forEach(C=>{C.track&&U&&(console.log("[WebRTC] Adding track to new remote stream:",C.track.id),U.addTrack(C.track))}),i.value=U}else console.log("[WebRTC] ðŸ”´ No remote stream or receivers available");return setTimeout(()=>{const $=document.querySelectorAll("audio");$.length>0&&U&&(console.log(`[WebRTC] Found ${$.length} audio elements, ensuring they use remote stream`),Array.from($).forEach((C,P)=>{C.srcObject!==U&&(console.log(`[WebRTC] Audio element ${P} not using correct stream, updating`),C.srcObject=U,C.muted=!1,C.volume=1,C.play().catch(me=>console.log("[WebRTC] Error playing audio:",me)))}))},100),setTimeout(F,3e3),!0}async function x(){if(!(!h||!s.value)){console.log("[WebRTC] Attempting connection recovery");try{if(ze=!0,Fe===At?(Fe=Ct,console.log("[WebRTC] Switching to fast configuration for quicker connection")):ae>5&&(Fe=wt,console.log("[WebRTC] Switching to TURN-only configuration")),h.restartIce){h.restartIce();const t=await h.createOffer({iceRestart:!0,offerToReceiveAudio:!0});await h.setLocalDescription(t),o.value&&(o.value.emit("offer",{offer:h.localDescription,to:s.value}),o.value.emit("webrtc-signal",{type:"offer",offer:h.localDescription,to:s.value}))}setTimeout(()=>{ze=!1},500)}catch(t){console.error("[WebRTC] Recovery attempt failed:",t),ze=!1,ae<_e&&setTimeout(()=>{g(),s.value&&m(s.value)},200)}}}function L(){typeof window<"u"&&(window.__webrtc_debug={connectionState:ne.value,connectionRetryCount:ae,lastConnectionError:re,failureReason:Ce,isNegotiating:oe,isRestartingIce:ze,pendingCandidates:be.length,hasLocalTracks:B?B.getAudioTracks().length>0:!1,hasRemoteTracks:U?U.getAudioTracks().length>0:!1})}ce(()=>ne.value,()=>{L()});function Y(){De&&clearInterval(De),typeof window<"u"&&(window.__localIceCandidates=[],window.__remoteIceCandidates=[],window.__iceCandidatePairs=[]),h&&(h.onicecandidate=t=>{t.candidate&&(console.log("[WebRTC] ICE candidate generated:",t.candidate.candidate),typeof window<"u"&&(window.__localIceCandidates=window.__localIceCandidates||[],window.__localIceCandidates.push({candidate:t.candidate.candidate,timestamp:Date.now()})),o.value&&s.value&&(console.log("[WebRTC] Sending ICE candidate to partner"),o.value.emit("ice-candidate",{candidate:t.candidate,to:s.value})))}),De=window.setInterval(async()=>{if(!h||ne.value!=="connecting"&&ne.value!=="connected"){D();return}try{const t=await Pt();t&&t.iceCandidatePairs&&typeof window<"u"&&(window.__iceCandidatePairs=t.iceCandidatePairs),W(t)}catch(t){console.error("[WebRTC] Error monitoring connection:",t)}},ra)}function D(){De&&(clearInterval(De),De=null)}function W(t){if(!t||t.error)return;const a=!t.media||t.media.length===0||!t.media.some($=>$.kind==="audio"&&$.audioLevel>0),T=!t.selectedCandidatePair||t.selectedCandidatePair.state!=="succeeded";(a||T)&&(console.log("[WebRTC] Connection health issues detected, trying to fix..."),F(),ne.value==="connected"&&ae<_e&&(ae++,console.log(`[WebRTC] Attempting connection improvement (${ae}/${_e})`),h&&h.getTransceivers&&h.getTransceivers().forEach($=>{$.sender&&$.sender.track&&$.sender.track.kind==="audio"&&$.sender.setParameters({...$.sender.getParameters(),degradationPreference:"maintain-framerate"})})))}function X(t){if(!s.value)return;window.__webrtcConnectionTimeout&&clearTimeout(window.__webrtcConnectionTimeout);const a=5e3;window.__webrtcConnectionTimeout=setTimeout(()=>{(t.connectionState==="connecting"||t.connectionState==="new")&&(console.log(`[WebRTC] Connection not established after ${a/1e3} seconds, trying fast config`),Fe=Ct,s.value&&!oe&&m(s.value),window.__webrtcConnectionTimeout=setTimeout(()=>{var T,$,C;if(t.connectionState==="connecting"||t.connectionState==="new"){console.log("[WebRTC] Connection still not established, trying TURN-only config");const P={localCandidates:((T=window.__localIceCandidates)==null?void 0:T.length)||0,remoteCandidates:(($=window.__remoteIceCandidates)==null?void 0:$.length)||0,iceCandidatePairsCount:((C=window.__iceCandidatePairs)==null?void 0:C.length)||0};console.log("[WebRTC] Connection diagnostic info:",JSON.stringify(P)),Fe=wt,g(),s.value&&setTimeout(()=>{m(s.value)},200)}},5e3))},a)}const fe=async t=>{if(!h){console.log("[WebRTC] Received ICE candidate but no peer connection exists");return}try{if(M&&console.log("[WebRTC] Adding received ICE candidate:",t.candidate),window.__remoteIceCandidates||(window.__remoteIceCandidates=[]),window.__remoteIceCandidates.push(t),!h.remoteDescription||!h.localDescription){M&&console.log("[WebRTC] Delaying ICE candidate addition until descriptions are set"),setTimeout(async()=>{if(h&&h.remoteDescription){M&&console.log("[WebRTC] Adding delayed ICE candidate after timeout");try{await h.addIceCandidate(t)}catch(a){console.error("[WebRTC] Error adding delayed ICE candidate:",a)}}},1e3);return}await h.addIceCandidate(t),M&&console.log("[WebRTC] Successfully added ICE candidate")}catch(a){console.error("[WebRTC] Error adding ICE candidate:",a),re=`Error adding ICE candidate: ${a}`,setTimeout(async()=>{if(h&&h.remoteDescription){console.log("[WebRTC] Retrying to add ICE candidate after error");try{await h.addIceCandidate(t),M&&console.log("[WebRTC] Successfully added ICE candidate on retry")}catch(T){console.error("[WebRTC] Error adding ICE candidate on retry:",T)}}},2e3)}};function Z(){if(!h||!s.value||oe){console.log("[WebRTC] Cannot start negotiation: missing connection, partner ID, or already negotiating");return}console.log("[WebRTC] Starting new negotiation"),oe=!0;try{h.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1}).then(t=>{if(h)return h.setLocalDescription(t)}).then(()=>{!h||!o.value||!s.value||(o.value.emit("voice-offer",{offer:h.localDescription,to:s.value}),M&&console.log("[WebRTC] Sent renegotiation offer"))}).catch(t=>{console.error("[WebRTC] Error during negotiation:",t)}).finally(()=>{setTimeout(()=>{oe=!1},2e3)})}catch(t){console.error("[WebRTC] Failed to start negotiation:",t),oe=!1}}const ee={connectionState:ne.value,iceCandidatesGenerated:be.length,localStreamActive:!!B&&B.active,remoteStreamActive:!!U&&U.active,localTracks:B?B.getAudioTracks().length:0,remoteTracks:U?U.getAudioTracks().length:0,connectionRetries:ae,lastError:re||Ce||"",isAudioMuted:We.value,forceReconnect:()=>h&&ne.value!=="new"?(x(),!0):!1};return{socket:o,peerConnection:l,remoteStream:i,localStream:A,connectionState:n,isAudioMuted:c,partnerId:s,createOffer:m,handleOffer:j,handleAnswer:G,handleIceCandidate:fe,toggleMicrophone:q,closeConnection:g,initializeLocalStream:S,cleanup:y,diagnosticReport:ee}}function ua(o){return o.signalingState==="stable"||o.signalingState==="have-remote-offer"}function Ue(o){ne.value!==o&&(console.log(`[WebRTC] Connection state changing from ${ne.value} to ${o}`),ne.value=o,o==="connected"||o==="completed"?(Ce="",re="",ae=0,console.log("[WebRTC] Connection established successfully")):(o==="failed"||o==="disconnected")&&(console.warn(`[WebRTC] Connection ${o}: ${Ce||"Unknown reason"}`),o==="failed"&&(ae++,console.log(`[WebRTC] Connection failure count: ${ae}/${_e}`))))}function da(){const o="test";try{return localStorage.setItem(o,o),localStorage.removeItem(o),!0}catch(k){return console.error("localStorage is not available:",k),!1}}function va(){const o=p(da());function k(n,c){if(!o.value){console.warn("localStorage is not available, cannot set item");return}try{localStorage.setItem(n,c)}catch(s){console.error("Failed to set localStorage item:",s)}}function l(n){if(!o.value)return console.warn("localStorage is not available, cannot get item"),null;try{return localStorage.getItem(n)}catch(c){return console.error("Failed to get localStorage item:",c),null}}function A(n){if(!o.value){console.warn("localStorage is not available, cannot remove item");return}try{localStorage.removeItem(n)}catch(c){console.error("Failed to remove localStorage item:",c)}}function i(){if(!o.value){console.warn("localStorage is not available, cannot clear storage");return}try{localStorage.clear()}catch(n){console.error("Failed to clear localStorage:",n)}}return{isAvailable:o,setItem:k,getItem:l,removeItem:A,clear:i}}const le=p({}),Ye=p(null),Se=p({}),Ze=p(!1),vt=!0;let Tt=!1;function ga(){const{socket:o,userId:k}=Ae(),l=va();Tt?console.log("[ChatService] Using existing chat service instance"):(console.log("[ChatService] Initializing chat service"),A(),Tt=!0);function A(){i(),j(),ce(le,()=>{w()},{deep:!0}),ce(()=>o.value,g=>{g&&!Ze.value&&(console.log("[ChatService] Socket reconnected, setting up listeners again"),i())})}function i(){if(!o.value){console.log("[ChatService] No socket available, cannot set up listeners");return}Ze.value&&(console.log("[ChatService] Removing existing chat-message listener"),o.value.off("chat-message"),Ze.value=!1),console.log("[ChatService] Setting up chat-message listener"),o.value.on("chat-message",g=>{console.log("[ChatService] Received chat message:",g);const y=g.from,b=m(y);console.log(`[ChatService] Conversation key: ${b}, current partner: ${Ye.value}`),le.value[b]||(le.value[b]=[]),le.value[b].push({sender:"partner",text:g.text,timestamp:g.timestamp||Date.now()}),y!==Ye.value&&(Se.value[y]=!0,console.log(`[ChatService] Marked message from ${y} as unread`)),w(),console.log("[ChatService] Updated messages:",le.value[b])}),Ze.value=!0,console.log("[ChatService] Chat message listener setup complete")}function n(g){console.log(`[ChatService] Setting current partner: ${g}`),Ye.value=g,g&&(Se.value[g]=!1)}function c(g,y=null){const b=y||Ye.value;if(!b||!g.trim()||!o.value)return console.log(`[ChatService] Cannot send message: partnerId=${b}, text=${g.trim()?"present":"empty"}, socket=${o.value?"present":"not present"}`),!1;console.log(`[ChatService] Sending message to ${b}: ${g}`);const F=m(b);le.value[F]||(le.value[F]=[]);const I=Date.now();return le.value[F].push({sender:"me",text:g.trim(),timestamp:I}),o.value.emit("chat-message",{text:g.trim(),to:b}),console.log("[ChatService] Message sent, current messages:",le.value[F]),!0}function s(g){if(!g)return[];const y=m(g),b=le.value[y]||[];return console.log(`[ChatService] Getting messages for ${g}, found ${b.length} messages`),b}function S(g){if(!g)return!1;const y=!!Se.value[g];return console.log(`[ChatService] Checking unread for ${g}: ${y}`),y}function _(g){g&&(console.log(`[ChatService] Marking messages as read for ${g}`),Se.value[g]=!1)}function m(g){if(!k.value)return g;const y=[k.value,g].sort();return`${y[0]}_${y[1]}`}function w(){if(!l.isAvailable.value){console.log("[ChatService] localStorage not available, cannot save chats");return}try{l.setItem("chat_messages",JSON.stringify(le.value)),l.setItem("chat_unread",JSON.stringify(Se.value)),vt&&console.log("[ChatService] Saved chats to localStorage")}catch(g){console.error("[ChatService] Failed to save chats:",g)}}function j(){if(!l.isAvailable.value){console.log("[ChatService] localStorage not available, cannot load chats");return}try{const g=l.getItem("chat_messages");g&&(le.value=JSON.parse(g),vt&&console.log("[ChatService] Loaded messages from localStorage:",Object.keys(le.value).length,"conversations"));const y=l.getItem("chat_unread");y&&(Se.value=JSON.parse(y),vt&&console.log("[ChatService] Loaded unread status from localStorage"))}catch(g){console.error("[ChatService] Failed to load chats:",g)}}function G(g){if(!g)return;const y=m(g);le.value[y]&&(le.value[y]=[],w(),console.log(`[ChatService] Cleared chat for ${g}`))}function q(){le.value={},Se.value={},w(),console.log("[ChatService] Cleared all chats")}return{messages:le,unreadMessages:Se,currentPartnerId:Ye,setCurrentPartner:n,sendMessage:c,getMessages:s,hasUnreadMessages:S,markAsRead:_,clearChat:G,clearAllChats:q}}const Qe="/assets/Circle-e098ae42.png",fa={class:"bg-white/5 backdrop-blur-sm rounded-2xl p-4 sm:p-6 text-center border border-white/10"},ma={key:"disconnected"},pa={key:"searching"},ba={key:"matched"},ya={class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},ha={key:0,class:"flex items-center justify-center gap-2 text-gray-300"},xa={class:"text-lg sm:text-xl"},wa={class:"text-xs sm:text-sm font-medium"},Ca={key:"connected"},ka={class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},Ta={key:0,class:"flex items-center justify-center gap-2 text-gray-300"},_a={class:"text-lg sm:text-xl"},$a={class:"text-xs sm:text-sm font-medium"},Ra={key:0,class:"mt-3 sm:mt-4 text-xs"},Sa={class:"flex items-center justify-center gap-1 sm:gap-2"},Ia={class:"text-gray-300"},Wa={key:0,class:"text-red-400 mt-1 text-xs"},Ea=ye({__name:"connection-card",props:{status:{type:String,default:"disconnected"},partnerInfo:{type:Object,default:null},errorMessage:{type:String,default:""},showStatus:{type:Boolean,default:!0}},setup(o){const k=o,l=p(k.status);ce(()=>k.status,(_,m)=>{l.value=m});const A=ie(()=>l.value==="disconnected"&&k.status==="searching"?"idle-to-search":l.value==="searching"&&k.status==="matched"?"search-to-match":l.value==="matched"&&k.status==="connected"?"match-to-connect":k.status==="disconnected"?"to-idle":"fade"),i=_=>{},n=(_,m)=>{},c=_=>{},s=ie(()=>{switch(k.status){case"searching":return"Searching...";case"matched":return"Partner found, connecting...";case"connected":return"Connected";default:return"Disconnected"}}),S=_=>{switch(_.toLowerCase()){case"any":return"Go With the Flow";case"chill":return"Chill";case"fun":return"Fun";case"curious":return"Curious";case"creative":return"Creative";default:return _}};return(_,m)=>(d(),v("div",fa,[$e(Vt,{name:A.value,mode:"out-in",onBeforeLeave:i,onEnter:n,onAfterEnter:c},{default:Yt(()=>{var w,j;return[o.status==="disconnected"?(d(),v("div",ma,m[0]||(m[0]=[e("div",{class:"status-container"},[e("div",{class:"status-circle"},[e("img",{src:Qe,alt:"Connection Circle",class:"circle-image"}),e("div",{class:"thin-ring idle-ring"})])],-1),e("h2",{class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},"Ready to Connect",-1),e("p",{class:"text-xs sm:text-sm text-gray-300"},'Press "Next" to find someone to talk with',-1)]))):o.status==="searching"?(d(),v("div",pa,m[1]||(m[1]=[e("div",{class:"status-container"},[e("div",{class:"status-circle"},[e("img",{src:Qe,alt:"Connection Circle",class:"circle-image pulse-effect"}),e("div",{class:"thin-ring search-ring"})])],-1),e("h2",{class:"text-base sm:text-lg font-semibold mb-1 sm:mb-2 text-white"},"Searching...",-1),e("p",{class:"text-xs sm:text-sm text-gray-300"},"Looking for someone to talk to",-1)]))):o.status==="matched"?(d(),v("div",ba,[m[2]||(m[2]=e("div",{class:"status-container"},[e("div",{class:"status-circle"},[e("img",{src:Qe,alt:"Connection Circle",class:"circle-image fast-rotate"}),e("div",{class:"thin-ring match-ring"})])],-1)),e("h2",ya,R((w=o.partnerInfo)!=null&&w.vibe?S(o.partnerInfo.vibe):"Match Found!"),1),o.partnerInfo?(d(),v("div",ha,[e("span",xa,R(o.partnerInfo.flag||"ðŸŒ"),1),e("span",wa,R(o.partnerInfo.country),1)])):H("",!0),m[3]||(m[3]=e("p",{class:"text-xs sm:text-sm text-yellow-400 mt-1 sm:mt-2"},"Setting up voice connection...",-1))])):o.status==="connected"?(d(),v("div",Ca,[m[4]||(m[4]=e("div",{class:"status-container"},[e("div",{class:"status-circle"},[e("img",{src:Qe,alt:"Connection Circle",class:"circle-image"}),e("div",{class:"thin-ring connect-ring"})])],-1)),e("h2",ka,R((j=o.partnerInfo)!=null&&j.vibe?S(o.partnerInfo.vibe):"Connected!"),1),o.partnerInfo?(d(),v("div",Ta,[e("span",_a,R(o.partnerInfo.flag||"ðŸŒ"),1),e("span",$a,R(o.partnerInfo.country),1)])):H("",!0),m[5]||(m[5]=e("p",{class:"text-xs sm:text-sm text-green-400 mt-1 sm:mt-2"},"You can talk now",-1))])):H("",!0)]}),_:1},8,["name"]),o.showStatus&&o.status!=="disconnected"?(d(),v("div",Ra,[e("div",Sa,[e("span",{class:V({"text-green-400":o.status==="connected","text-yellow-400":o.status==="matched","text-blue-400":o.status==="searching"})},"â—",2),e("span",Ia,R(s.value),1)]),o.errorMessage?(d(),v("p",Wa,R(o.errorMessage),1)):H("",!0)])):H("",!0)]))}});const Ie=(o,k)=>{const l=o.__vccOpts||o;for(const[A,i]of k)l[A]=i;return l},Aa=Ie(Ea,[["__scopeId","data-v-e5241095"]]),Pa={class:"space-y-2 sm:space-y-3 md:space-y-4 px-1 sm:px-2"},ja={class:"flex justify-center items-center gap-2 sm:gap-3 md:gap-4"},Ma=["disabled"],Oa={class:"relative"},Na={key:0,class:"text-white text-base sm:text-lg md:text-xl"},Da={key:1,class:"text-white text-base sm:text-lg md:text-xl"},Fa={key:2,class:"absolute -top-1 -right-1 w-2 h-2 sm:w-3 sm:h-3 bg-yellow-300 rounded-full animate-pulse"},Ga=["disabled"],La={class:"flex flex-wrap justify-center gap-1 sm:gap-2 md:gap-3"},Ba=ye({__name:"control-buttons",props:{isMuted:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!0}},emits:["toggle-mute","find-next","toggle-chat","toggle-games","toggle-history","toggle-donation"],setup(o,{emit:k}){const l=k,A=p(!1);function i(){A.value||(A.value=!0,l("toggle-mute"),setTimeout(()=>{A.value=!1},200),setTimeout(()=>{try{const n=document.querySelector("audio");n&&n.paused&&n.play().catch(c=>{console.warn("Could not auto-play audio after mute toggle:",c)})}catch(n){console.error("Error trying to auto-play:",n)}},300))}return(n,c)=>(d(),v("div",Pa,[e("div",ja,[e("button",{onClick:i,class:V(["w-11 h-11 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center transition-all shadow-xl transform hover:scale-110",o.isMuted?"bg-gradient-to-r from-red-400 to-pink-400 shadow-red-400/70":"bg-gradient-to-r from-emerald-400 to-green-400 hover:from-green-400 hover:to-emerald-400 shadow-emerald-400/70"]),disabled:A.value},[e("div",Oa,[o.isMuted?(d(),v("span",Da,"ðŸ”‡")):(d(),v("span",Na,"ðŸŽ¤")),A.value?(d(),v("span",Fa)):H("",!0)])],10,Ma),e("button",{onClick:c[0]||(c[0]=s=>n.$emit("find-next")),class:"w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-gradient-to-r from-orange-400 to-yellow-400 hover:from-yellow-400 hover:to-orange-400 rounded-full flex items-center justify-center shadow-2xl shadow-orange-400/80 transition-all transform hover:scale-110"},c[5]||(c[5]=[e("span",{class:"text-white text-xl sm:text-2xl md:text-3xl"},"ðŸ“ž",-1)])),e("button",{onClick:c[1]||(c[1]=s=>n.$emit("toggle-chat")),disabled:o.isDisabled,class:V(["w-11 h-11 sm:w-14 sm:h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center shadow-xl transition-all transform hover:scale-110",o.isDisabled?"bg-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-blue-400 to-cyan-400 hover:from-cyan-400 hover:to-blue-400 shadow-blue-400/70"])},c[6]||(c[6]=[e("span",{class:"text-white text-base sm:text-lg md:text-xl"},"ðŸ’¬",-1)]),10,Ga)]),e("div",La,[e("button",{onClick:c[2]||(c[2]=s=>n.$emit("toggle-games")),class:"bg-gradient-to-r from-purple-400 to-pink-400 hover:from-pink-400 hover:to-purple-400 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-purple-400/70 transition-all transform hover:scale-110 whitespace-nowrap"}," ðŸŽ® Games "),e("button",{onClick:c[3]||(c[3]=s=>n.$emit("toggle-history")),class:"bg-gradient-to-r from-indigo-400 to-blue-400 hover:from-blue-400 hover:to-indigo-400 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-indigo-400/70 transition-all transform hover:scale-110 whitespace-nowrap"}," ðŸ“ž History "),e("button",{onClick:c[4]||(c[4]=s=>n.$emit("toggle-donation")),class:"bg-gradient-to-r from-yellow-400 to-orange-400 hover:from-orange-400 hover:to-yellow-400 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 md:px-4 md:py-2 text-xs md:text-sm shadow-xl shadow-yellow-400/70 transition-all animate-pulse transform hover:scale-110 whitespace-nowrap"}," â¤ï¸ Support ")])]))}}),za={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Ua={class:"bg-gray-900 rounded-lg w-full max-w-md mx-auto h-[80vh] flex flex-col"},Ya={class:"flex items-center justify-between p-4 border-b border-gray-700"},Va={key:0,class:"h-full flex items-center justify-center text-gray-500"},qa={key:1,class:"space-y-2"},Ha={class:"flex justify-between gap-2"},Ja={class:"text-xs text-gray-400"},Ka={class:"mt-1 text-white break-words"},Xa={class:"p-3 border-t border-gray-700"},Za=["disabled"],Qa=["disabled"],eo=ye({__name:"chat-modal",props:{isOpen:{type:Boolean,default:!1},isConnected:{type:Boolean,default:!1},messages:{type:Array,default:()=>[]}},emits:["close","send-message"],setup(o,{emit:k}){const l=o,A=k,i=p(""),n=p(null),c=()=>{i.value.trim()&&l.isConnected&&(A("send-message",i.value),i.value="")},s=async()=>{await St(),n.value&&(n.value.scrollTop=n.value.scrollHeight)},S=_=>new Date(_).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return ce(()=>l.messages,()=>{s()},{deep:!0}),ce(()=>l.isOpen,_=>{_&&s()}),Re(()=>{l.isOpen&&s()}),(_,m)=>o.isOpen?(d(),v("div",za,[e("div",Ua,[e("div",Ya,[m[2]||(m[2]=e("div",{class:"flex items-center"},[e("span",{class:"text-white text-lg font-medium"},"ðŸ’¬ Chat")],-1)),e("button",{onClick:m[0]||(m[0]=w=>_.$emit("close")),class:"text-gray-400 hover:text-white"}," âœ• ")]),e("div",{class:"flex-1 p-4 overflow-y-auto",ref_key:"messagesContainerRef",ref:n},[o.messages.length===0?(d(),v("div",Va,m[3]||(m[3]=[e("div",{class:"text-center"},[e("p",null,"No messages yet"),e("p",{class:"text-sm mt-1"},"Send a message to start the conversation")],-1)]))):(d(),v("div",qa,[(d(!0),v(de,null,ve(o.messages,w=>(d(),v("div",{key:w.id,class:V(["rounded-lg p-3 max-w-[80%]",w.isOwn?"bg-blue-700 ml-auto":"bg-gray-700 mr-auto"])},[e("div",Ha,[e("span",{class:V(["text-sm",w.isOwn?"text-blue-200":"text-gray-200"])},R(w.isOwn?"You":"Partner"),3),e("span",Ja,R(S(w.timestamp)),1)]),e("p",Ka,R(w.message),1)],2))),128))]))],512),e("div",Xa,[e("form",{onSubmit:qt(c,["prevent"]),class:"flex gap-2"},[et(e("input",{"onUpdate:modelValue":m[1]||(m[1]=w=>i.value=w),type:"text",placeholder:"Type a message...",class:"flex-1 bg-gray-800 border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!o.isConnected},null,8,Za),[[ft,i.value]]),e("button",{type:"submit",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",disabled:!o.isConnected||!i.value.trim()}," Send ",8,Qa)],32)])])])):H("",!0)}}),to={class:"w-full p-2"},ao={class:"flex justify-between items-center mb-4"},oo={key:0,class:"text-yellow-300 animate-pulse"},no={key:1},lo={key:2},so={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 mb-4"},ro={class:"mb-4 text-center"},io={class:"flex items-center justify-center gap-4"},co={class:"text-center"},uo={class:"grid grid-cols-3 gap-3 mb-4"},vo=["onClick","disabled"],go={key:0,class:"text-blue-400"},fo={key:1,class:"text-green-400"},mo={key:0,class:"text-center mt-4 animate__animated animate__fadeIn"},po={key:1,class:"text-center mt-4"},bo={class:"flex justify-between"},_t=3e4,yo=ye({__name:"TicTacToe",props:{partnerId:{type:String,required:!0},isFirstPlayer:{type:Boolean,default:!0}},emits:["back","error"],setup(o,{emit:k}){const l=o,A=k,{socket:i}=Ae(),n=p("waiting"),c=p(["","","","","","","","",""]),s=p(l.isFirstPlayer?"X":"O"),S=p(l.isFirstPlayer?"O":"X"),_=p("X"),m=p(null),w=p(null),j=p(Date.now()),G=ie(()=>_.value===s.value),q=I=>{var x;if(!(n.value!=="playing"||c.value[I]!==""||!G.value||m.value!==null))try{c.value[I]=s.value,_.value=S.value,j.value=Date.now(),(x=i.value)==null||x.emit("game-move",{gameType:"tic-tac-toe",move:I,to:l.partnerId}),g(),F()}catch{b("Failed to make a move. Please try again.")}},g=()=>{const I=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const x of I){const[L,Y,D]=x;if(c.value[L]&&c.value[L]===c.value[Y]&&c.value[L]===c.value[D]){m.value=c.value[L],n.value="finished",w.value&&(clearTimeout(w.value),w.value=null);return}}c.value.includes("")||(m.value="tie",n.value="finished",w.value&&(clearTimeout(w.value),w.value=null))},y=()=>{var I;try{c.value=["","","","","","","","",""],_.value="X",m.value=null,n.value="playing",j.value=Date.now(),(I=i.value)==null||I.emit("game-reset",{gameType:"tic-tac-toe",to:l.partnerId}),F()}catch{b("Failed to reset the game. Please try again.")}},b=I=>{console.error(`Tic-Tac-Toe Error: ${I}`),A("error",I)},F=()=>{w.value&&clearTimeout(w.value),n.value==="playing"&&!m.value&&(w.value=window.setTimeout(()=>{Date.now()-j.value>_t&&(b("Connection with your partner appears to be lost. The game will be closed."),A("back"))},_t))};return ce(()=>l.isFirstPlayer,I=>{s.value=I?"X":"O",S.value=I?"O":"X",I||(n.value="playing")}),Re(()=>{var I,x,L;try{(I=i.value)==null||I.on("game-partner-joined",Y=>{Y.from===l.partnerId&&Y.gameType==="tic-tac-toe"&&(console.log("Partner joined the game!",Y),n.value="playing",j.value=Date.now(),F())}),(x=i.value)==null||x.on("game-move",Y=>{if(Y.from===l.partnerId&&Y.gameType==="tic-tac-toe"){const D=Y.move;typeof D=="number"&&D>=0&&D<9&&c.value[D]===""?(c.value[D]=S.value,_.value=s.value,j.value=Date.now(),g(),F()):b("Received invalid move from partner.")}}),(L=i.value)==null||L.on("game-reset",Y=>{Y.from===l.partnerId&&Y.gameType==="tic-tac-toe"&&(c.value=["","","","","","","","",""],_.value="X",m.value=null,n.value="playing",j.value=Date.now(),F())}),l.isFirstPlayer||(n.value="playing")}catch{b("Failed to initialize game connection.")}}),Ge(()=>{var I,x,L;(I=i.value)==null||I.off("game-partner-joined"),(x=i.value)==null||x.off("game-move"),(L=i.value)==null||L.off("game-reset"),w.value&&(clearTimeout(w.value),w.value=null)}),(I,x)=>(d(),v("div",to,[e("div",ao,[x[1]||(x[1]=e("h2",{class:"text-xl font-bold text-purple-400"},"Tic Tac Toe",-1)),e("div",{class:V(["text-white text-sm px-3 py-1 rounded-full",{"bg-yellow-600/30":n.value==="waiting","bg-green-600/30":G.value&&n.value==="playing","bg-red-600/30":!G.value&&n.value==="playing","bg-purple-600/30":m.value}])},[n.value==="waiting"?(d(),v("span",oo," Waiting for partner... ")):m.value?(d(),v("span",no,R(m.value===s.value?"You Won! ðŸŽ‰":m.value==="tie"?"It's a Tie! ðŸ¤":"You Lost! ðŸ˜¢"),1)):(d(),v("span",lo,R(G.value?"Your Turn":"Partner's Turn"),1))],2)]),e("div",so,[e("div",{class:V(["flex flex-col items-center",{"opacity-70":n.value==="waiting"||!G.value&&!m.value}])},[e("div",ro,[e("div",io,[e("div",{class:V([{"ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800":s.value==="X"},"w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-lg font-bold"])}," X ",2),e("div",co,[x[2]||(x[2]=e("p",{class:"text-gray-300 text-sm"},"You are",-1)),e("p",{class:V(["font-bold text-lg",{"text-blue-400":s.value==="X","text-green-400":s.value==="O"}])},R(s.value),3)]),e("div",{class:V([{"ring-2 ring-purple-500 ring-offset-2 ring-offset-gray-800":s.value==="O"},"w-10 h-10 rounded-full bg-green-600 flex items-center justify-center text-lg font-bold"])}," O ",2)])]),e("div",uo,[(d(!0),v(de,null,ve(c.value,(L,Y)=>(d(),v("button",{key:Y,onClick:D=>q(Y),disabled:L!==""||!G.value||m.value!==null||n.value==="waiting",class:V(["w-20 h-20 rounded-lg flex items-center justify-center text-3xl font-bold transition-all duration-300",{"bg-gray-700 hover:bg-gray-600":L===""&&G.value&&!m.value&&n.value!=="waiting","bg-gray-700/50":L===""&&(!G.value||m.value!==null||n.value==="waiting"),"bg-blue-600/20":L==="X","bg-green-600/20":L==="O","cursor-not-allowed":L!==""||!G.value||m.value!==null||n.value==="waiting","hover:bg-purple-700/50":G.value&&L===""&&!m.value&&n.value==="playing"}])},[L==="X"?(d(),v("span",go,"X")):L==="O"?(d(),v("span",fo,"O")):H("",!0)],10,vo))),128))]),m.value?(d(),v("div",mo,[e("button",{onClick:y,class:"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg text-sm transition-colors mb-2"}," Play Again ")])):H("",!0),n.value==="waiting"?(d(),v("div",po,x[3]||(x[3]=[e("div",{class:"bg-yellow-600/20 rounded-lg p-4 animate-pulse"},[e("p",{class:"text-yellow-300 mb-1"},"Waiting for your partner to join..."),e("p",{class:"text-sm text-gray-300"},[ge("You'll play as "),e("span",{class:"font-bold text-blue-400"},"X")])],-1)]))):H("",!0)],2)]),e("div",bo,[e("button",{onClick:x[0]||(x[0]=L=>I.$emit("back")),class:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors"}," Back to Games ")])]))}});const ho=Ie(yo,[["__scopeId","data-v-98a0628f"]]),xo={class:"w-full p-2"},wo={class:"flex justify-between items-center mb-4"},Co={key:0,class:"text-yellow-300 animate-pulse flex items-center"},ko={key:1,class:"flex items-center"},To={key:2,class:"flex items-center"},_o={key:3,class:"flex items-center"},$o={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 md:p-6 mb-4 border border-gray-700/50 shadow-xl"},Ro={class:"flex justify-center items-center gap-4 md:gap-8 mb-6 w-full"},So={class:"text-center p-2 bg-blue-900/20 rounded-lg backdrop-blur-sm border border-blue-800/30 min-w-[70px]"},Io={class:"text-2xl font-bold text-blue-400"},Wo={class:"text-center px-4 py-2 bg-gray-700/50 rounded-lg border border-gray-600/30"},Eo={class:"text-xl font-bold text-white"},Ao={class:"text-center p-2 bg-green-900/20 rounded-lg backdrop-blur-sm border border-green-800/30 min-w-[70px]"},Po={class:"text-2xl font-bold text-green-400"},jo={class:"w-full mb-4"},Mo={key:0,class:"flex flex-col items-center mb-6 animate__animated animate__fadeIn"},Oo={class:"flex justify-center items-center gap-6 md:gap-10 mb-6"},No={class:"text-center"},Do={class:"text-center"},Fo={key:1,class:"animate__animated animate__fadeIn"},Go={class:"text-center mb-6"},Lo={class:"inline-block px-3 py-1 rounded-full bg-gray-700/70 text-sm text-gray-300 mb-2"},Bo={class:"flex justify-center items-center gap-3 md:gap-6"},zo=["onClick"],Uo={class:"text-4xl mb-2"},Yo={class:"text-xs text-gray-300"},Vo={key:2,class:"text-center"},qo={key:3,class:"text-center"},Ho={class:"flex justify-between"},$t=10,Jo=ye({__name:"RockPaperScissors",props:{partnerId:{type:String,required:!0},partnerReady:{type:Boolean,default:!1}},emits:["back","error"],setup(o,{emit:k}){const l=o,A=k,{socket:i}=Ae(),n=[{value:"rock",name:"Rock",emoji:"ðŸ‘Š"},{value:"paper",name:"Paper",emoji:"âœ‹"},{value:"scissors",name:"Scissors",emoji:"âœŒï¸"}],c=p("waiting"),s=p(null),S=p(null),_=p(0),m=p(0),w=p(1),j=p(null),G=p($t),q=p(null),g=ie(()=>j.value==="win"?"You Win!":j.value==="lose"?"You Lose!":j.value==="tie"?"It's a Tie!":""),y=D=>{if(!D)return"â“";const W=n.find(X=>X.value===D);return W?W.emoji:"â“"},b=()=>{var D;c.value="choosing",s.value=null,S.value=null,j.value=null,L(),(D=i.value)==null||D.emit("game-start-round",{gameType:"rock-paper-scissors",to:l.partnerId,round:w.value})},F=D=>{var W;s.value=D,(W=i.value)==null||W.emit("game-move",{gameType:"rock-paper-scissors",move:{choice:D,round:w.value},to:l.partnerId}),S.value&&I()},I=()=>{!s.value||!S.value||(Y(),c.value="result",s.value===S.value?j.value="tie":s.value==="rock"&&S.value==="scissors"||s.value==="paper"&&S.value==="rock"||s.value==="scissors"&&S.value==="paper"?(j.value="win",_.value++):(j.value="lose",m.value++),w.value++)},x=()=>{b()},L=()=>{G.value=$t,q.value&&clearInterval(q.value),q.value=window.setInterval(()=>{if(G.value--,G.value<=0&&(Y(),!s.value)){const D=Math.floor(Math.random()*n.length);F(n[D].value)}},1e3)},Y=()=>{q.value&&(clearInterval(q.value),q.value=null)};return Re(()=>{var D,W,X,fe,Z;l.partnerReady&&(c.value="ready"),(D=i.value)==null||D.on("game-move",ee=>{ee.from===l.partnerId&&ee.gameType==="rock-paper-scissors"&&(S.value=ee.move.choice,s.value&&I())}),(W=i.value)==null||W.on("game-start-round",ee=>{ee.from===l.partnerId&&ee.gameType==="rock-paper-scissors"&&(c.value="choosing",s.value=null,S.value=null,j.value=null,w.value=ee.round,L())}),(X=i.value)==null||X.on("game-partner-joined",ee=>{ee.from===l.partnerId&&(c.value="ready")}),(fe=i.value)==null||fe.on("game-partner-left",()=>{c.value="waiting",Y(),A("error","Your partner has left the game.")}),(Z=i.value)==null||Z.on("game-reset",ee=>{ee.from===l.partnerId&&ee.gameType==="rock-paper-scissors"&&(_.value=0,m.value=0,w.value=1,c.value="ready")})}),Ge(()=>{var D,W,X,fe,Z;Y(),(D=i.value)==null||D.off("game-move"),(W=i.value)==null||W.off("game-start-round"),(X=i.value)==null||X.off("game-partner-joined"),(fe=i.value)==null||fe.off("game-partner-left"),(Z=i.value)==null||Z.off("game-reset")}),(D,W)=>(d(),v("div",xo,[e("div",wo,[W[5]||(W[5]=e("h2",{class:"text-xl font-bold text-purple-400"},[e("span",{class:"hidden sm:inline"},"Rock Paper Scissors"),e("span",{class:"sm:hidden"},"RPS Game")],-1)),e("div",{class:V(["text-white text-sm px-3 py-1 rounded-full backdrop-blur-sm shadow-lg",{"bg-yellow-600/40 border border-yellow-500/30":c.value==="waiting","bg-green-600/40 border border-green-500/30":c.value==="ready","bg-blue-600/40 border border-blue-500/30":c.value==="choosing","bg-purple-600/40 border border-purple-500/30":c.value==="result"}])},[c.value==="waiting"?(d(),v("span",Co,W[1]||(W[1]=[e("span",{class:"inline-block w-2 h-2 bg-yellow-400 rounded-full mr-2 animate-ping"},null,-1),ge(" Waiting... ")]))):c.value==="ready"?(d(),v("span",ko,W[2]||(W[2]=[e("span",{class:"inline-block w-2 h-2 bg-green-400 rounded-full mr-2"},null,-1),ge(" Ready! ")]))):c.value==="choosing"?(d(),v("span",To,W[3]||(W[3]=[e("span",{class:"inline-block w-2 h-2 bg-blue-400 rounded-full mr-2"},null,-1),ge(" Choose ")]))):c.value==="result"?(d(),v("span",_o,[W[4]||(W[4]=e("span",{class:"inline-block w-2 h-2 bg-purple-400 rounded-full mr-2"},null,-1)),ge(" "+R(g.value),1)])):H("",!0)],2)]),e("div",$o,[e("div",{class:V(["flex flex-col items-center",{"opacity-70":c.value==="waiting"}])},[e("div",Ro,[e("div",So,[W[6]||(W[6]=e("div",{class:"text-sm text-gray-300 mb-1"},"You",-1)),e("div",Io,R(_.value),1)]),e("div",Wo,[W[7]||(W[7]=e("div",{class:"text-sm text-gray-300"},"Round",-1)),e("div",Eo,R(w.value),1)]),e("div",Ao,[W[8]||(W[8]=e("div",{class:"text-sm text-gray-300 mb-1"},"Partner",-1)),e("div",Po,R(m.value),1)])]),e("div",jo,[c.value==="result"?(d(),v("div",Mo,[e("div",Oo,[e("div",No,[e("div",{class:V(["w-20 h-20 md:w-24 md:h-24 bg-blue-500/20 rounded-full flex items-center justify-center text-4xl md:text-5xl mb-2 shadow-lg border border-blue-400/30 transform transition-all",{"scale-110 ring-2 ring-blue-400 ring-opacity-50":j.value==="win"}])},R(y(s.value)),3),W[9]||(W[9]=e("div",{class:"text-sm text-blue-400"},"You",-1))]),W[11]||(W[11]=e("div",{class:"text-2xl font-bold text-white bg-gray-700/50 rounded-full h-10 w-10 flex items-center justify-center"},"VS",-1)),e("div",Do,[e("div",{class:V(["w-20 h-20 md:w-24 md:h-24 bg-green-500/20 rounded-full flex items-center justify-center text-4xl md:text-5xl mb-2 shadow-lg border border-green-400/30 transform transition-all",{"scale-110 ring-2 ring-green-400 ring-opacity-50":j.value==="lose"}])},R(y(S.value)),3),W[10]||(W[10]=e("div",{class:"text-sm text-green-400"},"Partner",-1))])]),e("div",{class:V(["text-xl font-bold mb-4 py-2 px-4 rounded-lg",{"bg-yellow-500/10 text-yellow-400 border border-yellow-500/30":j.value==="tie","bg-green-500/10 text-green-400 border border-green-500/30":j.value==="win","bg-red-500/10 text-red-400 border border-red-500/30":j.value==="lose"}])},R(g.value),3),e("button",{onClick:x,class:"mt-2 px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"}," Play Again ")])):c.value==="choosing"?(d(),v("div",Fo,[e("div",Go,[W[13]||(W[13]=e("p",{class:"text-lg text-white mb-1"},"Choose your move:",-1)),e("div",Lo,[W[12]||(W[12]=ge(" Time: ")),e("span",{class:V(["font-mono text-white",{"text-red-400":G.value<=3}])},R(G.value)+"s",3)])]),e("div",Bo,[(d(),v(de,null,ve(n,X=>e("button",{key:X.value,onClick:fe=>F(X.value),class:V(["w-[90px] h-[90px] md:w-24 md:h-24 rounded-lg flex flex-col items-center justify-center transition-all shadow-lg hover:shadow-xl",{"bg-blue-600/30 border border-blue-500/30 scale-105":s.value===X.value,"bg-gray-800/80 border border-gray-700/50 hover:bg-gray-700/70 hover:scale-105 active:scale-95":s.value!==X.value}])},[e("span",Uo,R(X.emoji),1),e("span",Yo,R(X.name),1)],10,zo)),64))])])):c.value==="waiting"?(d(),v("div",Vo,W[14]||(W[14]=[ke('<div class="bg-yellow-600/20 rounded-lg p-4 border border-yellow-500/30 shadow-lg animate-pulse" data-v-a877cce4><div class="w-16 h-16 mx-auto mb-3 relative" data-v-a877cce4><div class="absolute inset-0 bg-yellow-500/20 rounded-full animate-ping" data-v-a877cce4></div><div class="absolute inset-2 bg-yellow-500/30 rounded-full animate-ping animation-delay-300" data-v-a877cce4></div><div class="absolute inset-4 bg-yellow-500/40 rounded-full animate-ping animation-delay-600" data-v-a877cce4></div><div class="absolute inset-0 flex items-center justify-center" data-v-a877cce4><span class="text-2xl" data-v-a877cce4>ðŸ‘¥</span></div></div><p class="text-yellow-300 mb-1 font-medium" data-v-a877cce4>Waiting for your partner to join...</p><p class="text-sm text-gray-300" data-v-a877cce4>Game will start automatically</p></div>',1)]))):c.value==="ready"?(d(),v("div",qo,[W[15]||(W[15]=ke('<div class="bg-green-600/20 rounded-lg p-4 border border-green-500/30 shadow-lg mb-4" data-v-a877cce4><div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center bg-green-500/30 rounded-full" data-v-a877cce4><span class="text-2xl" data-v-a877cce4>ðŸŽ®</span></div><p class="text-lg text-white mb-1" data-v-a877cce4>Both players are ready!</p><p class="text-sm text-gray-300 mb-4" data-v-a877cce4>Prepare for an epic battle</p></div>',1)),e("button",{onClick:b,class:"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"}," Start Game ")])):H("",!0)])],2)]),e("div",Ho,[e("button",{onClick:W[0]||(W[0]=X=>D.$emit("back")),class:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95"}," Back to Games ")])]))}});const Ko=Ie(Jo,[["__scopeId","data-v-a877cce4"]]),Xo={class:"w-full p-2",dir:"auto"},Zo={class:"flex justify-between items-center mb-4"},Qo={key:0,class:"text-yellow-300 animate-pulse flex items-center"},en={key:1,class:"flex items-center"},tn={key:2,class:"flex items-center"},an={key:3,class:"flex items-center"},on={class:"bg-gray-800/60 backdrop-blur-sm rounded-lg p-4 md:p-6 mb-4 border border-gray-700/50 shadow-xl"},nn={class:"flex justify-center items-center gap-4 md:gap-8 mb-6 w-full"},ln={class:"text-center p-2 bg-blue-900/20 rounded-lg backdrop-blur-sm border border-blue-800/30 min-w-[80px]"},sn={class:"text-2xl font-bold text-blue-400"},rn={key:0,class:"text-center px-4 py-2 bg-gray-700/50 rounded-lg border border-gray-600/30"},cn={class:"text-center p-2 bg-green-900/20 rounded-lg backdrop-blur-sm border border-green-800/30 min-w-[80px]"},un={class:"text-2xl font-bold text-green-400"},dn={class:"text-center p-2 bg-purple-900/20 rounded-lg backdrop-blur-sm border border-purple-800/30 min-w-[80px]"},vn={class:"text-2xl font-bold text-purple-400"},gn={class:"w-full mb-4"},fn={key:0,class:"animate__animated animate__fadeIn"},mn={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},pn={class:"mb-4"},bn=["dir","disabled"],yn={key:0,class:"text-xs text-red-400 mt-1"},hn={key:1,class:"text-xs text-gray-400 mt-1"},xn={class:"mb-4"},wn={class:"flex gap-2"},Cn={class:"text-center"},kn=["disabled"],Tn={key:1,class:"animate__animated animate__fadeIn"},_n={key:2,class:"animate__animated animate__fadeIn"},$n={class:"mb-6"},Rn={class:"bg-gray-700/50 rounded-lg p-4 shadow-inner mb-4"},Sn={class:"flex justify-between items-center mb-2"},In={class:"text-xs text-gray-400"},Wn=["dir"],En={class:"mb-4"},An={class:"flex gap-2"},Pn=["dir","maxlength"],jn=["disabled"],Mn={key:0,class:"text-xs text-red-400 mt-1"},On={key:1,class:"text-xs text-gray-400 mt-1"},Nn={class:"bg-gray-700/30 rounded-lg p-3 max-h-28 overflow-y-auto"},Dn={key:0,class:"text-gray-400 italic text-sm"},Fn={class:"text-gray-400 w-5"},Gn=["dir"],Ln={key:3,class:"animate__animated animate__fadeIn"},Bn={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},zn={class:"flex justify-between items-center mb-2"},Un=["dir"],Yn=["dir"],Vn={class:"mt-4 text-sm text-gray-300"},qn={key:0},Hn={class:"mt-2"},Jn={class:"bg-gray-700/30 rounded-lg p-3 max-h-36 overflow-y-auto"},Kn={key:0,class:"text-gray-400 italic text-sm"},Xn={class:"text-gray-400 w-5"},Zn=["dir"],Qn={key:4,class:"animate__animated animate__fadeIn"},el={class:"text-center mb-6"},tl={class:"w-20 h-20 mx-auto mb-4 flex items-center justify-center bg-purple-500/30 rounded-full"},al={class:"text-3xl"},ol={class:"text-2xl font-bold text-white mb-2"},nl={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},ll={class:"text-2xl font-bold text-purple-400 mb-2",dir:"rtl"},sl={key:0,class:"text-green-400 mt-4"},rl={key:1,class:"text-yellow-400 mt-4"},il={class:"bg-gray-700/50 rounded-lg p-4 mb-4"},cl={class:"flex justify-between items-center"},ul={class:"text-xl font-bold text-green-400"},dl={class:"text-xl font-bold text-blue-400"},vl={key:5,class:"text-center"},gl={class:"mb-4"},fl={key:0,class:"bg-gray-800/60 mt-2 p-4 rounded-lg border border-gray-700 text-sm text-gray-300 animate__animated animate__fadeIn"},ml=ye({__name:"WordGalaxy",props:{partnerId:{type:String,required:!0},partnerReady:{type:Boolean,default:!1}},emits:["back","error"],setup(o,{emit:k}){const l=o,A=k,{socket:i,userId:n}=Ae(),c=p(!1),s=p(""),S=p(""),_=p("waiting"),m=p(!1),w=p(""),j=p(0),G=p([]),q=p([]),g=p(0),y=p("medium"),b=p(""),F=p([]),I=p(0),x=p(!1),L=p(0),Y=p("Watching you set up the game..."),D=p(0),W=p(0),X=p(1),fe=p([]),Z=p(0),ee=p(null),t=p(!1),a={easy:{attempts:10,time:60,multiplier:1},medium:{attempts:8,time:45,multiplier:1.5},hard:{attempts:6,time:30,multiplier:2}},T=O=>/[\u0600-\u06FF]/.test(O),$=O=>/^[a-zA-Z\u0600-\u06FF]+$/.test(O),C=ie(()=>w.value&&T(w.value)?"rtl":"ltr"),P=()=>{if(s.value="",w.value.length>0&&w.value.length<3){s.value="The word must be at least 3 letters";return}w.value.length>0&&!$(w.value)&&(w.value=w.value.replace(/[^a-zA-Z\u0600-\u06FF]/g,""),s.value="Only Arabic or English letters are allowed")},me=()=>{if(S.value="",b.value.length>0&&b.value.length!==j.value){S.value=`The word must be ${j.value} letters long`;return}b.value.length>0&&!$(b.value)&&(b.value=b.value.replace(/[^a-zA-Z\u0600-\u06FF]/g,""),S.value="Only Arabic or English letters are allowed")},he=ie(()=>a[y.value].attempts),tt=ie(()=>a[y.value].time),at=ie(()=>he.value-I.value),Pe=ie(()=>w.value.length>=3&&w.value.length<=15&&$(w.value)&&!s.value),ot=()=>{var O;Pe.value&&(w.value=w.value.trim(),(O=i.value)==null||O.emit("game-word-setup",{gameType:"word-galaxy",to:l.partnerId,wordLength:w.value.length,difficulty:y.value}),_.value="guessing",j.value=w.value.length,Ve())},Ve=()=>{G.value=Array(j.value).fill("_"),q.value=[],g.value=0},nt=()=>{ee.value&&clearInterval(ee.value),Z.value=tt.value,t.value=!0,ee.value=window.setInterval(()=>{var O;Z.value--,Z.value<=0&&(Te(),m.value||(_.value="complete",x.value=!1,(O=i.value)==null||O.emit("game-move",{gameType:"word-galaxy",move:{type:"timeout"},to:l.partnerId})))},1e3)},Te=()=>{ee.value&&(clearInterval(ee.value),ee.value=null)},Le=()=>{var f,z;if(!b.value||b.value.length!==j.value)return;if(!$(b.value)){b.value=b.value.replace(/[^a-zA-Z\u0600-\u06FF]/g,""),S.value="Only Arabic or English letters are allowed";return}const O=b.value.trim();S.value="",(f=i.value)==null||f.emit("game-move",{gameType:"word-galaxy",move:{type:"guess",word:O},to:l.partnerId}),b.value="",I.value++,I.value>=he.value&&(_.value="complete",x.value=!1,Te(),(z=i.value)==null||z.emit("game-move",{gameType:"word-galaxy",move:{type:"out-of-attempts"},to:l.partnerId}))},qe=O=>{var pe;const f=w.value,z=O;let K=0;const te=[...q.value];if(T(f))for(let Q=0;Q<f.length;Q++)z[Q]===f[Q]&&(K++,te.includes(Q)||te.push(Q));else for(let Q=0;Q<f.length;Q++)z[Q]===f[Q]&&(K++,te.includes(Q)||te.push(Q));if(q.value=te,g.value=te.length,F.value.push({word:z,matches:K}),Y.value=`Made guess: "${z}" (${K} matches)`,K<f.length){const Q=10*a[y.value].multiplier;W.value+=Math.round(Q)}(pe=i.value)==null||pe.emit("game-guess-result",{gameType:"word-galaxy",to:l.partnerId,result:{word:f,originalGuess:z,matches:K,revealedPositions:te,isCorrect:K===f.length,creatorEarnedPoints:K<f.length?Math.round(10*a[y.value].multiplier):0}}),K===f.length&&(G.value=f.split(""),g.value=j.value,_.value="complete",x.value=!1,w.value=f,Te(),je())},He=O=>{F.value.push({word:O.originalGuess||b.value,matches:O.matches}),O.creatorEarnedPoints&&(W.value+=O.creatorEarnedPoints);for(let f=0;f<j.value;f++)O.revealedPositions.includes(f)&&(G.value[f]=O.word[f]);g.value=O.revealedPositions.length,O.isCorrect&&(G.value=O.word.split(""),g.value=j.value,_.value="complete",x.value=!0,w.value=O.word,Te(),je())},je=()=>{var O,f;if(x.value){if(!m.value){const K=a[y.value].multiplier,te=(he.value-I.value)*5,xe=Math.round(Z.value/3),pe=Math.round((50+te+xe)*K);D.value+=pe,(O=i.value)==null||O.emit("game-score-update",{gameType:"word-galaxy",to:l.partnerId,guesserScore:D.value,creatorScore:W.value})}}else if(m.value){const K=a[y.value].multiplier,te=Math.round(30*K);W.value+=te,(f=i.value)==null||f.emit("game-score-update",{gameType:"word-galaxy",to:l.partnerId,guesserScore:D.value,creatorScore:W.value})}fe.value.push({creator:m.value&&!x.value?Math.round(30*a[y.value].multiplier):0,guesser:!m.value&&x.value?Math.round((50+(he.value-I.value)*5+Math.round(Z.value/3))*a[y.value].multiplier):0})},Be=O=>O===0?"bg-red-500/30 text-red-300":O===j.value?"bg-green-500/30 text-green-300":O>=j.value/2?"bg-yellow-500/30 text-yellow-300":"bg-blue-500/30 text-blue-300",lt=()=>{var f;_.value="setup",w.value="",G.value=[],q.value=[],g.value=0,b.value="",F.value=[],I.value=0,x.value=!1,L.value=0,t.value=!1,X.value++;const O=m.value;m.value=!O,console.log(`Play Again clicked: Round ${X.value}, Swapping roles - I was ${O?"creator":"guesser"}, now I am ${m.value?"creator":"guesser"}`),(f=i.value)==null||f.emit("game-reset",{gameType:"word-galaxy",to:l.partnerId,swapRoles:!1,shouldBeCreator:!m.value,roundCount:X.value,guesserScore:D.value,creatorScore:W.value})},st=()=>{var O;(O=i.value)==null||O.emit("game-leave-notification",{gameType:"word-galaxy",to:l.partnerId,message:"User left the game but still in the chat"}),A("back")};return Re(()=>{var O,f,z,K,te,xe,pe,Q;if(l.partnerReady&&(_.value="setup",X.value===1)){const N=n.value||"",ue=l.partnerId||"";m.value=N<ue,console.log(`Role assignment: My ID ${N}, Partner ID ${ue}, I am ${m.value?"word creator":"guesser"}`)}(O=i.value)==null||O.on("game-word-setup",N=>{N.from===l.partnerId&&N.gameType==="word-galaxy"&&(j.value=N.wordLength,y.value=N.difficulty,_.value="guessing",m.value=!1,Ve(),nt())}),(f=i.value)==null||f.on("game-score-update",N=>{N.from===l.partnerId&&N.gameType==="word-galaxy"&&(N.guesserScore!==void 0&&(D.value=N.guesserScore),N.creatorScore!==void 0&&(W.value=N.creatorScore))}),(z=i.value)==null||z.on("game-move",N=>{if(N.from===l.partnerId&&N.gameType==="word-galaxy"){const ue=N.move;ue.type==="guess"?qe(ue.word):ue.type==="timeout"?(_.value="complete",x.value=!0,Y.value="Ran out of time!",je()):ue.type==="out-of-attempts"&&(_.value="complete",x.value=!0,Y.value="Ran out of attempts!",je())}}),(K=i.value)==null||K.on("game-guess-result",N=>{N.from===l.partnerId&&N.gameType==="word-galaxy"&&He(N.result)}),(te=i.value)==null||te.on("game-partner-joined",N=>{if(N.from===l.partnerId&&(_.value="setup",X.value===1)){const ue=n.value||"",Je=l.partnerId||"";m.value=ue<Je,console.log(`Partner joined: My ID ${ue}, Partner ID ${Je}, I am ${m.value?"word creator":"guesser"}`)}}),(xe=i.value)==null||xe.on("game-partner-left",()=>{_.value="waiting",Te(),A("error","Your partner has left the game.")}),(pe=i.value)==null||pe.on("game-reset",N=>{if(N.from===l.partnerId&&N.gameType==="word-galaxy"&&(console.log("Received game-reset from partner with data:",JSON.stringify({roundCount:N.roundCount,shouldBeCreator:N.shouldBeCreator})),_.value="setup",w.value="",G.value=[],q.value=[],g.value=0,b.value="",F.value=[],I.value=0,x.value=!1,L.value=0,Te(),t.value=!1,N.roundCount&&(X.value=N.roundCount),N.guesserScore!==void 0&&(D.value=N.guesserScore),N.creatorScore!==void 0&&(W.value=N.creatorScore),N.shouldBeCreator!==void 0)){const ue=m.value;m.value=N.shouldBeCreator,console.log(`Reset from partner: Round ${X.value}, Changing role from ${ue?"creator":"guesser"} to ${m.value?"creator":"guesser"}`)}}),(Q=i.value)==null||Q.on("game-notification",N=>{N.from===l.partnerId&&N.gameType==="word-galaxy"&&console.log(`Game notification from partner: ${N.message}`)})}),Ge(()=>{var O,f,z,K,te,xe,pe,Q;Te(),(O=i.value)==null||O.off("game-word-setup"),(f=i.value)==null||f.off("game-move"),(z=i.value)==null||z.off("game-guess-result"),(K=i.value)==null||K.off("game-score-update"),(te=i.value)==null||te.off("game-partner-joined"),(xe=i.value)==null||xe.off("game-partner-left"),(pe=i.value)==null||pe.off("game-reset"),(Q=i.value)==null||Q.off("game-notification")}),ie(()=>_.value!=="complete"?null:m.value?x.value?"failed":"guessed":x.value?"guessed":"failed"),(O,f)=>(d(),v("div",Xo,[e("div",Zo,[f[10]||(f[10]=e("h2",{class:"text-xl font-bold text-purple-400"},[e("span",{class:"hidden sm:inline"},"Word Galaxy"),e("span",{class:"sm:hidden"},"Word Game")],-1)),e("div",{class:V(["text-white text-sm px-3 py-1 rounded-full backdrop-blur-sm shadow-lg",{"bg-yellow-600/40 border border-yellow-500/30":_.value==="waiting","bg-green-600/40 border border-green-500/30":_.value==="setup","bg-blue-600/40 border border-blue-500/30":_.value==="guessing","bg-purple-600/40 border border-purple-500/30":_.value==="complete"}])},[_.value==="waiting"?(d(),v("span",Qo,f[6]||(f[6]=[e("span",{class:"inline-block w-2 h-2 bg-yellow-400 rounded-full mr-2 animate-ping"},null,-1),ge(" Waiting... ")]))):_.value==="setup"?(d(),v("span",en,f[7]||(f[7]=[e("span",{class:"inline-block w-2 h-2 bg-green-400 rounded-full mr-2"},null,-1),ge(" Setup ")]))):_.value==="guessing"?(d(),v("span",tn,f[8]||(f[8]=[e("span",{class:"inline-block w-2 h-2 bg-blue-400 rounded-full mr-2"},null,-1),ge(" Guessing ")]))):_.value==="complete"?(d(),v("span",an,f[9]||(f[9]=[e("span",{class:"inline-block w-2 h-2 bg-purple-400 rounded-full mr-2"},null,-1),ge(" Complete! ")]))):H("",!0)],2)]),e("div",on,[e("div",{class:V(["flex flex-col items-center",{"opacity-70":_.value==="waiting"}])},[e("div",nn,[e("div",ln,[f[11]||(f[11]=e("div",{class:"text-sm text-gray-300 mb-1"},"Attempts",-1)),e("div",sn,R(I.value)+"/"+R(he.value),1)]),_.value==="guessing"&&!m.value?(d(),v("div",rn,[f[12]||(f[12]=e("div",{class:"text-sm text-gray-300"},"Time",-1)),e("div",{class:V(["text-xl font-bold",{"text-red-400":Z.value<10,"text-yellow-400":Z.value<20,"text-white":Z.value>=20}])},R(Z.value)+"s",3)])):H("",!0),e("div",cn,[f[13]||(f[13]=e("div",{class:"text-sm text-gray-300 mb-1"},"Score",-1)),e("div",un,R(m.value?W.value:D.value),1)]),e("div",dn,[f[14]||(f[14]=e("div",{class:"text-sm text-gray-300 mb-1"},"Round",-1)),e("div",vn,R(X.value),1)])]),e("div",gn,[_.value==="setup"&&m.value?(d(),v("div",fn,[f[17]||(f[17]=ke('<div class="text-center mb-6" data-v-fcb3784a><div class="w-16 h-16 mx-auto mb-3 flex items-center justify-center bg-green-500/30 rounded-full" data-v-fcb3784a><span class="text-2xl" data-v-fcb3784a>ðŸ’¬</span></div><h3 class="text-xl font-bold text-white mb-2" data-v-fcb3784a>Create a Word</h3><p class="text-gray-300 mb-4" data-v-fcb3784a>Enter a word for your partner to guess</p></div>',1)),e("div",mn,[e("div",pn,[f[15]||(f[15]=e("label",{class:"block text-gray-300 text-sm mb-2"},"Your Word:",-1)),et(e("input",{"onUpdate:modelValue":f[0]||(f[0]=z=>w.value=z),dir:T(w.value)?"rtl":"ltr",class:"w-full bg-gray-900 text-white px-4 py-2 rounded border border-gray-600 focus:border-purple-500 focus:outline-none",placeholder:"Enter a word...",maxlength:"15",disabled:_.value!=="setup",onInput:P},null,40,bn),[[ft,w.value]]),s.value?(d(),v("p",yn,R(s.value),1)):(d(),v("p",hn,"The word should be 3-15 letters long"))]),e("div",xn,[f[16]||(f[16]=e("label",{class:"block text-gray-300 text-sm mb-2"},"Difficulty:",-1)),e("div",wn,[e("button",{onClick:f[1]||(f[1]=z=>y.value="easy"),class:V(["flex-1 px-4 py-2 rounded-lg text-sm transition-all",y.value==="easy"?"bg-green-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"])}," Easy ",2),e("button",{onClick:f[2]||(f[2]=z=>y.value="medium"),class:V(["flex-1 px-4 py-2 rounded-lg text-sm transition-all",y.value==="medium"?"bg-yellow-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"])}," Medium ",2),e("button",{onClick:f[3]||(f[3]=z=>y.value="hard"),class:V(["flex-1 px-4 py-2 rounded-lg text-sm transition-all",y.value==="hard"?"bg-red-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"])}," Hard ",2)])])]),e("div",Cn,[e("button",{onClick:ot,class:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:pointer-events-none",disabled:!Pe.value}," Start Game ",8,kn)])])):_.value==="setup"&&!m.value?(d(),v("div",Tn,f[18]||(f[18]=[ke('<div class="text-center mb-6" data-v-fcb3784a><div class="w-16 h-16 mx-auto mb-3 relative" data-v-fcb3784a><div class="absolute inset-0 bg-blue-500/20 rounded-full animate-ping" data-v-fcb3784a></div><div class="absolute inset-2 bg-blue-500/30 rounded-full animate-ping animation-delay-300" data-v-fcb3784a></div><div class="absolute inset-0 flex items-center justify-center" data-v-fcb3784a><span class="text-2xl" data-v-fcb3784a>ðŸ”¤</span></div></div><h3 class="text-xl font-bold text-white mb-2" data-v-fcb3784a>Get Ready!</h3><p class="text-gray-300" data-v-fcb3784a>Your partner is creating a word for you to guess...</p></div><div class="bg-gray-700/50 rounded-lg p-4 mb-4" data-v-fcb3784a><h4 class="font-bold text-white mb-2" data-v-fcb3784a>How to Play:</h4><ul class="text-gray-300 text-sm space-y-2 list-disc pl-4" data-v-fcb3784a><li data-v-fcb3784a>Your partner will create a secret word</li><li data-v-fcb3784a>You&#39;ll see a blurred version of the word</li><li data-v-fcb3784a>Type guesses to reveal more letters</li><li data-v-fcb3784a>You need to guess the word before the timer runs out</li><li data-v-fcb3784a>You win if you guess correctly, your partner wins if you don&#39;t</li></ul></div>',2)]))):_.value==="guessing"&&!m.value?(d(),v("div",_n,[e("div",$n,[e("div",Rn,[e("div",Sn,[f[19]||(f[19]=e("span",{class:"text-sm text-gray-400"},"The Secret Word:",-1)),e("span",In,R(g.value)+"/"+R(j.value)+" letters revealed",1)]),e("div",{class:"flex justify-center gap-1 md:gap-2 flex-wrap",dir:C.value},[(d(!0),v(de,null,ve(G.value,(z,K)=>(d(),v("div",{key:K,class:V(["w-8 h-10 md:w-10 md:h-12 flex items-center justify-center rounded bg-gray-800/80 border text-lg md:text-xl font-bold",z==="_"?"border-gray-700 text-gray-500":"border-purple-500 text-white"])},R(z),3))),128))],8,Wn)]),e("div",En,[f[20]||(f[20]=e("label",{class:"block text-gray-300 text-sm mb-2"},"Your Guess:",-1)),e("div",An,[et(e("input",{"onUpdate:modelValue":f[4]||(f[4]=z=>b.value=z),dir:T(b.value)||T(w.value.value)?"rtl":"ltr",class:"flex-1 bg-gray-900 text-white px-4 py-2 rounded-l border border-gray-600 focus:border-purple-500 focus:outline-none",placeholder:"Type your guess...",maxlength:j.value,onKeyup:Ht(Le,["enter"]),onInput:me},null,40,Pn),[[ft,b.value]]),e("button",{onClick:Le,class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-r transition-all",disabled:!b.value||b.value.length!==j.value}," Submit ",8,jn)]),S.value?(d(),v("p",Mn,R(S.value),1)):(d(),v("p",On,R(at.value)+" attempts remaining ",1))]),e("div",Nn,[F.value.length===0?(d(),v("p",Dn,"Your previous guesses will appear here...")):H("",!0),(d(!0),v(de,null,ve(F.value,(z,K)=>(d(),v("div",{key:K,class:"text-sm flex items-center mb-1"},[e("span",Fn,R(K+1)+".",1),e("span",{dir:T(z.word)||T(w.value.value)?"rtl":"ltr",class:"text-gray-300 mr-2"},R(z.word),9,Gn),e("span",{class:V(["text-xs px-1.5 py-0.5 rounded",Be(z.matches)])},R(z.matches)+" matching ",3)]))),128))])])])):_.value==="guessing"&&m.value?(d(),v("div",Ln,[e("div",Bn,[e("div",zn,[f[21]||(f[21]=e("span",{class:"text-gray-300"},"Your Secret Word:",-1)),e("span",{class:"text-white font-bold",dir:T(w.value)?"rtl":"ltr"},R(w.value),9,Un)]),e("div",{class:"flex justify-center gap-1 md:gap-2 flex-wrap",dir:C.value},[(d(!0),v(de,null,ve(w.value,(z,K)=>(d(),v("div",{key:K,class:V(["w-8 h-10 md:w-10 md:h-12 flex items-center justify-center rounded border border-purple-500 text-lg md:text-xl font-bold",q.value.includes(K)?"bg-purple-600/30 text-white":"bg-gray-800 text-gray-500"])},R(z),3))),128))],8,Yn),e("div",Vn,[t.value?(d(),v("p",qn,[f[22]||(f[22]=e("span",{class:"text-yellow-400 font-bold"},"Time remaining:",-1)),ge(" "+R(Z.value)+"s ",1)])):H("",!0),e("p",Hn,[f[23]||(f[23]=e("span",{class:"text-purple-400 font-bold"},"Status:",-1)),ge(" "+R(Y.value),1)])])]),e("div",Jn,[F.value.length===0?(d(),v("p",Kn,"Partner's guesses will appear here...")):H("",!0),(d(!0),v(de,null,ve(F.value,(z,K)=>(d(),v("div",{key:K,class:"text-sm flex items-center mb-1"},[e("span",Xn,R(K+1)+".",1),e("span",{dir:T(z.word)||T(w.value)?"rtl":"ltr",class:"text-gray-300 mr-2"},R(z.word),9,Zn),e("span",{class:V(["text-xs px-1.5 py-0.5 rounded",Be(z.matches)])},R(z.matches)+" matching ",3)]))),128))])])):_.value==="complete"?(d(),v("div",Qn,[e("div",el,[e("div",tl,[e("span",al,R(x.value?"ðŸŽ‰":"ðŸ”"),1)]),e("h3",ol,R(x.value?"You Won!":"You Lost!"),1),e("div",nl,[f[24]||(f[24]=e("p",{class:"text-gray-300 mb-2"},"The secret word was:",-1)),e("div",ll,R(w.value),1),x.value?(d(),v("p",sl,R(m.value?"Your partner couldn't solve it!":"Solved in "+I.value+" attempts!"),1)):(d(),v("p",rl,R(m.value?"Your partner solved it!":"Better luck next time!"),1))]),e("div",il,[f[27]||(f[27]=e("h4",{class:"text-lg font-bold text-white mb-2"},"Scores",-1)),e("div",cl,[e("div",null,[f[25]||(f[25]=e("p",{class:"text-gray-300"},"You:",-1)),e("p",ul,R(m.value?W.value:D.value),1)]),e("div",null,[f[26]||(f[26]=e("p",{class:"text-gray-300"},"Partner:",-1)),e("p",dl,R(m.value?D.value:W.value),1)])]),f[28]||(f[28]=e("p",{class:"text-xs text-gray-400 mt-2"},"Points are saved until you exit the game",-1))]),e("button",{onClick:lt,class:"px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"}," Play Again ")])])):_.value==="waiting"?(d(),v("div",vl,f[29]||(f[29]=[ke('<div class="bg-yellow-600/20 rounded-lg p-4 border border-yellow-500/30 shadow-lg animate-pulse" data-v-fcb3784a><div class="w-16 h-16 mx-auto mb-3 relative" data-v-fcb3784a><div class="absolute inset-0 bg-yellow-500/20 rounded-full animate-ping" data-v-fcb3784a></div><div class="absolute inset-2 bg-yellow-500/30 rounded-full animate-ping animation-delay-300" data-v-fcb3784a></div><div class="absolute inset-4 bg-yellow-500/40 rounded-full animate-ping animation-delay-600" data-v-fcb3784a></div><div class="absolute inset-0 flex items-center justify-center" data-v-fcb3784a><span class="text-2xl" data-v-fcb3784a>ðŸ‘¥</span></div></div><p class="text-yellow-300 mb-1 font-medium" data-v-fcb3784a>Waiting for your partner to join...</p><p class="text-sm text-gray-300" data-v-fcb3784a>Game will start automatically</p></div>',1)]))):H("",!0)])],2)]),e("div",gl,[e("button",{onClick:f[5]||(f[5]=z=>c.value=!c.value),class:"w-full flex justify-between items-center bg-gray-700/50 hover:bg-gray-700 px-4 py-2 rounded-lg text-white text-sm transition-colors"},[f[30]||(f[30]=e("span",null,"Game Rules & How to Play",-1)),e("span",null,R(c.value?"â–²":"â–¼"),1)]),c.value?(d(),v("div",fl,f[31]||(f[31]=[ke('<h4 class="font-bold text-white mb-2" data-v-fcb3784a>Word Galaxy Rules:</h4><ul class="list-disc pl-4 space-y-2 mb-4" data-v-fcb3784a><li data-v-fcb3784a>One player creates a secret word (3-15 letters)</li><li data-v-fcb3784a>The other player tries to guess the word</li><li data-v-fcb3784a>The guesser can see a blurred version of the word that gradually reveals itself with correct guesses</li><li data-v-fcb3784a>Each guess reveals letters that are in the correct position</li><li data-v-fcb3784a>The guesser has a limited number of attempts and time based on difficulty: <ul class="list-disc pl-4 mt-1" data-v-fcb3784a><li data-v-fcb3784a><span class="text-green-400" data-v-fcb3784a>Easy:</span> 10 attempts, 60 seconds</li><li data-v-fcb3784a><span class="text-yellow-400" data-v-fcb3784a>Medium:</span> 8 attempts, 45 seconds</li><li data-v-fcb3784a><span class="text-red-400" data-v-fcb3784a>Hard:</span> 6 attempts, 30 seconds</li></ul></li><li data-v-fcb3784a>The word creator can give hints verbally through voice chat</li><li data-v-fcb3784a>If the guesser solves the word, they win. If they run out of time or attempts, the word creator wins</li></ul><h4 class="font-bold text-white mb-2" data-v-fcb3784a>Tips:</h4><ul class="list-disc pl-4 space-y-1" data-v-fcb3784a><li data-v-fcb3784a><span class="text-blue-400" data-v-fcb3784a>For the Guesser:</span> Pay attention to revealed letters</li><li data-v-fcb3784a><span class="text-purple-400" data-v-fcb3784a>For the Word Creator:</span> Give helpful but not too obvious hints through voice</li><li data-v-fcb3784a>Work together to have fun!</li></ul>',4)]))):H("",!0)]),e("div",{class:"flex justify-between"},[e("button",{onClick:st,class:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-all shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95"}," Back to Games ")])]))}});const pl=Ie(ml,[["__scopeId","data-v-fcb3784a"]]),bl={key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-2 sm:p-4"},yl={class:"bg-[#1e1e2e] rounded-lg w-full max-w-md mx-auto shadow-2xl relative overflow-hidden"},hl={class:"flex items-center justify-between p-2 sm:p-3 border-b border-gray-800"},xl={key:1,class:"p-3 sm:p-4"},wl={class:"grid grid-cols-2 gap-2 sm:gap-4 mb-3 sm:mb-4"},Cl=["disabled"],kl=["disabled"],Tl=["disabled"],_l={key:2,class:"text-center p-4 sm:p-6"},$l={class:"mb-4"},Rl={class:"text-sm sm:text-base text-gray-300"},Sl={key:3},Il=ye({__name:"games-modal",props:{isOpen:{type:Boolean,default:!1},partnerId:{type:String,required:!0},isConnected:{type:Boolean,default:!1}},emits:["close"],setup(o,{emit:k}){const{socket:l,userId:A}=Ae(),i=o,n=p(null),c=p(null),s=p(!0),S=p(null),_=p(!1),m=p(""),w=g=>{console.log(`[Game Debug] ${g}`),m.value=g},j=g=>{var b;if(!i.isConnected)return;w(`Starting game: ${g} with partner: ${i.partnerId}`),c.value=null,n.value=g,s.value=!0,_.value=!1;const y=[A.value,i.partnerId].sort();S.value=`${g}-${y[0]}-${y[1]}`,w(`Created game room: ${S.value}`),(b=l.value)==null||b.emit("game-join-room",{gameType:g,roomId:S.value,to:i.partnerId,isFirstPlayer:!0})},G=()=>{var g,y;S.value&&i.partnerId&&((g=l.value)==null||g.emit("game-leave-notification",{gameType:n.value||"unknown",to:i.partnerId,message:"Your partner returned to the game menu"}),(y=l.value)==null||y.emit("game-leave-room",{roomId:S.value,to:i.partnerId})),n.value=null,c.value=null,s.value=!0,S.value=null,_.value=!1},q=g=>{c.value=g,w(`Error: ${g}`)};return Re(()=>{var g,y,b,F,I;w("Setting up game events"),(g=l.value)==null||g.on("game-room-invite",x=>{var L;x.from===i.partnerId&&(w(`Received invitation to join game room: ${x.roomId}`),S.value=x.roomId,n.value=x.gameType,s.value=!1,(L=l.value)==null||L.emit("game-join-room",{gameType:x.gameType,roomId:x.roomId,to:i.partnerId,isFirstPlayer:!1}))}),(y=l.value)==null||y.on("game-partner-joined",x=>{x.from===i.partnerId&&(w(`Partner joined the game: ${x.gameType}`),_.value=!0)}),(b=l.value)==null||b.on("game-error",x=>{(x.from==="system"||x.from===i.partnerId)&&(c.value=x.message||"An error occurred in the game.",w(`Game error: ${x.message}`))}),(F=l.value)==null||F.on("game-partner-left",x=>{n.value&&(c.value="Your partner left the game.",w("Partner left the game"),n.value=null)}),(I=l.value)==null||I.on("game-notification",x=>{x.from===i.partnerId&&w(`Notification from partner: ${x.message}`)})}),Ge(()=>{var g,y,b,F,I,x;(g=l.value)==null||g.off("game-room-invite"),(y=l.value)==null||y.off("game-partner-joined"),(b=l.value)==null||b.off("game-error"),(F=l.value)==null||F.off("game-partner-left"),(I=l.value)==null||I.off("game-notification"),S.value&&((x=l.value)==null||x.emit("game-leave-room",{roomId:S.value,to:i.partnerId}))}),ce(()=>i.isOpen,g=>{g||G()}),(g,y)=>o.isOpen?(d(),v("div",bl,[e("div",yl,[e("div",hl,[y[4]||(y[4]=e("div",{class:"flex items-center gap-2"},[e("span",{class:"text-purple-400 text-lg sm:text-xl"},"ðŸŽ®"),e("h2",{class:"text-lg sm:text-xl font-semibold text-[#a881fc]"},"Space Games")],-1)),e("button",{onClick:y[0]||(y[0]=b=>g.$emit("close")),class:"text-gray-400 hover:text-white text-lg"}," âœ• ")]),H("",!0),n.value?c.value?(d(),v("div",_l,[e("div",$l,[y[10]||(y[10]=e("div",{class:"w-12 h-12 sm:w-16 sm:h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-2"},[e("span",{class:"text-xl sm:text-2xl"},"âš ï¸")],-1)),y[11]||(y[11]=e("h3",{class:"text-lg sm:text-xl font-bold mb-2 text-red-400"},"Game Error",-1)),e("p",Rl,R(c.value),1)]),e("button",{onClick:G,class:"px-4 py-2 bg-gray-700 rounded-full hover:bg-gray-600 transition-colors mt-2"}," Back to Games ")])):(d(),v("div",Sl,[n.value==="tic-tac-toe"?(d(),dt(ho,{key:0,partnerId:o.partnerId,isFirstPlayer:s.value,partnerReady:_.value,onBack:G,onError:q},null,8,["partnerId","isFirstPlayer","partnerReady"])):H("",!0),n.value==="rock-paper-scissors"?(d(),dt(Ko,{key:1,partnerId:o.partnerId,partnerReady:_.value,onBack:G,onError:q},null,8,["partnerId","partnerReady"])):H("",!0),n.value==="word-galaxy"?(d(),dt(pl,{key:2,partnerId:o.partnerId,partnerReady:_.value,onBack:G,onError:q},null,8,["partnerId","partnerReady"])):H("",!0)])):(d(),v("div",xl,[e("div",wl,[e("button",{class:V(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!o.isConnected}]),disabled:!o.isConnected,onClick:y[1]||(y[1]=b=>j("rock-paper-scissors"))},y[5]||(y[5]=[e("div",{class:"bg-yellow-500 text-white w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl"},"ðŸ‘Š",-1),e("div",{class:"text-white text-xs sm:text-sm font-medium"},"Rock Paper Scissors",-1),e("div",{class:"text-xs text-gray-400 hidden sm:block"},"vs Partner",-1)]),10,Cl),e("button",{class:V(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!o.isConnected}]),disabled:!o.isConnected,onClick:y[2]||(y[2]=b=>j("word-galaxy"))},y[6]||(y[6]=[e("div",{class:"bg-white text-gray-800 w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl"},"ðŸ’¬",-1),e("div",{class:"text-white text-xs sm:text-sm font-medium"},"Word Galaxy",-1),e("div",{class:"text-xs text-gray-400 hidden sm:block"},"Word Guessing Game",-1)]),10,kl),e("button",{class:V(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center hover:bg-[#3a3a52] transition-colors relative",{"opacity-50 cursor-not-allowed":!o.isConnected}]),disabled:!o.isConnected,onClick:y[3]||(y[3]=b=>j("tic-tac-toe"))},y[7]||(y[7]=[e("div",{class:"bg-red-600 text-white w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl"},"â­•",-1),e("div",{class:"text-white text-xs sm:text-sm font-medium"},"Tic-Tac-Toe",-1),e("div",{class:"text-xs text-gray-400 hidden sm:block"},"vs Partner",-1)]),10,Tl),e("button",{class:V(["bg-[#2e2e42] p-2 sm:p-4 rounded-lg flex flex-col items-center text-center relative",{"opacity-50 cursor-not-allowed":!0}]),disabled:""},y[8]||(y[8]=[ke('<div class="absolute inset-0 flex items-center justify-center bg-[#2e2e42]/80 rounded-lg" data-v-75f9e8fe><span class="bg-purple-500 text-white text-xs px-2 py-1 rounded-md font-medium" data-v-75f9e8fe>Coming Soon</span></div><div class="bg-purple-600 text-white w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center mb-2 sm:mb-3 text-base sm:text-xl" data-v-75f9e8fe>ðŸŽ²</div><div class="text-white text-xs sm:text-sm font-medium" data-v-75f9e8fe>Mystery Game</div><div class="text-xs text-gray-400 hidden sm:block" data-v-75f9e8fe>More Fun Ahead</div>',4)]))]),y[9]||(y[9]=e("p",{class:"text-center text-xs sm:text-sm text-gray-400 mt-2"}," Connect to play with others ",-1))]))])])):H("",!0)}});const Wl=Ie(Il,[["__scopeId","data-v-75f9e8fe"]]),El={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},Al={class:"bg-gray-900 rounded-lg w-full max-w-md mx-auto p-6"},Pl={class:"flex items-center justify-between mb-6"},jl={class:"grid grid-cols-3 gap-4 mb-6"},Ml=ye({__name:"donation-modal",props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(o,{emit:k}){const l=k,A=p(15),i=c=>{A.value=c},n=()=>{window.open(`https://www.paypal.com/paypalme/spacetalk/${A.value}`,"_blank"),l("close")};return(c,s)=>o.isOpen?(d(),v("div",El,[e("div",Al,[e("div",Pl,[s[4]||(s[4]=e("div",{class:"flex items-center gap-2"},[e("span",{class:"text-red-400 text-xl"},"â¤ï¸"),e("h2",{class:"text-lg font-semibold text-violet-400"},"Support SpaceTalk")],-1)),e("button",{onClick:s[0]||(s[0]=S=>c.$emit("close")),class:"text-gray-400 hover:text-white text-lg"}," âœ• ")]),s[8]||(s[8]=e("div",{class:"mb-6 text-center"},[e("p",{class:"text-gray-300"},"Keep SpaceTalk free for everyone")],-1)),e("div",jl,[e("button",{class:V(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",A.value===5?"ring-2 ring-emerald-500 scale-105":""]),onClick:s[1]||(s[1]=S=>i(5))},s[5]||(s[5]=[e("div",{class:"text-lg font-bold text-white"},"$5",-1),e("div",{class:"text-sm text-gray-400"},"Coffee",-1)]),2),e("button",{class:V(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",A.value===15?"ring-2 ring-emerald-500 scale-105":""]),onClick:s[2]||(s[2]=S=>i(15))},s[6]||(s[6]=[e("div",{class:"text-lg font-bold text-white"},"$15",-1),e("div",{class:"text-sm text-gray-400"},"Fuel",-1)]),2),e("button",{class:V(["bg-gray-800 hover:bg-gray-700 rounded-lg p-4 text-center transition-colors duration-200 transform",A.value===50?"ring-2 ring-emerald-500 scale-105":""]),onClick:s[3]||(s[3]=S=>i(50))},s[7]||(s[7]=[e("div",{class:"text-lg font-bold text-white"},"$50",-1),e("div",{class:"text-sm text-gray-400"},"Rocket",-1)]),2)]),s[9]||(s[9]=e("div",{class:"flex justify-center items-center gap-1 mb-6"},[e("span",{class:"text-yellow-400"},"â­"),e("span",{class:"text-sm text-gray-300"},"Boost development")],-1)),e("button",{class:"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-3 rounded-lg transition-colors mb-2 active:scale-95 transform duration-150",onClick:n}," Donate via PayPal "),s[10]||(s[10]=e("div",{class:"text-xs text-gray-500 text-center"}," Secure payments via PayPal ",-1))])])):H("",!0)}});const Ol={class:"fixed inset-0 overflow-hidden pointer-events-none"},Nl=ye({__name:"starfield",setup(o){const k=p([]);Re(()=>{l()});const l=()=>{const i=[];for(let n=0;n<50;n++)i.push({id:n,x:Math.random()*100,y:Math.random()*100,size:Math.random()*2+1,opacity:Math.random()*.7+.3,duration:Math.random()*8+2});k.value=i};return(A,i)=>(d(),v("div",Ol,[(d(!0),v(de,null,ve(k.value,n=>(d(),v("div",{key:n.id,class:"absolute rounded-full bg-white",style:Jt({width:`${n.size}px`,height:`${n.size}px`,top:`${n.y}%`,left:`${n.x}%`,opacity:n.opacity,boxShadow:`0 0 ${n.size*2}px rgba(255, 255, 255, ${n.opacity})`,animation:`twinkle ${n.duration}s infinite ease-in-out`})},null,4))),128))]))}});const Dl=Ie(Nl,[["__scopeId","data-v-f4bff5a3"]]),gt=!1,Fl=10,Gl=ye({__name:"AudioOutput",props:{showControls:{type:Boolean,default:!0}},setup(o){const{remoteStream:k,connectionState:l,partnerId:A,isAudioMuted:i}=pt(),n=p(null),c=p(.8),s=p(!1),S=p(0),_=ie(()=>(k.value!==null&&k.value?k.value.getAudioTracks().length>0:!1)&&k.value?k.value.getAudioTracks().some(x=>x.enabled):!1);ie(()=>k.value?k.value.getAudioTracks().filter(b=>b.enabled&&b.readyState==="live").length:0),ie(()=>s.value&&_.value?"connected":(l.value==="connected"&&!_.value&&!s.value&&setTimeout(q,500),l.value)),ce(()=>k.value,b=>{q(),S.value=0,setTimeout(g,500)}),ce(()=>i.value,b=>{!b&&k.value&&n.value&&setTimeout(()=>{n.value&&n.value.paused&&n.value.play().catch(F=>{})},300)}),ce(()=>l.value,b=>{b==="connected"?setTimeout(()=>{q(),g()},1e3):b==="new"||b==="connecting"?S.value=0:(b==="disconnected"||b==="failed")&&y()}),ce(()=>A.value,b=>{s.value=!1,S.value=0,b||n.value&&(n.value.srcObject=null)}),Re(()=>{q(),n.value&&(n.value.onplaying=()=>{s.value=!0},n.value.onpause=()=>{s.value=!1},n.value.onended=()=>{s.value=!1},n.value.onerror=b=>{console.error("[AudioOutput] Audio error:",b),s.value=!1},n.value.volume=c.value),document.addEventListener("visibilitychange",G),w()}),It(()=>{n.value&&(n.value.srcObject=null),document.removeEventListener("visibilitychange",G),j()});let m=null;function w(){j(),m=window.setInterval(()=>{!s.value&&_.value&&l.value==="connected"&&(q(),g())},5e3)}function j(){m&&(clearInterval(m),m=null)}function G(){document.visibilityState==="visible"&&(q(),setTimeout(()=>{!s.value&&_.value&&g()},500))}function q(){n.value&&(k.value?(n.value.srcObject=k.value,k.value.getAudioTracks().forEach(b=>{b.enabled=!0}),g()):(n.value.srcObject=null,s.value=!1))}async function g(){if(!(!n.value||!n.value.srcObject))try{const b=k.value&&k.value.getAudioTracks().length>0;await n.value.play(),s.value=!0,S.value=0}catch(b){if(console.error("[AudioOutput] Error playing audio:",b),s.value=!1,b instanceof DOMException&&b.name==="NotAllowedError"&&console.warn("[AudioOutput] Audio play was blocked by browser policy, user interaction needed"),S.value<Fl){S.value++;const F=S.value*1e3;setTimeout(g,F)}else console.warn("[AudioOutput] Max retry attempts reached, manual play required")}}function y(){S.value=0,n.value&&(n.value.srcObject=null),setTimeout(()=>{q(),g()},500)}return(b,F)=>(d(),v("div",null,[e("audio",{ref_key:"audioElement",ref:n,autoplay:"",playsinline:"",class:"hidden"},null,512),H("",!0)]))}});const Ll=Ie(Gl,[["__scopeId","data-v-f63dc209"]]),Bl={class:"min-h-screen font-sans"},zl={class:"relative min-h-screen z-10 text-white"},Ul={class:"p-2 sm:p-4 border-b border-white/10"},Yl={class:"max-w-4xl mx-auto"},Vl={class:"flex justify-center gap-2 mb-2 sm:mb-3"},ql={class:"bg-green-500/20 rounded-full px-2 py-1 text-xs flex items-center gap-1"},Hl={key:0,class:"bg-purple-500/20 rounded-full px-2 py-1 text-xs"},Jl={class:"grid grid-cols-2 gap-2 text-xs relative"},Kl={class:"flex items-center truncate"},Xl={key:0,class:"absolute top-full left-0 mt-1 w-full bg-gray-800/95 backdrop-blur-md border border-gray-700 rounded-xl shadow-xl z-20 overflow-hidden transition-all duration-200 animate-dropdown"},Zl={class:"py-1"},Ql=["onClick"],es={class:"text-sm"},ts={class:"flex-1 p-2 sm:p-4"},as={class:"max-w-md mx-auto space-y-4 sm:space-y-6"},os={class:"flex items-center justify-center gap-2 mb-2 sm:mb-4"},ns={class:"text-center"},ls={class:"text-xs text-gray-400 italic"},ss={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},rs={class:"bg-gray-800 rounded-2xl p-6 w-full max-w-sm"},is={class:"flex justify-between items-center mb-4"},cs={class:"space-y-3"},us={key:0,class:"text-center py-8"},ds={class:"flex items-center gap-3"},vs={class:"text-2xl"},gs={class:"text-white text-sm font-medium"},fs={class:"text-gray-400 text-xs"},ms={class:"text-xs text-gray-500"},ps={key:0,class:"text-xs text-gray-500 text-center mt-4"},bs={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-20 p-4"},ys={class:"bg-gray-800 rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto relative"},hs={class:"flex justify-between items-center mb-6"},xs={class:"space-y-6"},ws={class:"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide"},Cs={key:0,class:"text-xs text-gray-400 p-2"},ks={key:1,class:"flex flex-wrap gap-2"},Ts={class:"flag-icon"},_s=["onClick"],$s={class:"bg-gray-700 border border-gray-600 rounded-lg p-3 min-h-[60px] max-h-32 overflow-y-auto scrollbar-hide"},Rs={key:0,class:"text-xs text-gray-400 p-2"},Ss={key:1,class:"flex flex-wrap gap-2"},Is={class:"flag-icon"},Ws=["onClick"],Es={key:2,class:"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer preferred-outer"},As={class:"py-1 w-full"},Ps={key:0,class:"text-xs text-gray-400 px-3 py-2"},js=["onClick"],Ms={class:"flag-icon w-6 text-center"},Os={class:"text-sm"},Ns={key:3,class:"fixed z-50 max-h-64 bg-gray-700 border border-gray-600 rounded-lg shadow-lg overflow-y-auto scrollbar-hide dropdown-outer blocked-outer"},Ds={class:"py-1 w-full"},Fs={key:0,class:"text-xs text-gray-400 px-3 py-2"},Gs=["onClick"],Ls={class:"flag-icon w-6 text-center"},Bs={class:"text-sm"},zs={key:4,class:"hidden"},Us=ye({__name:"HomeView",setup(o){const k=p("disconnected"),l=p(null),A=p(null),i=p(""),n=p(!1);let c=null;const s=p(!1),S=p(!1),_=p(!1),m=p(!1),w=p(!1),j=p(0),G=p(0),q=p(!1),g=p([]),y=p([]),b=p("any"),F=p(!1),I=p([]),x=p([]);p(""),p("");const L=p(!1),Y=p(!1),D=[{value:"any",text:"Go With the Flow",emoji:"ðŸŒŸ"},{value:"chill",text:"Chill",emoji:"ðŸ˜Œ"},{value:"fun",text:"Fun",emoji:"ðŸŽ‰"},{value:"curious",text:"Curious",emoji:"ðŸ¤”"},{value:"creative",text:"Creative",emoji:"ðŸŽ¨"}],W=p([{value:"any",label:"ðŸŒ Any Country",name:"Any Country",flag:"ðŸŒ"},{value:"ae",label:"ðŸ‡¦ðŸ‡ª UAE",name:"United Arab Emirates",flag:"ðŸ‡¦ðŸ‡ª"},{value:"af",label:"ðŸ‡¦ðŸ‡« Afghanistan",name:"Afghanistan",flag:"ðŸ‡¦ðŸ‡«"},{value:"al",label:"ðŸ‡¦ðŸ‡± Albania",name:"Albania",flag:"ðŸ‡¦ðŸ‡±"},{value:"dz",label:"ðŸ‡©ðŸ‡¿ Algeria",name:"Algeria",flag:"ðŸ‡©ðŸ‡¿"},{value:"ar",label:"ðŸ‡¦ðŸ‡· Argentina",name:"Argentina",flag:"ðŸ‡¦ðŸ‡·"},{value:"au",label:"ðŸ‡¦ðŸ‡º Australia",name:"Australia",flag:"ðŸ‡¦ðŸ‡º"},{value:"at",label:"ðŸ‡¦ðŸ‡¹ Austria",name:"Austria",flag:"ðŸ‡¦ðŸ‡¹"},{value:"bh",label:"ðŸ‡§ðŸ‡­ Bahrain",name:"Bahrain",flag:"ðŸ‡§ðŸ‡­"},{value:"bd",label:"ðŸ‡§ðŸ‡© Bangladesh",name:"Bangladesh",flag:"ðŸ‡§ðŸ‡©"},{value:"be",label:"ðŸ‡§ðŸ‡ª Belgium",name:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{value:"br",label:"ðŸ‡§ðŸ‡· Brazil",name:"Brazil",flag:"ðŸ‡§ðŸ‡·"},{value:"ca",label:"ðŸ‡¨ðŸ‡¦ Canada",name:"Canada",flag:"ðŸ‡¨ðŸ‡¦"},{value:"cn",label:"ðŸ‡¨ðŸ‡³ China",name:"China",flag:"ðŸ‡¨ðŸ‡³"},{value:"dk",label:"ðŸ‡©ðŸ‡° Denmark",name:"Denmark",flag:"ðŸ‡©ðŸ‡°"},{value:"eg",label:"ðŸ‡ªðŸ‡¬ Egypt",name:"Egypt",flag:"ðŸ‡ªðŸ‡¬"},{value:"fi",label:"ðŸ‡«ðŸ‡® Finland",name:"Finland",flag:"ðŸ‡«ðŸ‡®"},{value:"fr",label:"ðŸ‡«ðŸ‡· France",name:"France",flag:"ðŸ‡«ðŸ‡·"},{value:"de",label:"ðŸ‡©ðŸ‡ª Germany",name:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{value:"gr",label:"ðŸ‡¬ðŸ‡· Greece",name:"Greece",flag:"ðŸ‡¬ðŸ‡·"},{value:"hk",label:"ðŸ‡­ðŸ‡° Hong Kong",name:"Hong Kong",flag:"ðŸ‡­ðŸ‡°"},{value:"hu",label:"ðŸ‡­ðŸ‡º Hungary",name:"Hungary",flag:"ðŸ‡­ðŸ‡º"},{value:"in",label:"ðŸ‡®ðŸ‡³ India",name:"India",flag:"ðŸ‡®ðŸ‡³"},{value:"id",label:"ðŸ‡®ðŸ‡© Indonesia",name:"Indonesia",flag:"ðŸ‡®ðŸ‡©"},{value:"ir",label:"ðŸ‡®ðŸ‡· Iran",name:"Iran",flag:"ðŸ‡®ðŸ‡·"},{value:"iq",label:"ðŸ‡®ðŸ‡¶ Iraq",name:"Iraq",flag:"ðŸ‡®ðŸ‡¶"},{value:"ie",label:"ðŸ‡®ðŸ‡ª Ireland",name:"Ireland",flag:"ðŸ‡®ðŸ‡ª"},{value:"it",label:"ðŸ‡®ðŸ‡¹ Italy",name:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{value:"jp",label:"ðŸ‡¯ðŸ‡µ Japan",name:"Japan",flag:"ðŸ‡¯ðŸ‡µ"},{value:"jo",label:"ðŸ‡¯ðŸ‡´ Jordan",name:"Jordan",flag:"ðŸ‡¯ðŸ‡´"},{value:"kz",label:"ðŸ‡°ðŸ‡¿ Kazakhstan",name:"Kazakhstan",flag:"ðŸ‡°ðŸ‡¿"},{value:"kr",label:"ðŸ‡°ðŸ‡· Korea",name:"South Korea",flag:"ðŸ‡°ðŸ‡·"},{value:"kw",label:"ðŸ‡°ðŸ‡¼ Kuwait",name:"Kuwait",flag:"ðŸ‡°ðŸ‡¼"},{value:"lb",label:"ðŸ‡±ðŸ‡§ Lebanon",name:"Lebanon",flag:"ðŸ‡±ðŸ‡§"},{value:"ly",label:"ðŸ‡±ðŸ‡¾ Libya",name:"Libya",flag:"ðŸ‡±ðŸ‡¾"},{value:"my",label:"ðŸ‡²ðŸ‡¾ Malaysia",name:"Malaysia",flag:"ðŸ‡²ðŸ‡¾"},{value:"mx",label:"ðŸ‡²ðŸ‡½ Mexico",name:"Mexico",flag:"ðŸ‡²ðŸ‡½"},{value:"ma",label:"ðŸ‡²ðŸ‡¦ Morocco",name:"Morocco",flag:"ðŸ‡²ðŸ‡¦"},{value:"nl",label:"ðŸ‡³ðŸ‡± Netherlands",name:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{value:"nz",label:"ðŸ‡³ðŸ‡¿ New Zealand",name:"New Zealand",flag:"ðŸ‡³ðŸ‡¿"},{value:"ng",label:"ðŸ‡³ðŸ‡¬ Nigeria",name:"Nigeria",flag:"ðŸ‡³ðŸ‡¬"},{value:"no",label:"ðŸ‡³ðŸ‡´ Norway",name:"Norway",flag:"ðŸ‡³ðŸ‡´"},{value:"om",label:"ðŸ‡´ðŸ‡² Oman",name:"Oman",flag:"ðŸ‡´ðŸ‡²"},{value:"pk",label:"ðŸ‡µðŸ‡° Pakistan",name:"Pakistan",flag:"ðŸ‡µðŸ‡°"},{value:"ps",label:"ðŸ‡µðŸ‡¸ Palestine",name:"Palestine",flag:"ðŸ‡µðŸ‡¸"},{value:"ph",label:"ðŸ‡µðŸ‡­ Philippines",name:"Philippines",flag:"ðŸ‡µðŸ‡­"},{value:"pl",label:"ðŸ‡µðŸ‡± Poland",name:"Poland",flag:"ðŸ‡µðŸ‡±"},{value:"pt",label:"ðŸ‡µðŸ‡¹ Portugal",name:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{value:"qa",label:"ðŸ‡¶ðŸ‡¦ Qatar",name:"Qatar",flag:"ðŸ‡¶ðŸ‡¦"},{value:"ro",label:"ðŸ‡·ðŸ‡´ Romania",name:"Romania",flag:"ðŸ‡·ðŸ‡´"},{value:"ru",label:"ðŸ‡·ðŸ‡º Russia",name:"Russia",flag:"ðŸ‡·ðŸ‡º"},{value:"sa",label:"ðŸ‡¸ðŸ‡¦ Saudi Arabia",name:"Saudi Arabia",flag:"ðŸ‡¸ðŸ‡¦"},{value:"sg",label:"ðŸ‡¸ðŸ‡¬ Singapore",name:"Singapore",flag:"ðŸ‡¸ðŸ‡¬"},{value:"za",label:"ðŸ‡¿ðŸ‡¦ South Africa",name:"South Africa",flag:"ðŸ‡¿ðŸ‡¦"},{value:"es",label:"ðŸ‡ªðŸ‡¸ Spain",name:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{value:"sd",label:"ðŸ‡¸ðŸ‡© Sudan",name:"Sudan",flag:"ðŸ‡¸ðŸ‡©"},{value:"se",label:"ðŸ‡¸ðŸ‡ª Sweden",name:"Sweden",flag:"ðŸ‡¸ðŸ‡ª"},{value:"ch",label:"ðŸ‡¨ðŸ‡­ Switzerland",name:"Switzerland",flag:"ðŸ‡¨ðŸ‡­"},{value:"sy",label:"ðŸ‡¸ðŸ‡¾ Syria",name:"Syria",flag:"ðŸ‡¸ðŸ‡¾"},{value:"tw",label:"ðŸ‡¹ðŸ‡¼ Taiwan",name:"Taiwan",flag:"ðŸ‡¹ðŸ‡¼"},{value:"th",label:"ðŸ‡¹ðŸ‡­ Thailand",name:"Thailand",flag:"ðŸ‡¹ðŸ‡­"},{value:"tn",label:"ðŸ‡¹ðŸ‡³ Tunisia",name:"Tunisia",flag:"ðŸ‡¹ðŸ‡³"},{value:"tr",label:"ðŸ‡¹ðŸ‡· Turkey",name:"Turkey",flag:"ðŸ‡¹ðŸ‡·"},{value:"ua",label:"ðŸ‡ºðŸ‡¦ Ukraine",name:"Ukraine",flag:"ðŸ‡ºðŸ‡¦"},{value:"gb",label:"ðŸ‡¬ðŸ‡§ UK",name:"United Kingdom",flag:"ðŸ‡¬ðŸ‡§"},{value:"us",label:"ðŸ‡ºðŸ‡¸ USA",name:"United States",flag:"ðŸ‡ºðŸ‡¸"},{value:"ye",label:"ðŸ‡¾ðŸ‡ª Yemen",name:"Yemen",flag:"ðŸ‡¾ðŸ‡ª"}]),X=async()=>{try{const r=await fetch("/api/countries");if(!r.ok)throw new Error("Failed to load countries");let u=await r.json();if(!u||u.length===0){console.log("Using static countries list");return}u=u.filter(we=>we.value!=="il"),u.some(we=>we.value==="ps")||u.push({value:"ps",label:"ðŸ‡µðŸ‡¸ Palestine",name:"Palestine",flag:"ðŸ‡µðŸ‡¸"}),u.some(we=>we.value==="eg")||u.push({value:"eg",label:"ðŸ‡ªðŸ‡¬ Egypt",name:"Egypt",flag:"ðŸ‡ªðŸ‡¬"}),u.sort((we,Ke)=>we.name.localeCompare(Ke.name)),W.value=[{value:"any",label:"ðŸŒ Any Country",name:"Any Country",flag:"ðŸŒ"},...u],console.log("Countries loaded:",W.value.length),console.log("Filtered out Israel and ensured Palestine and Egypt are included")}catch(r){console.error("Failed to load countries list:",r)}},fe=p(null),Z=["You're not alone in the universe.","Every voice carries a story from across the stars.","Connection transcends distance in the cosmic web.","Discover new worlds through conversation.","In space, every voice matters."],ee=p(Z[Math.floor(Math.random()*Z.length)]),t=Ae(),a=t.socket,{isConnected:T}=t,{remoteStream:$,localStream:C,connectionState:P,createOffer:me,handleOffer:he,handleAnswer:tt,handleIceCandidate:at,closeConnection:Pe,toggleMicrophone:ot,initializeLocalStream:Ve}=pt(),nt=ga(),Te=Xt(),Le=p(Te.params.roomId||null);ce(()=>Le.value,r=>{r&&(S.value=!0)},{immediate:!0});const qe=ie(()=>W.value.filter(r=>r.value!=="any"&&!I.value.includes(r.value)&&!x.value.includes(r.value))),He=ie(()=>W.value.filter(r=>r.value!=="any"&&!x.value.includes(r.value)&&!I.value.includes(r.value))),je=async()=>{const r=await ot();n.value!==!r&&(n.value=!r),k.value==="connected"&&setTimeout(()=>{const u=document.querySelector("audio");u&&u.paused&&u.play().catch(()=>{})},300)},Be=async()=>{if(!C.value)try{await Ve(),console.log("Microphone initialized")}catch(r){console.error("Failed to access microphone",r),alert("Please allow microphone access to use voice chat");return}a.value&&(k.value="searching",l.value&&(console.log("Disconnecting from current partner"),a.value.emit("disconnect-partner"),l.value=null,A.value=null,g.value=[],Pe()),console.log("Finding new partner with preferences"),a.value.emit("join-queue",{vibe:b.value,preferences:{preferredCountries:I.value.length?I.value:void 0,blockedCountries:x.value.length?x.value:void 0}}),G.value++)},lt=()=>{s.value=!s.value,s.value&&l.value&&nt.markAsRead(l.value)},st=r=>{a.value&&l.value&&(a.value.emit("chat-message",{message:r,to:l.value}),g.value.push({id:Date.now().toString(),message:r,isOwn:!0,timestamp:Date.now()}))},O=r=>{console.log(`Selected game: ${r}`),a.value&&l.value&&a.value.emit("game-invite",{game:r,to:l.value})},f=r=>{r&&!I.value.includes(r)&&I.value.push(r)},z=r=>{I.value=I.value.filter(u=>u!==r)},K=r=>{if(r&&!x.value.includes(r)){x.value.push(r);const u=N(r);console.log(`Added ${u} (${r}) to blocked countries list`),localStorage.setItem("blockedCountries",JSON.stringify(x.value))}},te=r=>{x.value=x.value.filter(E=>E!==r);const u=N(r);console.log(`Removed ${u} (${r}) from blocked countries list`),localStorage.setItem("blockedCountries",JSON.stringify(x.value))},xe=()=>{I.value=[],x.value=[],localStorage.removeItem("preferredCountries"),localStorage.removeItem("blockedCountries")},pe=()=>{console.log("Applying filters with the following settings:"),console.log("- Blocked countries:",x.value.length?x.value:"None"),console.log("- Preferred countries:",I.value.length?I.value:"None"),w.value=!1,ht(),Ft()},Q=r=>{const u=W.value.find(E=>E.value===r);return u?u.flag:"ðŸ³ï¸"},N=r=>{const u=W.value.find(E=>E.value===r);return u?u.name:"Earth"},ue=r=>new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Je=()=>{F.value=!F.value},Mt=r=>{b.value=r,F.value=!1},Ot=r=>{const u=D.find(E=>E.value===r);return u?u.emoji:"ðŸŒŸ"},Nt=r=>{const u=D.find(E=>E.value===r);return u?u.text:"Go With the Flow"},rt=p(null),it=p(null),Me=()=>{St(()=>{var we,Ke;const r=(we=rt.value)==null?void 0:we.getBoundingClientRect(),u=(Ke=it.value)==null?void 0:Ke.getBoundingClientRect(),E=document.querySelector(".preferred-outer"),se=document.querySelector(".blocked-outer");r&&E&&(E.style.left=`${r.left}px`,E.style.top=`${r.bottom+5}px`,E.style.width=`${r.width}px`),u&&se&&(se.style.left=`${u.left}px`,se.style.top=`${u.bottom+5}px`,se.style.width=`${u.width}px`)})},bt=()=>{L.value=!L.value,L.value&&(Y.value=!1,Me())},yt=()=>{Y.value=!Y.value,Y.value&&(L.value=!1,Me())},ht=()=>{localStorage.setItem("preferredCountries",JSON.stringify(I.value)),localStorage.setItem("blockedCountries",JSON.stringify(x.value))},Dt=()=>{try{const r=localStorage.getItem("preferredCountries"),u=localStorage.getItem("blockedCountries");r&&(I.value=JSON.parse(r)),u&&(x.value=JSON.parse(u))}catch(r){console.error("Error loading filter settings:",r)}},Ft=()=>{a.value&&T.value?(console.log("Restarting matching with updated filters:",{preferredCountries:I.value,blockedCountries:x.value}),a.value.emit("startMatching",{preferredCountries:I.value.length>0?I.value:null,blockedCountries:x.value}),k.value="searching",i.value=""):console.warn("Cannot restart matching - socket not connected")};ce(k,r=>{console.log(`Connection status changed to: ${r}`),r==="connected"?(c&&clearInterval(c),c=setInterval(()=>{l.value&&P.value!=="connected"&&(console.log("Connection health check: WebRTC not connected but partnerId exists"),["failed","closed","disconnected"].includes(P.value)&&(console.log("Connection appears to be broken - resetting UI state"),k.value="disconnected",l.value=null,A.value=null))},2e3)):r==="disconnected"&&c&&(clearInterval(c),c=null)}),Re(()=>{console.log("Home view mounted"),X();try{const r=localStorage.getItem("preferredCountries"),u=localStorage.getItem("blockedCountries");r&&(I.value=JSON.parse(r)),u&&(x.value=JSON.parse(u))}catch(r){console.error("Error loading saved preferences:",r)}a.value&&(a.value.on("filters-updated",r=>{r.success&&console.log("Filters updated successfully on server")}),a.value.on("user-location",r=>{console.log("Received user location:",r),r&&r.countryCode&&r.country?(fe.value=r,I.value.length===0&&r.countryCode!=="unknown"&&r.countryCode!=="earth"&&(console.log(`Adding user's country ${r.country} (${r.countryCode}) to preferred countries`),I.value.push(r.countryCode),ht()),console.log(`Your location: ${r.flag} ${r.country}`)):console.warn("Received incomplete location data:",r)}),a.value.on("online-count",r=>{j.value=r}),a.value.on("matched",r=>{if(console.log("Partner matched with event:",r),k.value="matched",i.value="",l.value=r.partnerId,A.value={id:r.partnerId,country:r.country||"Earth",countryCode:r.countryCode||"unknown",flag:r.flag||"ðŸŒ",vibe:r.vibe||"any"},y.value.unshift({id:Date.now().toString(),country:A.value.country,flag:A.value.flag,timestamp:Date.now()}),y.value.length>3&&(y.value=y.value.slice(0,3)),r.partnerId){console.log("Initiating WebRTC connection with partner immediately");const{createOffer:u}=pt();u(r.partnerId),setTimeout(()=>{k.value==="matched"&&P.value==="connected"&&(console.log("WebRTC connection established, updating UI state"),k.value="connected")},2e3)}}),a.value.on("direct-connection-established",r=>{console.log("Direct connection established:",r),k.value="connected",l.value=r.partnerId,A.value={id:r.partnerId,country:r.country||"Earth",countryCode:r.countryCode||"unknown",flag:r.flag||"ðŸŒ"}}),a.value.on("partner-disconnected",(r={})=>{console.log("Partner disconnected event received:",r),Pe(),k.value="disconnected",l.value=null,A.value=null,g.value=[];let u="";if(r&&r.reason){switch(r.reason){case"user-initiated":u="Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± Ø£Ù†Ù‡Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©";break;case"connection-lost":u="Ø§Ù†Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±";break;default:u="Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©"}i.value=u,setTimeout(()=>{i.value===u&&(i.value="")},5e3)}q.value&&setTimeout(()=>{k.value==="disconnected"&&q.value&&Be()},2e3)}),a.value.on("chat-message",r=>{g.value.push({id:Date.now().toString(),message:r.message,isOwn:!1,timestamp:Date.now()})}),a.value.on("error",r=>{console.error("Socket error:",r.message),r.type==="matching"&&(k.value="disconnected")}),a.value.on("voice-offer",Gt),a.value.on("voice-answer",Lt),a.value.on("ice-candidate",Bt),a.value.emit("get-online-count")),document.addEventListener("click",xt),window.addEventListener("resize",Me),document.addEventListener("scroll",Me,!0),Dt()}),It(()=>{console.log("Home view unmounting, cleaning up connection"),Pe(),c&&(clearInterval(c),c=null),a.value&&(a.value.off("online-count"),a.value.off("matched"),a.value.off("direct-connection-established"),a.value.off("partner-disconnected"),a.value.off("chat-message"),a.value.off("error"),a.value.off("voice-offer"),a.value.off("voice-answer"),a.value.off("ice-candidate")),document.removeEventListener("click",xt),window.removeEventListener("resize",Me),document.removeEventListener("scroll",Me,!0)});const Gt=async r=>{console.log("Received voice offer - forwarding to WebRTC service"),he(r.offer,r.from)},Lt=async r=>{console.log("Received voice answer - forwarding to WebRTC service"),tt(r.answer)},Bt=async r=>{console.log("Received ICE candidate - forwarding to WebRTC service"),at(r.candidate)};ce(P,(r,u)=>{console.log(`[HomeView] WebRTC connection state changed: ${u} -> ${r}`),r==="connected"&&k.value==="matched"?setTimeout(()=>{P.value==="connected"&&k.value==="matched"&&(k.value="connected",i.value="",console.log("[HomeView] Successfully transitioned from matched to connected"))},1e3):r==="failed"?(i.value="",setTimeout(()=>{P.value==="failed"&&(k.value==="matched"||k.value==="connected")&&(i.value='Connection failed. Press "Next" to find a new partner.')},6e4)):r==="disconnected"&&(k.value==="connected"||k.value==="matched")&&(i.value="",setTimeout(()=>{P.value==="disconnected"&&(k.value==="connected"||k.value==="matched")&&(i.value="Connection lost. Trying to reconnect...")},6e4))});const ct=p(null),xt=r=>{const u=r.target;if(ct.value&&!ct.value.contains(u)&&(F.value=!1),L.value){const E=rt.value,se=document.querySelector(".preferred-outer");E&&se&&!E.contains(u)&&!se.contains(u)&&(L.value=!1)}if(Y.value){const E=it.value,se=document.querySelector(".blocked-outer");E&&se&&!E.contains(u)&&!se.contains(u)&&(Y.value=!1)}};return(r,u)=>(d(),v("div",Bl,[u[23]||(u[23]=ke('<div class="fixed inset-0 pointer-events-none" data-v-716fd95e><div class="absolute top-1/4 left-1/4 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl animate-pulse" data-v-716fd95e></div><div class="absolute top-1/3 right-1/3 w-24 h-24 bg-violet-500/20 rounded-full blur-2xl animate-pulse delay-1000" data-v-716fd95e></div><div class="absolute bottom-1/4 left-1/3 w-28 h-28 bg-indigo-500/20 rounded-full blur-3xl animate-pulse delay-2000" data-v-716fd95e></div><div class="absolute top-1/2 right-1/4 w-20 h-20 bg-fuchsia-500/20 rounded-full blur-2xl animate-pulse delay-500" data-v-716fd95e></div></div>',1)),$e(Dl),e("div",zl,[e("header",Ul,[e("div",Yl,[u[11]||(u[11]=ke('<div class="text-center mb-2 sm:mb-4" data-v-716fd95e><div class="inline-flex items-center gap-2" data-v-716fd95e><div class="w-6 h-6 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full flex items-center justify-center shadow-lg shadow-cyan-500/50" data-v-716fd95e><span class="text-white text-xs" data-v-716fd95e>âœ¨</span></div><h1 class="text-lg font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent drop-shadow-lg" data-v-716fd95e> SpaceTalk.live </h1></div></div>',1)),e("div",Vl,[e("div",ql,[u[10]||(u[10]=e("div",{class:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"},null,-1)),e("span",null,R(j.value)+" online",1)]),G.value>0?(d(),v("div",Hl," Today: "+R(G.value)+" voices ",1)):H("",!0)]),e("div",Jl,[e("div",{class:"relative",ref_key:"vibeDropdownRef",ref:ct},[e("div",{onClick:Je,class:"cursor-pointer bg-purple-500/20 border border-purple-500/30 rounded-full h-8 flex items-center justify-between px-3 text-xs shadow-lg shadow-purple-500/20 text-white hover:bg-purple-500/30 active:scale-95 transition-all duration-150"},[e("span",Kl,R(Ot(b.value))+" "+R(Nt(b.value)),1),e("span",{class:V(["ml-2 text-xs transition-transform duration-300",{"rotate-180":F.value}])},"â–¼",2)]),F.value?(d(),v("div",Xl,[e("div",Zl,[(d(),v(de,null,ve(D,E=>e("div",{key:E.value,onClick:se=>Mt(E.value),class:V(["px-3 py-2 hover:bg-gray-700/80 cursor-pointer transition-colors flex items-center gap-2",{"bg-gray-700/70":b.value===E.value}])},[e("span",es,R(E.emoji),1),e("span",null,R(E.text),1)],10,Ql)),64))])])):H("",!0)],512),e("button",{onClick:u[0]||(u[0]=E=>w.value=!0),class:"bg-violet-500/20 border border-violet-500/30 rounded-full h-8 px-3 text-xs hover:bg-violet-500/30 active:scale-95 transition-all duration-150 shadow-lg shadow-violet-500/20"}," ðŸ” Filters ")])])]),e("main",ts,[e("div",as,[$e(Aa,{status:k.value,"partner-info":A.value,"error-message":i.value,"show-status":!0},null,8,["status","partner-info","error-message"]),e("div",os,[et(e("input",{type:"checkbox",id:"auto-reconnect","onUpdate:modelValue":u[1]||(u[1]=E=>q.value=E),class:"w-3 h-3 rounded border-gray-600 bg-gray-700 text-emerald-500 focus:ring-emerald-500 focus:ring-1"},null,512),[[Kt,q.value]]),u[12]||(u[12]=e("label",{for:"auto-reconnect",class:"text-xs text-gray-400 cursor-pointer"}," Auto-reconnect to others ",-1))]),$e(Ba,{"is-muted":n.value,"is-disabled":k.value!=="connected",onToggleMute:je,onFindNext:Be,onToggleChat:lt,onToggleGames:u[2]||(u[2]=E=>S.value=!0),onToggleHistory:u[3]||(u[3]=E=>m.value=!0),onToggleDonation:u[4]||(u[4]=E=>_.value=!0)},null,8,["is-muted","is-disabled"]),e("div",ns,[e("p",ls,'"'+R(ee.value)+'"',1)])])]),u[13]||(u[13]=ke('<footer class="p-2 sm:p-4 border-t border-white/10" data-v-716fd95e><div class="max-w-md mx-auto text-center space-y-1 sm:space-y-2" data-v-716fd95e><h3 class="text-sm font-semibold text-emerald-400" data-v-716fd95e>Community Guidelines</h3><div class="text-xs text-gray-300 space-y-0.5 sm:space-y-1" data-v-716fd95e><p data-v-716fd95e>â€¢ Must be 18+ years old to use this service</p><p data-v-716fd95e>â€¢ Be respectful and kind to other users</p><p data-v-716fd95e>â€¢ No harassment, hate speech, or inappropriate content</p><p data-v-716fd95e>â€¢ Report any misconduct using the report feature</p><p data-v-716fd95e>â€¢ Your privacy and safety are our priority</p></div><p class="text-xs text-gray-400 mt-2 sm:mt-3" data-v-716fd95e> By using SpaceTalk.live, you agree to follow these guidelines </p><div class="flex flex-wrap justify-center gap-2 sm:gap-3 mt-2 sm:mt-4 text-xs" data-v-716fd95e><a href="#" class="bg-cyan-500/20 border border-cyan-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-cyan-300 hover:text-cyan-200 hover:bg-cyan-500/30 transition-all shadow-lg shadow-cyan-500/20" data-v-716fd95e> â„¹ï¸ About </a><a href="https://instagram.com" target="_blank" class="bg-pink-500/20 border border-pink-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-pink-300 hover:text-pink-200 hover:bg-pink-500/30 transition-all shadow-lg shadow-pink-500/20" data-v-716fd95e> ðŸ“· Instagram </a><a href="https://facebook.com" target="_blank" class="bg-blue-500/20 border border-blue-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-blue-300 hover:text-blue-200 hover:bg-blue-500/30 transition-all shadow-lg shadow-blue-500/20" data-v-716fd95e> ðŸ“˜ Facebook </a><a href="mailto:contact@spacetalk.live" class="bg-emerald-500/20 border border-emerald-500/30 rounded-full px-2 py-1 sm:px-3 sm:py-1.5 text-emerald-300 hover:text-emerald-200 hover:bg-emerald-500/30 transition-all shadow-lg shadow-emerald-500/20" data-v-716fd95e> ðŸ“§ Contact </a></div></div></footer>',1))]),m.value?(d(),v("div",ss,[e("div",rs,[e("div",is,[u[14]||(u[14]=e("h2",{class:"text-lg font-semibold text-indigo-400"},"ðŸ“ž Call History",-1)),e("button",{onClick:u[5]||(u[5]=E=>m.value=!1),class:"text-gray-400 hover:text-white text-xl"}," âœ• ")]),e("div",cs,[y.value.length===0?(d(),v("div",us,u[15]||(u[15]=[e("p",{class:"text-gray-400 text-sm"},"No recent calls",-1),e("p",{class:"text-xs text-gray-500 mt-1"},"Your last 3 conversations will appear here",-1)]))):(d(!0),v(de,{key:1},ve(y.value,(E,se)=>(d(),v("div",{key:E.id,class:"bg-gray-700 rounded-lg p-3 flex items-center justify-between hover:bg-gray-600 transition-colors"},[e("div",ds,[e("span",vs,R(E.flag),1),e("div",null,[e("p",gs,R(E.country),1),e("p",fs,R(ue(E.timestamp)),1)])]),e("div",ms," #"+R(se+1),1)]))),128))]),y.value.length>0?(d(),v("p",ps," History clears when you leave the page ")):H("",!0)])])):H("",!0),w.value?(d(),v("div",bs,[e("div",ys,[e("div",hs,[u[16]||(u[16]=e("h2",{class:"text-lg font-semibold text-emerald-400"},"Filters & Preferences",-1)),e("button",{onClick:u[6]||(u[6]=E=>w.value=!1),class:"text-gray-400 hover:text-white text-xl"}," âœ• ")]),e("div",xs,[e("div",null,[u[18]||(u[18]=e("label",{class:"block text-sm font-medium mb-3 text-emerald-400"},"Preferred Countries",-1)),e("div",ws,[I.value.length===0?(d(),v("p",Cs,"No countries selected")):(d(),v("div",ks,[(d(!0),v(de,null,ve(I.value,E=>(d(),v("span",{key:E,class:"bg-emerald-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1"},[e("span",Ts,R(Q(E)),1),ge(" "+R(N(E))+" ",1),e("button",{onClick:se=>z(E),class:"text-emerald-200 hover:text-white ml-1"}," âœ• ",8,_s)]))),128))]))]),e("div",{class:"mt-2 relative preferred-dropdown",ref_key:"preferredDropdownRef",ref:rt},[e("div",{onClick:bt,class:"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white"},u[17]||(u[17]=[e("span",{class:"text-gray-300"},"Add preferred country...",-1),e("span",{class:"ml-1"},"â–¼",-1)]))],512),u[19]||(u[19]=e("p",{class:"text-xs text-gray-400 mt-2"},"You'll be matched only with users from these countries",-1))]),e("div",null,[u[21]||(u[21]=e("label",{class:"block text-sm font-medium mb-3 text-red-400"},"Blocked Countries",-1)),e("div",$s,[x.value.length===0?(d(),v("p",Rs,"No countries blocked")):(d(),v("div",Ss,[(d(!0),v(de,null,ve(x.value,E=>(d(),v("span",{key:E,class:"bg-red-600 text-white px-2 py-1 rounded text-xs flex items-center gap-1"},[e("span",Is,R(Q(E)),1),ge(" "+R(N(E))+" ",1),e("button",{onClick:se=>te(E),class:"text-red-200 hover:text-white ml-1"}," âœ• ",8,Ws)]))),128))]))]),e("div",{class:"mt-2 relative blocked-dropdown",ref_key:"blockedDropdownRef",ref:it},[e("div",{onClick:yt,class:"cursor-pointer flex items-center justify-between w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white"},u[20]||(u[20]=[e("span",{class:"text-gray-300"},"Add blocked country...",-1),e("span",{class:"ml-1"},"â–¼",-1)]))],512),u[22]||(u[22]=e("p",{class:"text-xs text-gray-400 mt-2"},"You won't be matched with users from these countries",-1))])]),e("div",{class:"flex gap-2 mt-8"},[e("button",{onClick:xe,class:"flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg text-sm transition-colors"}," Clear All "),e("button",{onClick:pe,class:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-lg text-sm transition-colors"}," Apply Filters ")])])])):H("",!0),L.value?(d(),v("div",Es,[e("div",As,[qe.value.length===0?(d(),v("div",Ps,"No more countries available")):H("",!0),(d(!0),v(de,null,ve(qe.value,E=>(d(),v("div",{key:E.value,onClick:()=>{f(E.value),bt()},class:"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2"},[e("span",Ms,R(E.flag),1),e("span",Os,R(E.name),1)],8,js))),128))])])):H("",!0),Y.value?(d(),v("div",Ns,[e("div",Ds,[He.value.length===0?(d(),v("div",Fs,"No more countries available")):H("",!0),(d(!0),v(de,null,ve(He.value,E=>(d(),v("div",{key:E.value,onClick:()=>{K(E.value),yt()},class:"cursor-pointer px-3 py-2 hover:bg-gray-600 flex items-center gap-2"},[e("span",Ls,R(E.flag),1),e("span",Bs,R(E.name),1)],8,Gs))),128))])])):H("",!0),$e(eo,{"is-open":s.value,onClose:u[7]||(u[7]=E=>s.value=!1),messages:g.value,onSendMessage:st,"is-connected":k.value==="connected"},null,8,["is-open","messages","is-connected"]),$e(Wl,{"is-open":S.value,onClose:u[8]||(u[8]=E=>S.value=!1),"is-connected":k.value==="connected",onSelectGame:O,"partner-id":l.value||"","initial-game-room-id":Le.value},null,8,["is-open","is-connected","partner-id","initial-game-room-id"]),$e(Ml,{"is-open":_.value,onClose:u[9]||(u[9]=E=>_.value=!1)},null,8,["is-open"]),k.value==="connected"?(d(),v("div",zs,[$e(Ll,{showControls:!1})])):H("",!0)]))}});const Rt=Ie(Us,[["__scopeId","data-v-716fd95e"]]),Ys=Zt({history:Qt("/"),routes:[{path:"/",name:"home",component:Rt},{path:"/game/:roomId",name:"game",component:Rt,props:!0}]}),jt=ea(oa);jt.use(Ys);jt.mount("#app");
//# sourceMappingURL=index-bb14f82c.js.map
